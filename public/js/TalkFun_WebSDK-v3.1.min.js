var MT=function(r){var i={};function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=r,n.c=i,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=41)}([function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,i){"use strict";var r,a=i(0)(i(4));void 0===(r=function(e){var t=i(26),n=i(27),r=i(45);return{getTime:function(){function e(e){e=new String(e);for(var t=0,r="";t<2-e.length;t++)r+="0";return r+e}var t=new Date;return e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+e(t.getMilliseconds())},crc32:function(e,t){void 0===t&&(t=0);var r=0;t^=-1;for(var i=0,n=e.length;i<n;i++)r=255&(t^e.charCodeAt(i)),t=t>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*r,8);return-1^t},timestamp:function(e){var t=(new Date).getTime();return e||(t=Math.round(t/1e3)),t},second2HMS:function(e){e=parseInt(e);var t=Math.floor(e/3600),r=Math.floor(e%3600/60),i=Math.floor(e%3600%60);function n(e){return 0<e?10<=e?e:"0"+e:"00"}return n(t)+":"+n(r)+":"+n(i)},detectProtocol:function(e){return e.replace(/http:\/\//gi,window.location.protocol+"//")},replaceDom:function(e,t){if(e&&t){var r=e,i=t,n=r.parentNode,a=i.parentNode;n.replaceChild(i,r),a.prepend(r)}else this.warn("Dom A/B must be defined!")},deepClone:function(e){var t=Array.isArray(e)?[]:{};if(e&&"object"===(0,a.default)(e))for(var r in e)e.hasOwnProperty(r)&&(e[r]&&"object"===(0,a.default)(e[r])?t[r]=this.deepClone(e[r]):t[r]=e[r]);return t},setRoom:function(e){this.room=e},getRoom:function(){return this.room?this.room:null},_typeof:function(e){return Object.prototype.toString.call(e).replace(/object /,"").replace(/^\[|\]$/g,"").toLowerCase()},getStaticHost:function(e){return window.TF_getStaticHost?window.TF_getStaticHost(e):e},assignObject:function(e,t){var r={};for(var i in e)r[i]=e[i];for(var i in t)r[i]=t[i];return r},sortObjByKey:function(e,r){return e.sort(function(e,t){return e=e[r],t=t[r],"string"==("string"==typeof e||"string"==typeof t?"string":"number")?e.localeCompare(t):e-t})},getSDKMode:function(){var e=window.location.href.match(/sdkmode=[0-9]/gi),t=0;if(e&&0<e.length){var r=e.length-1;t=parseInt(e[r].replace("sdkmode=",""),10)}return t},isInNative:function(){return!(!this.isMobileSDK()||2!==this.getSDKMode())},qtWebEngine:function(r){var i=this;if(!this.isCloudLiveBrowser())return!1;try{new n.QWebChannel(qt.webChannelTransport,function(e){i.debug("QtWebEngine start success!");var t=e.objects.interactObj;r&&r(t)})}catch(e){this.debug("qtweb on error => ",e)}},htmlLog:function(e){if(!e)return!1;var t=document.createElement("p");if(!document.querySelector("#talkfun_frontend_ht_logs")){var r=document.createElement("div");r.id="talkfun_frontend_ht_logs",r.style.height="auto",r.style.overflow="auto",r.style.position="fixed",r.style["-webkit-overflow-scrolling"]="touch",r.style.left="0",r.style.top="20%",r.style.bottom="0",r.style.zIndex="99999999",r.innerHTML="<p>start...</p>",document.querySelector("body").appendChild(r)}try{var i=JSON.stringify(Array.prototype.slice.call(e));i=i.replace(/^\[/,"").replace(/\]$/,""),t.innerHTML=i}catch(e){t.innerHTML="LOG_ERROR ==> "+e.message}t.style.backgroundColor="#000000",t.style.color="#58FF19",t.style.marginTop="5px",t.style.padding="2%",t.style.width="96%",t.style.wordBreak="break-all";window.document.body;document.getElementById("talkfun_frontend_ht_logs").insertBefore(t,document.querySelector("#talkfun_frontend_ht_logs p"))},isShowDebug:function(){return-1<window.location.href.indexOf("debug=list")},flashDebugPath:function(e){if(-1<window.location.href.indexOf("swf=v1")){var t="static/swf/debug/small_v1/";return/static\/swf\/debug\//.test(e)?e.replace(/static\/swf\/debug\//,t).replace(/level[\d]\//,""):e.replace(/static\/swf\//,t).replace(/level[\d]\//,"")}return e},isShowHtmlLog:function(){return-1<window.location.href.indexOf("htmllog=true")},debugTimeStart:function(e){console&&console.time&&console.time(e)},debugTimeEnd:function(e){console&&console.timeEnd&&console.timeEnd(e)},disableConsole:function(){},argumentToArray:function(e){return Array.prototype.slice.call(e)},warn:function(){if(console&&console.warn){var e=Array.prototype.slice.call(arguments);e.unshift("[TalkFun WARN message]"),console.warn.apply(console,e)}},error:function(){if(console&&console.error){var e=Array.prototype.slice.call(arguments);e.unshift("[TalkFun ERROR message]"),console.error.apply(console,e)}},debug:function(){var e=this.isShowDebug();if("undefined"!=typeof console&&e){var t=Array.prototype.slice.call(arguments);t.unshift("[TalkFun LOG message]"),console.log.apply(console,t),this.isShowHtmlLog()&&this.htmlLog(t)}},getFlash:function(t){if(-1==navigator.appName.indexOf("Microsoft"))return document[t];try{return document[t]}catch(e){return window[t]}},flashChecker:function(){var e=!1,t={},r=-1;if(document.all){try{var i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}i&&(e=!0,t=i.GetVariable("$version"),r=parseInt(t.split(" ")[1].split(",")[0]))}else{if(navigator.plugins&&0<navigator.plugins.length)if(i=navigator.plugins["Shockwave Flash"]){e=!0;for(var n=i.description.split(" "),a=0;a<n.length;++a)isNaN(parseInt(n[a]))||(r=parseInt(n[a]))}}return{flash:e,version:r}},in_array:function(e,t,r){for(var i=0;i<t.length;i++)if(e==t[i])return!r||{key:i,item:t[i]};return!1},find:function(e,t){return!!this.in_array(e,t)&&this.in_array(e,t,!0)},without:function(e,t){for(var r=e.length,i=0;i<r;i++)e[i]===t&&e.splice(i,1);return e},getPlatformInfo:function(){var e=navigator.userAgent.toLowerCase(),t=null,r=-1,i=e.match(/iphone|ipad|ipod/gi)||!1,n=e.match(/android/gi)||!1;return i?(t="ios",r=e.match(/os\s([0-9_0-9]*)/)[1].replace("_",".")):n&&(t="android",r=e.match(/android\s([0-9\.]*)/)[1]),{partform:t,version:parseFloat(r)}},closeSet:function(e,t){if(e&&0===e.length)return null;t=Math.abs(t);var r=e,i=r.length;if(void 0!==r[0].st){for(var n=[],a=0;a<i;a++)n.push(r[a].st);r=n}for(a=0;a<i;a++){if(r[a]===t)return e[a];if(r[a]>t)return e[a-1];if(t>r[r.length-1])return e[r.length-1]}},isCompatible:function(){return-1<window.location.href.indexOf("compatible=true")},isIE:function(){var e=navigator.userAgent.toLowerCase(),t=!1;return(-1<e.indexOf("msie")||-1<e.indexOf(".net"))&&(t=!0),t},platform:function(){var e=navigator.userAgent.toLowerCase();return-1<e.indexOf("macintosh")?"MacOS":-1<e.indexOf("iphone")||-1<e.indexOf("ipad")||-1<e.indexOf("ios-sdk")?"IOS":-1<e.indexOf("android")||-1<e.indexOf("android-sdk")?"Android":-1<e.indexOf("linux")?"Linux":-1<e.indexOf("windows")?"Windows":"Unknow"},isQQMobile:function(){var e=navigator.userAgent.toLowerCase();return-1<e.indexOf("qqbrowser")||-1<e.indexOf("qq")},isUCMobile:function(){return-1<navigator.userAgent.toLowerCase().indexOf("ucbrowser")},isSafari:function(){return-1<navigator.userAgent.toLowerCase().indexOf("safari")},touchSupport:function(){return"ontouchstart"in window},isWechat:function(){return-1<navigator.userAgent.indexOf("MicroMessenger")},isMobile:function(){this.platform();return!0},isMobileSDK:function(){var e=navigator.userAgent.toLowerCase();return-1<e.indexOf("ios-sdk")||-1<e.indexOf("android-sdk")},isTalkFunBrowser:function(){return-1<navigator.userAgent.toLowerCase().indexOf("talkfun-browser")},isCloudLiveBrowser:function(){return!!this.userAgent("TALK_FUN_2.0")},userAgent:function(e){var t=navigator.userAgent.toLowerCase();return e=e.toLowerCase(),-1<t.indexOf(e)},isIphone:function(){return-1<navigator.userAgent.toLowerCase().indexOf("iphone")},isIpad:function(){return-1<navigator.userAgent.toLowerCase().indexOf("ipad")},isAndroid:function(){return"android"===this.getPlatformInfo().partform},isIos:function(){return"ios"===this.getPlatformInfo().partform},insertPosition:function(e,t){var r=e,i=t;if(r.focus(),document.selection)r.focus(),sel=document.selection.createRange(),sel.text=i,sel.select();else if(r.selectionStart||"0"==r.selectionStart){var n=r.selectionStart,a=r.selectionEnd,o=r.scrollTop;r.value=r.value.substring(0,n)+i+r.value.substring(a,r.value.length),0<o&&(r.scrollTop=o),r.focus(),r.selectionStart=n+i.length,r.selectionEnd=n+i.length}else r.value+=i,r.focus()},ubb2img:function(e,t){var r=e,i=t;return i=i.replace(/\[.+?\]/g,function(e){return void 0!==r[e]?'<img src="'+r[e]+'"/>':e})},formatTime:function(e){var t=parseInt(e/60);return 0===t&&(t=1),t},urlHashMap:function(){var e=window.location.hash.substring(1),t=[];if(e){var r=e.split("&");for(var i in r){var n=r[i].split("=");t[n[0]]=n[1]?n[1]:""}}return t},callback:function(e,t){"function"==typeof e&&(void 0!==t?e(t):e())},bindEvent:function(e,t,r){if(3===arguments.length)if(void 0!==window.addEventListener)for(var i=e||e,n=(t=t||arguments[1],r||r),a=0;a<n.length;a++)for(var o in n[a]){var s=t[n[a][o][1]],l=n[a][o][0];"click"===o&&(o=this.isMobile()?"touchstart":"click"),i.on(o,l,s)}else this.debug("事件绑定参数出错.")},now:function(){return(new Date).getTime()/1e3},isWebpSupport:null,webpSupport:function(e){var t=this;if(null!==t.isWebpSupport)e(t.isWebpSupport);else{var r=new Image;r.onerror=function(){t.isWebpSupport=!1,e(t.isWebpSupport)},r.onload=function(){1==r.width?t.isWebpSupport=!0:t.isWebpSupport=!1,e(t.isWebpSupport)},r.src="data:image/webp;base64,UklGRiwAAABXRUJQVlA4ICAAAAAUAgCdASoBAAEAL/3+/3+CAB/AAAFzrNsAAP5QAAAAAA=="}},fullscreen:function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()},exitFullscreen:function(){document.exitFullScreen?document.exitFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():element.msExitFullscreen&&element.msExitFullscreen()},ajax:function(e){return t(e)},detectiveWxJsBridge:function(e){return r(e)},guid:"",getGuid:function(){var e=this;return e.guid||(window.localStorage?(e.guid=window.localStorage.getItem("tfsdk.guid"),e.guid||(e.guid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),window.localStorage.setItem("tfsdk.guid",e.guid))):e.guid=navigator.userAgent.toLowerCase().substr(30,36).replace(/[^\w\-]/g,"-")),e.guid},timers:{},operationTimer:function(e,t,r){if(e[t]=!1,"number"!=typeof r)return!1;0<r?(this.timers[t]&&clearTimeout(this.timers[t]),this.timers[t]=setTimeout(function(){e[t]=!0},1e3*r)):e[t]=!0}}}.call(t,i,t,e))||(e.exports=r)},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(1)),a=new function(){this.keys=new Array,this.data=new Object,this.put=function(e,t){-1<window.location.href.indexOf("maplog")&&n.default.debug("MAP--PUT ===> "+e),null==this.data[e]&&this.keys.push(e),this.data[e]=t},this.get=function(e,t){return-1<window.location.href.indexOf("maplog")&&(n.default.debug("MAP--GET ===> "+e),console.warn(this.data[e])),t||void 0===this.data[e]&&(this.data[e]=function(){}),this.data[e]},this.remove=function(e){this.keys.remove(e),this.data[e]=null},this.each=function(e){if(alert(e),"function"==typeof e)for(var t=this.keys.length,r=0;r<t;r++){var i=this.keys[r];e(i,this.data[i],r)}},this.entrys=function(){for(var e=this.keys.length,t=new Array(e),r=0;r<e;r++)t[r]={key:this.keys[r],value:this.data[r]};return t},this.isEmpty=function(){return 0==this.keys.length},this.size=function(){return this.keys.length},this.toString=function(){for(var e="{",t=0;t<this.keys.length;t++,e+=","){var r=this.keys[t];e+=r+"="+this.data[r]}return e+="}"}};t.default=a},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(5)),a={ROOM:{},player:{},camera:{},CODE:{},CMD:{}};a.CMD.MODE={WHITEBOARD:"WHITEBOARD",PPT:"PPT"},a.CMD.WHITEBOARD_WIDTH=800,a.CMD.WHITEBOARD_HEIGHT=600,a.CMD.PAGE="51",a.CMD.DRAW="25",a.CMD.LINE="18",a.CMD.DOTTEDLINE="21",a.CMD.CLEAR="1",a.CMD.DRAW_LIST="31",a.CMD.SCROLL_ON_UP="6",a.CMD.SCROLL_ON_DOWN="5",a.CMD.LIVE_START="start",a.CMD.LIVE_STOP="stop",a.CMD.VIDEO_START="103",a.CMD.VIDEO_STOP="104",a.CMD.OPEN_CAMERA="101",a.CMD.CLOSE_CAMERA="102",a.CMD.MODE_CHANGE="151",a.CMD.DESKTOP_START="201",a.CMD.DESKTOP_STOP="202",a.CODE.SUCCESS=0,a.CODE.MEMBER_FORBIDDEN=10034,a.CODE_SUCCESS=0,a.EC_SUCCESS=0,a.EC_GENERAL_ERROR=-1,a.PROTOCOL="https:"==document.location.protocol?"https://":"http://";var o=n.default.state().api.host,s=window.location.host.match(/open-[\d]+\.talk-fun\.com/);a.APP_DOMAIN=s?s[0]:o||"open.talk-fun.com",a.APP_HOST=a.PROTOCOL+a.APP_DOMAIN,a.STATIC_HOST=a.PROTOCOL+"static-1.talk-fun.com",a.MT_ADDMAPLIST_ERROR="绑定监听事件错误",a.SOCKET_CONNECT_NOTE="初始化未完成,请稍后重试",a.MT_CONNECTING="connecting",a.MT_CONNECT_SUCCESS="connect",a.MT_CONNECT_FAILED="connect_failed",a.MT_CONNECT_ERROR="error",a.MT_DISCONNECT="disconnect",a.MT_RECONNECTING="reconnecting",a.MT_RECONNECTING_FAILED="reconnecting_failed",a.CODE.LIVE_COURSE_UNEXIST=1260,a.CODE.LIVE_COURSE_CONFLICT=1261,a.CODE.LIVE_COURSE_END=1262,a.CODE.LIVE_COURSE_NOT_START=1263,a.PLAYER_CMD_START=1,a.PLAYER_CMD_PAUSE=2,a.PLAYER_CMD_STOP=3,a.PLAYER_CMD_RESUME=4,a.player.bufferlength=.5,a.player.bufferTimeMax=1,a.player.bufferTimeArr="[0.8,1.5,3]",a.player.cmdTimeDelay=0,a.player.MAX_PULL_STREAM_ERROR="max_pull_stream_error",a.camera.bufferlength=.5,a.camera.bufferTimeMax=1,a.camera.bufferTimeArr="[0.8,1.5,3]",a.VOICE_FLOW_DEFAULT=1,a.VOICE_FLOW_ADAPTER=2,a.VOICE_MODE_FREEDOM=0,a.VOICE_MODE_CHAIRMAN=1,a.VOICE_MODE_QUEUE=2,a.VOICE_MODE_HAND=3,a.HT_MAIN_PLAYER="HT_01",a.HT_CAMERA_PLAYER="HT_02",a.HT_LIVE_PLAYER="HT_03",a.ROOM.USER_CAMERA_MODE="5",a.CAMERA_URL_STREAM=null,a.player.PLAY_ICON="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAJQElEQVR4Xu1bfaxcRRU/Z3b32fdqMFAIFBD7xFoSKSjyIUJAE2MaY4pFrIpoYpCgVlre696Z3VfQbW3f7sy+vOoTJERsVIJKsdJaxe/w1RJrK2AErfWjYsEKWL6U3bb77j3m6L7mvvvu3juzu32QtJPsPztnzvnNb87MnDkzF+EIL3iE9x+OEnDUA45wBo5OgelwgLVr184+ePDgIgCYh4izieh4RBRsm4j+AwD/5B8i7iWivUKIXZ7nPTYd2A6bB1QqlflCCO70ZQBwThud2UNEGwDgB/39/Q8sXrzYb0NHapOuE6C1PhcRbwKAC1KtWwoQ0fOIuG7GjBmrli5d+pJlMyuxrhHQdPMxRLzCynJ7Qi8Q0cr+/v6vdMsjOiaAiNAYIwHg84jY116/nFvtDILg2kKh8IBzy0iDjggYHh4+IZvNfhsA3mMDhIj+AAAPAcCDQognwm2IqIeIXg8AcxHxYgA4HwByrfQSUYCIq2u12spSqRTY2I+TaZuASqVymhBiCwAw6JaFiHYg4q3j4+ObhoaGnrUFWqlUXieEuBIAPgsAZyYQcW8QBB8sFovP2+oOy7VFgDFmLhHdh4gntzB6AABuF0Kszefzv28H2EQbnmIjIyMfC4JgDSKeFqeLiP4GAAuUUn90teVMQLVa7Q+CYBsintDC2GYhxHX5fH6Si7sCi8qXSqUZvb29BUQcipsaHD/4vn+2i5exDScChoeHZ2UymYdbjESDiKRS6kuddjapfblcfpsQYmMLDNtrtdolpVJpvy0GawKaq/0vEfHdUeVEdBARL5NS/sTWcCdy5XL5WCHEDxHxnTF6bpFS8rphVawJ0ForRKzEdH682fl7rCx2SahUKmX7+vq+14w0J2lFxMs9z7vbxpQVAc0g588x+zwBwIeklByyTnsplUo9vb297JW8bR4qRLTP9/15Q0ND+9JAWRFgjLkdAK6KGf2VSqlSmpHDWc+D02g0dgLAMRESvquU+mia7VQCeMsDAN5eorI/8zxvASKyF7yiRWv9cUT8VhQEIs5PO1XaEPBNAPhERPmBTCYzd/ny5Xte0Z6HjBtjOCi7KOIF65VSH07CmEjAyMjI8b7vPz1xdg8pWi2lvNG28yMjI2/3ff9eAOAF88ZarXZLJ+FrnN1qtXomEf0uUkeNRmP2ihUrnm6FNZEAY0weAKoRVl8kojcUCoUXbQkwxtwAAF+ckCeixxHxWinlVlsdNnLGmPW8KEfwLlNKjbVLwCMA8NaIwjGl1DIbQBMyWutVPPIxbTYQ0fVKqSdd9LWSrVQqFwshHozgfUgpNWlqhOtbesDo6Ohx4+PjU7YRIcT5+Xx+uwvgBAI4JcZRW7Verw+7RHCt7Gut9yDiqaF6mjlz5jFLlizh1NuU0pKAarW6iIi+H2nxjJTyRJfOs2wSAaFp8SQiSinld1z1h+WNMezu14X/C4LgfYVC4cdOBBhjeM7y3D1UiOgOpdSUeCANsA0BIR1bm8mOx9P0xtVrrRci4qYI7pbxSksP0FrfFU1vBUGwvFAojLoCcySApwUnO27LZrPFwcHB51zsaa1PRsSnIm3ulFJ+xMkDtNbbEfHcSQsG4kLP8za7ALKdAi10tpUD1Fr/GxFfG5pejyilYjPTSR6wExHnhYH5vn9OsVjkncGpuHpAjHKnHKAxhlNvZ4T07JZSvtHVA6KrKfi+f3qxWPyrU+8tF8E0nXzkBoCzbLI+Md77LyllbAInyQOeiqa8stnsqYODg9H5lYbdahdIVfJ/gXdJKe9PkzXGcOL1wpDcc1LKWa4eMGUKAMCbpZR/SgMQre/CFDiAiOV8Ps8BVerhyxjDIXE4kfqElHKOEwHGmF8DwHmR7eQCpRT/71Q6IYCINmYymetdcozGmL0AcFII5GNSyvmuBMTF1Vcppe5w6n37awCf8T9t4/JhPGNjY6/Zv39/NCe4WUq50JWAlXzbE/EArZQqHGYCXgCA0pw5c25q5/rLGMPb3W9scSctgpcj4qRUFxH9SikVXlysuLCZAs3g52vZbHbINfgJgzDGDADApGCNiFp6ruthiHzfn+V6C2NBQEfhb4QAjvkXhP9DxBM9z3vGaQqwsNb6UUQ8O9LwGinlbVZD3xRKIIAzSp6U8k4Xfa1kOV2eyWT4+i0zIUNEu5RSkwK6SeQkGTbG8BrAa0G4bJNSvsMFcIyeOh+Ba7VauRtH4AksWuuliPjlCLYvSClXtcKbmBEql8tvymQyU/Z9vhzxPO8+WxKq1eqFQRBs4dQaEXEuf6BbSZAJDJwi7+vr4+u48PZHuVzulIGBAd4WY0tqUlRrfT8iXhJZVXcopSbFCGlkNC9UhU0om6Yrrl5rvRwRRyJ1G6SUiQ82UgkwxrwXAH4aY/RqKeW6dsB2u40xhkedzyi9Yd1CiLek3U6nEsAKY2Jr/vulXC53RpJ7dbujcfrWr1+f2b17N1/VT7odAoDU0Wd9VgTwWiCE4ExuT2Qq/Lxery/odorbhThjzFcB4DORNtb3FlYEsHKtdRERh6PgiOjrSqlPuYDulqwxht8KrInBZH1lZ01A0vU4ANxcq9WWTqcnGGN41Hn0o2Vr842A1bshawLYCj+QyGazvwWAU2IM3xMEwZUuFybtekLzVZqOGfm9uVzuPJechRMBbLBarZ7FZ4Loist1RPR3RFwkpXy43c4ltWs+jPgGIk452RHRs4h4kWu+wpmA5q7wfiLirPGMmFHgjO66RqNxQ9KdnAtBfMSt1+tXA8BqRDw2xuY+Irq0UCg4p9LbIoABNN/q/IgfP7fozMtEVO7p6bl5YGCAj7jORWvNj6uvAYBPAsBxcQqI6B+IyKky50yV9TbYCrnNQ8lmMvMuIQQ/oflFq1MZ2xgdHe1tNBq8n1+KiPz4MvG9MRFtGR8fv6ITT2vbAyZICT2VLcVNiRh35QeNf0HElyN1nMfni9hDJ7kElzlARGvq9fqaTneejgmYAKm15gvJtYf5sTSb2ySEWOaSI0yae10jIERE15/LN3eYHUKIz3met815MUlo0HUCJmw1t8sPdPDBBKt6lD+Y8H1/Yzs3UjZEHTYCwsZjPpnhnYNPcCchImP43ycz/Ny1+dnMrlwud7dLQGPT2TiZaSGgXXDT0e4oAdPB8qvZxlEPeDWPznRgO+I94L+7uQh9LgqjswAAAABJRU5ErkJggg==";var l=a;t.default=l},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r},function(e,t,r){"use strict";var i=r(12),n=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(42),o=n(r(8)),s=n(r(43)),l=n(r(1)),u=n(r(28)),d=(i(r(13)),{init:function(){l.default.debug("Store init done ==>",o.default),this.observe()},state:function(){return o.default},getters:function(e){return"function"==typeof u.default[e]?u.default[e]():null},commit:function(e,t){return s.default.commit.apply(s.default,arguments)},observe:function(){(0,a.watch)(o.default,"token",function(e,t){}),(0,a.watch)(o.default.global,"curMode",function(e,t){}),(0,a.watch)(o.default.global,"data",function(e,t){}),(0,a.watch)(o.default.player,"status",function(e,t){})}}),c=window.__store__=d;t.default=c},function(e,t,r){"use strict";var i=r(12),n=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(4)),o=n(r(5)),s=n(r(8)),l=i(r(13)),u=n(r(3)),d=n(r(2)),c=n(r(1)),f={playType:"live",vodPlayer:null,currentMediaSourceIndex:0,mainContainerId:null,curMeidaData:null,mode:0,containers:{},playItems:{playerIcon:"#tf-xplay-icon",posterId:"#tf-xplay-poster"},playStatus:"wait",currentMode:"0",COMMAND:{START:"start",STOP:"stop",WAIT:"wait",GRAFFITI:1,RUBBER:26,IMAGE:11,TEXT:15,CIRCLE:16,RECTANGLE:17,LINE:18,ERASER:20,DRAW:25,DRAW_LIST:31,PAGE:51,ARROW:19,DOTTED_LINE:21,PPTCLEAR:3,CAMERA_START:101,CAMERA_STOP:102,VIDEO_START:103,VIDEO_STOP:104,MODE_CHANGE:151,DESKTOP_START:201,DESKTOP_STOP:202,DESKTOP_PAUSE:203,IMAGE_PRELOAD:1111,LIVE_POWER_CHANGE:161,POINTER:210},constant:{MODE_EDUCATION:0,MODE_VIDEO:1,MODE_DESKTOP:2,MODE_NAME:{0:"课件模式",1:"视频分享模式",2:"桌面分享模式"}},setFlvPlayer:function(e){this.flvPlayer||(this.flvPlayer=e)},commonEventListener:function(e){e.addEventListener("x5videoenterfullscreen",function(){e.play(),c.default.debug("wx fullscreen enter..."),d.default.get("wx:enter:fullscreen")()},!1),e.addEventListener("x5videoexitfullscreen",function(){e.play(),c.default.debug("wx fullscreen exit..."),d.default.get("wx:exit:fullscreen")()},!1)},settingMaps:{emotions:null},config:function(e){"object"===(0,a.default)(e)&&e.playType&&(this.playType=e.playType)},setting:function(e,t){e=e||"",this.settingMaps.hasOwnProperty(e)?this.settingMaps[e]=t:c.default.debug("配置非法属性 ==> "+e)},getSetting:function(e){if("string"==typeof e)return this.settingMaps[e]},initConfig:null,initialize:function(){this.mainContainerId&&(document.getElementById(this.mainContainerId).innerHTML="")},setPlayerStatus:function(e){this.playStatus=e,o.default.commit(l.UPDATE_LIVE_STATUS,e)},isForceAudio:function(e){return!(!this.initConfig||!this.initConfig.forceAudio)&&(!e||"start"!==e)},updateCourseData:function(e){if(!e)return!1;var t={};e&&0<e.liveid&&(t.liveId=e.liveid,o.default.commit(l.UPDATE_LIVE_DATA,t)),e&&0<e.course_id&&(t.courseId=e.course_id,o.default.commit(l.UPDATE_LIVE_DATA,t))},isForceVideo:function(){return!(!this.initConfig||!this.initConfig.forceVideo)},getContainerId:function(e){return"mt-container-"+e},getContainer:function(e){return c.default.debug("get Container...",e),document.getElementById(this.mainContainerId)},modeChange:function(e,t){var r=e.c.split("|"),i=r[0],n=r[1],a=r[1];o.default.commit(l.UPDATE_LIVE_MODE,n),this.baseCurrentMode=n,i==this.constant.MODE_VIDEO&&(i=this.constant.MODE_DESKTOP),n==this.constant.MODE_VIDEO&&(n=this.constant.MODE_DESKTOP),this.beforeMode=i,this.currentMode=n,d.default.get("live:mode:change")({beforeMode:i,currentMode:n,sourceMode:a}),t&&t(i,n)},getFlvVideoUrl:function(e){return u.default.PROTOCOL+this.stream2flv(e)},getVideoUrl:function(e){var t=e;return c.default.debug("stream content => ",t),"playback"==this.playType?t:u.default.PROTOCOL+this.stream2m3u8(t)},stream2m3u8:function(e){var t;return t=e.hosts.hls+e.domain+"/"+e.app+"/"+e.path+"/"+e.ext.m3u8+(0<e.query.length?"?"+e.query:""),c.default.debug("get hls url ==>",u.default.PROTOCOL+t),t},stream2flv:function(e){var t;return t=e.hosts.flv+e.domain+"/"+e.app+"/"+e.path+e.ext.flv+(0<e.query.length?"?"+query:""),c.default.debug("get flv url ==>",u.default.PROTOCOL+t),t},stream2Rtmp:function(e){var t;return t="rtmp://"+e.hosts.rtmp+e.domain+"/"+e.app+"/"+e.path,c.default.debug("get rtmp url ==>",u.default.PROTOCOL+t),t},stream2RtmpPath:function(e){var t={path:"rtmp://"+e.hosts.rtmp+e.domain+"/"+e.app+"/",id:e.path};return c.default.debug("get rtmp path ==>",t),t},removePlayIcon:function(e){c.default.debug("hide player toolkit...");var t=document.querySelector(this.playItems.playerIcon);t&&(t.style.display="none",e&&(e.style.width="100%",e.style.height="100%"));var r=document.querySelector(this.playItems.posterId);r&&(r.style.display="none")},showPoster:function(){var e=document.querySelector(this.playItems.posterId);e&&(e.style.display="block")},mdeidaOnModeChange:function(){var e=document.querySelector(this.playItems.posterId);e&&(c.default.debug("remove kit ==>",e),e.parentNode.removeChild(e));var t=document.querySelector(this.playItems.playerIcon);t&&(c.default.debug("remove kit ==>",t),t.parentNode.removeChild(t))},stop:function(){c.default.debug("remove shortcut dom");var e=document.querySelector(this.playItems.playerIcon);e&&e.parentNode.removeChild(e)},getPlayIcon:function(e){if(c.default.debug("Start getPlayIcon toolkit..."),document.querySelector(this.playItems.playerIcon))return!1;if(!e.parentNode)return!1;var t=c.default.touchSupport()?"touchend":"click",r=document.createElement("div");if(r.id=this.playItems.playerIcon.replace("#",""),r.style.position="absolute",r.style.width="100%",r.style.height="100%",r.style["z-index"]="100",r.style.top="0",r.style.left="0",r.style.zIndex=100,r.style.cursor="pointer",r.style.cssText+="background-image: url("+u.default.player.PLAY_ICON+");background-repeat: no-repeat; background-position: 50% 50%;",e.parentNode.appendChild(r),s.default.video.poster){var i=document.createElement("div");i.id=this.playItems.posterId.replace("#",""),i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style["z-index"]="100",i.style.top="0",i.style.left="0",i.style.zIndex=90,i.style.cursor="pointer",i.style.cssText+="\n        background: url('".concat(s.default.video.poster,"') rgba(0, 0, 0, 0.65) 50% 50% no-repeat;\n        background-size: contain; \n        "),e.parentNode.appendChild(i)}r.addEventListener(t,function(){e.play().then(function(){e.style.width="100%",e.style.height="100%"}),r.removeEventListener(t,null,!1),r.style.display="none",i&&(i.style.display="none")},!1)},elementPlay:function(t){if(t){var r=this;c.default.debug("vdom on play...");var e=t.play();return void 0===e&&(e=Promise.resolve()),void 0!==t?e.then(function(){c.default.debug("H5 player is playing."),d.default.get("live:video:onplay")(),r.setPlayerStatus("playing"),r.removePlayIcon(t)}).catch(function(e){c.default.warn("h5 player play Exception! Autoplay disabled!",e),d.default.get("live:video:pause")(),r.setPlayerStatus("error"),r.getPlayIcon(t),r.showPoster(t)}):t.play()}},mediaValidate:function(e,t){if(!this.curMeidaData.detail)return!1;var r=this,i=e-r.curMeidaData.detail.duration,n=(0,a.default)("function"===t)?t:function(){};c.default.debug("验证视频时长 ===> 偏差"+i+"秒."),this.vodPlayer.vodLiveType?n(!0):i>r.vodPlayer.live.timeDiffLimit?(r.currentMediaSourceIndex+=1,r.currentMediaSourceIndex>r.curMeidaData.detail.allUrl.length&&(r.currentMediaSourceIndex=r.curMeidaData.detail.allUrl.length-1),r.vodPlayer.changeSource(r.currentMediaSourceIndex),n(!1)):n(!0)},getVideoSource:function(e){if(c.default.debug("getVideoSource ==> "+e),!e)return!1;var t=[];if(/\.m3u8/gi.test(e)){var r={type:"application/x-mpegURL",src:e};t.push(r)}else{for(var i=["mp4","mov","webm","ogv","hts"],n=0;n<i.length;n++){var a={},o=i[n];a.type="video/"+o,a.src=e.replace(/\.mp4/gi,"."+o),t.push(a)}c.default.debug("vod socure ===>",t)}return t},isOpenSafariVideo:function(){return!(!this.initConfig||!this.initConfig.safariOpenVideo)},isCreateAudio:function(){return!!c.default.isIphone()&&!(c.default.isQQMobile()||this.isOpenSafariVideo()||10<c.default.getPlatformInfo().version)}};t.default=f},function(e,t,r){"use strict";var i=r(12),n=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(6)),o=n(r(1)),s=(n(r(8)),n(r(10))),l=n(r(2)),u=n(r(5)),d=i(r(13)),c=n(r(3)),f=r(29),h=n(r(48)),p=n(r(19)),g=n(r(21)),m=n(r(20)),v=n(r(22)),_=n(r(15)),y={curPlayerDom:null,curPlayerObject:null,curMediaIndex:0,streams:null,curStream:null,setStreams:function(e){o.default.debug("Media streams ==>",e),this.streams=e,this.getCurMedia(),this.getLines(e)},setStep:function(e,t){var r=e.toString(),i=null,n=JSON.stringify(t);switch(r){case c.default.CMD.LIVE_START:case c.default.CMD.LIVE_STOP:i=1;break;case c.default.CMD.OPEN_CAMERA:case c.default.CMD.CLOSE_CAMERA:i=4;break;case c.default.CMD.PAGE:i=2;break;case c.default.CMD.MODE_CHANGE:i=6;break;case c.default.CMD.VIDEO_START:case c.default.CMD.VIDEO_STOP:i=3;break;case c.default.CMD.DESKTOP_START:case c.default.CMD.DESKTOP_STOP:i=7}o.default.debug("Update Step ==>",i,n),i&&-1<i&&u.default.commit(d.UPDATE_STEP_DATA,{step:i,type:t.t,command:n})},setVideoAttributes:function(t){var r=u.default.getters("getExtData");o.default.debug("ext params ==>",r),r&&r.video&&0<Object.keys(r.video).length&&Object.keys(r.video).forEach(function(e){if(e&&r.video[e]){if("poster"===e)return;t.setAttribute(e,r.video[e])}else t.removeAttribute(e)})},streamTest:function(e){e[0].hosts&&(e[0].hosts.hls="hlsxx",e[0].hosts.flv="hlsxx",e[1].hosts.hls="hlsxx988",e[1].hosts.flv="hlsxx988")},getLines:function(e){var i=[];return(e=e||this.streams).forEach(function(e,t){if(e.host){var r={key:t,label:"线路"+(t+1)};i.push(r)}}),l.default.get("live:network:list")(i),i||[]},setLine:function(e){var t=this.getMediaList(this.streams[e]);this.curPlayerObject&&this.curPlayerObject.reload(t)},setControls:function(e,t){o.default.debug("set config controls...");var r=document.querySelector("#"+t);if(r.querySelector(".tf-x-controls"))return!1;var i=document.createElement("div");i.className="tf-x-controls",r.appendChild(i),(0,f.render)((0,f.h)(h.default,{tplType:e,fullDom:r}),i)},removeControls:function(e){o.default.debug("remove config controls...");var t=e.querySelector(".tf-x-controls");t&&t.parentNode.removeChild(t)},onError:function(e,t){var r=this;return o.default.debug("视频流错误, 重试中...",e,this.curMediaIndex,this.getMediaList()),"flvplayer"===e?s.default.res(this.getMediaList().flv,"flv"):s.default.res(this.getMediaList().hls,"m3u8"),this.curMediaIndex+=1,this.curMediaIndex>this.streams.length-1&&(this.curMediaIndex=this.streams.length-1),o.default.debug("Retrying ==>",this.streams[this.curMediaIndex]),this.setCurMedia(this.curMediaIndex).then(function(){return t&&r.reloadNativeVideo(t,r.getMediaList()),Promise.resolve(r.getMediaList())})},setVideoDom:function(e){o.default.debug("set vdom ==>",e),this.videoDom&&(this.videoDom=e)},getVideoDom:function(e){o.default.debug("Create video dom from ==>",e);var t=u.default.getters("getPlayer");if(!t[e])return o.default.warn("未定义播放器类型, 请指定获取类型"),!1;var r=t[e],i=document.querySelector("#"+r.wrapContainer);if(!i)return o.default.debug("[".concat(e,"]video wrapper not found!")),!1;var n=document.getElementById(r.playerId);o.default.getRoom().user.role;if(!this.videoDom){o.default.debug("create video dom.");n=document.createElement("video");this.videoDom={},o.default.isWechat()&&(n.className="camera_wechat"),n.id=r.playerId,n.setAttribute("webkit-playsinline","webkit-playsinline"),n.setAttribute("webkit-playsinline","true"),n.setAttribute("playsinline",""),n.setAttribute("autoplay",""),n.setAttribute("preload","auto"),n.setAttribute("raw-controls","true"),n.setAttribute("x5-video-player-type","h5-page"),o.default.isCompatible()&&n.setAttribute("x5-video-player-type","h5"),n.style.width="100%",n.style.height="auto",n.style.display="block",this.setVideoAttributes(n),this.videoDom=n,i.innerText="",i.appendChild(n),_.default.bindEvent(n,e),a.default.elementPlay(n),o.default.detectiveWxJsBridge(function(){a.default.elementPlay(n)}),u.default.getters("getExtData").config.controls&&this.setControls("video",r.wrapContainer),"function"==typeof this.cameraCallback&&this.cameraCallback(n)}return n},emit:function(){var e=this.curPlayerObject;o.default.debug("## mediaCore Emit ==>",Array.prototype.slice.call(arguments)),e&&e.on&&e.on.apply(e,arguments),v.default&&v.default.on.apply(v.default,arguments)},setCurMedia:function(e){return this.curStream=this.streams[e],Promise.resolve(this.curStream)},setCurPlayer:function(e){e&&(this.curPlayerObject=e)},getPlayer:function(){return this.curPlayerObject?Promise.resolve(this.curPlayerObject):Promise.reject(!1)},setCurPlayerDom:function(e){this.curPlayerDom=e},reloadNativeVideo:function(e,t){var r=t.hls;e&&r&&(e.src=r,e.load(),a.default.elementPlay(e))},reload:function(){this.curPlayerObject&&this.curPlayerObject.reload()},getCurMedia:function(e){return e=-1<e?e:0,this.curStream=this.streams[e]},getStep:function(e){var t=u.default.getters("getInitData");return!(!t||!t.InitData)&&t.InitData["step"+e]},getMediaList:function(e){if(!e&&!this.curStream)return!1;var t={hls:a.default.getVideoUrl(e||this.curStream),flv:a.default.getFlvVideoUrl(e||this.curStream),rtmp:a.default.stream2Rtmp(e||this.curStream),rtmpPath:a.default.stream2RtmpPath(e||this.curStream)};return o.default.debug("Get media socure list ==>",t),t},emitPlayer:function(){this.emit("ppt:player"),this.emit("camera:player"),this.emit("video:player")},setTechOrder:function(e){var t=null;e?t=e:t=u.default.getters("getInitData").streamType[0];var r="RTMP"===(t=t&&t.toLocaleUpperCase())?"FLASH":t,i=o.default.flashChecker();switch("FLASH"!==r||i.flash||(o.default.warn("当前浏览器不支持Flash插件,正在使用H5播放器..."),r=t="FLV"),"FLV"===t&&(p.default.isSupported()||(r=t="HLS")),l.default.get("live:tech:order")(r),u.default.commit(d.UPDATE_TECH_ORDER,r),o.default.debug("Current TechOrder ==>",t),t){case"RTMP":case"FLASH":this.setCurPlayer(m.default);break;case"FLV":this.setCurPlayer(p.default);break;case"HLS":this.setCurPlayer(g.default);break;default:return e=null}e&&this.emitPlayer(),this.curPlayerObject}},b=window.__media=y;t.default=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={api:{host:window.apiHost||"open.talk-fun.com"},token:null,extConfig:{config:{},video:{}},global:{curMode:0,data:null,liveData:{liveId:0,courseId:0}},player:{techOrder:null,status:null,withUi:!1,camera:{wrapContainer:null,playerId:null},video:{wrapContainer:null,playerId:null},whiteboard:{wrapContainer:null,playerId:null}},video:{poster:null,autoplay:!0,controls:!1}};t.default=i},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(1)),o=i(r(2)),s=i(r(10)),l=i(r(17)),u=i(r(3)),n=i(r(5)),d={access_token:null,getAccessToken:function(){return n.default.getters("getToken")||window.access_token||null},course:null,setCourse:function(e){this.course=e},configs:null,init:function(e,r,t){a.default.debug("room.init.js => module init."),t&&(this.player=t);var i=this,n=e;this.access_token=e,a.default.ajax({type:"GET",url:u.default.APP_HOST+"/live/init.php",dataType:"jsonp",data:{access_token:e},success:function(e){if(e.code!=u.default.CODE.SUCCESS&&a.default.error(e),e.code===u.default.CODE.SUCCESS){var t=e;a.default.setRoom(t),s.default.init(t.log);try{t=a.default.detectProtocol(JSON.stringify(t)),t=JSON.parse(t)}catch(e){a.default.debug("room data parse Error "+e)}if(t.course&&t.course.course_id&&(i.course=t.course),0<t.ext.liveEndExpire&&0===t.ext.liveEndJumpUrl.indexOf("http")&&window.localStorage){if(window.localStorage.getItem("liveEndExpireToken")==n)return void(window.location.href=t.ext.liveEndJumpUrl);window.localStorage.removeItem("liveEndExpireToken")}i.room=t,l.default.addHostGroup(t.hostGroup||{}),a.default.debug("房间验证成功====>",t);try{r(t)}catch(e){console.error(e)}}else e.code>=u.default.CODE.LIVE_COURSE_UNEXIST&&e.code<=u.default.CODE.LIVE_COURSE_NOT_START?o.default.get("live:course:access:error")(e):o.default.get("system:room:error")(e)},error:function(){o.default.get("system:room:error")("room请求超时,请重试...")}})},liveEndExpieTimer:null,broadcastHandler:function(e){var t=this;"start"==e.t?t.liveEndExpieTimer&&(clearTimeout(t.liveEndExpieTimer),t.liveEndExpieTimer=null):"stop"==e.t&&!a.default.isMobileSDK()&&0<t.room.ext.liveEndExpire&&0===t.room.ext.liveEndJumpUrl.indexOf("http")&&(t.liveEndExpieTimer=setTimeout(function(){window.localStorage&&window.localStorage.setItem("liveEndExpireToken",t.getAccessToken()),window.location.href=t.room.ext.liveEndJumpUrl},1e3*t.room.ext.liveEndExpire))}},c=window.__room=d;t.default=c},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(3)),a=i(r(1)),o=i(r(8)),s=(i(r(17)),n.default.PROTOCOL+"log.talk-fun.com"),l={srcUrl:null,sdkVersion:null,setBaseParam:function(e){e.sdkVersion&&(this.sdkVersion=e.sdkVersion),e.srcUrl&&(this.srcUrl=window.encodeURIComponent(e.srcUrl))},init:function(e){this.logConfig=e},res:function(e,t){var r=a.default.getRoom(),i={cid:o.default.default.global.liveData.liveId||0,type:4,pid:r.user.pid,rid:r.user.roomid,xid:r.user.xid,url:window.encodeURIComponent(e),resType:t,errorType:"error",host:e.split("/")[2]};return a.default.debug("[ERROR]资源错误上报 ==>",i),a.default.ajax({type:"GET",url:s+"/stats/res.html",data:i})},socket:function(e){this.logConfig&&this.logConfig.socket&&a.default.ajax({type:"GET",url:s+"/stats/socket.html",data:e,error:function(){a.default.warn(s+"/stats/socket.html"," ==> 请求错误,请检查网络!")}})},play:function(e){this.sdkVersion&&(e.sdkVersion=this.sdkVersion),this.srcUrl&&(e.srcUrl=this.srcUrl),a.default.ajax({type:"GET",url:s+"/stats/play.html",data:e})},errorReport:function(e){"undefined"!=typeof access_token&&(e.access_token=access_token),e.__type="jserror",a.default.ajax({type:"GET",url:s+"/stats.html",data:e})}},u={};window.onerror=function(){var e=["Error","Script","Line","Column","StackTrace"],t="",r=arguments.length;5<r&&(r=5);for(var i=0;i<r;i++)t=t+"|"+e[i]+": "+arguments[i];var n={type:"JS-ERROR-LOG",msg:t};void 0===u[n.msg]&&(l.errorReport(n),u[n.msg]=1)};var d=l;t.default=d},function(e,t,r){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t,r,i=Array.prototype.slice.call(arguments,1);i.length;){var n=i.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var a in n)t=n,r=a,Object.prototype.hasOwnProperty.call(t,r)&&(e[a]=n[a])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,i,n){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+i),n);else for(var a=0;a<i;a++)e[n+a]=t[r+a]},flattenChunks:function(e){var t,r,i,n,a,o;for(t=i=0,r=e.length;t<r;t++)i+=e[t].length;for(o=new Uint8Array(i),t=n=0,r=e.length;t<r;t++)a=e[t],o.set(a,n),n+=a.length;return o}},a={arraySet:function(e,t,r,i,n){for(var a=0;a<i;a++)e[n+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(i)},function(e,t,r){var o=r(4);function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=i?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(r,n,a):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_STEP_DATA=t.UPDATE_EXT_CONFIG=t.UPDATE_API_DOMAIN=t.UPDATE_WHITEBOARD_DOM=t.UPDATE_VIDEO_DOM=t.UPDATE_CAMERA_DOM=t.UPDATE_TECH_ORDER=t.UPDATE_LIVE_STATUS=t.UPDATE_LIVE_MODE=t.UPDATE_LIVE_DATA=t.UPDATE_INIT_DATA=t.UPDATE_TOKEN=void 0;t.UPDATE_TOKEN="UPDATE_TOKEN";t.UPDATE_INIT_DATA="UPDATE_INIT_DATA";t.UPDATE_LIVE_DATA="UPDATE_LIVE_DATA";t.UPDATE_LIVE_MODE="UPDATE_LIVE_MODE";t.UPDATE_LIVE_STATUS="UPDATE_LIVE_STATUS";t.UPDATE_TECH_ORDER="UPDATE_TECH_ORDER";t.UPDATE_CAMERA_DOM="UPDATE_CAMERA_DOM";t.UPDATE_VIDEO_DOM="UPDATE_VIDEO_DOM";t.UPDATE_WHITEBOARD_DOM="UPDATE_WHITEBOARD_DOM";t.UPDATE_API_DOMAIN="UPDATE_API_DOMAIN";t.UPDATE_EXT_CONFIG="UPDATE_EXT_CONFIG";t.UPDATE_STEP_DATA="UPDATE_STEP_DATA"},function(e,t,r){"use strict";var n=r(12),a=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(r(4)),s=a(r(1)),l=a(r(2)),u=a(r(18)),d=a(r(3)),c=a(r(9)),f=a(r(17)),h=a(r(10)),p=a(r(7)),g=a(r(6)),m=(a(r(19)),a(r(21)),a(r(22))),v=a(r(30)),_=a(r(31)),y=a(r(5)),b=n(r(13)),E=a(r(15)),S={action:"wait",playerInit:!1,room:null,playNumber:1,stream:null,page:0,st:0,ba:0,bn:0,bx:0,waitLastTime:0,_roomCurrentTime:0,curLastTime:0,countdownTime:0,cameraVideoDom:null,isDisableDraws:!1,curDocument:null,width:0,height:0,pptWidth:1280,pptHeight:960,drawWidth:1280,drawHeight:960,pptRate:.75,pptMatrix:[],imgMatrix:[],whiteBoardWidth:800,whiteBoardHeight:600,ratio:.75,rwidth:800,rheight:600,cameraWidth:280,cameraHeight:210,mainContainerId:null,mainPlayerId:null,cameraContainerId:null,cameraPlayerId:null,pageRatio:.75,pages:{},commands:{},canvasObj:{},imageObj:{},textObj:{},strokeObj:{},circleObj:{},drawObj:{},ctx:{},lineObj:{},dottedLineObj:{},rectangleObj:{},arrowObj:{},durationTimmer:null,doStep:function(){if(!this.steploaded){var e=y.default.getters("getInitData");s.default.debug("init do step ==> data->",e);var t;if(!e||!e.InitData)return!1;for(var r=e.InitData,i=1;i<=7;i++){if(t="step"+i,s.default.debug("step===>[".concat(i,"] ").concat(r[t])),r[t]&&(this.execute(r[t]),l.default.get("ppt:player:loaded")()),2===i){var n="string"==typeof r[t]&&0<r[t].length;l.default.get("live:has:whiteboard")(n)}4!=i||r[t]||l.default.get("camera:stop")()}this.steploaded=!0}},getStep:function(e){return p.default.getStep(e)},init:function(){var t=this,e=y.default.getters("getExtData");e&&e.config&&e.config.techOrder?p.default.setTechOrder(e.config.techOrder):p.default.setTechOrder(),E.default.listen(d.default.player.MAX_PULL_STREAM_ERROR,function(e){t.stop()}),this.initPlayer()},initPlayer:function(){var e=y.default.getters("getInitData");s.default.debug("=====> H5 v2 ROOM <=======",e);var t=(this.room=e).InitData;if(s.default.debug("=====h5 player init=======",t),t.title&&(this.liveTitle=t.title),u.default.set("delayDuration",e.cmdDelay),u.default.set("cmdDelay",e.cmdDelay),u.default.run(g.default.playType),"wait"===t.action)return this.wait(),void this.cnState("wait");"start"===this.action&&u.default.set("initDuration",e.live.duration),this.doStep()},fireWhiteboard:function(){return p.default.emit("ppt:player",this),Promise.resolve()},destroyAll:function(){return s.default.debug("## Destroy All! ##"),new Promise(function(t,e){g.default.stop(),p.default.emit("media:destroy","camera"),p.default.emit("media:destroy","video"),p.default.emit("flash:destroy:all"),p.default.emit("ppt:destroy",function(e){t(e)})})},videoPlayer:{destroy:function(){s.default.debug("camera player destroy!")},disposeAll:function(){this.playerInit=!1,this.clearPageCommands()}},loadWhiteboardV3:function(){},config:function(e){"object"===(0,o.default)(e)&&(e.width&&(this.cameraWidth=parseInt(e.width)),e.height&&(this.cameraHeight=parseInt(e.height)),e.playType&&(this.playType=e.playType))},volume:function(t){s.default.debug("H5 Volume set ==> ",t),-1<t&&p.default.getPlayer().then(function(e){e.volume(t)})},getRatio:function(e,t){var r=this.pageRatio,i=document.querySelector("#"+this.mainContainerId);if(!i)return{width:e,height:t};var n,a,o=e||i.clientWidth,s=t||i.scrollHeight;return a=r<o/s?(n=s*r,s):(n=o)/r,{width:n,height:a}},getSDK:function(){return SDK},whiteboardCore:function(e,t,r){y.default.commit(b.UPDATE_WHITEBOARD_DOM,{wrapContainer:e,playerId:t,callback:r}),this.fireWhiteboard()},mainPlayer:function(e,t,r){s.default.debug("init mainPlayer =>",e,t);g.default.mainContainerId=this.mainContainerId=e,this.playerCallback=r,this.mainContainerId=e,this.playerId=t;var i=document.querySelector("#"+e);"function"==typeof r&&r.call(i),y.default.commit(b.UPDATE_VIDEO_DOM,{wrapContainer:e,playerId:t,callback:r}),p.default.emit("video:player")},camera:function(e,t,r){s.default.debug("init Camera =>",e,t);this.cameraContainerId=e,this.cameraPlayerId=t,this.cameraCallback=r,y.default.commit(b.UPDATE_CAMERA_DOM,{wrapContainer:e,playerId:t,callback:r})},cameraRun:function(){p.default.emit("camera:player")},doCameraStep:function(){var t=this;[p.default.getStep(1),p.default.getStep(3),p.default.getStep(4),p.default.getStep(6)].forEach(function(e){e&&t.dispatch(e)})},setPlayerTechOrder:function(e){return e=e.toLocaleUpperCase(),-1===["FLASH","FLV","HLS"].indexOf(e)?(s.default.warn("请正确输入切换模式 ==>",e),!1):y.default.getters("getTechOrder")!==e&&(p.default.emit("player:tech:order",e),void this.destroyAll().then(function(){p.default.setTechOrder(e)}))},changeSource:function(e){var t=this,r="",i="";if(s.default.debug("source-currentMode ==> "+g.default.currentMode),e.curSourceStream?g.default.currentMode==g.default.constant.MODE_DESKTOP?i=e.curSourceStream:g.default.currentMode==g.default.constant.MODE_EDUCATION&&(i=e.curSourceStream):g.default.currentMode==g.default.constant.MODE_DESKTOP?(r=v.default.desktopStreamPath.split("|"),i=v.default.desktopStreamPath):g.default.currentMode==g.default.constant.MODE_EDUCATION&&(r=t.videoStreamPath.split("|"),i=t.videoStreamPath),s.default.debug("stream ===> ",r),e.data&&0<e.data.length)t.getNGB(i,e.data);else{var n=this.m3u8(i);s.default.debug("Change to default ==> ",n),t.videoUrl=n}t.curMeidaStream=i,this.mediaReload()},getNGB:function(e,t){var r="",i=t,n=i.length-1,a=i[Math.round(Math.random()*n)]+"/";return r+=d.default.PROTOCOL+a+g.default.stream2m3u8(e),s.default.debug("===> Change video source",r),this.videoUrl=r},reload:function(){p.default.reload()},lineSetting:function(e){return p.default.setLine.call(p.default,e)},mediaReload:function(){if(window.location.href.match(/vreload=false/gi)||!1)return!1;s.default.debug("重新加载视频===>"+this.videoUrl),g.default.currentMode==g.default.constant.MODE_DESKTOP?(v.default.videoUrl=this.videoUrl,v.default.reloadDesktop()):g.default.currentMode==g.default.constant.MODE_EDUCATION&&this.videoEmitPlay()},isOpenSafariVideo:function(){return!(!c.default.configs||!c.default.configs.safariOpenVideo)},isCreateAudio:function(){return!1},toggleMeidaElement:function(){var e=document.getElementById(this.cameraPlayerId);e&&document.body.removeChild(e)},getCamera:function(){console.warn("get camera...")},changeMediaElement:function(e){if(e){s.default.debug("getCamera 6");var t=e.data.type,r=this.getCamera();clearInterval(this.durationTimmer),r.pause();var i=document.getElementById(this.cameraPlayerId);i.parentNode.removeChild(i),s.default.debug("getCamera 7"),this.getCamera(t)}},playTimes:0,resumePlay:function(e){1===this.playTimes&&(s.default.debug("do resumePlay......"),this._roomCurrentTime=0,e.load(),this.elementPlay())},changeSourceFlag:0,setWaitingTimes:function(){var e=this,t=Math.round((new Date).getTime()/1e3);1<=t-e.waitLastTime&&(e.bn+=1,e.ba+=1,e.bx<15?e.bx+=1:(e.bx=0,e.changeSourceFlag=1,l.default.get("live:video:timeout")(e.bx)),e.waitLastTime=t)},startDurationTimmer:function(){var e=this;if(!e.durationTimmer){s.default.debug("getCamera 1");var t=this.getCamera();e.durationTimmer=setInterval(function(){t.currentTime&&(e.currentTime=t.currentTime,u.default.setPlayDuration(t.currentTime),l.default.get("live:duration")(t.currentTime,e.duration,t.currentTime/e.duration))},100)}},videoEmitPlay:function(e){var t=this;e||this.videoUrl;s.default.isWechat()?s.default.detectiveWxJsBridge(function(){s.default.debug("[Camera]Autoplay by Wechat..."),t.elementPlay()}):t.elementPlay()},elementPlay:function(){p.default.curPlayerObject&&p.default.curPlayerObject.play()},play:function(){s.default.debug("======== H5 Start Playing ==========> "+g.default.currentMode);g.default.currentMode==g.default.constant.MODE_EDUCATION?this.videoEmitPlay():g.default.currentMode==g.default.constant.MODE_DESKTOP&&v.default.play()},pause:function(){if(s.default.debug("======== pause =========="),s.default.isMobileSDK());else if(g.default.currentMode==g.default.constant.MODE_EDUCATION){s.default.debug("getCamera 8");var e=this.getCamera();e&&e.pause()}g.default.setPlayerStatus("pause")},livePowerChange:function(){this.commands={}},getTitle:function(e){if(e.title&&0<e.title.length)return this.liveTitle=e.title,e.title},isWhiteBoard:function(e){return 1e4<e},whiteBoardOnSocket:function(e){s.default.debug("Whiteboard on socket...",e);var t=e.args,r=this;if(r.liveTitle=r.getTitle(t),t.metadata)try{p.default.emit("socket:cmd",t.metadata);var i=JSON.parse(t.metadata);p.default.setStep(i.t,i),r.isWhiteBoard(i.t)||i.t!=g.default.COMMAND.PAGE||r.clearPageCommands(),0==i.st&&this.dispatch(i),i.st,this.st,this.st=i.st,i.t==g.default.COMMAND.VIDEO_START||i.t==g.default.COMMAND.VIDEO_STOP||i.t==g.default.COMMAND.CAMERA_START||i.t==g.default.COMMAND.CAMERA_STOP||i.t==g.default.COMMAND.DESKTOP_START||i.t==g.default.COMMAND.DESKTOP_STOP||i.t==g.default.COMMAND.MODE_CHANGE||11==i.t||15==i.t||16==i.t||i.t==g.default.COMMAND.RECTANGLE||i.t==g.default.COMMAND.LINE||i.t==g.default.COMMAND.DOTTED_LINE||31==i.t||20==i.t||25==i.t||1==i.t||51==i.t||i.t==g.default.COMMAND.ARROW||i.t==g.default.COMMAND.POINTER?(i.receiveTime=s.default.now(),u.default.addSchedule(i.st,i,function(e){s.default.debug("schedule execute ==>",e),r.dispatch(e,!0)})):this.dispatch(i)}catch(e){s.default.debug("[ERROR]Command parse onError ==>",e)}},dispatch:function(e,t){s.default.debug("command dispatch do ==>",e);try{if("string"==typeof e&&(e=JSON.parse(e)),31==e.t)for(var r,i=0;i<e.d.length;i++)r=JSON.parse(e.d[i]),t&&this.pushCommands(e),this.execute(r);else t&&this.pushCommands(e),this.execute(e)}catch(e){}},initStorage:function(){this.st=0,this.pages={},this.commands={},this.imageObj={},this.textObj={},this.strokeObj={},this.circleObj={},this.drawObj={},this.canvasObj={},this.ctx={}},pushCommands:function(e){if(s.default.in_array(e.t,[11,15,16,20,25,1,g.default.COMMAND.LINE,g.default.COMMAND.DOTTED_LINE,g.default.COMMAND.RECTANGLE,g.default.COMMAND.RUBBER,g.default.COMMAND.ARROW]))this.commands[e.p]||(this.commands[e.p]=[]),this.commands[e.p].push(e);else if(51==e.t){var t=e.c.split("|")[0];if(!this.isWhiteBoard(e.p)){var r=this.getPage(e.p);if(r)t!=r.c.split("|")[0]&&this.flushCommands(e.p)}this.pages[e.p]=e}},flushCommands:function(e){this.commands[e]&&delete this.commands[e]},isCommandInCurrentPage:function(e){return s.default.debug("page in command"+e,this.page),(e=parseInt(e))===parseInt(this.page)},getPage:function(e){return this.pages[e]},execute:function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return s.default.debug("h5 player execute command error:"+e)}s.default.debug("###### H5 player execute ===>",e.t," #######"),s.default.debug(e);g.default.updateCourseData(e);var t=this.liveTitle;if(e.p&&this.isCommandInCurrentPage(e.p),"start"==e.t)this.start(e,t),this.cnState("start");else if(51==e.t)this.setPage(e);else if(103==e.t||104==e.t)this.video(e);else if(101==e.t||102==e.t)this.cameraDo(e);else if(1111==e.t)this.imagePreload(e);else if(e.t==g.default.LIVE_POWER_CHANGE)this.livePowerChange();else if("stop"==e.t)this.stop(e),this.cnState("stop");else if(151==e.t)s.default.debug("live mode change ==> "+e.t),this.modeChangeFlag=!0,g.default.modeChange(e,function(e,t){s.default.debug("live currentMode ==> "+t),t==g.default.constant.MODE_EDUCATION?p.default.emit("media:destroy","video"):p.default.emit("media:destroy","camera"),e==g.default.constant.MODE_EDUCATION||e==g.default.constant.MODE_VIDEO||g.default.constant.MODE_DESKTOP});else if(201==e.t){if(s.default.debug("live desktop Start ==> "+e.t),!this.modeChangeFlag){var r={st:0,p:-1,c:"0|2",t:151};g.default.modeChange(r)}e.streams&&p.default.setStreams(e.streams),v.default.start(e)}else if(203==e.t){if(!this.modeChangeFlag){r={st:0,p:-1,c:"0|2",t:151};g.default.modeChange(r)}}else 202==e.t&&v.default.stop(e);103==e.t||e.t,this.graphExecute(e)},graphExecute:function(e){-1<[51,25,1,16,11,g.default.COMMAND.RECTANGLE,g.default.COMMAND.LINE,g.default.COMMAND.DOTTED_LINE,g.default.COMMAND.TEXT,g.default.COMMAND.POINTER].indexOf(parseInt(e.t))&&m.default.whiteboardObject&&(s.default.debug("图形渲染 ==>",e),m.default.whiteboardObject.render({data:e}))},resize:function(e,t){return m.default.whiteboardObject&&m.default.whiteboardObject.whiteboardResize(),this.getRatio(e,t)},stop:function(){s.default.debug("Live on stop..."),this.initStorage(),this.action="stop",g.default.setPlayerStatus("stop"),g.default.stop(),u.default.stop(),p.default.emit("ppt:destroy"),p.default.emit("media:destroy","camera"),p.default.emit("media:destroy","video"),p.default.emit("live:stop"),y.default.commit(b.UPDATE_LIVE_DATA,"stop"),y.default.commit(b.UPDATE_LIVE_MODE,"0"),this.statsStop(),l.default.get("live:stop")()},wait:function(){this.action="wait","start"===this.action?l.default.get("live:stop")():l.default.get("live:wait")()},start:function(e,t){s.default.debug("Live on start..."),s.default.debug("h5 live start",e);var r=this;this.room.user;if(r.action=e.t,r.initStorage(),(this.action="start")===e.t){var i={liveId:e.liveid||0,courseId:e.course_id||0};this.liveData=i}r.liveid=e.liveid||0,r.logTimer||r.statsPlay(),0==u.default.initDuration&&u.default.set("initDuration",1),u.default.run(g.default.playType),p.default.emit("ppt:player"),s.default.debug("直播主题 ===>",t,e),l.default.get("live:start")(t)},calssTimer:function(e){var t=this;t.setTimer=setInterval(function(){0!=(t.countdownTime=e)?e--:clearInterval(t.setTimer)},1e3)},cnState:function(e){var t=this,r=s.default.getRoom();if(t.action=e,r.course&&0<r.course.videoUrl.length&&void 0!==r.course.videoUrl)if(t.calssTimer(r.course.info.timeToStart),"wait"===e){if(0<t.countdownTime)t.cnPlay();else if(0==t.countdownTime){if(1==r.course.startLive)return void clearTimeout(t.cnTimer);0==r.course.startLive&&t.cnPlay()}}else if("stop"===e){if(0<t.countdownTime)t.cnPlay();else if(0==t.countdownTime){if(1==r.course.startLive)return void clearTimeout(t.cnTimer);0==r.course.startLive&&t.cnPlay()}}else"start"===e&&clearTimeout(t.cnTimer)},cnPlay:function(){var e=this,t=this.room.user,r="",i=navigator.userAgent.toLowerCase();r=-1<i.indexOf("ios-sdk")?"ios-sdk":-1<i.indexOf("android-sdk")?"android-sdk":"html",h.default.play({xid:t.xid,uid:t.uid,pid:t.partner_id,rid:t.roomid,cid:e.liveid,courseId:e.room.course.course_id,pf:r,pt:1,pl:"start"===e.action?1:0,cbt:0,type:g.default.playStatus}),e.cnTimer=setTimeout(function(){e.cnPlay()},1e3*e.room.heartbeatInterval||18e4)},statsStop:function(){this.logTimer&&(window.clearTimeout(this.logTimer),this.logTimer=null),this.cnTimer&&(window.clearTimeout(this.cnTimer),this.cnTimer=null)},statsPlay:function(e){var t=this,r=this.room.user,i="",n=navigator.userAgent.toLowerCase();i=-1<n.indexOf("ios-sdk")?"ios-sdk":-1<n.indexOf("android-sdk")?"android-sdk":"html";var a={bn:0,ba:0};e&&(a.ba=e.ba,a.bn=e.bn);var o=y.default.getters("getLiveData"),s={xid:r.xid,uid:r.uid,pid:r.partner_id,rid:r.roomid,cid:o.liveId,courseId:o.courseId,pf:i,pt:1,pl:"start"===t.action?1:0,cbt:0,bn:a.bn,ba:a.ba,type:g.default.playStatus,pn:t.playNumber};11661==r.partner_id&&"start"!==t.action&&(s.pt=2,s.ctype=9,s.cid=o.courseId),h.default.play(s),t.bn=0,t.logTimer=setTimeout(function(){var e=E.default.getQAData();++t.playNumber,t.statsPlay(e),E.default.resetQA()},1e3*t.room.heartbeatInterval||18e4)},getDrawObjectById:function(e,t){if(!t)return null;for(var r=e.getObjects(),i=0,n=r.length;i<n;i++)if(r[i].id===t)return r[i]},isDraw:function(e,t){for(var r=!1,i=e.getObjects(),n=0;n<i.length;n++)i[n].id===t&&(r=!0);return r},clearPageCommands:function(){var e=this.pages,t=this.commands;for(var r in e)this.isWhiteBoard(r)||delete e[r];for(var i in t)this.isWhiteBoard(i)||delete t[i];s.default.debug("clear Page Commands...")},setPage:function(e){s.default.debug("Live set page ==>",e);var t=e.p,r=e.c.split("|");_.default.setCurPageCommand(r[0]);r[2];t&&(this.page=e.p,this.pages[e.p]=e),p.default.emit("live:set:page",e),l.default.get("live:set:page")(e),this.playerInit=!0,t&&s.default.debug("load canvas whiteBoard...")},loadImage:function(r,i){var n=this;if(n.imageObj[r])return i(n.imageObj[r]);s.default.webpSupport(function(e){e&&(r=r.replace(".jpg",".jpeg")),r=f.default.getRetryUrl(r);var t=new Image;t.src=r,t.onload=function(){n.imageObj[r]=t,i(t)},t.onerror=function(){f.default.loadRetry(r,function(e){n.loadImage(e,i)})}})},m3u8:function(){},video:function(e){s.default.debug("Live Video Start ==> "+e.t),s.default.debug("Video Source:",e),e.streams&&p.default.setStreams(e.streams),this.videoStreamPath=e.stream,u.default.set("LAST_LIVE_TIME",e.st),103==e.t?p.default.emit("camera:player"):104==e.t&&(s.default.debug("Live Video Stop..."),p.default.emit("media:destroy","camera"))},cameraDo:function(e){101==e.t?(s.default.debug("camera start ..."),l.default.get("camera:start")()):102==e.t&&(l.default.get("camera:stop")(),s.default.debug("camera stop ..."))},getColor:function(e){if((e=(e=parseInt(e)).toString(16)).length<6){var t=6-e.length;for(i=0;i<t;i++)e="0"+e}return e="#"+e},draw:function(){var e=this.getPage(this.page);e&&this.execute(e)}},w=window.__player=S;t.default=w},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(6)),o=i(r(1)),a=i(r(2)),s=i(r(3)),l=i(r(9)),u=i(r(18)),d=i(r(7)),c={st:0,ba:0,bn:0,bx:0,playTimes:0,waitLastTime:0,roomIncreaseTimer:null,_roomCurrentTime:0,curPlayerType:null,showLog:function(e,t){o.default.debug("".concat(e," event do ==> ").concat(t))},bindEvent:function(e,t){o.default.debug("Bind Event on v2 ==>",t),this.curPlayerType=t,e&&(this.curVideoDom=e);var r=this,i=this;n.default.commonEventListener(e),i.on("loadeddata",function(){r.showLog(t,"loaded"),a.default.get("live:camera:loadeddata")()},!1),i.on("play",function(){r.playTimes+=1,r.showLog(t,"play"),a.default.get("live:camera:play")(),r.getServerCurTime(),r.roomInterval("play")},!1),i.on("pause",function(){r.playTimes=0,r.showLog(t,"pause"),a.default.get("live:camera:pause")(),n.default.setPlayerStatus("pause"),r.vCountDown&&(r.startPlaying=!1,clearInterval(r.vCountDown))},!1),i.on("abort",function(){r.showLog(t,"abort"),a.default.get("live:camera:abort")(),n.default.setPlayerStatus("abort")},!1),i.on("error",function(){var e=this.error.code;if(r.showLog(t,"error [".concat(e,"]")),r.bn+=1,r.ba+=1,r.bx+=1,n.default.setPlayerStatus("error"),a.default.get("live:camera:error")(e),20<r.bn)return!1;setTimeout(function(){d.default.onError("camera",r.cameraVideoDom).then(function(e){o.default.debug("[video]切换资源...")})},2e3)},!1),i.on("suspend",function(){r.showLog(t,"suspend"),a.default.get("live:camera:suspend")()},!1),i.on("stalled",function(){r.showLog(t,"stalled"),r.bn+=1,r.ba+=1,n.default.setPlayerStatus("stalled")},!1),i.on("waiting",function(){r.showLog(t,"waiting"),r.bn+=1,r.ba+=1,a.default.get("live:camera:waiting")(),n.default.setPlayerStatus("waiting")},!1),i.on("timeupdate",function(){r.showLog(t,"timeupdate");var e=this.currentTime;r.liveCurrentDuration=e,n.default.setPlayerStatus("playing"),e<=r.curLastTime&&(r.setWaitingTimes(),r.curLastTime=e),r.roomInterval("timeupdate"),a.default.get("live:camera:timeupdate")(e),u.default.setPlayDuration(e)},!1)},cacheVideoEvents:{},cacheListenEvents:{},listen:function(e,t){this.cacheListenEvents[e]||(this.cacheListenEvents[e]=t)},on:function(e,t,r){var i=this.curVideoDom;i&&i.addEventListener(e,t,r),this.cacheVideoEvents[e]={event:e,handler:t,useCapture:r}},off:function(e){var t=this.curVideoDom;if("string"==typeof e&&this.cacheVideoEvents[e]){var r=this.cacheVideoEvents[e];t&&(o.default.debug("remove video event ==> "+r.event),t.removeEventListener(r.event,r.handler,r.useCapture))}else if(!e&&this.cacheVideoEvents){var i=this.cacheVideoEvents;if(t)for(var n in i){var a=i[n];o.default.debug("Remove video event ==>"+a.event),t.removeEventListener(a.event,a.handler,a.useCapture)}}},roomInterval:function(e){var i=this;"timeupdate"===e?i._roomCurrentTime=i.curVideoDom.currentTime:"play"===e&&(i._roomCurrentTime=0),i.startPlaying||(i.roomIncreaseTimer=setInterval(function(){var e=i._roomCurrentTime+=1,t=i.curVideoDom.currentTime||0,r=e-t;if(10<r){i.timeOutTimes||(i.timeOutTimes=!0);1200<=r&&i.cacheListenEvents[s.default.player.MAX_PULL_STREAM_ERROR]&&(o.default.warn("已达到最大断流时长"),i.cacheListenEvents[s.default.player.MAX_PULL_STREAM_ERROR](e)),a.default.get("live:camera:timeout")(e,t)}},1e3),i.startPlaying=!0)},getServerCurTime:function(){o.default.debug("do getServerCurTime..."),o.default.ajax({type:"GET",url:s.default.APP_HOST+"/live/info.php",dataType:"jsonp",data:"access_token="+l.default.getAccessToken(),success:function(e){e.code==s.default.CODE.SUCCESS&&(u.default.reset(),u.default.playDuration=0,u.default.initDuration=e.data.duration,u.default.baseDuration=e.data.duration,o.default.debug("getServerCurTime ==> initDuration:"+e.data.duration))}})},unBind:function(){this.off()},getQAData:function(){return{ba:this.ba,bn:this.bn,bx:this.bx}},resetQA:function(){this.bn=0},destroy:function(e,t){if(o.default.debug("Destroy on ==>",e,"| current ==>",this.curPlayerType),this.curPlayerType!==e)return!1;var r=this.curVideoDom;r&&r.parentNode&&(o.default.debug("## player(event) on destroy! ##",r),this.unBind(),"function"==typeof t&&t(),n.default.mdeidaOnModeChange(),d.default.setVideoDom(null),r.parentNode.removeChild(r),clearInterval(this.roomIncreaseTimer),this.startPlaying=null,this.roomIncreaseTimer=null,this.curVideoDom=null)}};t.default=c},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var b=i(r(4)),E=i(r(1)),n=i(r(9)),a=i(r(3)),o=i(r(2)),s={userList:new Object,onlineXids:new Array,group:{0:0,all:0},getOnlineList:function(){for(var e=[],t=0;t<this.onlineXids.length;t++){var r=this.onlineXids[t];this.userList[r]&&e.push(this.userList[r])}return e},onlineUsers:function(e,t){E.default.debug("member.js => online list.");var r=this.userList,i=this.onlineXids,n=e.online.spadmin.data,a=e.online.admin.data,o=e.online.user.data,s=e.online.guest.data,l=[],u=[],d=[],c=[];for(var f in n)n[f].self=!1,n[f].xid===t?(n[f].self=!0,l.unshift(n[f])):l.push(n[f]);for(var h in a)a[h].self=!1,a[h].xid===t?(a[h].self=!0,u.unshift(a[h])):u.push(a[h]);for(var p in o)o[p].self=!1,o[p].xid===t?(o[p].self=!0,d.unshift(o[p])):d.push(o[p]);for(var g in s)s[g].self=!1,s[g].xid===t?(s[g].self=!0,c.unshift(s[g])):c.push(s[g]);for(var m=u.concat(l,d,c),v=0;v<m.length;v++)if(m[v]&&"object"===(0,b.default)(m[v])&&"null"!==m[v].xid){if(r[m[v].xid])return!1;try{var _=m[v].xid.toString(),y=m[v];r[_]=y,i.push(_)}catch(e){E.default.debug("onlineUsers ===>",m),E.default.debug("onlineUsers error ===>",e)}}this.renderMember(m),this.setOnlineTotal(e),this.countdown(e.online.total),window.__onlineXids=this.onlineXids,window.__userList=this.userList},renderMember:function(e){o.default.get("member:list")(e)},renderMemberPower:function(e,t){o.default.get("member:voice:power")(e,t)},addMember:function(t){E.default.debug("===>addMember",t);var e=t.member;if(e&&e.xid){if(this.get(e.xid))return!1;try{this.onlineXids.push(e.xid.toString()),this.userList[e.xid]=e}catch(e){E.default.debug("addMember ===>",t),E.default.debug("addMember error ===>",e),E.default.debug(e)}this.setOnlineTotal(t),this.countdown(t.total)}o.default.get("member:list")(this.getOnlineList())},deleteMember:function(e){var t=e;if(this.get(t.xid)){try{delete this.userList[t.xid]}catch(e){this.userList[t.xid]=null}for(var r=0;r<this.onlineXids.length;r++)t.xid==this.onlineXids[r]&&this.onlineXids.splice(r,1)}this.setOnlineTotal(e),this.countdown(t.total),o.default.get("member:list")(this.getOnlineList())},setOnlineTotal:function(e){if("number"==typeof e)this.group.all=e;else{if("object"===(0,b.default)(e.group))for(var t in e.group.total)E.default.debug("groups "+t,e.group),this.group[t]=e.group.total[t];void 0!==e.total?this.group.all=e.total:void 0!==e.online.total&&(this.group.all=e.online.total)}},getOnlineTotal:function(){if(window.MT)var e=window.MT.me;else e=o.default.get("sdk:curuser");return void 0!==e.gid&&0<e.gid?(E.default.debug("group "+e.gid),this.group[e.gid]+this.group[0]):(E.default.debug("group all"),this.group.all)},get:function(e){if(e)return this.userList[e]},modeVoiceProwers:function(e){var t=this,r=e.xids,i=e.mode;if(!r&&!i)return!1;this.onlineXids,this.onlineXids.length,this.userList;0==i?(t.me&&(t.me.voice.enable=1,t.renderMemberPower(t.me.xid,t.me.voice)),r&&this.VoicePowerSetting(r,0)):(t.me&&(t.me.voice.enable=0,t.renderMemberPower(t.me.xid,t.me.voice)),r&&this.VoicePowerSetting(r,1))},modifyOneVoicePrower:function(e,t,r){r&&(this.me=r,this.me.voice=t,this.userList[e]=r),this.userList[e]&&(this.userList[e].voice=t,this.renderMemberPower(e,t))},VoicePowerSetting:function(e,t){if(e&&0<e.length)for(var r=0,i=e.length;r<i;r++)this.me.xid==e[r]&&(this.me.voice.enable=t,this.renderMemberPower(e[r],this.userList[e[r]].voice))},countdown:function(){var e=this.getOnlineTotal();o.default.get("member:total")(e),window.SDK&&E.default.isMobileSDK()&&SDK.call("member:total",{total:e})},getMemberDetail:function(e,t){E.default.ajax({method:"GET",url:a.default.APP_HOST+"/live/member.php",data:{xid:e,act:"info",access_token:n.default.getAccessToken()},success:function(e){0==e.code&&t&&t(e)}})},dealMemberAvatar:function(e){if(e.robot&&0<e.robot){var t=Math.abs(E.default.crc32(e.nickname))%n.default.room.ext.robotDefaultAvatarNum,r="/avatar/default/lifelive/".concat(t,".jpg");e.avatar=n.default.room.ext.avatarHost+r}else e.a&&e.xid&&n.default.room.ext.avatarHost?(e.avatar=n.default.room.ext.avatarHost+"/avatar/"+e.xid%255+"/"+e.xid%600+"/"+e.xid%1024+"/"+e.xid+".jpg","object"==(0,b.default)(e.attr)&&e.attr.v&&(e.avatar+="?v="+e.attr.v)):void 0!==e.a&&e.role&&n.default.room.ext.avatarHost&&n.default.room.ext.defaultAvatar&&(e.avatar=n.default.room.ext.defaultAvatar[e.role]||n.default.room.ext.defaultAvatar.user);return e}};t.default=s},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(4)),a=i(r(1)),o=(i(r(6)),i(r(3))),s=(i(r(20)),i(r(5)),i(r(7))),l={url:o.default.APP_HOST+"/live/network.php",pullUrl:null,pullHost:null,pullHostType:{video:null,desktop:null},groupData:{},sourceSetting:{code:0,data:[],buffer:1,sourceName:"",curSourceStream:{},isDefaultSetting:!0},setPullInfo:function(){var e=this,t=[];t.push("rtmp://"),t.push(e.sourceSetting.curSourceStream.host),t.push(e.sourceSetting.curSourceStream.app),t.push(e.sourceSetting.curSourceStream.path),t&&(e.pullUrl=t[0]+t[1]+"/"+t[2]+"/"+t[3],e.pullHost=t[1]),a.default.debug("network pullUrl ===>"+e.pullUrl,t)},setGroup:function(e){for(var t=e.length,r=0;r<t;r++)this.sourceSetting.sourceName||1!=e[r].cur||(this.sourceSetting.sourceName=e[r].sourceName),this.groupData[e[r].sourceName]=e[r].stream},getOperators:function(t,e){var r=this,i=1;r.setPullInfo(),e&&(i=e);var n=s.default.getMediaList();a.default.ajax({url:r.url,type:"GET",data:{access_token:r.room.getAccessToken(),pullUrl:n.rtmp,act:"list",version:i},success:function(e){e.data&&0<e.data.length&&r.setGroup(e.data),0==e.code?(e.buffer=r.player.liveBuffer||1,a.default.isInNative()&&window.SDK&&SDK.call("getOperatorSuccess",e)):a.default.isInNative()&&window.SDK&&SDK.call("getOperatorFail",e),"function"==typeof t&&t(e)},error:function(){a.default.isInNative()&&window.SDK&&SDK.call("getOperatorFail",{error:"-1"}),"function"==typeof t&&t({code:"-1"})}})},reset:function(){this.groupData={},this.sourceSetting={isDefaultSetting:!0}},curDefinition:"fd",setDefinition:function(e){var t=this;if(e&&(t.curDefinition=e),e&&""==t.sourceSetting.sourceName)t.getOperators(function(){t.setDefinition()},2);else{if(t.groupData[t.sourceSetting.sourceName]){var r=t.groupData[t.sourceSetting.sourceName],i="";r.definition&&r.definition[t.curDefinition]&&(i=r.definition[t.curDefinition].streamExt||"");var n=r.path;r=JSON.stringify(r).replace(n,n+i),r=JSON.parse(r),t.sourceSetting.curSourceStream=r}t.sourceSetting.isDefaultSetting=!1,t.playBySetting(!1,!1)}},playBySetting:function(e){var t=this;if(e&&e.streams){var r=[];for(var i in e.streams){var n={};if(n.cur=e.streams[i].cur||0,n.sourceName=e.streams[i].typeName||"",n.stream=e.streams[i],r.unshift(n),t.sourceSetting.isDefaultSetting&&0==i&&(t.sourceSetting.sourceName=e.streams[i].typeName,e.streams[i].definition))for(var a in e.streams[i].definition)if(e.streams[i].definition[a].isDefault){t.definition=a;break}}return t.setGroup(r),void t.setDefinition()}t.setSource(t.sourceSetting)},setOperator:function(e,t){var r=this,i={};if(a.default.isMobileSDK())try{i=JSON.parse(e)}catch(e){SDK.call("setOperatorFail",e)}else"string"==typeof e?(i.type=e,i.buffer=r.player.liveBuffer):"object"===(0,n.default)(e)&&(i=e);r.sourceSetting.buffer=i.buffer||1,r.sourceSetting.sourceName=i.sourceName||"",a.default.debug("network groupData ===> ",r.groupData[i.sourceName],i.sourceName),r.setPullInfo(),a.default.ajax({url:r.url,type:"GET",data:{access_token:r.room.getAccessToken(),act:"get",type:i.type,sourceName:i.sourceName||""},success:function(e){a.default.isMobileSDK()||0==e.code&&(r.sourceSetting.data=e.data,r.sourceSetting.code=e.code,r.setDefinition(),t&&t(e))}})},setSource:function(t,r){var e=this;if(e.sourceSetting.isDefaultSetting=!1,a.default.isMobile())e.player.changeSource(t),r&&r(t);else{if(!e.player)return!1;var i={t:"flashInfo",ipList:t.data,buffer:t.buffer,sourceName:t.sourceName,stream:t.curSourceStream};i=JSON.stringify(i),e.player.getCameraPlayer(function(e){e.cameraCommand(i),r&&r(t.code)}),e.player.getPlayer(function(e){e.command(i),r&&r(t.code)})}},changeHost:function(i){var n=this;n.setPullInfo(),a.default.ajax({url:n.url,type:"GET",data:{access_token:n.room.getAccessToken(),act:"changeHost",pullHost:n.pullHost},success:function(e){if(0!=e.code||""==e.data.newPullHost)return i&&i({code:-1}),!1;var t={_old:n.pullHost,_new:e.data.newPullHost};n.pullUrl=n.pullUrl.replace(n.pullHost,e.data.newPullHost),n.pullHost=e.data.newPullHost;var r={pullHost:t,type:"hostChange"};if(!n.player)return!1;a.default.debug("pullHost ===>",r),n.player.changeHost(r,i)}})},init:function(e,t){this.room=e,this.player=t},hostReplace:{},oriUrls:{},hostGroup:[],addHostGroup:function(e){for(var t in e)this.hostGroup.push(e[t])},getRetryUrl:function(e){var t=e,r=t.split("/")[2];return void 0!==this.hostReplace[r]&&(e=e.replace(r,this.hostReplace[r])),this.oriUrls[e]=t,e},loadRetry:function(e,t){var r=this;if(void 0===r.oriUrls[e])return!1;var i=r.oriUrls[e].split("/")[2],n=e.split("/")[2];for(var a in r.hostGroup)for(var o in r.hostGroup[a])if(r.hostGroup[a][o]==i){var s=[].concat(r.hostGroup[a]);return s.splice(o,1),void 0!==s[s.indexOf(n)+1]&&(r.hostReplace[i]=s[s.indexOf(n)+1],setTimeout(function(){t(r.oriUrls[e])},1e3)),!0}return!1},ajax:function(t,r){var i=this;t.url=i.getRetryUrl(t.url),t.error=function(){i.loadRetry(t.url,function(e){t.url=e,i.ajax(t,r)})},r&&(t.success=function(e){r(e)}),a.default.ajax(t)}},u=window.__network=l;t.default=u},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(1)),n=i(r(2)),o=i(r(19)),s={LAST_LIVE_TIME:-1,initDuration:0,playDuration:0,delayDuration:0,timeupdate:0,cmdDelay:0,baseDuration:0,curPlayDuration:0,jobs:[],timmer:null,lock:!1,set:function(e,t){a.default.debug("schedule set ==> ",e,t),this.hasOwnProperty(e)?this[e]=t:a.default.warn(e+"is Not Definded!")},setPlayDuration:function(e){0<=e&&(this.playDuration=parseInt(e),this.updatePlayDuration(this.playDuration))},setDelayTime:function(e){var r=this,i=this,n=e.disposeTime+this.LAST_LIVE_TIME;return this.setDisposeTime(n),setTimeout(function(){var e=o.default.getVideoEl(),t=e.buffered.end(0)-e.currentTime;0<r.curPlayDuration&&(i.cmdDelay=r.curPlayDuration-(n-t)+2,a.default.debug("cmdDelay ==>",i.cmdDelay),a.default.debug("disposeTime ==>",n))},100),i.cmdDelay},setDisposeTime:function(e){if(0<=this.LAST_LIVE_TIME){var t=e;this.baseDuration=t,this.timeupdate=0}},updatePlayDuration:function(){this.autoUp()},autoUp:function(){var e=this;this.setDisTimer||(this.setDisTimer=setInterval(function(){e.timeupdate+=1,e.curPlayDuration=e.baseDuration+e.timeupdate,n.default.get("live:time",e.curPlayDuration)},1e3))},reset:function(){this.timeupdate=0,this.curPlayDuration=0,this.playDuration=0,this.initDuration=0,this.baseDuration=0},addSchedule:function(e,t,r,i){var n={st:e,command:t,callback:r};return a.default.debug("schedule add ==>",t),i&&"top"===i?this.jobs.unshift(n):this.jobs.push(n),Promise.resolve(n)},clearSchedule:function(){this.jobs=[]},run:function(r){a.default.debug("涂鸦队列开启..."),this.playType=r||"live",this.lock=!1;var i=this;if(!this.timmer){var n;i=this;if(!this.timmer){i.timmer=setInterval(function(){if(!this.lock&&0<i.jobs.length)for(var e=0,t=i.jobs.length;e<t&&(n=i.jobs[e]);e++)if("live"===r){if(!(n.st&&n.st<=i.cmdDelay||void 0!==n.command.receiveTime&&a.default.now()-n.command.receiveTime>i.cmdDelay))break;i.fire(i.jobs.shift()),a.default.debug("schedule ===> cmd.st:"+n.st+" initDuration:"+i.initDuration+" playDuration:"+i.playDuration+"delayDuration:"+i.delayDuration+" now:"+a.default.now()+" cmdDelay ==> "+i.cmdDelay)}},200)}}},pause:function(){this.timmer&&(clearInterval(this.timmer),this.timmer=null),this.setDisTimer&&(clearInterval(this.setDisTimer),this.setDisTimer=null),this.lock=!0},stop:function(){this.initDuration=0,this.delayDuration=0,this.setPlayDuration(0),this.pause(),this.clearSchedule(),this.reset()},fire:function(e){e.callback&&"function"==typeof e.callback&&e.callback(e.command)}},l=window.__schedule=s;t.default=l},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=i(r(1)),o=i(r(18)),s=i(r(2)),n=i(r(10)),a=i(r(6)),u=i(r(7)),d=(i(r(14)),i(r(8))),c=i(r(15)),f=i(r(5)),h=i(r(57)),p={curVdom:null,curStream:null,videoPlayer:null,getVideoEl:function(){if(this.curVdom)return this.curVdom},volume:function(e){this.getVideoEl()&&(this.getVideoEl().volume=e)},init:function(e,t){if(l.default.debug("Flv mode init =>",t,e),!t)return!1;e&&(this.curStream=e);var r=this;this.getFlvUrl(e).then(function(){r.createPlayer("video",t)}),a.default.setFlvPlayer(this)},on:function(e,t){var r=this;l.default.debug("Flvplayer emit on ==>",e,"=>",t);var i=f.default.getters("getPlayer");if("camera:player"===e){if(0!=f.default.getters("getGlobal").curMode)return!1;var n=u.default.getVideoDom("camera"),a=u.default.getMediaList();if(!a||!n)return!1;this.init(a,n),l.default.callback(i.camera.callback,n)}if("video:player"===e){if(0==f.default.getters("getGlobal").curMode)return!1;var o=u.default.getMediaList(),s=u.default.getVideoDom("video");if(!o||!s)return!1;this.init(o,s),l.default.callback(i.video.callback,s)}"media:destroy"===e&&c.default.destroy(t,function(){r.destroy()})},reload:function(e){var t=this,r=(e=e||this.curStream,this.curVdom);this.videoPlayer&&this.videoPlayer.pause(),this.destroy("reload").then(function(){setTimeout(function(){t.init(e,r)},300)})},isSupported:function(){return h.default.isSupported()},flvEvent:function(t){var n=this;t.on(h.default.Events.MEDIA_INFO,function(e){l.default.debug("flv media info ==>",e),e.disposeTime&&o.default.setDisposeTime(parseFloat(e.disposeTime))});var a=l.default.now();t.on(h.default.Events.SCRIPTDATA_ARRIVED,function(e){var t=l.default.now();if(l.default.debug("收到时间差",t-a),t-a<4)a=l.default.now();else{a=l.default.now();var r=n.videoPlayer;if(e.disposeTime&&r&&r.buffered){var i={disposeTime:Number(e.disposeTime),buffered:r.buffered.end(0),curTime:r.currentTime};o.default.setDelayTime(i)}}}),t.on(h.default.Events.ERROR,function(e){l.default.debug("flv on error ==>",e),u.default.onError("flvplayer").then(function(e){l.default.debug("cur stream ==>",e.flv),n.getFlvUrl(e),n.destroy().then(function(){setTimeout(function(){n.init(e,u.default.curPlayerDom)},1500)})}),s.default.get("live:camera:error")({code:-1,src:t.src})})},play:function(){return this.videoPlayer&&(l.default.debug("Flv on play..."),this.videoPlayer.unload(),this.videoPlayer.load(),a.default.elementPlay(this.curVdom)),Promise.resolve()},createPlayer:function(e,t){if(l.default.debug("flv player create ==>",this.videoPlayer),"video"===e&&!this.videoPlayer){var r=d.default.global.data.flvConfig||{enableStashBuffer:!0,isLive:!0,enableWorker:!0,fixAudioTimestampGap:!1,stashInitialSize:128,lazyLoad:!0,lazyLoadMaxDuration:3,lazyLoadRecoverDuration:3,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:1.5,autoCleanupMinBackwardDuration:.8};l.default.debug("Flv config ==>",r),l.default.debug("FLVJS-VERSION ==>",h.default);var i=h.default.createPlayer({type:"flv",isLive:!0,hasVideo:!0,url:this.flvUrl},r);this.videoPlayer=i,this.flvEvent(i),i.attachMediaElement(t),this.curVdom=t,this.play()}},getFlvUrl:function(e){return this.flvUrl=e.flv,n.default.setBaseParam({srcUrl:e.flv}),Promise.resolve()},destroy:function(e){return l.default.debug("## flvplayer do destroy ##"),this.videoPlayer&&(e||u.default.removeControls(this.curVdom.parentNode),this.videoPlayer.pause(),this.videoPlayer.unload(),this.videoPlayer.detachMediaElement(),this.videoPlayer.destroy(),this.videoPlayer=null,this.curVdom=null,this.flvUrl=null),Promise.resolve()}},g=window.__flv=p;t.default=g},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(4)),g=i(r(5)),m=i(r(2)),v=i(r(1)),_=(i(r(14)),i(r(3))),y=i(r(59)),n=i(r(7)),o=i(r(25)),s={_playerLoaded:null,_cameraPlayerLoaded:null,init:function(){this.isSupported(),this.windowInterface()},onPlayerLoadSuccess:function(){this.initRunStep()},initRunStep:function(){g.default.getters("getInitData");var e=[n.default.getStep(1),n.default.getStep(2),n.default.getStep(3),n.default.getStep(4),n.default.getStep(6),n.default.getStep(7)];this.getPlayer(function(t){e.forEach(function(e){e&&t.command&&t.command(e)})}),this.play()},isSupported:function(){var e=v.default.flashChecker();return e.flash||(v.default.warn("PPT播放器加载失败, 请安装或允许Flash插件 (https://get.adobe.com/cn/flashplayer/)"),v.default.warn("Chrome 启用 Flash Player 方法 ==> (https://www.flash.cn/help/article/article.php?id=45)")),e.flash},play:function(){var r=this,e=g.default.getters("getCurMode");if(v.default.debug("Flash on play...",e),"DESKTOP"===e)return!1;this.getCameraPlayer(function(e){if(r._cameraPlayerLoaded){var t=n.default.getMediaList().rtmpPath;t&&e.cameraPlay(t.path,t.id)}})},stop:function(){var t=this;v.default.debug("Flash on stop..."),this.getCameraPlayer(function(e){t._cameraPlayerLoaded&&e.cameraStop()})},volume:function(e){o.default.live&&this._cameraPlayerLoaded&&o.default.live.cameraSetVolume(e)},on:function(e,t){var r=this;if("camera:player"===e){var i=g.default.getters("getPlayer").camera;this.camera(i.wrapContainer,i.playerId,i.callback)}if("video:player"===e||"ppt:player"===e){var n=g.default.getters("getPlayer").video;n.wrapContainer&&n.playerId&&this.mainPlayer(n.wrapContainer,n.playerId,n.callback)}"flash:destroy:all"===e&&this.destroy(),"socket:cmd"===e&&(v.default.debug("flash execute command ==>",t),(JSON.parse(t)||"").t==_.default.CMD.VIDEO_START&&setTimeout(function(){r.play()},500),this.getPlayer(function(e){e.command(t)}));"live:stop"===e&&this.stop()},reload:function(){v.default.debug("Flash on reload!"),this.play()},setPlayer:function(e){var t=v.default.getFlash(this.mainPlayerId);return!!t&&(v.default.callback(e,t),t)},getPlayer:function(e){this.setPlayer(e)},setCameraPlayer:function(e){var t=v.default.getFlash(this.cameraPlayerId);return!!t&&(v.default.callback(e,t),t)},getCameraPlayer:function(e){this.setCameraPlayer(e)},mainPlayer:function(e,t,r){var i=g.default.getters("getInitData");v.default.debug("mainPlayer do Start...");var n=v.default.isShowDebug()?"list":"",a=v.default.getStaticHost(i.swfUrl),o=i,s=i.user;if(this.setPlayer())return!1;var l=v.default.flashChecker();if(!l.flash)return v.default.warn("PPT播放器加载失败, 请安装或允许Flash插件 (https://get.adobe.com/cn/flashplayer/)"),v.default.warn("Chrome 启用 Flash Player 方法 ==> (https://www.flash.cn/help/article/article.php?id=45)"),m.default.get("flash:load:error")(l),!1;if(a=v.default.flashDebugPath(a),"function"!=typeof r&&(r=function(){}),!e)return v.default.warn("mainPlayer 播放器ID 未定义"),!1;t=t||e+"_tflash",this.mainPlayerId=t;var u=e+"_flash",d=document.createElement("div");d.id=u,document.querySelector("#".concat(e)).appendChild(d);var c={bufferlength:_.default.player.bufferlength,bufferTimeMax:_.default.player.bufferTimeMax,bufferTimeArr:_.default.player.bufferTimeArr,cmdTimeDelay:_.default.player.cmdTimeDelay,xid:s.xid,uid:s.uid,pid:s.pid,roomid:s.roomid,debug:n};for(var f in o.flashvar)c[f]=o.flashvar[f];var h={quality:"high",allowscriptaccess:"always",allowfullscreen:"true",wmode:"transparent"},p={};p.id=t,p.name=t,p.align="middle";v.default.debug("主播播放器渲染开始...");try{y.default.embedSWF(a,u,"100%","100%","10.2.0","",c,h,p,function(e){e&&e.ref&&r(e.ref)})}catch(e){v.default.debug("[wb]flash on error",e)}y.default.createCSS("#"+t,"display:block;width:100%;height:100%;"),v.default.debug("主播播放器渲染完成...")},camera:function(e,t,r){v.default.debug("Camera player do Start...");var i=g.default.getters("getInitData"),n=0<location.href.indexOf("debug=list")?"list":"",a=v.default.getStaticHost(i.cameraUrl),o=i,s=i.user;if(this.setCameraPlayer())return this.play(),!1;var l=v.default.flashChecker();if(!l.flash)return v.default.warn("Camera播放器加载失败, 请安装/允许Flash插件 (https://get.adobe.com/cn/flashplayer/)"),v.default.warn("Chrome 启用 Flash Player 方法 ==> (https://www.flash.cn/help/article/article.php?id=45)"),m.default.get("flash:load:error")(l),!1;if(a=v.default.flashDebugPath(a),"function"!=typeof r&&(r=function(){}),!e)return v.default.warn("Flash[camera]容器ID未定义"),!1;v.default.debug("Flash[camera]容器ID完成 ==>",e),this.cameraPlayerId=t;var u=e+"_flash",d=document.createElement("div");d.id=u,document.querySelector("#".concat(e)).appendChild(d);var c={bufferlength:_.default.camera.bufferlength,bufferTimeMax:_.default.camera.bufferTimeMax,bufferTimeArr:_.default.player.bufferTimeArr,xid:s.xid,uid:s.uid,pid:s.pid,roomid:s.roomid,debug:n};for(var f in o.flashvar)c[f]=o.flashvar[f];var h={quality:"high",allowscriptaccess:"always",allowfullscreen:"true",wmode:"transparent"},p={};p.id=t,p.name=t,p.align="middle";try{y.default.embedSWF(a,u,"100%","100%","10.2.0","",c,h,p,function(e){e&&e.ref&&r(e.ref)})}catch(e){v.default.debug("[camera]Flash on error ==>",e)}y.default.createCSS("#"+t,"display:block;"),v.default.debug("摄像头渲染完成...")},cameraCallback:function(e){var t=null,r=this;t=setInterval(function(){v.default.debug("camera-callback:"+r._cameraPlayerLoaded),r._cameraPlayerLoaded&&(clearInterval(t),m.default.get("cameraCallback")(e),r.initRunStep("camera"))},400);r.getCameraPlayer(function(e){try{var t=e.getParams("buffer");r.liveBuffer=JSON.parse(t),v.default.debug("当前缓冲模式:===>",r.liveBuffer)}catch(e){r.liveBuffer=1,v.default.debug("缓冲模式Error",e)}})},mainPlayerCallback:function(){var e=null,t=this;e=setInterval(function(){!function(){if(t.initRunStep("mainPlayer"),v.default.debug("mainplayer-callback:"+t._playerLoaded),t._playerLoaded)clearInterval(e)}()},400)},windowInterface:function(){var n=this;g.default.getters("getInitData");return v.default.debug("Flash global-Interface init..."),{readyModule:function(e){v.default.debug("MT.live.readyModule",e);switch(e=e||_.default.HT_MAIN_PLAYER){case _.default.HT_MAIN_PLAYER:return _.default.HT_MAIN_PLAYER;case _.default.HT_CAMERA_PLAYER:return _.default.HT_CAMERA_PLAYER;case _.default.HT_LIVE_PLAYER:return this.livePlayerLoaded(),_.default.HT_LIVE_PLAYER}return e},livePlayerLoaded:function(){v.default.debug("MT.live.livePlayerLoaded"),livePlayer.livePlayerLoaded=!0,livePlayer.getPlayer(function(e){m.default.get("livePlayerCallback")(e),livePlayer.initPlayer()})},playerLoaded:function(){return v.default.debug("MT.live.mainPlayerLoaded"),n._playerLoaded=!0,n.getPlayer(function(e){n.mainPlayerCallback(m.default.get("mainPlayerCallback")(e))}),this.syncLoad("mainPlayer LoadSuccess..."),!0},cameraPlayerLoaded:function(){v.default.debug("MT.live.cameraPlayerLoaded");return n._cameraPlayerLoaded=!0,n.getCameraPlayer(function(e){n.cameraCallback(e)}),this.syncLoad("cameraPlayer LoadSuccess..."),!0},times:0,syncLoad:function(e){v.default.debug("syncLoad() ===> "+e);!0===n._playerLoaded&&!0===n._cameraPlayerLoaded&&n.onPlayerLoadSuccess()},getVoiceMode:function(){return v.default.debug("Flash call voiceMode"),"rtmp"},desktopFirstPlay:function(){v.default.debug("desktop fplay"),m.default.get("live:media:play")("desktop")},cameraFirstPlay:function(){v.default.debug("camera fplay"),m.default.get("live:media:play")("camera")},cameraPlay:function(e,t){v.default.debug("camera call play:"+player.cameraPlayerId),null!==player.cameraPlayerId&&v.default.getFlash(player.cameraPlayerId).cameraPlay(e,t),v.default.debug("camera playing")},cameraShow:function(){v.default.debug("camera call show."),null!==n.cameraPlayerId&&m.default.get("camera:start")()},cameraHide:function(){v.default.debug("camera call hide."),null!==n.cameraPlayerId&&m.default.get("camera:stop")()},cameraStop:function(){v.default.debug("camera call stop."),null!==n.cameraPlayerId&&n.getCameraPlayer(function(e){e.cameraStop()})},cameraSetVolume:function(t){v.default.debug("MT.live.cameraSetVolume"),n.getCameraPlayer(function(e){e.cameraSetVolume(t)})},swfRemote:function(t){v.default.debug("remote cmd ==> ",t),n.getCameraPlayer(function(e){e.swfRemote(t)})},cameraCommand:function(t){v.default.debug("MT.live.cameraCommand"),n.getCameraPlayer(function(e){e.cameraCommand(t)})},optCommand:function(t){v.default.debug("MT.live.optCommand"),n.getPlayer(function(e){e.optCommand(t)})},jsCallFlash:function(t,r,i){switch(v.default.debug("MT.live.jsCallFlash",r),r="object"===(0,a.default)(r)?JSON.stringify(r):"",i){case"mainPlayer":n.getPlayer(function(e){e.jsCallFlash(t,r,i)});break;case"cameraPlayer":n.getCameraPlayer(function(e){e.jsCallFlash(t,r,i)});break;case"livePlayer":n.getPlayer(function(e){e.jsCallFlash(t,r,i)})}},flashCallJs:function(e){v.default.debug("MT.live.flashCallJs",e);var t={};if(e){"object"===(0,a.default)(e)&&0<e.length&&(e[0]&&e[0],e[1]&&(t=e[1]));try{t=JSON.parse(t)}catch(e){}t=t}},flashAnnounce:function(e){return v.default.debug("MT.live.flashAnnounce"),e=e||"",m.default.get("player:announce")(e),e}}},destroy:function(){var e=g.default.getters("getPlayer").camera,t=g.default.getters("getPlayer").video,r=document.querySelector("#"+e.playerId),i=document.querySelector("#"+t.playerId);r&&r.parentNode.removeChild(r),i&&i.parentNode.removeChild(i),this._playerLoaded=null,this._playerLoaded=null}},l=window.__flash=s;t.default=l},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=i(r(1)),n=(i(r(18)),i(r(10))),a=i(r(6)),u=i(r(7)),d=i(r(15)),c=i(r(5)),o=i(r(56)),s={videoUrl:null,curStream:null,vdom:null,player:null,hlsPlayer:null,getVideoEl:function(){if(this.vdom)return this.vdom},volume:function(e){this.getVideoEl()&&(this.getVideoEl().volume=e)},init:function(e,t){var r=this;if(e&&(n.default.setBaseParam({srcUrl:e.hls}),this.curStream=e),t&&(this.vdom=t),o.default.isSupported()){l.default.debug("hls.js player init =>",t,e.hls);var i=new o.default;i.attachMedia(t),i.on(o.default.Events.MEDIA_ATTACHED,function(){l.default.debug("video and m3u8 are now bound together!"),i.loadSource(e.hls),r.hlsEvent(i),r.play()}),this.hlsPlayer=i}else this.initByNative.apply(this,arguments)},hlsEvent:function(e){e.on(o.default.Events.MANIFEST_PARSED,function(e,t){l.default.debug("manifest loaded, found "+t.levels.length+" quality level")})},initByNative:function(e,t){if(l.default.debug("hls native player init =>",t),!t)return!1;var r=e.hls;this.videoUrl=r,this.play()},isSupported:function(){return o.default.isSupported()},play:function(){if(l.default.debug("HLS on play..."),this.vdom){var e=this.vdom;this.isSupported()&&this.hlsPlayer||(e.load(),e.src=this.videoUrl),a.default.elementPlay(e)}return Promise.resolve()},changeSource:function(e){this.vdom&&(this.videoUrl=e.hls,this.play())},reload:function(e){var t=e||this.curStream;this.hlsPlayer?(this.hlsPlayer.destroy(),this.init(t,this.vdom)):t?this.changeSource(t):this.play()},onError:function(){l.default.debug("hls on error")},on:function(e,t){var r=this;l.default.debug("HLS on ==>",e,"==>",t);var i=c.default.getters("getPlayer");if("camera:player"===e){if(0!=c.default.getters("getGlobal").curMode)return!1;var n=u.default.getMediaList(),a=u.default.getVideoDom("camera");this.init(n,a),l.default.callback(i.camera.callback,a)}if("video:player"===e){if(0==c.default.getters("getGlobal").curMode)return!1;var o=u.default.getMediaList(),s=u.default.getVideoDom("video");this.init(o,s)}"media:destroy"===e&&d.default.destroy(t,function(){r.destroy()})},events:function(){},destroy:function(){u.default.removeControls(this.vdom.parentNode),this.hlsPlayer&&(this.hlsPlayer.destroy(),this.hlsPlayer=null),this.videoUrl=null}},f=window.__hls=s;t.default=f},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(7)),a=(i(r(6)),i(r(28))),o=i(r(14)),s=i(r(5)),l=i(r(1)),u=i(r(3)),d={packUrl:null,whiteboardObject:null,loadPack:!1,loadCommandLoack:!1,commands:{},build:function(){this.init()},init:function(){var r=this,e=s.default.getters("getInitData");if(e.whiteboard&&(this.packUrl=e.whiteboard),"FLASH"===a.default.getTechOrder())return l.default.debug("正在初始化Flash画板..."),!1;if(this.whiteboardObject)return this.whiteboardObject;l.default.debug("Whiteborad on beforeCreate...");var i=s.default.getters("getPlayer").whiteboard;return i&&i.wrapContainer?this.load().then(function(e){if(r.whiteboardObject)return!1;l.default.debug("Whiteboard SDK on init...");var t=new e(i.wrapContainer,!1,!1);t.on("whiteboard:init:ready",function(){s.default.getters("getExtData").config.controls&&n.default.setControls("whiteboard",i.wrapContainer)}),t.setUser({role:"user"}),r.whiteboardObject=t,l.default.callback(i.callback,t)}).then(function(){[n.default.getStep(2),n.default.getStep(6),n.default.getStep(7)].forEach(function(e){e&&o.default.dispatch(e)})}).catch(function(e){console.error("whiteboard.js load error ==>",e),Promise.reject("whiteboard on Reject ==>",e)}):(l.default.warn("[PPT]课件播放器容器初始化错误..."),!1)},load:function(){var i=this;return new Promise(function(e,t){if(window.WhiteBoard)e(window.WhiteBoard);else{if(i.loadPack)return!1;i.loadPack=!0;var r=document.createElement("script");r.src=i.packUrl,r.addEventListener("load",function(){e(window.WhiteBoard)},!1),r.addEventListener("error",function(){t("load script error!")},!1),document.body.appendChild(r)}})},getPlayer:function(e){this.whiteboardObject&&"function"==typeof e&&e(this.whiteboardObject)},destroy:function(e){var t=this;if(l.default.debug("Whiteboard SDK on destroy...",s.default.getters("getTechOrder")),"FLASH"===s.default.getters("getTechOrder"))return e&&e(),Promise.resolve();if(this.whiteboardObject){this.loadCommandLoack=!1;var r=s.default.getters("getPlayer").whiteboard,i=document.querySelector("#"+r.wrapContainer);i&&this.whiteboardObject.destroy().then(function(){n.default.removeControls(i),t.whiteboardObject=null,e&&e()})}},setPage:function(e){var t=this;this.whiteboardObject&&(l.default.debug("Whiteboard render set Page ...",e.p),e.t=e.t.toString(),this.whiteboardObject.setPage(e),this.getCommands(e,function(e){e&&0<e.length&&e.forEach(function(e){l.default.debug("run ==>",e),t.whiteboardObject.render({data:e})})}))},on:function(e,t){l.default.debug("whiteboard emit on ==>",e,t),"ppt:player"===e&&this.init(),"ppt:destroy"===e&&this.destroy(t),"live:set:page"===e&&this.setPage(t)},getCommands:function(e,t){if(!this.whiteboardObject||this.loadCommandLoack)return!1;var r=s.default.getters("getToken");this.loadCommandLoack=!0,l.default.ajax({type:"GET",url:u.default.APP_HOST+"/live/command.php",dataType:"jsonp",data:{access_token:r,page:e.p},success:function(e){e.code==u.default.CODE.SUCCESS&&(l.default.debug("get commands from server:",e.data),t(e.data))}})}},c=window.__whiteboard=d;t.default=c},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(6)),a=r(1),o=r(74),s=r(2),l=(r(27),new o),u={connentTimes:0,qtHeartBeatTimer:null,qtObject:null,createConnectMaxCount:0,isTalkFunBrowser:0,initLockScreen:!1,setting:function(e){"screen:lock"===e?this.initLockScreen=!0:"screen:unlock"===e&&(this.initLockScreen=!1)},doInit:function(){},on:function(e,t){s.put("client:"+e,t)},get:function(e,t){s.get("client:"+e)(t)},emit:function(e,t,r){this.sendMsgToClient.call(this,e,t,2,r)},process:function(e){var t=null,r=this;switch(e.args.args?t=e.args.args:e.args&&(t=e.args),a.debug("clietn socket message ==>",e),t.t){case"start":r.sendMsgToClient("live:start",e.args);break;case"stop":r.sendMsgToClient("live:stop",e.args);break;case n.default.COMMAND.CAMERA_START:r.sendMsgToClient("camera:start",e.args);break;case n.default.COMMAND.CAMERA_STOP:r.sendMsgToClient("camera:stop",e.args);break;default:r.sendMsgToClient(e.cmd,e.args,"socket")}},send:function(e){l.sendMessage(e.t,e.args,e.type)},queue:[],timer:null,timeToSend:800,sendToTBrowser:function(e,t){var r=this,i=this;i.qtObject&&e&&(this.queue.push({payload:e,type:t}),this.timer||(this.timer=setInterval(function(){if(0<r.queue.length){var e=r.queue.shift();a.debug("Send cmd to TF-Client success ===> ",e),i.qtObject.JSSendMessage(e.type,JSON.stringify(e.payload))}else window.clearInterval(r.timer),r.timer=null},this.timeToSend)))},sendMsgToClient:function(e,t,r){a.debug("TalkFun-Client ===> ",e,t,r);var i={cmd:e,data:t};r=r||1,a.isCloudLiveBrowser()?this.sendToTBrowser(i,r):l.sendMessage(e,t,r)},init:function(){var t=this;a.debug("TF-Browser Init ==>",a.isCloudLiveBrowser());var r=this;a.qtWebEngine(function(e){t.qtObject=e,r.get("on:init",r),e.SigSendMessageToJS.connect(function(e){if("string"==typeof e){var t=JSON.parse(e);t.cmd&&t.data?r.get(t.cmd,t.data):r.get("client:data:callback",e)}})}),l.receiveMessage(function(e){r.get(e.cmd,e.msg)})}};t.default=u},function(e,t,r){"use strict";var i=r(12),n=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(4)),s=n(r(3)),o=n(r(5)),l=i(r(13)),u=n(r(46)),d=n(r(9)),c=n(r(1)),f=n(r(2)),h=n(r(16)),p=n(r(32)),g=n(r(75)),m=n(r(82)),v=n(r(17)),_=n(r(33)),y=n(r(6)),b=n(r(34)),E=n(r(24)),S=n(r(83)),w=n(r(10)),T=n(r(84)),k=n(r(85)),A=n(r(31)),D=(n(r(8)),n(r(14))),R=(n(r(30)),n(r(86)),n(r(20))),O=n(r(22)),L=n(r(7)),C=n(r(87));c.default.debug("TF_JSSDK v".concat("3.1","-").concat((new Date).getTime())),E.default.init(),o.default.init(),o.default.commit(l.UPDATE_API_DOMAIN,window.apiHost||"https://open.talk-fun.com");var P,x=window.sdkVersion||"3.1";c.default.debug("SDK-Core-Version: "+x),c.default.debug("Current-UA ===> "+navigator.userAgent),w.default.setBaseParam({sdkVersion:x}),u.default.player=D.default;var I={SYS_CODE:x,version:x,tools:c.default,socket_connect_success:!1,room_init:!1,initDataObj:null,me:{},zhubo:{},getAvatar:h.default.dealMemberAvatar,client:E.default,plugins:g.default,main:function(){var e=arguments;c.default.debug("Talk-Fun JS-SDK Params",c.default.argumentToArray(arguments)),this.getAvatar=h.default.dealMemberAvatar;var t=null,r=null,i=null;if(!this.init)return c.default.error("实例化 MT 对象失败, 请重试!"),f.default.get("system:room:error")({msg:"实例化 MT 对象失败, 请重试!"}),!1;if(0<e.length&&e.length<=3){if(3<e)return c.default.warn("参数错误, 请传入正确参数"),f.default.get("system:room:error")({msg:"参数错误, 请传入正确参数"}),!1;1===e.length?"string"==typeof e[0]&&(t=e[0],this.init(t)):2===e.length?"string"==typeof e[0]&&"function"==typeof e[1]?(t=e[0],r=e[1],this.init(t,r)):"string"==typeof e[0]&&"object"===(0,a.default)(e[1])&&(t=e[0],i=e[1],o.default.commit(l.UPDATE_EXT_CONFIG,i),this.init(t)):3===e.length&&"string"==typeof e[0]&&"object"===(0,a.default)(e[1])&&"function"==typeof e[2]&&(t=e[0],i=e[1],r=e[2],o.default.commit(l.UPDATE_EXT_CONFIG,i),this.init(t,r))}else c.default.warn("参数错误, 请传入正确token值"),f.default.get("system:room:error")({msg:"参数错误, 请传入正确token值"});this.access_token=t}};P=c.default.deepClone(I),I.main.prototype.getTools=function(){return c.default},I.main.prototype.init=function(e,t){var r=this;o.default.commit(l.UPDATE_TOKEN,e),d.default.init(e,function(e){c.default.debug("Get Start =>",e),e&&(I.main.prototype.initDataObj=e,o.default.commit(l.UPDATE_INIT_DATA,e),y.default.updateCourseData(e.course||null),r.serverRoom=e,r.room(e,t),D.default.init())},D.default)},I.main.prototype.room=function(e,t){var r=e,i=this,n=I.room={};n.initData=r.InitData,n.appHost=r.appHost,n.conString=r.conString,n.heartbeatInterval=r.heartbeatInterval,n.live=r.live,n.modules=r.modules,n.plugin=r.plugin,n.rtmp=r.rtmp,n.curUser=h.default.dealMemberAvatar(r.user),n.voiceFlow=r.voiceFlow,n.zhubo=r.zhubo,n.user=r.user,n.title=r.InitData.title,n.websocket=r.websocket,n.cameraUrl=r.cameraUrl,n.swfUrl=r.swfUrl,n.livingDuration=r.live.duration,n.announce=r.announce,n.flashvar=r.flashvar,n.initEvent=r.initEvent,n.access_token=this.access_token,n.modeType=r.room.modetype,n.livePlayerUrl=r.livePlayerUrl,n.resConfig=r.resConfig,S.default.setData(r),r.InitData.action&&(D.default.action=r.InitData.action,y.default.setPlayerStatus(r.InitData.action)),r.flower&&(i.plugins("flower").initFlower=r.flower),r.room.robotList&&(n.robots=r.room.robotList),r.modules&&(n.roomModules=r.modules),r.course&&(n.course=r.course),r.usercamera?(n.userCamera=r.usercamera,r.usercamera.inviteList2&&f.default.get("rtc:invite")(r.usercamera.inviteList2)):n.userCamera={},r.room.chatList&&(r.room.chatList&&0<r.room.chatList.length&&r.room.chatList.forEach(function(e){h.default.dealMemberAvatar(e)}),f.default.get("chat:list")(r.room.chatList)),n.ext=r.ext,r.room&&r.room.online&&(n.online=r.room.online),I.room=n,this.roomObject=r,this.roomInfo=n,c.default.debug("房间初始化完成 ====> room:init"),i._applyByInit(n,r),r.room.chat&&0<r.room.chat.disableall&&f.default.get("chat:disable:all")({status:r.room.chat.disableall}),u.default.init(I.room,function(e){c.default.debug("room data ==>",I.room),i._listen(e)}),0===T.default.queueArys.length&&D.default.doStep(),T.default.run(i),T.default.isLoaded=!0,c.default.callback(t,r)},I.main.prototype.getLiveState=function(){var e="wait";return this.firstRun?e=D.default.action:("string"==typeof D.default.action&&(e=D.default.action),this.firstRun=!0),c.default.debug("getLiveState => "+e),e},I.main.prototype.getSDKMode=function(){return c.default.getSDKMode()},I.main.prototype.changeMediaElement=function(e){return D.default.changeMediaElement(e)},I.main.prototype.setMediaControl=function(e){c.default.debug("setting controls ==> ",e);var t={fullscreenButton:e.fullscreenButton,volumeButton:e.volumeButton};D.default.setConfig&&D.default.setConfig(t)},I.main.prototype.changePosition=function(e){D.default.initPlayer(null)},I.main.prototype.volume=function(e){D.default.volume&&D.default.volume(e)},I.main.prototype.emitTrigger=function(e){var t,r,i;switch(2===e.length?(t=e[0],i="function"==typeof e[1]?e[1]:""):3===e.length&&(t=e[0],r=e[1],i="function"==typeof e[2]?e[2]:""),t){case"question:ask":var n={action:"question",type:"question",typeId:"ask",filter:r.filter?r.filter:null,replyId:r.replyId||"",content:r.msg,ext:e[1].ext};return _.default.quesPost("ask",n,i),!0;case"question:reply":n={action:"answer",type:"answer",typeId:"reply",replyId:r.replyId,content:r.msg};return _.default.quesPost("reply",n,i),!0;case"question:get:list":return _.default.getList(I.room.access_token,i),!0;case"question:get:part":return _.default.getQuestionById(r.qid,i),!0;case"question:delete":return _.default.allQids.del(r.qid),!0;case"danmaku:open":case"danmaku:close":var a={eventName:t,data:r};return m.default.danmakuHandle(a,D.default),!0;case"rtc:start":return C.default.setUserCamera("start",i),!0;case"rtc:stop":return C.default.setUserCamera("stop",i),!0;case"rtc:up":return C.default.setUserCamera("up",r.xid,i),!0;case"rtc:down":return C.default.setUserCamera("down",i),!0;case"rtc:kick":return C.default.setUserCamera("kick",{xid:r.xid,broad:r.broad||"0"},i),!0;case"rtc:apply":return C.default.setUserCamera("apply",r.xid,i),!0;case"rtc:cancel":return C.default.setUserCamera("cancel",i),!0;case"rtc:clear":return C.default.setUserCamera("clear",null,i),!0;case"rtc:check:state":a={cmd:"rtc:check:state",callback:i};return C.default.dispatch(a),!0;case"rtc:force:out":return C.default.forceOut(i),!0;case"rtc:invite":return C.default.setUserCamera("invite",r.xid,i),!0}},I.main.prototype.packetHandler=function(e){switch(e.args=h.default.dealMemberAvatar(e.args),e.cmd){case"video:whiteboard":if(e){var t=JSON.parse(e.args.metadata);f.default.get("core:whiteboard")(t);var r={liveId:0,courseId:0};if(t.live&&(r.liveId=t.live.liveid),(t.liveid||t.course_id)&&(t.liveid&&(r.liveId=t.liveid),t.course_id&&(r.courseId=t.course_id)),y.default.updateCourseData(t),c.default.debug("Update live data ==>",r),f.default.get("live:data:update")(r),void 0!==e.args.course_id&&d.default.setCourse({course_id:e.args.course_id}),void 0!==e.args.small_rtmp&&!C.default.zhuboSmallRtmp){var i={};i[e.args.small_rtmp.xid]=e.args.small_rtmp,C.default.zhuboSmallRtmp=i}D.default.whiteBoardOnSocket&&D.default.whiteBoardOnSocket(e,t),C.default&&C.default.whiteboard&&C.default.whiteboard(e,t),d.default.broadcastHandler(t)}else f.default.get("whiteboard:error")();break;case"chat:send":m.default.danmaku(e,D.default);break;case"question:ask":_.default.allQids.add(e.args.qid);break;case"question:reply":if(void 0!==e.args.question&&0==_.default.allQids.exists(e.args.replyId)){var n={cmd:e.args.question.cmd="question:ask",args:e.args.question},a=this.packetHandler(n);a&&(c.default.isMobileSDK()&&2==c.default.getSDKMode()?window.SDK.broadcast(n):f.default.get("question:ask")(a))}break;case"question:delete":_.default.allQids.del(e.args.qid);break;case"fakelive:video:converted":break;case"vote:pub":if(e.args.rightUser)for(var o in e.args.rightUser)e.args.rightUser[o]=h.default.dealMemberAvatar(e.args.rightUser[o]);break;case"video:player":try{D.default.controlPlayer(e)}catch(e){}f.default.get("video:player")(e.args.action);break;case"member:leave":h.default.deleteMember(e.args);break;case"member:join:other":e.args.member=h.default.dealMemberAvatar(e.args.member);var s=e.args.member;if(s&&-1<s.uid.indexOf("client_"))return!1;h.default.addMember(e.args);break;case"member:total":h.default.setOnlineTotal(e.args),e.args=h.default.getOnlineTotal();break;case"vote:new":g.default.vote.setData(e);case"voice:mode:change":p.default.VoiceModel(e.args.mode,{},e.args);break;case"voice:power:forbid":p.default.VoiceForbid(e.args.data.xid,e.args.data.voice);break;case"voice:power:allow":p.default.VoiceAllow(e.args.data.xid,e.args.data.voice);break;case"voice:hand:up":case"voice:hand:leave":case"voice:hand:allow":case"voice:hand:forbid":case"voice:hand:remove":case"voice:hand:clear":p.default.VoiceModelAppoint(e.cmd,e);break;case"voice:queue:list":case"voice:queue:join":case"voice:queue:leave":case"voice:queue:move":case"voice:queue:clear":case"voice:queue:control":case"voice:queue:moveto":case"voice:queue:time":p.default.VoiceModelAppoint(e.cmd,e);break;case"rtc:up":case"rtc:down":case"rtc:kick":case"rtc:stop":case"rtc:apply":case"rtc:cancel":case"rtc:force:out":case"rtc:start":case"rtc:ready":case"rtc:invite":C.default.dispatch(e)}return e.args},I.main.prototype._applyByInit=function(e,t){var r=this,i=e;if(r.export2Window(),r.roomObject.room.online&&f.default.get("member:total")(r.roomObject.room.online),g.default.vote.init(i),D.default.room=i,f.default.get("room:mode:type")(i.modeType),f.default.get("mainPlayer")(),f.default.get("camera")(),C.default&&C.default.init&&i.userCamera&&(C.default.room=i,C.default.init(i.userCamera)),d.default.room&&f.default.get("live:room:configs")(d.default.room.room),e.live){var n={liveId:e.live.liveid||0,courseId:e.user.course_id||0};f.default.get("live:data:update")(n)}f.default.get("live:robots:users")(i.robots),i.userCamera&&f.default.get("rtc:init")(i.userCamera),i.initData&&f.default.get("core:initdata")(i.initData),i.roomModules&&f.default.get("live:room:modules")(i.roomModules),i.course&&f.default.get("live:course")(i.course),t.definition&&f.default.get("live:definition")(t.definition),c.default.isMobile()||r.voice(i,u.default),r.broadcastEventInit(i.initEvent),I.me=i.curUser,v.default.init(d.default,D.default),f.default.get("room:init")()},I.main.prototype.export2Window=function(){var e=I.room;return c.default.debug("SDK => window export done..."),window.MT={},window.MT.SYS_CODE=x,window.MT.CODE=s.default.CODE,window.MT.STATIC_HOST=s.default.STATIC_HOST,window.MT.me=e.curUser,window.MT.zhubo=e.zhubo,window.MT.title=e.title,window.MT.ext=e.ext,window.MT.tools=c.default,window.MT.getLiveState=this.getLiveState,window.MT.getSDKMode=this.getSDKMode,window.MT.liveDuration=e.livingDuration||-1,window.MT.announce=e.announce,window.MT.live=R.default.windowInterface(),window.MT.chat=m.default,window.MT.network=v.default||{},window.MT.getDetail=h.default.getMemberDetail||{},window.__map=f.default,window.MT.changeMediaElement=this.changeMediaElement,I},I.main.prototype.getMtData=function(){return I.room},I.main.prototype.broadcastEventInit=function(e){if(void 0!==e&&0<e.length)for(var t=0;t<e.length;t++){var r=e[t].cmd,i=e[t].args;this.get(r,i),E.default.setting(r,i)}},I.main.prototype.getModules=function(e){return void 0!==e&&"function"==typeof e&&e(I.room.modules),I.room.modules},I.main.prototype.playerTechOrder=function(e){D.default.setPlayerTechOrder(e)},I.main.prototype.destroy=function(){v.default.reset(),u.default.destroy(),D.default.destroyAll(),window.MT&&(window.MT=null),window.MT={SDK:P}},I.main.prototype.pptPreview=function(e){var t={wrap:null,callback:null,next:null,prev:null};t=Object.assign(t,e),A.default.init(t)},I.main.prototype._listen=function(e){var i=this;k.default.init("chat:send",{min_run_num:1,max_queue_time:5e3,max_queue_len:1e3,callback:function(e){a(e)}});var n={},a=function(e){if(c.default.debug("obj===>",e),void 0!==e)try{var t=e,r=i.packetHandler(e);if(r)if(c.default.isMobileSDK()&&2==c.default.getSDKMode())t.args=r,window.SDK.broadcast(t);else f.default.get(e.cmd)(r),f.default.get("_liveIframe:broadcast")(e.cmd,r)}catch(e){c.default.debug(e)}};e.on("_broadcast",function(e){if(c.default.debug("package=====> ",e),void 0!==e.cmd)(i=u.default.onBroadcast(e))&&i.cmd&&"chat:send"==i.cmd?k.default.add(i.cmd,i):a(i);else if(e.length)for(var t=0,r=e.length;t<r;t++){var i;(i=u.default.onBroadcast(e[t]))&&i.cmd&&"chat:send"==i.cmd?k.default.add(i.cmd,i):a(i)}}),e.on("_bro:zip",function(e){try{e=b.default.inflate(e,{to:"string"}),e=JSON.parse(e)}catch(e){c.default.debug("_bor:zip ERROR====> ",e.message)}if(void 0!==e.cmd)n=u.default.onBroadcast(e),a(n);else if(e.length)for(var t=0,r=e.length;t<r;t++)n=u.default.onBroadcast(e[t]),a(n)})},I.main.prototype.emit=function(){var t=this,e=arguments.length,r=arguments;if(c.default.debug("emit===>",r,u.default.connectSuc),u.default.connectSuc){if(t.emitTrigger(r))return!1;var i={cmd:r[0]};if(2===e){if("string"==typeof r[0]&&"function"==typeof r[1]){var n=r[0],a=r[1];u.default.emit(n,function(e){a(e),i.args=e,t.packetHandler(i)})}}else{if(3!==e)return r;if("string"==typeof r[0]&&void 0!==r[1]&&"function"==typeof r[2]){var o=r[1];a=r[2];"chat:send"===(n=r[0])&&o.msg&&(o.msg=m.default.toUBB(o.msg)),u.default.emit(n,o,function(e){e.code===s.default.CODE.SUCCESS?(a(e),i.args=e,t.packetHandler(i)):a(e)})}}}else f.default.get("emit:error")(s.default.SOCKET_CONNECT_NOTE)},I.main.prototype.getRatio=function(){},I.main.prototype.on=function(e,t){void 0!==e&&0<e.length&&"string"==typeof e&&void 0!==t&&"function"==typeof t?f.default.put(e,t):alert(s.default.MT_ADDMAPLIST_ERROR+": "+e)},I.main.prototype.get=function(e,t){void 0!==e&&0<e.length&&"string"==typeof e?f.default.get(e)(t):alert(s.default.MT_ADDMAPLIST_ERROR+": "+e)},I.main.prototype.mainPlayer=function(e,t,r){T.default.join("live:main:player",{parent:this,callback:function(){D.default.mainPlayer(e,t,r)}})},I.main.prototype.whiteboardPlayer=function(e,t,r){T.default.join("whiteboard:player",{parent:O.default,callback:function(){D.default.whiteboardCore(e,t,r)}})},I.main.prototype.videoPlayer=function(e,t){},I.main.prototype.camera=function(e,t,r){D.default.camera.apply(D.default,arguments),T.default.join("live:camera:player",{parent:this,callback:function(){D.default.cameraRun()}})},I.main.prototype.livePlayer=function(e,t,r){C.default.containerId=e,C.default.playerId=t,C.default.playerCallback=r,c.default.debug("create liveplayer ...",this.isLivePlayerCanCreate,i);var i=document.getElementById(e)},I.main.prototype.member=function(e){if(!u.default.connectSuc)return!1;e(h.default.userList)},I.main.prototype.voice=function(e,t){p.default.init(e,t,this)},I.main.prototype.getQuestion=function(e){u.default.getQuestionList(d.default.getAccessToken(),e)},I.main.prototype.cmdHandleEmit=function(e,t,r){E.default.sendMsgToClient(e,t,r)},I.main.prototype.cmdHandleOn=function(e,t){E.default.on.apply(this,arguments)},I.main.prototype.plugins=function(e){return g.default[e]?g.default[e]:g.default},I.main.prototype.playerResize=function(e,t){if(D.default.resize)return D.default.resize(e,t)},I.main.prototype.play=function(){D.default.play()},I.main.prototype.pause=function(){D.default.pause()},I.main.prototype.reload=function(){D.default.reload()},I.main.prototype.setLine=function(e){L.default.setLine(e)};var M=I;t.default=M},function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,_interopRequireDefault=__webpack_require__(0),_typeof2=_interopRequireDefault(__webpack_require__(4)),rH;rH=function(){return function(){function extend(){var e=Array.prototype.slice.call(arguments);if(e.length<=1){if("[object Object]"===Array.prototype.toString.call(e[0]))return console.warn("extend methods received one param or none, need two more."),e[0];throw new Error("Must passed an object.")}for(var t=e.shift(),r=0;r<e.length;r++){var i=e[r];if("[object Object]"!==Array.prototype.toString.call(i))throw new Error("extend method's error: the"+(r+1));for(var n in i)"[object Object]"===Object.prototype.toString.call(i[n])?(t[n]={},extend(t[n],i[n])):"[object Array]"===Object.prototype.toString.call(i[n])?t[n]=i[n].slice():t[n]=i[n]}return t}function isEmptyObject(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function formatParam(e,t){var r,i,n=[];t=t||!1;for(var a in e)i=t?(r=encodeURIComponent(a),encodeURIComponent(e[a])):e[r=a],n.push(r+"="+i);return n.join("&")}function ajaxs(options){if("[object Object]"!==Object.prototype.toString.call(options))throw new Error("should passed an object.");var abortTimer=null,responseHeaderContentType="",dhead,s,defaults={url:"",type:"get",dataType:"json",data:{},timeout:0,withCredentials:!0,async:!0,cache:!1,beforeSend:function(e){return e},success:function(){},error:function(){}};defaults=Object.assign?Object.assign(defaults,options):extend(defaults,options);var type=defaults.type.toLowerCase(),url=defaults.url,dataType=defaults.dataType.toLowerCase();if("string"==typeof defaults.data){for(var tempDataArr=defaults.data.split("&"),tempDataObj={},i=0;i<tempDataArr.length;i++){var cur=tempDataArr[i],tempCurArr=cur.split("=");tempDataObj[tempCurArr[0]]=tempCurArr[1]}var data=tempDataObj}else var data=defaults.data;var async=defaults.async,cache=defaults.cache,tTimeStampName="ht_tstamp",timeout=defaults.timeout,encodeFlag=!1,contentType=defaults.contentType;if("jsonp"===dataType){var jsonp=data.jsonp||"callback",jsonpCallback;if(jsonpCallback=defaults.jsonpCallback?defaults.jsonpCallback:"tf_tstamp"+(new Date).getTime().toString()+Math.random().toString().slice(2),url=url+"?"+jsonp+"="+jsonpCallback,url=url+"&"+formatParam(data),cache||(url=url+"&"+tTimeStampName+"="+(new Date).getTime().toString()),s=document.createElement("script"),dhead=dhead||document.getElementsByTagName("head")[0],s.src=url,s.onerror=function(){throw new Error("script onerror: jsonp请求发送失败")},defaults.beforeSend&&!1===defaults.beforeSend())return!1;dhead.appendChild(s),window[jsonpCallback]=function(e){clearTimeout(s.timer),dhead.removeChild(s),window[jsonpCallback]=null,defaults.success&&defaults.success(e)},defaults.timeout&&(s.timer=setTimeout(function(){dhead.removeChild(s),window[jsonpCallback]=null,defaults.error&&defaults.error({message:"jsonp request timeout"})},timeout))}else if("script"===dataType){if(s=document.createElement("script"),dhead=dhead||document.getElementsByTagName("head")[0],isEmptyObject(data)||(url=-1<url.lastIndexOf("?")?url+"&"+formatParam(data):url+"?"+formatParam(data)),cache||(url=(url.lastIndexOf("?"),url+"&"+tTimeStampName+"="+(new Date).getTime().toString())),s.src=url,s.onload=function(){defaults.success&&defaults.success(this),s=null},s.onerror=function(){defaults.error&&defaults.error({message:"script loaded error"}),s=null},defaults.beforeSend&&!1===defaults.beforeSend())return!1;dhead.appendChild(s)}else{var xhr=new XMLHttpRequest;if(xhr="withCredentials"in xhr?xhr:"undefined"!=typeof XDomainRequest?new XDomainRequest:null,xhr.onreadystatechange=function(){var res,status;1===xhr.readyState&&!abortTimer&&0<timeout&&(abortTimer=setTimeout(function(){xhr.abort(),abortTimer=null},timeout)),2===xhr.readyState&&(responseHeaderContentType=xhr.getResponseHeader("Content-Type")),4===xhr.readyState&&(status=xhr.status,200<=status&&status<300?(clearTimeout(abortTimer),abortTimer=null,"json"!==dataType||/javascript/.test(responseHeaderContentType)?"xml"===dataType?xhr.responseXML&&(res=xhr.responseXML,res.documentElement&&(res=res.documentElement)):res=xhr.responseText:res="object"===(0,_typeof2.default)(xhr.responseText)?xhr.responseText:JSON.parse?"string"==typeof xhr.responseText&&0<xhr.responseText.length?JSON.parse(xhr.responseText):{}:eval("("+xhr.responseText+")"),options.success&&options.success(res)):options.error&&options.error(status))},"get"===type){if(isEmptyObject(data)||(url=-1<url.lastIndexOf("?")?url+"&"+formatParam(data):url+"?"+formatParam(data)),cache||(url=-1<url.lastIndexOf("?")?url+"&"+tTimeStampName+"="+(new Date).getTime().toString():url+"?"+tTimeStampName+"="+(new Date).getTime().toString()),xhr.open(type,url,async),!1===("function"==typeof defaults.beforeSend&&defaults.beforeSend(xhr)))return xhr=null,!1;xhr.send(null)}else if("post"===type){if(xhr.open(type,url,async),contentType?xhr.setRequestHeader("Content-Type",contentType):xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!1===(defaults.beforeSend&&defaults.beforeSend(xhr)))return xhr=null,!1;var _params="",_postArrs=[];if("object"===(0,_typeof2.default)(data)){var _postDatas=Object.keys(data),_it="";if(0<_postDatas.length)for(var _k in data)_it=_k+"="+data[_k],_postArrs.push(_it);_params=_postArrs.join("&")}xhr.send(_params)}}}return ajaxs}()},__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=rH)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,r){"use strict";function i(e,r){if("object"===(0,s.default)(e)&&"function"==typeof e.send){var n=this;this.transport=e,this.send=function(e){"string"!=typeof e&&(e=JSON.stringify(e)),n.transport.send(e)},this.transport.onmessage=function(e){var t=e.data;switch("string"==typeof t&&(t=JSON.parse(t)),t.type){case l.signal:n.handleSignal(t);break;case l.response:n.handleResponse(t);break;case l.propertyUpdate:n.handlePropertyUpdate(t);break;default:console.error("invalid message received:",e.data)}},this.execCallbacks={},this.execId=0,this.exec=function(e,t){t?(n.execId===Number.MAX_VALUE&&(n.execId=Number.MIN_VALUE),e.hasOwnProperty("id")?console.error("Cannot exec message with property id: "+JSON.stringify(e)):(e.id=n.execId++,n.execCallbacks[e.id]=t,n.send(e))):n.send(e)},this.objects={},this.handleSignal=function(e){var t=n.objects[e.object];t?t.signalEmitted(e.signal,e.args):console.warn("Unhandled signal: "+e.object+"::"+e.signal)},this.handleResponse=function(e){e.hasOwnProperty("id")?(n.execCallbacks[e.id](e.data),delete n.execCallbacks[e.id]):console.error("Invalid response message received: ",JSON.stringify(e))},this.handlePropertyUpdate=function(e){for(var t in e.data){var r=e.data[t],i=n.objects[r.object];i?i.propertyUpdate(r.signals,r.properties):console.warn("Unhandled property update: "+r.object+"::"+r.signal)}n.exec({type:l.idle})},this.debug=function(e){n.send({type:l.debug,data:e})},n.exec({type:l.init},function(e){for(var t in e)new u(t,e[t],n);for(var t in n.objects)n.objects[t].unwrapProperties();r&&r(n),n.exec({type:l.idle})})}else console.error("The QWebChannel expects a transport object with a send function and onmessage callback property. Given is: transport: "+(0,s.default)(e)+", transport.send: "+(0,s.default)(e.send))}var n,a,o,s=r(0)(r(4)),l={signal:1,propertyUpdate:2,init:3,idle:4,debug:5,invokeMethod:6,connectToSignal:7,disconnectFromSignal:8,setProperty:9,response:10};function u(e,t,a){this.__id__=e,(a.objects[e]=this).__objectSignals__={},this.__propertyCache__={};var o=this;function n(e,r){var i=e[0],n=e[1];o[i]={connect:function(e){"function"==typeof e?(o.__objectSignals__[n]=o.__objectSignals__[n]||[],o.__objectSignals__[n].push(e),r||"destroyed"===i||a.exec({type:l.connectToSignal,object:o.__id__,signal:n})):console.error("Bad callback given to connect to signal "+i)},disconnect:function(e){if("function"==typeof e){o.__objectSignals__[n]=o.__objectSignals__[n]||[];var t=o.__objectSignals__[n].indexOf(e);-1!==t?(o.__objectSignals__[n].splice(t,1),r||0!==o.__objectSignals__[n].length||a.exec({type:l.disconnectFromSignal,object:o.__id__,signal:n})):console.error("Cannot find connection of signal "+i+" to "+e.name)}else console.error("Bad callback given to disconnect from signal "+i)}}}function s(e,t){var r=o.__objectSignals__[e];r&&r.forEach(function(e){e.apply(e,t)})}for(var e in this.unwrapQObject=function(e){if(e instanceof Array){for(var t=new Array(e.length),r=0;r<e.length;++r)t[r]=o.unwrapQObject(e[r]);return t}if(!e||!e["__QObject*__"]||void 0===e.id)return e;var i=e.id;if(a.objects[i])return a.objects[i];if(e.data){var n=new u(i,e.data,a);return n.destroyed.connect(function(){if(a.objects[i]===n){delete a.objects[i];var e=[];for(var t in n)e.push(t);for(var r in e)delete n[e[r]]}}),n.unwrapProperties(),n}console.error("Cannot unwrap unknown QObject "+i+" without data.")},this.unwrapProperties=function(){for(var e in o.__propertyCache__)o.__propertyCache__[e]=o.unwrapQObject(o.__propertyCache__[e])},this.propertyUpdate=function(e,t){for(var r in t){var i=t[r];o.__propertyCache__[r]=i}for(var n in e)s(n,e[n])},this.signalEmitted=function(e,t){s(e,t)},t.methods.forEach(function(e){var t=e[0],i=e[1];o[t]=function(){for(var r,e=[],t=0;t<arguments.length;++t)"function"==typeof arguments[t]?r=arguments[t]:e.push(arguments[t]);a.exec({type:l.invokeMethod,object:o.__id__,method:i,args:e},function(e){if(void 0!==e){var t=o.unwrapQObject(e);r&&r(t)}})}}),t.properties.forEach(function(e){var t=e[0],r=e[1],i=e[2];o.__propertyCache__[t]=e[3],i&&(1===i[0]&&(i[0]=r+"Changed"),n(i,!0)),Object.defineProperty(o,r,{configurable:!0,get:function(){var e=o.__propertyCache__[t];return void 0===e&&console.warn('Undefined value in property cache for property "'+r+'" in object '+o.__id__),e},set:function(e){void 0!==e?(o.__propertyCache__[t]=e,a.exec({type:l.setProperty,object:o.__id__,property:t,value:e})):console.warn("Property setter for "+r+" called with undefined value!")}})}),t.signals.forEach(function(e){n(e,!1)}),t.enums)o[e]=t.enums[e]}o=function(){return{QWebChannel:i}},"object"===(0,s.default)(t)?e.exports=o():void 0===(a="function"==typeof(n=o)?n.call(t,r,t,e):n)||(e.exports=a)},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(8)),a={getGlobal:function(){return n.default.global},getCurMode:function(){return"0"==n.default.global.curMode?"TECH":"DESKTOP"},getToken:function(){return n.default.token},getInitData:function(){return n.default.global.data},getTechOrder:function(){return n.default.player.techOrder},getPlayer:function(){return n.default.player},getLiveData:function(){return n.default.global.liveData},getExtData:function(){return n.default.extConfig}};t.default=a},function(e,t,r){"use strict";r.r(t),r.d(t,"render",function(){return I}),r.d(t,"hydrate",function(){return M}),r.d(t,"createElement",function(){return d}),r.d(t,"h",function(){return d}),r.d(t,"Fragment",function(){return T}),r.d(t,"createRef",function(){return f}),r.d(t,"isValidElement",function(){return i}),r.d(t,"Component",function(){return k}),r.d(t,"cloneElement",function(){return j}),r.d(t,"createContext",function(){return B}),r.d(t,"toChildArray",function(){return D}),r.d(t,"_unmount",function(){return P}),r.d(t,"options",function(){return b});var b,i,s,n,a,o,l,E={},S=[],u=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function w(e,t){for(var r in t)e[r]=t[r];return e}function _(e){var t=e.parentNode;t&&t.removeChild(e)}function d(e,t,r){var i,n,a,o,s=arguments;if(t=w({},t),3<arguments.length)for(r=[r],i=3;i<arguments.length;i++)r.push(s[i]);if(null!=r&&(t.children=r),null!=e&&null!=e.defaultProps)for(n in e.defaultProps)void 0===t[n]&&(t[n]=e.defaultProps[n]);return o=t.key,null!=(a=t.ref)&&delete t.ref,null!=o&&delete t.key,c(e,t,o,a)}function c(e,t,r,i){var n={type:e,props:t,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__d:null,__c:null,constructor:void 0};return b.vnode&&b.vnode(n),n}function f(){return{}}function T(e){return e.children}function k(e,t){this.props=e,this.context=t}function y(e,t){if(null==t)return e.__?y(e.__,e.__.__k.indexOf(e)+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?y(e):null}function h(e){var t,r;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e){e.__e=e.__c.base=r.__e;break}return h(e)}}function p(e){(!e.__d&&(e.__d=!0)&&1===s.push(e)||a!==b.debounceRendering)&&((a=b.debounceRendering)||n)(g)}function g(){var e,t,r,i,n,a,o;for(s.sort(function(e,t){return t.__v.__b-e.__v.__b});e=s.pop();)e.__d&&(i=r=void 0,a=(n=(t=e).__v).__e,(o=t.__P)&&(r=[],i=O(o,n,w({},n),t.__n,void 0!==o.ownerSVGElement,null,r,null==a?y(n):a),L(r,n),i!=a&&h(n)))}function A(t,r,e,i,n,a,o,s,l){var u,d,c,f,h,p,g,m=e&&e.__k||S,v=m.length;if(s==E&&(s=null!=a?a[0]:v?y(e,0):null),u=0,r.__k=D(r.__k,function(e){if(null!=e){if(e.__=r,e.__b=r.__b+1,null===(c=m[u])||c&&e.key==c.key&&e.type===c.type)m[u]=void 0;else for(d=0;d<v;d++){if((c=m[d])&&e.key==c.key&&e.type===c.type){m[d]=void 0;break}c=null}if(f=O(t,e,c=c||E,i,n,a,o,s,l),(d=e.ref)&&c.ref!=d&&(g=g||[],c.ref&&g.push(c.ref,null,e),g.push(d,e.__c||f,e)),null!=f){if(null==p&&(p=f),null!=e.__d)f=e.__d,e.__d=null;else if(a==c||f!=s||null==f.parentNode){e:if(null==s||s.parentNode!==t)t.appendChild(f);else{for(h=s,d=0;(h=h.nextSibling)&&d<v;d+=2)if(h==f)break e;t.insertBefore(f,s)}"option"==r.type&&(t.value="")}s=f.nextSibling,"function"==typeof r.type&&(r.__d=f)}}return u++,e}),r.__e=p,null!=a&&"function"!=typeof r.type)for(u=a.length;u--;)null!=a[u]&&_(a[u]);for(u=v;u--;)null!=m[u]&&P(m[u],m[u]);if(g)for(u=0;u<g.length;u++)C(g[u],g[++u],g[++u])}function D(e,t,r){if(null==r&&(r=[]),null==e||"boolean"==typeof e)t&&r.push(t(null));else if(Array.isArray(e))for(var i=0;i<e.length;i++)D(e[i],t,r);else r.push(t?t("string"==typeof e||"number"==typeof e?c(null,e,null,null):null!=e.__e||null!=e.__c?c(e.type,e.props,e.key,null):e):e);return r}function m(e,t,r){"-"===t[0]?e.setProperty(t,r):e[t]="number"==typeof r&&!1===u.test(t)?r+"px":null==r?"":r}function R(e,t,r,i,n){var a,o,s,l,u;if(n?"className"===t&&(t="class"):"class"===t&&(t="className"),"key"===t||"children"===t);else if("style"===t)if(a=e.style,"string"==typeof r)a.cssText=r;else{if("string"==typeof i&&(a.cssText="",i=null),i)for(o in i)r&&o in r||m(a,o,"");if(r)for(s in r)i&&r[s]===i[s]||m(a,s,r[s])}else"o"===t[0]&&"n"===t[1]?(l=t!==(t=t.replace(/Capture$/,"")),t=((u=t.toLowerCase())in e?u:t).slice(2),r?(i||e.addEventListener(t,v,l),(e.l||(e.l={}))[t]=r):e.removeEventListener(t,v,l)):"list"!==t&&"tagName"!==t&&"form"!==t&&!n&&t in e?e[t]=null==r?"":r:"function"!=typeof r&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/^xlink:?/,""))?null==r||!1===r?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):null==r||!1===r?e.removeAttribute(t):e.setAttribute(t,r))}function v(e){this.l[e.type](b.event?b.event(e):e)}function O(e,t,r,i,n,a,o,s,l){var u,d,c,f,h,p,g,m,v,_,y=t.type;if(void 0!==t.constructor)return null;(u=b.__b)&&u(t);try{e:if("function"==typeof y){if(m=t.props,v=(u=y.contextType)&&i[u.__c],_=u?v?v.props.value:u.__:i,r.__c?g=(d=t.__c=r.__c).__=d.__E:("prototype"in y&&y.prototype.render?t.__c=d=new y(m,_):(t.__c=d=new k(m,_),d.constructor=y,d.render=x),v&&v.sub(d),d.props=m,d.state||(d.state={}),d.context=_,d.__n=i,c=d.__d=!0,d.__h=[]),null==d.__s&&(d.__s=d.state),null!=y.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=w({},d.__s)),w(d.__s,y.getDerivedStateFromProps(m,d.__s))),f=d.props,h=d.state,c)null==y.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==y.getDerivedStateFromProps&&null==d.__e&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(m,_),!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(m,d.__s,_)){for(d.props=m,d.state=d.__s,d.__d=!1,(d.__v=t).__e=r.__e,t.__k=r.__k,d.__h.length&&o.push(d),u=0;u<t.__k.length;u++)t.__k[u]&&(t.__k[u].__=t);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(m,d.__s,_),null!=d.componentDidUpdate&&d.__h.push(function(){d.componentDidUpdate(f,h,p)})}d.context=_,d.props=m,d.state=d.__s,(u=b.__r)&&u(t),d.__d=!1,d.__v=t,d.__P=e,u=d.render(d.props,d.state,d.context),t.__k=D(null!=u&&u.type==T&&null==u.key?u.props.children:u),null!=d.getChildContext&&(i=w(w({},i),d.getChildContext())),c||null==d.getSnapshotBeforeUpdate||(p=d.getSnapshotBeforeUpdate(f,h)),A(e,t,r,i,n,a,o,s,l),d.base=t.__e,d.__h.length&&o.push(d),g&&(d.__E=d.__=null),d.__e=null}else t.__e=function(e,t,r,i,n,a,o,s){var l,u,d,c,f,h=r.props,p=t.props;if(n="svg"===t.type||n,null==e&&null!=a)for(l=0;l<a.length;l++)if(null!=(u=a[l])&&(null===t.type?3===u.nodeType:u.localName===t.type)){e=u,a[l]=null;break}if(null==e){if(null===t.type)return document.createTextNode(p);e=n?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type),a=null}if(null===t.type)null!=a&&(a[a.indexOf(e)]=null),h!==p&&(e.data=p);else if(t!==r){if(null!=a&&(a=S.slice.call(e.childNodes)),d=(h=r.props||E).dangerouslySetInnerHTML,c=p.dangerouslySetInnerHTML,!s){if(h===E)for(h={},f=0;f<e.attributes.length;f++)h[e.attributes[f].name]=e.attributes[f].value;(c||d)&&(c&&d&&c.__html==d.__html||(e.innerHTML=c&&c.__html||""))}(function(e,t,r,i,n){var a;for(a in r)a in t||R(e,a,null,r[a],i);for(a in t)n&&"function"!=typeof t[a]||"value"===a||"checked"===a||r[a]===t[a]||R(e,a,t[a],r[a],i)})(e,p,h,n,s),t.__k=t.props.children,c||A(e,t,r,i,"foreignObject"!==t.type&&n,a,o,E,s),s||("value"in p&&void 0!==p.value&&p.value!==e.value&&(e.value=null==p.value?"":p.value),"checked"in p&&void 0!==p.checked&&p.checked!==e.checked&&(e.checked=p.checked))}return e}(r.__e,t,r,i,n,a,o,l);(u=b.diffed)&&u(t)}catch(e){b.__e(e,t,r)}return t.__e}function L(e,t){b.__c&&b.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){b.__e(e,t.__v)}})}function C(e,t,r){try{"function"==typeof e?e(t):e.current=t}catch(e){b.__e(e,r)}}function P(e,t,r){var i,n,a;if(b.unmount&&b.unmount(e),(i=e.ref)&&C(i,null,t),r||"function"==typeof e.type||(r=null!=(n=e.__e)),e.__e=e.__d=null,null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){b.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(a=0;a<i.length;a++)i[a]&&P(i[a],t,r);null!=n&&_(n)}function x(e,t,r){return this.constructor(e,r)}function I(e,t,r){var i,n,a;b.__&&b.__(e,t),n=(i=r===o)?null:r&&r.__k||t.__k,e=d(T,null,[e]),a=[],O(t,(i?t:r||t).__k=e,n||E,E,void 0!==t.ownerSVGElement,r&&!i?[r]:n?null:S.slice.call(t.childNodes),a,r||E,i),L(a,e)}function M(e,t){I(e,t,o)}function j(e,t){return t=w(w({},e.props),t),2<arguments.length&&(t.children=S.slice.call(arguments,2)),c(e.type,t,t.key||e.key,t.ref||e.ref)}function B(e){var i={},n={__c:"__cC"+l++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var r,t=this;return this.getChildContext||(r=[],this.getChildContext=function(){return i[n.__c]=t,i},this.shouldComponentUpdate=function(t){e.value!==t.value&&r.some(function(e){e.context=t.value,p(e)})},this.sub=function(e){r.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){r.splice(r.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Consumer.contextType=n}b={__e:function(e,t){for(var r;t=t.__;)if((r=t.__c)&&!r.__)try{if(r.constructor&&null!=r.constructor.getDerivedStateFromError)r.setState(r.constructor.getDerivedStateFromError(e));else{if(null==r.componentDidCatch)continue;r.componentDidCatch(e)}return p(r.__E=r)}catch(t){e=t}throw e}},i=function(e){return null!=e&&void 0===e.constructor},k.prototype.setState=function(e,t){var r;r=this.__s!==this.state?this.__s:this.__s=w({},this.state),"function"==typeof e&&(e=e(r,this.props)),e&&w(r,e),null!=e&&this.__v&&(this.__e=!1,t&&this.__h.push(t),p(this))},k.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),p(this))},k.prototype.render=T,s=[],n="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,o=E,l=0},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(2)),a=i(r(1)),o=i(r(6)),s=i(r(19)),l=i(r(21)),u=i(r(7)),d=(i(r(15)),{player:null,playStatus:"stop",videoPlayType:"",durationTimmer:null,currentTime:0,currentDuration:0,bn:0,ba:0,bx:0,waitLastTime:0,desktopVideoDom:null,config:function(e){e.videoPlayType&&(this.videoPlayType=e.videoPlayType)},getPlayer_x2:function(){},bindMediaEvents:function(){},startDurationTimmer:function(){var e=this;if(!e.durationTimmer)if(a.default.isMobileSDK());else{var t=this.getPlayer();e.durationTimmer=setInterval(function(){t.currentTime&&(e.currentTime=t.currentTime(),"live"===o.default.playType&&schedule.setPlayDuration(e.currentTime),e.currentTime>=e.duration&&e.stopDurationTimmer())},200)}},stopDurationTimmer:function(){this.durationTimmer&&(clearInterval(this.durationTimmer),this.durationTimmer=null)},volume:function(e){a.default.debug("volume setting..",e),this.player&&this.player.volume(e)},start:function(e){if(e.c){a.default.debug("desktop start: ===>",e);"live"===o.default.playType&&(a.default.debug("Desktop / Video on Start..."),u.default.emit("video:player")),n.default.get("live:desktop:start")(this.playStatus)}},setMeidaPlayStatus:function(e){this.playStatus=e,o.default.playStatus=e},changeSource:0,setWaitingTimes:function(e){var t=this;1<=e-t.waitLastTime&&(t.bn+=1,t.ba+=1,t.bx<15?t.bx+=1:(t.bx=0,t.changeSource=1,n.default.get("live:video:timeout")(t.bx)),t.waitLastTime=e)},reloadDesktop:function(){this.player},fire:function(){this.play(),o.default.playStatus="playing"},play:function(){a.default.debug("desktop playing.",this.player),this.setMeidaPlayStatus("playing"),n.default.get("live:desktop:play")(),n.default.get("live:camera:play")(),s.default.isSupported()?s.default.play():l.default.play()},pause:function(){a.default.debug("desktop pause."),this.player&&this.player.pause(),this.setMeidaPlayStatus("pause"),n.default.get("live:desktop:pause")()},stop:function(){a.default.debug("desktop call stop!"),this.seekDuration=null,this.player&&this.player.pause(),n.default.get("live:desktop:stop")(),this.setMeidaPlayStatus("ended"),this.stopDurationTimmer()}}),c=window.__desktop=d;t.default=c},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(1)),n=(i(r(14)),i(r(3))),o=i(r(8)),s={dom:null,isInitDone:!1,opts:null,pageIndex:0,pptUrls:[],cmd:{url:null},docList:[],setCurPageCommand:function(e){if(!this.isInitDone)return!1;if(e){if(e===this.cmd.url)return!1;this.reset(),this.cmd.url=e,this.getDocList()}},init:function(e){if(!document.querySelector(e.wrap))return a.default.debug("ppt preview dom is not found!"),this.isInitDone=!1;a.default.debug("ppt preview init ==>",e),this.dom=e.wrap,this.opts=e,this.isInitDone=!0,this.bindEvent()},bindEvent:function(){var e=this,t=document.querySelector(this.opts.next),r=document.querySelector(this.opts.prev);t&&t.addEventListener("click",function(){e.next()},!1),r&&r.addEventListener("click",function(){e.prev()},!1)},getDocList:function(){var t=this;a.default.ajax({method:"GET",url:n.default.APP_HOST+"/live/document.php",data:{act:"preview",url:this.cmd.url,access_token:o.default.token},success:function(e){e&&0<e.data.length&&(t.docList=e.data,t.computed(e.data),t.get(1))},error:function(e){console.error("ppt load preview error",e)}})},computed:function(e){if(0<e.length){var t=[];e.forEach(function(e){e.urls.forEach(function(e){t.push(e)})}),this.pptUrls=t}},get:function(r){var i=this;if(r<=0&&(r=1),0<r){r>this.pptUrls.length&&(r=this.pptUrls.length);var n=this.pptUrls[r-1];a.default.webpSupport(function(e){e&&(n=n.replace(".jpg",".jpeg"));var t={curPage:r,total:i.pptUrls.length,img:n};a.default.debug("cur ppt preview object ==>",t),a.default.callback(i.opts.callback,t),i.opts.wrap&&!i.imgDom?(i.imgDom=document.createElement("img"),i.imgDom.src=n,i.imgDom.style.display="block",i.imgDom.style.width="100%",i.imgDom.style.height="auto",document.querySelector(i.opts.wrap).appendChild(i.imgDom)):i.imgDom.src=n}),this.pageIndex=r}},reset:function(){this.docList=[],this.pptUrls=[],this.pageIndex=1},next:function(){this.pageIndex+=1,this.get(this.pageIndex)},prev:function(){this.pageIndex-=1,this.get(this.pageIndex)}};t.default=s},function(e,t,r){"use strict";var i;void 0===(i=function(e){var o=r(60),s=r(3),l=r(2),u=r(16),d=r(61),c=r(1),n=r(62),a=r(63),f=r(64),h=r(65),p={voiceMode:"rtmp",forceRTMP:!1,voiceModelType:-1,switchRoomType:function(e){switch(e=parseInt(e,10),l.get("room:mode")(e),e){case 1:this.VoiceCloud.initVoiceCloud(this.room.conString,this.socket);break;case 2:this.VoiceRtmp.initRtmp();break;case 3:this.VoiceAutoModel.init(this.room.conString,this.socket)}},VoiceModelDispatch:function(e){l.get("voice:model:init")(e.room.voice.mode),c.debug("===>voice join me",e),e.member&&this.modifyUserVoicePrower(e.member.xid,e.member.voice,e.member),e.voiceQueueList?this.VoiceModel(e.room.voice.mode,e.voiceQueueList):e.hands?this.VoiceModel(e.room.voice.mode,e.hands):this.VoiceModel(e.room.voice.mode,null)},VoiceModel:function(e,t,r){c.debug("当前模式===> "+e,t,r);var i=this.MT;p.VoiceCloudOperation;if(e=parseInt(e,10),this.voiceModelType=e,r&&this.modeVoiceProwers(r),this.clearMode(),-1<e)switch(e){case 0:n.init(u,t);break;case 1:a.init(u);break;case 2:h.init(i,this,t);break;case 3:f.init(i,this,t)}},clearMode:function(){h.clear(),f.clear()},VoiceModelAppoint:function(e,t){var r=this.voiceModelType;c.debug("====>当前模式："+r,e),2===r&&h.eventAppoint(e,t),3===r&&f.eventAppoint(e,t)},VoiceJudgement:function(){var e=c.platform().toLocaleUpperCase();return"2"==this.room.voiceFlow||(!!this.forceRTMP||"WINDOWS"!==e)},setPlayer:function(e){this.player=e},modifyUserVoicePrower:function(e,t,r){e=parseInt(e,10),u.modifyOneVoicePrower(e,t,r)},VoicePowerSetting:function(e,t){e&&u.VoicePowerSetting(e,t)},modeVoiceProwers:function(e){e&&u.modeVoiceProwers(e)},VoiceAllow:function(e,t){this.modifyUserVoicePrower(e,t)},VoiceForbid:function(e,t){this.modifyUserVoicePrower(e,t)},init:function(e,t,r){e.voiceFlow;this.MT=r,this.room=e,this.socket=t,this.switchRoomType(e.voiceFlow)}};return p.VoiceCloud={initVoiceCloud:function(r,i,n){var a=p.VoiceCloud;this.regVoiceMethod();try{o.check.checkVoice()}catch(e){}o.check.isPlugin(function(e){if(e)o.check.hasInit||o.check.init(r,function(){p.voiceMode="cloud",i.emit("voice:ready",function(e){c.debug("======> voiceReady <======"),p.MT.get("voice:connect:success","success"),d.set("voice_cloud_success",1),e.code===s.CODE.SUCCESS&&(a.checkStatus(e.xid),a.listenPowerSpeaking())}),a.regOperation()});else{p.voiceMode="rtmp";var t=d.get("voice_cloud_success");if(p.VoiceJudgement())return c.debug("===>run Rtmp..."),p.VoiceRtmp.initRtmp(),void l.get("voice:unlaunch")(!0);if(void 0!==n&&n)return c.debug("===>run Auto..."),p.VoiceRtmp.initRtmp(),void l.get("voice:unlaunch")(!0);l.get("voice:unlaunch")(!1,t),a.reCheckVoice(!0)}})},regVoiceMethod:function(){var t=p.VoiceCloud;l.put("open:voice",function(e){t.tryLanuch(),"function"==typeof e&&e()}),l.put("voice:set:listen",function(e){d.set("force:listen",1),p.forceRTMP=!0,p.VoiceRtmp.initRtmp(),"function"==typeof e&&e()})},regOperation:function(){var t=!1,e=p.MT,r=p.VoiceCloudOperation;e.on("voice:speaker:press",function(e){if(t)return!1;r.VoiceEnable(),e(1)}),e.on("voice:speaker:bounce",function(e){if(t)return!1;r.VoiceDisable(),e(0)}),e.on("voice:free",function(e){t=!0,r.VoiceEnable(),e(1)}),e.on("voice:close",function(e){t=!1,r.VoiceDisable(),e(0)}),e.on("voice:accompany:open",function(e){r.clickAccompany(),e(!0)}),e.on("voice:accompany:stop",function(e){r.clickAccompanyStop(),e(!1)}),e.on("voice:setting",function(e){o.op.setConfig(),"function"==typeof e&&e()}),o.op.getOutVolume(function(e){l.get("voice:volume:output")(e)}),o.op.getInputVolume(function(e){l.get("voice:volume:input")(e)}),e.on("voice:set:output:volume",function(e){e(function(e,t){o.op.setOutVolume(e,t)})}),e.on("voice:set:input:volume",function(e){e(function(e,t){o.op.setInputVolume(e,t)})})},checkStatus:function(e){var r=this;if(void 0===r.checkStatusOpen){r.checkStatusOpen=!0,c.debug("voice checkStatus...");var i=0;!function t(){o.op.checkStatus(e,function(e){if(e)r.status=!0,i=0;else if(3<=(i+=1))return r.status=!1,void l.get("voice:disconnent")(i);setTimeout(function(){t()},5e3)})}()}},reCheckVoice:function(e){e||(this.checkVoiceTimer=setTimeout(function(){window.location.reload()},1e5)),o.check.reCheckPlugins()},clearCheck:function(){clearTimeout(this.checkVoiceTimer)},tryLanuch:function(){function e(){var e=document.createElement("iframe");e.id="talkfun_cloud_voice",e.src="maituoStart://start",e.style.display="none",document.body.appendChild(e)}var t=document.getElementById("talkfun_cloud_voice");t&&t.parentNode.removeChild(t),e(),d.set("voice_cloud_success",-1),this.reCheckVoice()},listenPowerSpeaking:function(){var r=this;if(void 0===r.listenPowerSpeakingOpen){r.listenPowerSpeakingOpen=!0,c.debug("voice listenPowerSpeaking...");setTimeout(function(){!0===r.status&&o.op.getPowerSpeaking(function(e,t){l.get("voice:power")(e),r.speakingList(t)}),setTimeout(arguments.callee,200);try{CollectGarbage()}catch(e){}},200)}},speakingList:function(e){if(void 0!==e){var t=e.length,r=[],i=u.userList;if(0<t){for(var n=0,a=e.length;n<a;n++){var o=e[n];i[o]&&r.push(i[o])}l.get("voice:speaking:list")(r)}else l.get("voice:speaking:list")(r)}}},p.VoiceCloudOperation={clickSpeakFree:function(){return o.op.setCapture(0,function(){}),!1},clickSpeakPress:function(){return o.op.setCapture(1,function(){}),!1},clickAccompany:function(){return o.op.playSysSound(!0,function(e){}),!1},clickAccompanyStop:function(){return o.op.playSysSound(!1,function(e){}),!1},VoiceEnable:function(){return o.op.setCapture(1,function(){}),!1},VoiceDisable:function(){return o.op.setCapture(0,function(){}),!1}},p.VoiceRtmp={rtmpPlaying:!1,initRtmp:function(){this.voiceRtmpPlay()},getPlayer:function(e){var t=p.player;return"function"==typeof e&&e(t),!1},voiceRtmpPlay:function(){var t=p,n=this;if(c.isMobile())return!1;t.voiceMode="rtmp",this.getPlayer(function(e){var r=t.room.rtmp,i=null;if(!e)return!1;if(r){!function t(){i=setTimeout(function(){c.debug("player audioPlay() start...");try{n.rtmpPlaying=e.audioPlay(r.video.server,r.video.path),c.debug("audioPlay() @===> "+n.rtmpPlaying),n.rtmpPlaying&&clearTimeout(i)}catch(e){t()}},300)}()}})},voiceRtmpStop:function(){this.getPlayer(function(e){c.debug("stop mic rtmp");!function(){try{e.audioStop()}catch(e){}}()})}},p.VoiceAutoModel={init:function(e,t){if(c.isMobile())return!1;p.VoiceCloud.initVoiceCloud(e,t,!0)}},p}.call(t,r,t,e))||(e.exports=i)},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=i(r(2)),u=i(r(9)),d=i(r(16)),c=i(r(3)),f=i(r(1)),n={allQids:{list:{},exists:function(e){return e.toString()in this.list},add:function(e){this.list[e]||(this.list[e.toString()]=1)},del:function(e){this.list[e]&&delete this.list[e.toString()]}},getList:function(e,r){var t=u.default.getAccessToken();f.default.debug("======> question list init",t);var i=this;f.default.ajax({type:"GET",url:c.default.APP_HOST+"/live/questions.php",dataType:"jsonp",data:{access_token:t},success:function(e){if(e.code!==c.default.EC_SUCCESS)return l.default.get("live:question:error")(e),!1;for(var t in f.default.debug("获取问答列表成功..."),e.data)1==e.data.hasOwnProperty(t)&&i.allQids.add(e.data[t].qid);r(e)},error:function(){l.default.get("live:question:error")("问答连接超时,请重试...")}})},getQuestionById:function(e,t){var r=u.default.getAccessToken();f.default.debug("======> question list by qid",r);f.default.ajax({type:"GET",url:c.default.APP_HOST+"/live/questions.php",dataType:"jsonp",data:{access_token:r,qid:e},success:function(e){if(e.code!==c.default.EC_SUCCESS)return l.default.get("live:get:question:error")(e),!1;f.default.debug("Qid获取问答列表成功..."),t(e)},error:function(){l.default.get("question:error","问答连接超时,请重试...")}})},quesPost:function(i,n,a){f.default.debug(i,n);var o=this,s=encodeURIComponent(n.content),e={},t=c.default.APP_HOST+"/live/interaction.php";switch(i){case"ask":e={action:n.action,content:s},n.ext&&(e=Object.assign(e,n.ext));break;case"reply":e={action:n.action,replyId:n.replyId,content:s};break;case"delqus":e={action:n.action,qid:n.qid}}e.access_token=u.default.getAccessToken(),f.default.debug("question===>",t,e),f.default.ajax({type:"GET",url:t,dataType:"jsonp",data:e,success:function(e){var t=(new Date).getTime(),r=e;if(o.lastPost=t,f.default.debug("Question response ==>",e),r.code!=c.default.EC_SUCCESS&&l.default.get("live:question:error")(e),null!=r){if(21==r.code)return a(r),!1;if(20==r.code)return o.lastQuestion=s,a(r),!1;switch(i){case"ask":r.data&&1==r.data.localInsert&&(r.data=d.default.dealMemberAvatar(r.data),o.allQids.add(r.data.qid),f.default.isMobileSDK()&&2==f.default.getSDKMode()?window.SDK.broadcast({cmd:"question:ask",args:r.data}):n.ext&&n.ext.robotName||l.default.get("question:ask")(r.data))}a(r)}}})}};t.default=n},function(e,t,r){"use strict";var i={};(0,r(11).assign)(i,r(66),r(69),r(39)),e.exports=i},function(e,t,r){"use strict";e.exports=function(e,t,r,i){for(var n=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){for(r-=o=2e3<r?2e3:r;a=a+(n=n+t[i++]|0)|0,--o;);n%=65521,a%=65521}return n|a<<16|0}},function(e,t,r){"use strict";var s=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var n=s,a=i+r;e^=-1;for(var o=i;o<a;o++)e=e>>>8^n[255&(e^t[o])];return-1^e}},function(e,t,r){"use strict";var l=r(11),n=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var u=new l.Buf8(256),i=0;i<256;i++)u[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function d(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&n))return String.fromCharCode.apply(null,l.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}u[254]=u[254]=1,t.string2buf=function(e){var t,r,i,n,a,o=e.length,s=0;for(n=0;n<o;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<o&&56320==(64512&(i=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new l.Buf8(s),n=a=0;a<s;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<o&&56320==(64512&(i=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t},t.buf2binstring=function(e){return d(e,e.length)},t.binstring2buf=function(e){for(var t=new l.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,i,n,a,o=t||e.length,s=new Array(2*o);for(r=i=0;r<o;)if((n=e[r++])<128)s[i++]=n;else if(4<(a=u[n]))s[i++]=65533,r+=a-1;else{for(n&=2===a?31:3===a?15:7;1<a&&r<o;)n=n<<6|63&e[r++],a--;1<a?s[i++]=65533:n<65536?s[i++]=n:(n-=65536,s[i++]=55296|n>>10&1023,s[i++]=56320|1023&n)}return d(s,i)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+u[e[r]]>t?r:t}},function(e,t,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){var d;e.exports=function(){var F,e,t;return function n(a,o,s){function l(r,e){if(!o[r]){if(!a[r]){var t=typeof d=="function"&&d;if(!e&&t)return d(r,!0);if(u)return u(r,!0);throw new Error("Cannot find module '"+r+"'")}var i=o[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return l(t?t:e)},i,i.exports,n,a,o,s)}return o[r].exports}var u=typeof d=="function"&&d;for(var e=0;e<s.length;e++)l(s[e]);return l}({1:[function(e,t,r){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,r){var o=e("./url");var i=e("socket.io-parser");var s=e("./manager");var l=e("debug")("socket.io-client");t.exports=r=n;var u=r.managers={};function n(e,t){if(typeof e=="object"){t=e;e=undefined}t=t||{};var r=o(e);var i=r.source;var n=r.id;var a;if(t.forceNew||t["force new connection"]||false===t.multiplex){l("ignoring socket cache for %s",i);a=s(i,t)}else{if(!u[n]){l("new io instance for %s",i);u[n]=s(i,t)}a=u[n]}return a.socket(r.path)}r.protocol=i.protocol;r.connect=n;r.Manager=e("./manager");r.Socket=e("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(e,t,r){var i=e("./url");var s=e("engine.io-client");var n=e("./socket");var a=e("component-emitter");var o=e("socket.io-parser");var l=e("./on");var u=e("component-bind");var d=e("object-component");var c=e("debug")("socket.io-client:manager");var f=e("indexof");var h=e("backo2");t.exports=p;function p(e,t){if(!(this instanceof p))return new p(e,t);if(e&&"object"==typeof e){t=e;e=undefined}t=t||{};t.path=t.path||"/socket.io";this.nsps={};this.subs=[];this.opts=t;this.reconnection(t.reconnection!==false);this.reconnectionAttempts(t.reconnectionAttempts||Infinity);this.reconnectionDelay(t.reconnectionDelay||1e3);this.reconnectionDelayMax(t.reconnectionDelayMax||5e3);this.randomizationFactor(t.randomizationFactor||.5);this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==t.timeout?2e4:t.timeout);this.readyState="closed";this.uri=e;this.connected=[];this.encoding=false;this.packetBuffer=[];this.encoder=new o.Encoder;this.decoder=new o.Decoder;this.autoConnect=t.autoConnect!==false;if(this.autoConnect)this.open()}p.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps){this.nsps[e].emit.apply(this.nsps[e],arguments)}};p.prototype.updateSocketIds=function(){for(var e in this.nsps){this.nsps[e].id=this.engine.id}};a(p.prototype);p.prototype.reconnection=function(e){if(!arguments.length)return this._reconnection;this._reconnection=!!e;return this};p.prototype.reconnectionAttempts=function(e){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=e;return this};p.prototype.reconnectionDelay=function(e){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=e;this.backoff&&this.backoff.setMin(e);return this};p.prototype.randomizationFactor=function(e){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=e;this.backoff&&this.backoff.setJitter(e);return this};p.prototype.reconnectionDelayMax=function(e){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=e;this.backoff&&this.backoff.setMax(e);return this};p.prototype.timeout=function(e){if(!arguments.length)return this._timeout;this._timeout=e;return this};p.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};p.prototype.open=p.prototype.connect=function(r){c("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;c("opening %s",this.uri);this.engine=s(this.uri,this.opts);var e=this.engine;var i=this;this.readyState="opening";this.skipReconnect=false;var t=l(e,"open",function(){i.onopen();r&&r()});var n=l(e,"error",function(e){c("connect_error");i.cleanup();i.readyState="closed";i.emitAll("connect_error",e);if(r){var t=new Error("Connection error");t.data=e;r(t)}else{i.maybeReconnectOnOpen()}});if(false!==this._timeout){var a=this._timeout;c("connect attempt will timeout after %d",a);var o=setTimeout(function(){c("connect attempt timed out after %d",a);t.destroy();e.close();e.emit("error","timeout");i.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(o)}})}this.subs.push(t);this.subs.push(n);return this};p.prototype.onopen=function(){c("open");this.cleanup();this.readyState="open";this.emit("open");var e=this.engine;this.subs.push(l(e,"data",u(this,"ondata")));this.subs.push(l(this.decoder,"decoded",u(this,"ondecoded")));this.subs.push(l(e,"error",u(this,"onerror")));this.subs.push(l(e,"close",u(this,"onclose")))};p.prototype.ondata=function(e){this.decoder.add(e)};p.prototype.ondecoded=function(e){this.emit("packet",e)};p.prototype.onerror=function(e){c("error",e);this.emitAll("error",e)};p.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new n(this,e);this.nsps[e]=t;var r=this;t.on("connect",function(){t.id=r.engine.id;if(!~f(r.connected,t)){r.connected.push(t)}})}return t};p.prototype.destroy=function(e){var t=f(this.connected,e);if(~t)this.connected.splice(t,1);if(this.connected.length)return;this.close()};p.prototype.packet=function(e){c("writing packet %j",e);var r=this;if(!r.encoding){r.encoding=true;this.encoder.encode(e,function(e){for(var t=0;t<e.length;t++){r.engine.write(e[t])}r.encoding=false;r.processPacketQueue()})}else{r.packetBuffer.push(e)}};p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}};p.prototype.cleanup=function(){var e;while(e=this.subs.shift())e.destroy();this.packetBuffer=[];this.encoding=false;this.decoder.destroy()};p.prototype.close=p.prototype.disconnect=function(){this.skipReconnect=true;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};p.prototype.onclose=function(e){c("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",e);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts){c("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var e=this.backoff.duration();c("will wait %dms before reconnect attempt",e);this.reconnecting=true;var r=setTimeout(function(){if(t.skipReconnect)return;c("attempting reconnect");t.emitAll("reconnect_attempt",t.backoff.attempts);t.emitAll("reconnecting",t.backoff.attempts);if(t.skipReconnect)return;t.open(function(e){if(e){c("reconnect attempt error");t.reconnecting=false;t.reconnect();t.emitAll("reconnect_error",e.data)}else{c("reconnect success");t.onreconnect()}})},e);this.subs.push({destroy:function(){clearTimeout(r)}})}};p.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",e)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(e,t,r){t.exports=i;function i(e,t,r){e.on(t,r);return{destroy:function(){e.removeListener(t,r)}}}},{}],5:[function(e,t,r){var a=e("socket.io-parser");var i=e("component-emitter");var o=e("to-array");var n=e("./on");var s=e("component-bind");var l=e("debug")("socket.io-client:socket");var u=e("has-binary");t.exports=r=f;var d={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1};var c=i.prototype.emit;function f(e,t){this.io=e;this.nsp=t;this.json=this;this.ids=0;this.acks={};if(this.io.autoConnect)this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true}i(f.prototype);f.prototype.subEvents=function(){if(this.subs)return;var e=this.io;this.subs=[n(e,"open",s(this,"onopen")),n(e,"packet",s(this,"onpacket")),n(e,"close",s(this,"onclose"))]};f.prototype.open=f.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};f.prototype.send=function(){var e=o(arguments);e.unshift("message");this.emit.apply(this,e);return this};f.prototype.emit=function(e){if(d.hasOwnProperty(e)){c.apply(this,arguments);return this}var t=o(arguments);var r=a.EVENT;if(u(t)){r=a.BINARY_EVENT}var i={type:r,data:t};if("function"==typeof t[t.length-1]){l("emitting packet with ack id %d",this.ids);this.acks[this.ids]=t.pop();i.id=this.ids++}if(this.connected){this.packet(i)}else{this.sendBuffer.push(i)}return this};f.prototype.packet=function(e){e.nsp=this.nsp;this.io.packet(e)};f.prototype.onopen=function(){l("transport is open - connecting");if("/"!=this.nsp){this.packet({type:a.CONNECT})}};f.prototype.onclose=function(e){l("close (%s)",e);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",e)};f.prototype.onpacket=function(e){if(e.nsp!=this.nsp)return;switch(e.type){case a.CONNECT:this.onconnect();break;case a.EVENT:this.onevent(e);break;case a.BINARY_EVENT:this.onevent(e);break;case a.ACK:this.onack(e);break;case a.BINARY_ACK:this.onack(e);break;case a.DISCONNECT:this.ondisconnect();break;case a.ERROR:this.emit("error",e.data);break}};f.prototype.onevent=function(e){var t=e.data||[];l("emitting event %j",t);if(null!=e.id){l("attaching ack callback to event");t.push(this.ack(e.id))}if(this.connected){c.apply(this,t)}else{this.receiveBuffer.push(t)}};f.prototype.ack=function(r){var i=this;var n=false;return function(){if(n)return;n=true;var e=o(arguments);l("sending ack %j",e);var t=u(e)?a.BINARY_ACK:a.ACK;i.packet({type:t,id:r,data:e})}};f.prototype.onack=function(e){l("calling ack %s with %j",e.id,e.data);var t=this.acks[e.id];t.apply(this,e.data);delete this.acks[e.id]};f.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};f.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++){c.apply(this,this.receiveBuffer[e])}this.receiveBuffer=[];for(e=0;e<this.sendBuffer.length;e++){this.packet(this.sendBuffer[e])}this.sendBuffer=[]};f.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};f.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++){this.subs[e].destroy()}this.subs=null}this.io.destroy(this)};f.prototype.close=f.prototype.disconnect=function(){if(this.connected){l("performing disconnect (%s)",this.nsp);this.packet({type:a.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(t,r,e){(function(i){var n=t("parseuri");var a=t("debug")("socket.io-client:url");r.exports=e;function e(e,t){var r=e;var t=t||i.location;if(null==e)e=t.protocol+"//"+t.host;if("string"==typeof e){if("/"==e.charAt(0)){if("/"==e.charAt(1)){e=t.protocol+e}else{e=t.hostname+e}}if(!/^(https?|wss?):\/\//.test(e)){a("protocol-less url %s",e);if("undefined"!=typeof t){e=t.protocol+"//"+e}else{e="https://"+e}}a("parse %s",e);r=n(e)}if(!r.port){if(/^(http|ws)$/.test(r.protocol)){r.port="80"}else if(/^(http|ws)s$/.test(r.protocol)){r.port="443"}}r.path=r.path||"/";r.id=r.protocol+"://"+r.host+":"+r.port;r.href=r.protocol+"://"+r.host+(t&&t.port==r.port?"":":"+r.port);return r}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:10,parseuri:44}],7:[function(e,t,r){t.exports=i;function i(e){e=e||{};this.ms=e.min||100;this.max=e.max||1e4;this.factor=e.factor||2;this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0;this.attempts=0}i.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random();var r=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-r:e+r}return Math.min(e,this.max)|0};i.prototype.reset=function(){this.attempts=0};i.prototype.setMin=function(e){this.ms=e};i.prototype.setMax=function(e){this.max=e};i.prototype.setJitter=function(e){this.jitter=e}},{}],8:[function(e,t,r){var i=[].slice;t.exports=function(e,t){if("string"==typeof t)t=e[t];if("function"!=typeof t)throw new Error("bind() requires a function");var r=i.call(arguments,2);return function(){return t.apply(e,r.concat(i.call(arguments)))}}},{}],9:[function(e,t,r){t.exports=i;function i(e){if(e)return n(e)}function n(e){for(var t in i.prototype){e[t]=i.prototype[t]}return e}i.prototype.on=i.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks[e]=this._callbacks[e]||[]).push(t);return this};i.prototype.once=function(e,t){var r=this;this._callbacks=this._callbacks||{};function i(){r.off(e,i);t.apply(this,arguments)}i.fn=t;this.on(e,i);return this};i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var r=this._callbacks[e];if(!r)return this;if(1==arguments.length){delete this._callbacks[e];return this}var i;for(var n=0;n<r.length;n++){i=r[n];if(i===t||i.fn===t){r.splice(n,1);break}}return this};i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var i=0,n=r.length;i<n;++i){r[i].apply(this,t)}}return this};i.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks[e]||[]};i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],10:[function(e,t,r){t.exports=n;function n(i){if(!n.enabled(i))return function(){};return function(e){e=a(e);var t=new Date;var r=t-(n[i]||t);n[i]=t;e=i+" "+e+" +"+n.humanize(r);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}n.names=[];n.skips=[];n.enable=function(e){try{localStorage.debug=e}catch(e){}var t=(e||"").split(/[\s,]+/),r=t.length;for(var i=0;i<r;i++){e=t[i].replace("*",".*?");if(e[0]==="-"){n.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{n.names.push(new RegExp("^"+e+"$"))}}};n.disable=function(){n.enable("")};n.humanize=function(e){var t=1e3,r=60*1e3,i=60*r;if(e>=i)return(e/i).toFixed(1)+"h";if(e>=r)return(e/r).toFixed(1)+"m";if(e>=t)return(e/t|0)+"s";return e+"ms"};n.enabled=function(e){for(var t=0,r=n.skips.length;t<r;t++){if(n.skips[t].test(e)){return false}}for(var t=0,r=n.names.length;t<r;t++){if(n.names[t].test(e)){return true}}return false};function a(e){if(e instanceof Error)return e.stack||e.message;return e}try{if(window.localStorage)n.enable(localStorage.debug)}catch(e){}},{}],11:[function(e,t,r){t.exports=e("./lib/")},{"./lib/":12}],12:[function(e,t,r){t.exports=e("./socket");t.exports.parser=e("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(d,h,e){(function(i){var n=d("./transports");var e=d("component-emitter");var c=d("debug")("engine.io-client:socket");var a=d("indexof");var o=d("engine.io-parser");var s=d("parseuri");var r=d("parsejson");var l=d("parseqs");h.exports=f;function t(){}function f(e,t){if(!(this instanceof f))return new f(e,t);t=t||{};if(e&&"object"==typeof e){t=e;e=null}if(e){e=s(e);t.host=e.host;t.secure=e.protocol=="https"||e.protocol=="wss";t.port=e.port;if(e.query)t.query=e.query}this.secure=null!=t.secure?t.secure:i.location&&"https:"==location.protocol;if(t.host){var r=t.host.split(":");t.hostname=r.shift();if(r.length){t.port=r.pop()}else if(!t.port){t.port=this.secure?"443":"80"}}this.agent=t.agent||false;this.hostname=t.hostname||(i.location?location.hostname:"localhost");this.port=t.port||(i.location&&location.port?location.port:this.secure?443:80);this.query=t.query||{};if("string"==typeof this.query)this.query=l.decode(this.query);this.upgrade=false!==t.upgrade;this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!t.forceJSONP;this.jsonp=false!==t.jsonp;this.forceBase64=!!t.forceBase64;this.enablesXDR=!!t.enablesXDR;this.timestampParam=t.timestampParam||"t";this.timestampRequests=t.timestampRequests;this.transports=t.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=t.policyPort||843;this.rememberUpgrade=t.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=t.onlyBinaryUpgrades;this.pfx=t.pfx||null;this.key=t.key||null;this.passphrase=t.passphrase||null;this.cert=t.cert||null;this.ca=t.ca||null;this.ciphers=t.ciphers||null;this.rejectUnauthorized=t.rejectUnauthorized||null;this.open()}f.priorWebsocketSuccess=false;e(f.prototype);f.protocol=o.protocol;f.Socket=f;f.Transport=d("./transport");f.transports=d("./transports");f.parser=d("engine.io-parser");f.prototype.createTransport=function(e){c('creating transport "%s"',e);var t=u(this.query);t.EIO=o.protocol;t.transport=e;if(this.id)t.sid=this.id;var r=new n[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return r};function u(e){var t={};for(var r in e){if(e.hasOwnProperty(r)){t[r]=e[r]}}return t}f.prototype.open=function(){var e;if(this.rememberUpgrade&&f.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1){e="websocket"}else if(0==this.transports.length){var t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}else{e=this.transports[0]}this.readyState="opening";var e;try{e=this.createTransport(e)}catch(e){this.transports.shift();this.open();return}e.open();this.setTransport(e)};f.prototype.setTransport=function(e){c("setting transport %s",e.name);var t=this;if(this.transport){c("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=e;e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})};f.prototype.probe=function(r){c('probing transport "%s"',r);var i=this.createTransport(r,{probe:1}),n=false,a=this;f.priorWebsocketSuccess=false;function e(){if(a.onlyBinaryUpgrades){var e=!this.supportsBinary&&a.transport.supportsBinary;n=n||e}if(n)return;c('probe transport "%s" opened',r);i.send([{type:"ping",data:"probe"}]);i.once("packet",function(e){if(n)return;if("pong"==e.type&&"probe"==e.data){c('probe transport "%s" pong',r);a.upgrading=true;a.emit("upgrading",i);if(!i)return;f.priorWebsocketSuccess="websocket"==i.name;c('pausing current transport "%s"',a.transport.name);a.transport.pause(function(){if(n)return;if("closed"==a.readyState)return;c("changing transport and sending upgrade packet");d();a.setTransport(i);i.send([{type:"upgrade"}]);a.emit("upgrade",i);i=null;a.upgrading=false;a.flush()})}else{c('probe transport "%s" failed',r);var t=new Error("probe error");t.transport=i.name;a.emit("upgradeError",t)}})}function o(){if(n)return;n=true;d();i.close();i=null}function t(e){var t=new Error("probe error: "+e);t.transport=i.name;o();c('probe transport "%s" failed because of error: %s',r,e);a.emit("upgradeError",t)}function s(){t("transport closed")}function l(){t("socket closed")}function u(e){if(i&&e.name!=i.name){c('"%s" works - aborting "%s"',e.name,i.name);o()}}function d(){i.removeListener("open",e);i.removeListener("error",t);i.removeListener("close",s);a.removeListener("close",l);a.removeListener("upgrading",u)}i.once("open",e);i.once("error",t);i.once("close",s);this.once("close",l);this.once("upgrading",u);i.open()};f.prototype.onOpen=function(){c("socket open");this.readyState="open";f.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){c("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++){this.probe(this.upgrades[e])}}};f.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState){c('socket receive: type "%s", data "%s"',e.type,e.data);this.emit("packet",e);this.emit("heartbeat");switch(e.type){case"open":this.onHandshake(r(e.data));break;case"pong":this.setPing();break;case"error":var t=new Error("server error");t.code=e.data;this.emit("error",t);break;case"message":this.emit("data",e.data);this.emit("message",e.data);break}}else{c('packet received with socket readyState "%s"',this.readyState)}};f.prototype.onHandshake=function(e){this.emit("handshake",e);this.id=e.sid;this.transport.query.sid=e.sid;this.upgrades=this.filterUpgrades(e.upgrades);this.pingInterval=e.pingInterval;this.pingTimeout=e.pingTimeout;this.onOpen();if("closed"==this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};f.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){if("closed"==t.readyState)return;t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)};f.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer);e.pingIntervalTimer=setTimeout(function(){c("writing ping packet - expecting pong within %sms",e.pingTimeout);e.ping();e.onHeartbeat(e.pingTimeout)},e.pingInterval)};f.prototype.ping=function(){this.sendPacket("ping")};f.prototype.onDrain=function(){for(var e=0;e<this.prevBufferLen;e++){if(this.callbackBuffer[e]){this.callbackBuffer[e]()}}this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(this.writeBuffer.length==0){this.emit("drain")}else{this.flush()}};f.prototype.flush=function(){if("closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){c("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};f.prototype.write=f.prototype.send=function(e,t){this.sendPacket("message",e,t);return this};f.prototype.sendPacket=function(e,t,r){if("closing"==this.readyState||"closed"==this.readyState){return}var i={type:e,data:t};this.emit("packetCreate",i);this.writeBuffer.push(i);this.callbackBuffer.push(r);this.flush()};f.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var e=this;function t(){e.onClose("forced close");c("socket closing - telling transport to close");e.transport.close()}function r(){e.removeListener("upgrade",r);e.removeListener("upgradeError",r);t()}function i(){e.once("upgrade",r);e.once("upgradeError",r)}if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){i()}else{t()}})}else if(this.upgrading){i()}else{t()}}return this};f.prototype.onError=function(e){c("socket error %j",e);f.priorWebsocketSuccess=false;this.emit("error",e);this.onClose("transport error",e)};f.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){c('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){r.writeBuffer=[];r.callbackBuffer=[];r.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",e,t)}};f.prototype.filterUpgrades=function(e){var t=[];for(var r=0,i=e.length;r<i;r++){if(~a(this.transports,e[r]))t.push(e[r])}return t}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(e,t,r){var i=e("engine.io-parser");var n=e("component-emitter");t.exports=a;function a(e){this.path=e.path;this.hostname=e.hostname;this.port=e.port;this.secure=e.secure;this.query=e.query;this.timestampParam=e.timestampParam;this.timestampRequests=e.timestampRequests;this.readyState="";this.agent=e.agent||false;this.socket=e.socket;this.enablesXDR=e.enablesXDR;this.pfx=e.pfx;this.key=e.key;this.passphrase=e.passphrase;this.cert=e.cert;this.ca=e.ca;this.ciphers=e.ciphers;this.rejectUnauthorized=e.rejectUnauthorized}n(a.prototype);a.timestamps=0;a.prototype.onError=function(e,t){var r=new Error(e);r.type="TransportError";r.description=t;this.emit("error",r);return this};a.prototype.open=function(){if("closed"==this.readyState||""==this.readyState){this.readyState="opening";this.doOpen()}return this};a.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.doClose();this.onClose()}return this};a.prototype.send=function(e){if("open"==this.readyState){this.write(e)}else{throw new Error("Transport not open")}};a.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};a.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)};a.prototype.onPacket=function(e){this.emit("packet",e)};a.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(r,e,i){(function(s){var l=r("xmlhttprequest");var u=r("./polling-xhr");var d=r("./polling-jsonp");var e=r("./websocket");i.polling=t;i.websocket=e;function t(e){var t;var r=false;var i=false;var n=false!==e.jsonp;if(s.location){var a="https:"==location.protocol;var o=location.port;if(!o){o=a?443:80}r=e.hostname!=location.hostname||o!=e.port;i=e.secure!=a}e.xdomain=r;e.xscheme=i;t=new l(e);if("open"in t&&!e.forceJSONP){return new u(e)}else{if(!n)throw new Error("JSONP disabled");return new d(e)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(s,l,e){(function(r){var i=s("./polling");var e=s("component-inherit");l.exports=o;var u=/\n/g;var d=/\\n/g;var n;var t=0;function a(){}function o(e){i.call(this,e);this.query=this.query||{};if(!n){if(!r.___eio)r.___eio=[];n=r.___eio}this.index=n.length;var t=this;n.push(function(e){t.onData(e)});this.query.j=this.index;if(r.document&&r.addEventListener){r.addEventListener("beforeunload",function(){if(t.script)t.script.onerror=a},false)}}e(o,i);o.prototype.supportsBinary=false;o.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}i.prototype.doClose.call(this)};o.prototype.doPoll=function(){var t=this;var e=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}e.async=true;e.src=this.uri();e.onerror=function(e){t.onError("jsonp poll error",e)};var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(e,r);this.script=e;var i="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(i){setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e);document.body.removeChild(e)},100)}};o.prototype.doWrite=function(e,t){var r=this;if(!this.form){var i=document.createElement("form");var n=document.createElement("textarea");var a=this.iframeId="eio_iframe_"+this.index;var o;i.className="socketio";i.style.position="absolute";i.style.top="-1000px";i.style.left="-1000px";i.target=a;i.method="POST";i.setAttribute("accept-charset","utf-8");n.name="d";i.appendChild(n);document.body.appendChild(i);this.form=i;this.area=n}this.form.action=this.uri();function s(){l();t()}function l(){if(r.iframe){try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';o=document.createElement(e)}catch(e){o=document.createElement("iframe");o.name=r.iframeId;o.src="javascript:0"}o.id=r.iframeId;r.form.appendChild(o);r.iframe=o}l();e=e.replace(d,"\\\n");this.area.value=e.replace(u,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(r.iframe.readyState=="complete"){s()}}}else{this.iframe.onload=s}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-inherit":21}],17:[function(d,c,e){(function(i){var n=d("xmlhttprequest");var a=d("./polling");var e=d("component-emitter");var t=d("component-inherit");var o=d("debug")("engine.io-client:polling-xhr");c.exports=s;c.exports.Request=l;function r(){}function s(e){a.call(this,e);if(i.location){var t="https:"==location.protocol;var r=location.port;if(!r){r=t?443:80}this.xd=e.hostname!=i.location.hostname||r!=e.port;this.xs=e.secure!=t}}t(s,a);s.prototype.supportsBinary=true;s.prototype.request=function(e){e=e||{};e.uri=this.uri();e.xd=this.xd;e.xs=this.xs;e.agent=this.agent||false;e.supportsBinary=this.supportsBinary;e.enablesXDR=this.enablesXDR;e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;return new l(e)};s.prototype.doWrite=function(e,t){var r=typeof e!=="string"&&e!==undefined;var i=this.request({method:"POST",data:e,isBinary:r});var n=this;i.on("success",t);i.on("error",function(e){n.onError("xhr post error",e)});this.sendXhr=i};s.prototype.doPoll=function(){o("xhr poll");var e=this.request();var t=this;e.on("data",function(e){t.onData(e)});e.on("error",function(e){t.onError("xhr poll error",e)});this.pollXhr=e};function l(e){this.method=e.method||"GET";this.uri=e.uri;this.xd=!!e.xd;this.xs=!!e.xs;this.async=false!==e.async;this.data=undefined!=e.data?e.data:null;this.agent=e.agent;this.isBinary=e.isBinary;this.supportsBinary=e.supportsBinary;this.enablesXDR=e.enablesXDR;this.pfx=e.pfx;this.key=e.key;this.passphrase=e.passphrase;this.cert=e.cert;this.ca=e.ca;this.ciphers=e.ciphers;this.rejectUnauthorized=e.rejectUnauthorized;this.create()}e(l.prototype);l.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new n(e);var r=this;try{o("xhr open %s: %s",this.method,this.uri);t.open(this.method,this.uri,this.async);if(this.supportsBinary){t.responseType="arraybuffer"}if("POST"==this.method){try{if(this.isBinary){t.setRequestHeader("Content-type","application/octet-stream")}else{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}if("withCredentials"in t){t.withCredentials=true}if(this.hasXDR()){t.onload=function(){r.onLoad()};t.onerror=function(){r.onError(t.responseText)}}else{t.onreadystatechange=function(){if(4!=t.readyState)return;if(200==t.status||1223==t.status){r.onLoad()}else{setTimeout(function(){r.onError(t.status)},0)}}}o("xhr data %s",this.data);t.send(this.data)}catch(e){setTimeout(function(){r.onError(e)},0);return}if(i.document){this.index=l.requestsCount++;l.requests[this.index]=this}};l.prototype.onSuccess=function(){this.emit("success");this.cleanup()};l.prototype.onData=function(e){this.emit("data",e);this.onSuccess()};l.prototype.onError=function(e){this.emit("error",e);this.cleanup(true)};l.prototype.cleanup=function(e){if("undefined"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=r}else{this.xhr.onreadystatechange=r}if(e){try{this.xhr.abort()}catch(e){}}if(i.document){delete l.requests[this.index]}this.xhr=null};l.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if(t==="application/octet-stream"){e=this.xhr.response}else{if(!this.supportsBinary){e=this.xhr.responseText}else{e="ok"}}}catch(e){this.onError(e)}if(null!=e){this.onData(e)}};l.prototype.hasXDR=function(){return"undefined"!==typeof i.XDomainRequest&&!this.xs&&this.enablesXDR};l.prototype.abort=function(){this.cleanup()};if(i.document){l.requestsCount=0;l.requests={};if(i.attachEvent){i.attachEvent("onunload",u)}else if(i.addEventListener){i.addEventListener("beforeunload",u,false)}}function u(){for(var e in l.requests){if(l.requests.hasOwnProperty(e)){l.requests[e].abort()}}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(r,e,t){var i=r("../transport");var n=r("parseqs");var a=r("engine.io-parser");var o=r("component-inherit");var s=r("debug")("engine.io-client:polling");e.exports=u;var l=function(){var e=r("xmlhttprequest");var t=new e({xdomain:false});return null!=t.responseType}();function u(e){var t=e&&e.forceBase64;if(!l||t){this.supportsBinary=false}i.call(this,e)}o(u,i);u.prototype.name="polling";u.prototype.doOpen=function(){this.poll()};u.prototype.pause=function(e){var t=0;var r=this;this.readyState="pausing";function i(){s("paused");r.readyState="paused";e()}if(this.polling||!this.writable){var n=0;if(this.polling){s("we are currently polling - waiting to pause");n++;this.once("pollComplete",function(){s("pre-pause polling complete");--n||i()})}if(!this.writable){s("we are currently writing - waiting to pause");n++;this.once("drain",function(){s("pre-pause writing complete");--n||i()})}}else{i()}};u.prototype.poll=function(){s("polling");this.polling=true;this.doPoll();this.emit("poll")};u.prototype.onData=function(e){var i=this;s("polling got data %s",e);var t=function(e,t,r){if("opening"==i.readyState){i.onOpen()}if("close"==e.type){i.onClose();return false}i.onPacket(e)};a.decodePayload(e,this.socket.binaryType,t);if("closed"!=this.readyState){this.polling=false;this.emit("pollComplete");if("open"==this.readyState){this.poll()}else{s('ignoring poll - transport state "%s"',this.readyState)}}};u.prototype.doClose=function(){var e=this;function t(){s("writing close packet");e.write([{type:"close"}])}if("open"==this.readyState){s("transport open - closing");t()}else{s("transport not open - deferring close");this.once("open",t)}};u.prototype.write=function(e){var t=this;this.writable=false;var r=function(){t.writable=true;t.emit("drain")};var t=this;a.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})};u.prototype.uri=function(){var e=this.query||{};var t=this.secure?"https":"http";var r="";if(false!==this.timestampRequests){e[this.timestampParam]=+new Date+"-"+i.timestamps++}if(!this.supportsBinary&&!e.sid){e.b64=1}e=n.encode(e);if(this.port&&("https"==t&&this.port!=443||"http"==t&&this.port!=80)){r=":"+this.port}if(e.length){e="?"+e}return t+"://"+this.hostname+r+this.path+e}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(e,t,r){var i=e("../transport");var a=e("engine.io-parser");var n=e("parseqs");var o=e("component-inherit");var s=e("debug")("engine.io-client:websocket");var l=e("ws");t.exports=u;function u(e){var t=e&&e.forceBase64;if(t){this.supportsBinary=false}i.call(this,e)}o(u,i);u.prototype.name="websocket";u.prototype.supportsBinary=true;u.prototype.doOpen=function(){if(!this.check()){return}var e=this;var t=this.uri();var r=void 0;var i={agent:this.agent};i.pfx=this.pfx;i.key=this.key;i.passphrase=this.passphrase;i.cert=this.cert;i.ca=this.ca;i.ciphers=this.ciphers;i.rejectUnauthorized=this.rejectUnauthorized;this.ws=new l(t,r,i);if(this.ws.binaryType===undefined){this.supportsBinary=false}this.ws.binaryType="arraybuffer";this.addEventListeners()};u.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()};this.ws.onclose=function(){t.onClose()};this.ws.onmessage=function(e){t.onData(e.data)};this.ws.onerror=function(e){t.onError("websocket error",e)}};if("undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){u.prototype.onData=function(e){var t=this;setTimeout(function(){i.prototype.onData.call(t,e)},0)}}u.prototype.write=function(e){var t=this;this.writable=false;for(var r=0,i=e.length;r<i;r++){a.encodePacket(e[r],this.supportsBinary,function(e){try{t.ws.send(e)}catch(e){s("websocket closed before onclose event")}})}function n(){t.writable=true;t.emit("drain")}setTimeout(n,0)};u.prototype.onClose=function(){i.prototype.onClose.call(this)};u.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};u.prototype.uri=function(){var e=this.query||{};var t=this.secure?"wss":"ws";var r="";if(this.port&&("wss"==t&&this.port!=443||"ws"==t&&this.port!=80)){r=":"+this.port}if(this.timestampRequests){e[this.timestampParam]=+new Date}if(!this.supportsBinary){e.b64=1}e=n.encode(e);if(e.length){e="?"+e}return t+"://"+this.hostname+r+this.path+e};u.prototype.check=function(){return!!l&&!("__initialize"in l&&this.name===u.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(e,t,r){var n=e("has-cors");t.exports=function(e){var t=e.xdomain;var r=e.xscheme;var i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&i){return new XDomainRequest}}catch(e){}if(!t){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}},{"has-cors":40}],21:[function(e,t,r){t.exports=function(e,t){var r=function(){};r.prototype=t.prototype;e.prototype=new r;e.prototype.constructor=e}},{}],22:[function(e,t,a){a=t.exports=e("./debug");a.log=n;a.formatArgs=i;a.save=o;a.load=s;a.useColors=r;a.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}a.formatters.j=function(e){return JSON.stringify(e)};function i(){var e=arguments;var t=this.useColors;e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+a.humanize(this.diff);if(!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0;var n=0;e[0].replace(/%[a-z%]/g,function(e){if("%"===e)return;i++;if("%c"===e){n=i}});e.splice(n,0,r);return e}function n(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{if(null==e){localStorage.removeItem("debug")}else{localStorage.debug=e}}catch(e){}}function s(){var e;try{e=localStorage.debug}catch(e){}return e}a.enable(s())},{"./debug":23}],23:[function(e,t,s){s=t.exports=i;s.coerce=d;s.disable=a;s.enable=n;s.enabled=o;s.humanize=e("ms");s.names=[];s.skips=[];s.formatters={};var r=0;var l;function u(){return s.colors[r++%s.colors.length]}function i(e){function t(){}t.enabled=false;function i(){var n=i;var e=+new Date;var t=e-(l||e);n.diff=t;n.prev=l;n.curr=e;l=e;if(null==n.useColors)n.useColors=s.useColors();if(null==n.color&&n.useColors)n.color=u();var a=Array.prototype.slice.call(arguments);a[0]=s.coerce(a[0]);if("string"!==typeof a[0]){a=["%o"].concat(a)}var o=0;a[0]=a[0].replace(/%([a-z%])/g,function(e,t){if(e==="%")return e;o++;var r=s.formatters[t];if("function"===typeof r){var i=a[o];e=r.call(n,i);a.splice(o,1);o--}return e});if("function"===typeof s.formatArgs){a=s.formatArgs.apply(n,a)}var r=i.log||s.log||console.log.bind(console);r.apply(n,a)}i.enabled=true;var r=s.enabled(e)?i:t;r.namespace=e;return r}function n(e){s.save(e);var t=(e||"").split(/[\s,]+/);var r=t.length;for(var i=0;i<r;i++){if(!t[i])continue;e=t[i].replace(/\*/g,".*?");if(e[0]==="-"){s.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{s.names.push(new RegExp("^"+e+"$"))}}}function a(){s.enable("")}function o(e){var t,r;for(t=0,r=s.skips.length;t<r;t++){if(s.skips[t].test(e)){return false}}for(t=0,r=s.names.length;t<r;t++){if(s.names[t].test(e)){return true}}return false}function d(e){if(e instanceof Error)return e.stack||e.message;return e}},{ms:24}],24:[function(e,t,r){var n=1e3;var a=n*60;var o=a*60;var s=o*24;var l=s*365.25;t.exports=function(e,t){t=t||{};if("string"==typeof e)return i(e);return t.long?d(e):u(e)};function i(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);var i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"y":return r*l;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"h":return r*o;case"minutes":case"minute":case"m":return r*a;case"seconds":case"second":case"s":return r*n;case"ms":return r}}function u(e){if(e>=s)return Math.round(e/s)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=a)return Math.round(e/a)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}function d(e){return c(e,s,"day")||c(e,o,"hour")||c(e,a,"minute")||c(e,n,"second")||e+" ms"}function c(e,t,r){if(e<t)return;if(e<t*1.5)return Math.floor(e/t)+" "+r;return Math.ceil(e/t)+" "+r+"s"}},{}],25:[function(i,e,b){(function(u){var e=i("./keys");var o=i("has-binary");var h=i("arraybuffer.slice");var n=i("base64-arraybuffer");var s=i("after");var l=i("utf8");var t=navigator.userAgent.match(/Android/i);var r=/PhantomJS/i.test(navigator.userAgent);var d=t||r;b.protocol=3;var c=b.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var f=e(c);var p={type:"error",data:"parser error"};var g=i("blob");b.encodePacket=function(e,t,r,i){if("function"==typeof t){i=t;t=false}if("function"==typeof r){i=r;r=null}var n=e.data===undefined?undefined:e.data.buffer||e.data;if(u.ArrayBuffer&&n instanceof ArrayBuffer){return v(e,t,i)}else if(g&&n instanceof u.Blob){return _(e,t,i)}if(n&&n.base64){return m(e,i)}var a=c[e.type];if(undefined!==e.data){a+=r?l.encode(String(e.data)):String(e.data)}return i(""+a)};function m(e,t){var r="b"+b.packets[e.type]+e.data.data;return t(r)}function v(e,t,r){if(!t){return b.encodeBase64Packet(e,r)}var i=e.data;var n=new Uint8Array(i);var a=new Uint8Array(1+i.byteLength);a[0]=c[e.type];for(var o=0;o<n.length;o++){a[o+1]=n[o]}return r(a.buffer)}function a(e,t,r){if(!t){return b.encodeBase64Packet(e,r)}var i=new FileReader;i.onload=function(){e.data=i.result;b.encodePacket(e,t,true,r)};return i.readAsArrayBuffer(e.data)}function _(e,t,r){if(!t){return b.encodeBase64Packet(e,r)}if(d){return a(e,t,r)}var i=new Uint8Array(1);i[0]=c[e.type];var n=new g([i.buffer,e.data]);return r(n)}b.encodeBase64Packet=function(t,r){var i="b"+b.packets[t.type];if(g&&t.data instanceof g){var n=new FileReader;n.onload=function(){var e=n.result.split(",")[1];r(i+e)};return n.readAsDataURL(t.data)}var a;try{a=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){var o=new Uint8Array(t.data);var s=new Array(o.length);for(var l=0;l<o.length;l++){s[l]=o[l]}a=String.fromCharCode.apply(null,s)}i+=u.btoa(a);return r(i)};b.decodePacket=function(e,t,r){if(typeof e=="string"||e===undefined){if(e.charAt(0)=="b"){return b.decodeBase64Packet(e.substr(1),t)}if(r){try{e=l.decode(e)}catch(e){return p}}var i=e.charAt(0);if(Number(i)!=i||!f[i]){return p}if(e.length>1){return{type:f[i],data:e.substring(1)}}else{return{type:f[i]}}}var n=new Uint8Array(e);var i=n[0];var a=h(e,1);if(g&&t==="blob"){a=new g([a])}return{type:f[i],data:a}};b.decodeBase64Packet=function(e,t){var r=f[e.charAt(0)];if(!u.ArrayBuffer){return{type:r,data:{base64:true,data:e.substr(1)}}}var i=n.decode(e.substr(1));if(t==="blob"&&g){i=new g([i])}return{type:r,data:i}};b.encodePayload=function(e,r,i){if(typeof r=="function"){i=r;r=null}var n=o(e);if(r&&n){if(g&&!d){return b.encodePayloadAsBlob(e,i)}return b.encodePayloadAsArrayBuffer(e,i)}if(!e.length){return i("0:")}function a(e){return e.length+":"+e}function t(e,t){b.encodePacket(e,!n?false:r,true,function(e){t(null,a(e))})}y(e,t,function(e,t){return i(t.join(""))})};function y(e,t,r){var n=new Array(e.length);var i=s(e.length,r);var a=function(r,e,i){t(e,function(e,t){n[r]=t;i(e,n)})};for(var o=0;o<e.length;o++){a(o,e[o],i)}}b.decodePayload=function(e,t,r){if(typeof e!="string"){return b.decodePayloadAsBinary(e,t,r)}if(typeof t==="function"){r=t;t=null}var i;if(e==""){return r(p,0,1)}var n="",a,o;for(var s=0,l=e.length;s<l;s++){var u=e.charAt(s);if(":"!=u){n+=u}else{if(""==n||n!=(a=Number(n))){return r(p,0,1)}o=e.substr(s+1,a);if(n!=o.length){return r(p,0,1)}if(o.length){i=b.decodePacket(o,t,true);if(p.type==i.type&&p.data==i.data){return r(p,0,1)}var d=r(i,s+a,l);if(false===d)return}s+=a;n=""}}if(n!=""){return r(p,0,1)}};b.encodePayloadAsArrayBuffer=function(e,i){if(!e.length){return i(new ArrayBuffer(0))}function t(e,t){b.encodePacket(e,true,true,function(e){return t(null,e)})}y(e,t,function(e,t){var r=t.reduce(function(e,t){var r;if(typeof t==="string"){r=t.length}else{r=t.byteLength}return e+r.toString().length+r+2},0);var o=new Uint8Array(r);var s=0;t.forEach(function(e){var t=typeof e==="string";var r=e;if(t){var i=new Uint8Array(e.length);for(var n=0;n<e.length;n++){i[n]=e.charCodeAt(n)}r=i.buffer}if(t){o[s++]=0}else{o[s++]=1}var a=r.byteLength.toString();for(var n=0;n<a.length;n++){o[s++]=parseInt(a[n])}o[s++]=255;var i=new Uint8Array(r);for(var n=0;n<i.length;n++){o[s++]=i[n]}});return i(o.buffer)})};b.encodePayloadAsBlob=function(e,r){function t(e,l){b.encodePacket(e,true,true,function(e){var t=new Uint8Array(1);t[0]=1;if(typeof e==="string"){var r=new Uint8Array(e.length);for(var i=0;i<e.length;i++){r[i]=e.charCodeAt(i)}e=r.buffer;t[0]=0}var n=e instanceof ArrayBuffer?e.byteLength:e.size;var a=n.toString();var o=new Uint8Array(a.length+1);for(var i=0;i<a.length;i++){o[i]=parseInt(a[i])}o[a.length]=255;if(g){var s=new g([t.buffer,o.buffer,e]);l(null,s)}})}y(e,t,function(e,t){return r(new g(t))})};b.decodePayloadAsBinary=function(e,r,i){if(typeof r==="function"){i=r;r=null}var t=e;var n=[];var a=false;while(t.byteLength>0){var o=new Uint8Array(t);var s=o[0]===0;var l="";for(var u=1;;u++){if(o[u]==255)break;if(l.length>310){a=true;break}l+=o[u]}if(a)return i(p,0,1);t=h(t,2+l.length);l=parseInt(l);var d=h(t,0,l);if(s){try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){var c=new Uint8Array(d);d="";for(var u=0;u<c.length;u++){d+=String.fromCharCode(c[u])}}}n.push(d);t=h(t,l)}var f=n.length;n.forEach(function(e,t){i(b.decodePacket(e,r,true),t,f)})}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(e,t,r){t.exports=Object.keys||function e(t){var r=[];var i=Object.prototype.hasOwnProperty;for(var n in t){if(i.call(t,n)){r.push(n)}}return r}},{}],27:[function(e,t,r){t.exports=i;function i(e,r,i){var n=false;i=i||o;a.count=e;return e===0?r():a;function a(e,t){if(a.count<=0){throw new Error("after called too many times")}--a.count;if(e){n=true;r(e);r=i}else if(a.count===0&&!n){r(null,t)}}}function o(){}},{}],28:[function(e,t,r){t.exports=function(e,t,r){var i=e.byteLength;t=t||0;r=r||i;if(e.slice){return e.slice(t,r)}if(t<0){t+=i}if(r<0){r+=i}if(r>i){r=i}if(t>=i||t>=r||i===0){return new ArrayBuffer(0)}var n=new Uint8Array(e);var a=new Uint8Array(r-t);for(var o=t,s=0;o<r;o++,s++){a[s]=n[o]}return a.buffer}},{}],29:[function(e,t,r){(function(c){"use strict";r.encode=function(e){var t=new Uint8Array(e),r,i=t.length,n="";for(r=0;r<i;r+=3){n+=c[t[r]>>2];n+=c[(t[r]&3)<<4|t[r+1]>>4];n+=c[(t[r+1]&15)<<2|t[r+2]>>6];n+=c[t[r+2]&63]}if(i%3===2){n=n.substring(0,n.length-1)+"="}else if(i%3===1){n=n.substring(0,n.length-2)+"=="}return n};r.decode=function(e){var t=e.length*.75,r=e.length,i,n=0,a,o,s,l;if(e[e.length-1]==="="){t--;if(e[e.length-2]==="="){t--}}var u=new ArrayBuffer(t),d=new Uint8Array(u);for(i=0;i<r;i+=4){a=c.indexOf(e[i]);o=c.indexOf(e[i+1]);s=c.indexOf(e[i+2]);l=c.indexOf(e[i+3]);d[n++]=a<<2|o>>4;d[n++]=(o&15)<<4|s>>2;d[n++]=(s&3)<<6|l&63}return u}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(e,a,t){(function(e){var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder;var t=function(){try{var e=new Blob(["hi"]);return e.size==2}catch(e){return false}}();var r=n&&n.prototype.append&&n.prototype.getBlob;function i(e,t){t=t||{};var r=new n;for(var i=0;i<e.length;i++){r.append(e[i])}return t.type?r.getBlob(t.type):r.getBlob()}a.exports=function(){if(t){return e.Blob}else if(r){return i}else{return undefined}}()}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],31:[function(t,r,e){(function(n){var a=t("isarray");r.exports=e;function e(e){function i(e){if(!e)return false;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File){return true}if(a(e)){for(var t=0;t<e.length;t++){if(i(e[t])){return true}}}else if(e&&"object"==typeof e){if(e.toJSON){e=e.toJSON()}for(var r in e){if(e.hasOwnProperty(r)&&i(e[r])){return true}}}return false}return i(e)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:32}],32:[function(e,t,r){t.exports=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"}},{}],33:[function(e,E,S){(function(b){(function(e){var t=typeof S=="object"&&S;var r=typeof E=="object"&&E&&E.exports==t&&E;var i=typeof b=="object"&&b;if(i.global===i||i.window===i){e=i}var a=String.fromCharCode;function o(e){var t=[];var r=0;var i=e.length;var n;var a;while(r<i){n=e.charCodeAt(r++);if(n>=55296&&n<=56319&&r<i){a=e.charCodeAt(r++);if((a&64512)==56320){t.push(((n&1023)<<10)+(a&1023)+65536)}else{t.push(n);r--}}else{t.push(n)}}return t}function n(e){var t=e.length;var r=-1;var i;var n="";while(++r<t){i=e[r];if(i>65535){i-=65536;n+=a(i>>>10&1023|55296);i=56320|i&1023}n+=a(i)}return n}function s(e,t){return a(e>>t&63|128)}function l(e){if((e&4294967168)==0){return a(e)}var t="";if((e&4294965248)==0){t=a(e>>6&31|192)}else if((e&4294901760)==0){t=a(e>>12&15|224);t+=s(e,6)}else if((e&4292870144)==0){t=a(e>>18&7|240);t+=s(e,12);t+=s(e,6)}t+=a(e&63|128);return t}function u(e){var t=o(e);var r=t.length;var i=-1;var n;var a="";while(++i<r){n=t[i];a+=l(n)}return a}function d(){if(p>=h){throw Error("Invalid byte index")}var e=f[p]&255;p++;if((e&192)==128){return e&63}throw Error("Invalid continuation byte")}function c(){var e;var t;var r;var i;var n;if(p>h){throw Error("Invalid byte index")}if(p==h){return false}e=f[p]&255;p++;if((e&128)==0){return e}if((e&224)==192){var t=d();n=(e&31)<<6|t;if(n>=128){return n}else{throw Error("Invalid continuation byte")}}if((e&240)==224){t=d();r=d();n=(e&15)<<12|t<<6|r;if(n>=2048){return n}else{throw Error("Invalid continuation byte")}}if((e&248)==240){t=d();r=d();i=d();n=(e&15)<<18|t<<12|r<<6|i;if(n>=65536&&n<=1114111){return n}}throw Error("Invalid UTF-8 detected")}var f;var h;var p;function g(e){f=o(e);h=f.length;p=0;var t=[];var r;while((r=c())!==false){t.push(r)}return n(t)}var m={version:"2.0.0",encode:u,decode:g};if(typeof F=="function"&&typeof F.amd=="object"&&F.amd){F(function(){return m})}else if(t&&!t.nodeType){if(r){r.exports=m}else{var v={};var _=v.hasOwnProperty;for(var y in m){_.call(m,y)&&(t[y]=m[y])}}}else{e.utf8=m}})(this)}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],34:[function(e,t,r){(function(r){var i=/^[\],:{}\s]*$/;var n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var a=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var o=/(?:^|:|,)(?:\s*\[)+/g;var s=/^\s+/;var l=/\s+$/;t.exports=function e(t){if("string"!=typeof t||!t){return null}t=t.replace(s,"").replace(l,"");if(r.JSON&&JSON.parse){return JSON.parse(t)}if(i.test(t.replace(n,"@").replace(a,"]").replace(o,""))){return new Function("return "+t)()}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],35:[function(e,t,r){r.encode=function(e){var t="";for(var r in e){if(e.hasOwnProperty(r)){if(t.length)t+="&";t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])}}return t};r.decode=function(e){var t={};var r=e.split("&");for(var i=0,n=r.length;i<n;i++){var a=r[i].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}},{}],36:[function(e,t,r){var l=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var u=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function e(t){var r=t,i=t.indexOf("["),n=t.indexOf("]");if(i!=-1&&n!=-1){t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length)}var a=l.exec(t||""),o={},s=14;while(s--){o[u[s]]=a[s]||""}if(i!=-1&&n!=-1){o.source=r;o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":");o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":");o.ipv6uri=true}return o}},{}],37:[function(e,t,r){var i=function(){return this}();var n=i.WebSocket||i.MozWebSocket;t.exports=n?a:null;function a(e,t,r){var i;if(t){i=new n(e,t)}else{i=new n(e)}return i}if(n)a.prototype=n.prototype},{}],38:[function(t,r,e){(function(n){var a=t("isarray");r.exports=e;function e(e){function i(e){if(!e)return false;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File){return true}if(a(e)){for(var t=0;t<e.length;t++){if(i(e[t])){return true}}}else if(e&&"object"==typeof e){if(e.toJSON){e=e.toJSON()}for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r)&&i(e[r])){return true}}}return false}return i(e)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:39}],39:[function(e,t,r){t.exports=e(32)},{}],40:[function(e,t,r){var i=e("global");try{t.exports="XMLHttpRequest"in i&&"withCredentials"in new i.XMLHttpRequest}catch(e){t.exports=false}},{global:41}],41:[function(e,t,r){t.exports=function(){return this}()},{}],42:[function(e,t,r){var i=[].indexOf;t.exports=function(e,t){if(i)return e.indexOf(t);for(var r=0;r<e.length;++r){if(e[r]===t)return r}return-1}},{}],43:[function(e,t,r){var i=Object.prototype.hasOwnProperty;r.keys=Object.keys||function(e){var t=[];for(var r in e){if(i.call(e,r)){t.push(r)}}return t};r.values=function(e){var t=[];for(var r in e){if(i.call(e,r)){t.push(e[r])}}return t};r.merge=function(e,t){for(var r in t){if(i.call(t,r)){e[r]=t[r]}}return e};r.length=function(e){return r.keys(e).length};r.isEmpty=function(e){return 0==r.length(e)}},{}],44:[function(e,t,r){var a=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function e(t){var r=a.exec(t||""),i={},n=14;while(n--){i[o[n]]=r[n]||""}return i}},{}],45:[function(e,t,r){(function(d){var c=e("isarray");var f=e("./is-buffer");r.deconstructPacket=function(e){var a=[];var t=e.data;function o(e){if(!e)return e;if(f(e)){var t={_placeholder:true,num:a.length};a.push(e);return t}else if(c(e)){var r=new Array(e.length);for(var i=0;i<e.length;i++){r[i]=o(e[i])}return r}else if("object"==typeof e&&!(e instanceof Date)){var r={};for(var n in e){r[n]=o(e[n])}return r}return e}var r=e;r.data=o(t);r.attachments=a.length;return{packet:r,buffers:a}};r.reconstructPacket=function(e,n){var t=0;function a(e){if(e&&e._placeholder){var t=n[e.num];return t}else if(c(e)){for(var r=0;r<e.length;r++){e[r]=a(e[r])}return e}else if(e&&"object"==typeof e){for(var i in e){e[i]=a(e[i])}return e}return e}e.data=a(e.data);e.attachments=undefined;return e};r.removeBlobs=function(e,o){function s(e,t,r){if(!e)return e;if(d.Blob&&e instanceof Blob||d.File&&e instanceof File){l++;var i=new FileReader;i.onload=function(){if(r){r[t]=this.result}else{u=this.result}if(!--l){o(u)}};i.readAsArrayBuffer(e)}else if(c(e)){for(var n=0;n<e.length;n++){s(e[n],n,e)}}else if(e&&"object"==typeof e&&!f(e)){for(var a in e){s(e[a],a,e)}}}var l=0;var u=e;s(u);if(!l){o(u)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":47,isarray:48}],46:[function(e,t,o){var s=e("debug")("socket.io-parser");var l=e("json3");var r=e("isarray");var i=e("component-emitter");var a=e("./binary");var n=e("./is-buffer");o.protocol=4;o.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"];o.CONNECT=0;o.DISCONNECT=1;o.EVENT=2;o.ACK=3;o.ERROR=4;o.BINARY_EVENT=5;o.BINARY_ACK=6;o.Encoder=u;o.Decoder=f;function u(){}u.prototype.encode=function(e,t){s("encoding packet %j",e);if(o.BINARY_EVENT==e.type||o.BINARY_ACK==e.type){c(e,t)}else{var r=d(e);t([r])}};function d(e){var t="";var r=false;t+=e.type;if(o.BINARY_EVENT==e.type||o.BINARY_ACK==e.type){t+=e.attachments;t+="-"}if(e.nsp&&"/"!=e.nsp){r=true;t+=e.nsp}if(null!=e.id){if(r){t+=",";r=false}t+=e.id}if(null!=e.data){if(r)t+=",";t+=l.stringify(e.data)}s("encoded %j as %s",e,t);return t}function c(e,n){function t(e){var t=a.deconstructPacket(e);var r=d(t.packet);var i=t.buffers;i.unshift(r);n(i)}a.removeBlobs(e,t)}function f(){this.reconstructor=null}i(f.prototype);f.prototype.add=function(e){var t;if("string"==typeof e){t=h(e);if(o.BINARY_EVENT==t.type||o.BINARY_ACK==t.type){this.reconstructor=new p(t);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",t)}}else{this.emit("decoded",t)}}else if(n(e)||e.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{t=this.reconstructor.takeBinaryData(e);if(t){this.reconstructor=null;this.emit("decoded",t)}}}else{throw new Error("Unknown type: "+e)}};function h(e){var t={};var r=0;t.type=Number(e.charAt(0));if(null==o.types[t.type])return g();if(o.BINARY_EVENT==t.type||o.BINARY_ACK==t.type){var i="";while(e.charAt(++r)!="-"){i+=e.charAt(r);if(r+1==e.length)break}if(i!=Number(i)||e.charAt(r)!="-"){throw new Error("Illegal attachments")}t.attachments=Number(i)}if("/"==e.charAt(r+1)){t.nsp="";while(++r){var n=e.charAt(r);if(","==n)break;t.nsp+=n;if(r+1==e.length)break}}else{t.nsp="/"}var a=e.charAt(r+1);if(""!==a&&Number(a)==a){t.id="";while(++r){var n=e.charAt(r);if(null==n||Number(n)!=n){--r;break}t.id+=e.charAt(r);if(r+1==e.length)break}t.id=Number(t.id)}if(e.charAt(++r)){try{t.data=l.parse(e.substr(r))}catch(e){return g()}}s("decoded %s as %j",e,t);return t}f.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function p(e){this.reconPack=e;this.buffers=[]}p.prototype.takeBinaryData=function(e){this.buffers.push(e);if(this.buffers.length==this.reconPack.attachments){var t=a.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return t}return null};p.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function g(e){return{type:o.ERROR,data:"parser error"}}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(e,r,t){(function(t){r.exports=e;function e(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],48:[function(e,t,r){t.exports=e(32)},{}],49:[function(e,t,B){(function(e){var w={}.toString,T,k,A;var t=typeof F==="function"&&F.amd;var r=typeof JSON=="object"&&JSON;var l=typeof B=="object"&&B&&!B.nodeType&&B;if(l&&r){l.stringify=r.stringify;l.parse=r.parse}else{l=e.JSON=r||{}}var u=new Date(-0xc782b5b800cec);try{u=u.getUTCFullYear()==-109252&&u.getUTCMonth()===0&&u.getUTCDate()===1&&u.getUTCHours()==10&&u.getUTCMinutes()==37&&u.getUTCSeconds()==6&&u.getUTCMilliseconds()==708}catch(e){}function d(e){if(d[e]!==A){return d[e]}var t;if(e=="bug-string-char-index"){t="a"[0]!="a"}else if(e=="json"){t=d("json-stringify")&&d("json-parse")}else{var r,i='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(e=="json-stringify"){var n=l.stringify,a=typeof n=="function"&&u;if(a){(r=function(){return 1}).toJSON=r;try{a=n(0)==="0"&&n(new Number)==="0"&&n(new String)=='""'&&n(w)===A&&n(A)===A&&n()===A&&n(r)==="1"&&n([r])=="[1]"&&n([A])=="[null]"&&n(null)=="null"&&n([A,w,null])=="[null,null,null]"&&n({a:[r,true,false,null,"\0\b\n\f\r "]})==i&&n(null,r)==="1"&&n([1,2],null,1)=="[\n 1,\n 2\n]"&&n(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&n(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&n(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&n(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(e){a=false}}t=a}if(e=="json-parse"){var o=l.parse;if(typeof o=="function"){try{if(o("0")===0&&!o(false)){r=o(i);var s=r["a"].length==5&&r["a"][0]===1;if(s){try{s=!o('"  "')}catch(e){}if(s){try{s=o("01")!==1}catch(e){}}if(s){try{s=o("1.")!==1}catch(e){}}}}}catch(e){s=false}}t=s}}return d[e]=!!t}if(!d("json")){var c="[object Function]";var D="[object Date]";var R="[object Number]";var O="[object String]";var L="[object Array]";var C="[object Boolean]";var s=d("bug-string-char-index");if(!u){var P=Math.floor;var i=[0,31,59,90,120,151,181,212,243,273,304,334];var x=function(e,t){return i[t]+365*(e-1970)+P((e-1969+(t=+(t>1)))/4)-P((e-1901+t)/100)+P((e-1601+t)/400)}}if(!(T={}.hasOwnProperty)){T=function(e){var t={},r;if((t.__proto__=null,t.__proto__={toString:1},t).toString!=w){T=function(e){var t=this.__proto__,r=e in(this.__proto__=null,this);this.__proto__=t;return r}}else{r=t.constructor;T=function(e){var t=(this.constructor||r).prototype;return e in this&&!(e in t&&this[e]===t[e])}}t=null;return T.call(this,e)}}var n={boolean:1,number:1,string:1,undefined:1};var f=function(e,t){var r=typeof e[t];return r=="object"?!!e[t]:!n[r]};k=function(e,t){var r=0,i,o,n;(i=function(){this.valueOf=0}).prototype.valueOf=0;o=new i;for(n in o){if(T.call(o,n)){r++}}i=o=null;if(!r){o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];k=function(e,t){var r=w.call(e)==c,i,n;var a=!r&&typeof e.constructor!="function"&&f(e,"hasOwnProperty")?e.hasOwnProperty:T;for(i in e){if(!(r&&i=="prototype")&&a.call(e,i)){t(i)}}for(n=o.length;i=o[--n];a.call(e,i)&&t(i));}}else if(r==2){k=function(e,t){var r={},i=w.call(e)==c,n;for(n in e){if(!(i&&n=="prototype")&&!T.call(r,n)&&(r[n]=1)&&T.call(e,n)){t(n)}}}}else{k=function(e,t){var r=w.call(e)==c,i,n;for(i in e){if(!(r&&i=="prototype")&&T.call(e,i)&&!(n=i==="constructor")){t(i)}}if(n||T.call(e,i="constructor")){t(i)}}}return k(e,t)};if(!d("json-stringify")){var h={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var a="000000";var I=function(e,t){return(a+(t||0)).slice(-e)};var p="\\u00";var M=function(e){var t='"',r=0,i=e.length,n=i>10&&s,a;if(n){a=e.split("")}for(;r<i;r++){var o=e.charCodeAt(r);switch(o){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=h[o];break;default:if(o<32){t+=p+I(2,o.toString(16));break}t+=n?a[r]:s?e.charAt(r):e[r]}}return t+'"'};var j=function(e,t,r,i,n,a,o){var s,l,u,d,c,f,h,p,g,m,v,_,y,b,E,S;try{s=t[e]}catch(e){}if(typeof s=="object"&&s){l=w.call(s);if(l==D&&!T.call(s,"toJSON")){if(s>-1/0&&s<1/0){if(x){c=P(s/864e5);for(u=P(c/365.2425)+1970-1;x(u+1,0)<=c;u++);for(d=P((c-x(u,0))/30.42);x(u,d+1)<=c;d++);c=1+c-x(u,d);f=(s%864e5+864e5)%864e5;h=P(f/36e5)%24;p=P(f/6e4)%60;g=P(f/1e3)%60;m=f%1e3}else{u=s.getUTCFullYear();d=s.getUTCMonth();c=s.getUTCDate();h=s.getUTCHours();p=s.getUTCMinutes();g=s.getUTCSeconds();m=s.getUTCMilliseconds()}s=(u<=0||u>=1e4?(u<0?"-":"+")+I(6,u<0?-u:u):I(4,u))+"-"+I(2,d+1)+"-"+I(2,c)+"T"+I(2,h)+":"+I(2,p)+":"+I(2,g)+"."+I(3,m)+"Z"}else{s=null}}else if(typeof s.toJSON=="function"&&(l!=R&&l!=O&&l!=L||T.call(s,"toJSON"))){s=s.toJSON(e)}}if(r){s=r.call(t,e,s)}if(s===null){return"null"}l=w.call(s);if(l==C){return""+s}else if(l==R){return s>-1/0&&s<1/0?""+s:"null"}else if(l==O){return M(""+s)}if(typeof s=="object"){for(b=o.length;b--;){if(o[b]===s){throw TypeError()}}o.push(s);v=[];E=a;a+=n;if(l==L){for(y=0,b=s.length;y<b;y++){_=j(y,s,r,i,n,a,o);v.push(_===A?"null":_)}S=v.length?n?"[\n"+a+v.join(",\n"+a)+"\n"+E+"]":"["+v.join(",")+"]":"[]"}else{k(i||s,function(e){var t=j(e,s,r,i,n,a,o);if(t!==A){v.push(M(e)+":"+(n?" ":"")+t)}});S=v.length?n?"{\n"+a+v.join(",\n"+a)+"\n"+E+"}":"{"+v.join(",")+"}":"{}"}o.pop();return S}};l.stringify=function(e,t,r){var i,n,a,o;if(typeof t=="function"||typeof t=="object"&&t){if((o=w.call(t))==c){n=t}else if(o==L){a={};for(var s=0,l=t.length,u;s<l;u=t[s++],(o=w.call(u),o==O||o==R)&&(a[u]=1));}}if(r){if((o=w.call(r))==R){if((r-=r%1)>0){for(i="",r>10&&(r=10);i.length<r;i+=" ");}}else if(o==O){i=r.length<=10?r:r.slice(0,10)}}return j("",(u={},u[""]=e,u),n,a,i,"",[])}}if(!d("json-parse")){var g=String.fromCharCode;var m={92:"\\",34:'"',47:"/",98:"\b",116:"  ",110:"\n",102:"\f",114:"\r"};var v,_;var y=function(){v=_=null;throw SyntaxError()};var o=function(){var e=_,t=e.length,r,i,n,a,o;while(v<t){o=e.charCodeAt(v);switch(o){case 9:case 10:case 13:case 32:v++;break;case 123:case 125:case 91:case 93:case 58:case 44:r=s?e.charAt(v):e[v];v++;return r;case 34:for(r="@",v++;v<t;){o=e.charCodeAt(v);if(o<32){y()}else if(o==92){o=e.charCodeAt(++v);switch(o){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:r+=m[o];v++;break;case 117:i=++v;for(n=v+4;v<n;v++){o=e.charCodeAt(v);if(!(o>=48&&o<=57||o>=97&&o<=102||o>=65&&o<=70)){y()}}r+=g("0x"+e.slice(i,v));break;default:y()}}else{if(o==34){break}o=e.charCodeAt(v);i=v;while(o>=32&&o!=92&&o!=34){o=e.charCodeAt(++v)}r+=e.slice(i,v)}}if(e.charCodeAt(v)==34){v++;return r}y();default:i=v;if(o==45){a=true;o=e.charCodeAt(++v)}if(o>=48&&o<=57){if(o==48&&(o=e.charCodeAt(v+1),o>=48&&o<=57)){y()}a=false;for(;v<t&&(o=e.charCodeAt(v),o>=48&&o<=57);v++);if(e.charCodeAt(v)==46){n=++v;for(;n<t&&(o=e.charCodeAt(n),o>=48&&o<=57);n++);if(n==v){y()}v=n}o=e.charCodeAt(v);if(o==101||o==69){o=e.charCodeAt(++v);if(o==43||o==45){v++}for(n=v;n<t&&(o=e.charCodeAt(n),o>=48&&o<=57);n++);if(n==v){y()}v=n}return+e.slice(i,v)}if(a){y()}if(e.slice(v,v+4)=="true"){v+=4;return true}else if(e.slice(v,v+5)=="false"){v+=5;return false}else if(e.slice(v,v+4)=="null"){v+=4;return null}y()}}return"$"};var b=function(e){var t,r;if(e=="$"){y()}if(typeof e=="string"){if((s?e.charAt(0):e[0])=="@"){return e.slice(1)}if(e=="["){t=[];for(;;r||(r=true)){e=o();if(e=="]"){break}if(r){if(e==","){e=o();if(e=="]"){y()}}else{y()}}if(e==","){y()}t.push(b(e))}return t}else if(e=="{"){t={};for(;;r||(r=true)){e=o();if(e=="}"){break}if(r){if(e==","){e=o();if(e=="}"){y()}}else{y()}}if(e==","||typeof e!="string"||(s?e.charAt(0):e[0])!="@"||o()!=":"){y()}t[e.slice(1)]=b(o())}return t}y()}return e};var E=function(e,t,r){var i=S(e,t,r);if(i===A){delete e[t]}else{e[t]=i}};var S=function(e,t,r){var i=e[t],n;if(typeof i=="object"&&i){if(w.call(i)==L){for(n=i.length;n--;){E(i,n,r)}}else{k(i,function(e){E(i,e,r)})}}return r.call(e,t,i)};l.parse=function(e,t){var r,i;v=0;_=""+e;r=b(o());if(o()!="$"){y()}v=_=null;return t&&w.call(t)==c?S((i={},i[""]=r,i),"",t):r}}}if(t){F(function(){return l})}})(this)},{}],50:[function(e,t,r){t.exports=i;function i(e,t){var r=[];t=t||0;for(var i=t||0;i<e.length;i++){r[i-t]=e[i]}return r}},{}]},{},[1])(1)}()},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={SDK:i(r(25)).default};t.default=n},function(e,t,r){e.exports=function(r){function i(e){if(n[e])return n[e].exports;var t=n[e]={exports:{},id:e,loaded:!1};return r[e].call(t.exports,t,t.exports,i),t.loaded=!0,t.exports}var n={};return i.m=r,i.c=n,i.p="",i(0)}([function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.unwatch=t.watch=void 0;var n=r(4),a=i(n),o=r(3),s=i(o),f=(t.watch=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[1];l(i)?_.apply(void 0,t):f(i)?c.apply(void 0,t):d.apply(void 0,t)},t.unwatch=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[1];l(i)||void 0===i?E.apply(void 0,t):f(i)?b.apply(void 0,t):y.apply(void 0,t)},function(e){return"[object Array]"==={}.toString.call(e)}),h=function(e){return"[object Object]"==={}.toString.call(e)},l=function(e){return"[object Function]"==={}.toString.call(e)},p=function(e,t,r){(0,s.default)(e,t,{enumerable:!1,configurable:!0,writable:!1,value:r})},g=function(e,t,r,i,n){var a=void 0,o=e.__watchers__[t];(a=e.__watchers__.__watchall__)&&(o=o?o.concat(a):a);for(var s=o?o.length:0,l=0;l<s;l++)o[l].call(e,r,i,t,n)},m=["pop","push","reverse","shift","sort","unshift","splice"],v=function(d,c,f,h){p(d,f,function(){for(var e=0,t=void 0,r=void 0,i=arguments.length,n=Array(i),a=0;a<i;a++)n[a]=arguments[a];if("splice"===f){var o=n[0],s=o+n[1];t=d.slice(o,s),r=[];for(var l=2;l<n.length;l++)r[l-2]=n[l];e=o}else r="push"===f||"unshift"===f?0<n.length?n:void 0:0<n.length?n[0]:void 0;var u=c.apply(d,n);return"pop"===f?(t=u,e=d.length):"push"===f?e=d.length-1:"shift"===f?t=u:"unshift"!==f&&void 0===r&&(r=u),h.call(d,e,f,r,t),u})},u=function(u,d,e,c){var t=!1,r=f(u);void 0===u.__watchers__&&(p(u,"__watchers__",{}),r&&function(e,t){if(l(t)&&e&&!(e instanceof String)&&f(e))for(var r=m.length;r>0;r--){var i=m[r-1];v(e,e[i],i,t)}}(u,function(e,t,r,i){if(g(u,e,r,i,t),0!==c&&r&&(h(r)||f(r))){var n=void 0,a=u.__watchers__[d];(n=u.__watchers__.__watchall__)&&(a=a?a.concat(n):n);for(var o=a?a.length:0,s=0;s<o;s++)if("splice"!==t)_(r,a[s],void 0===c?c:c-1);else for(var l=0;l<r.length;l++)_(r[l],a[s],void 0===c?c:c-1)}})),void 0===u.__proxy__&&p(u,"__proxy__",{}),void 0===u.__watchers__[d]&&(u.__watchers__[d]=[],r||(t=!0));for(var i=0;i<u.__watchers__[d].length;i++)if(u.__watchers__[d][i]===e)return;u.__watchers__[d].push(e),t&&function(){var n=(0,a.default)(u,d);void 0!==n?function(){var t={enumerable:n.enumerable,configurable:n.configurable};["get","set"].forEach(function(i){void 0!==n[i]&&(t[i]=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n[i].apply(u,t)})});["writable","value"].forEach(function(e){void 0!==n[e]&&(t[e]=n[e])}),(0,s.default)(u.__proxy__,d,t)}():u.__proxy__[d]=u[d];!function(e,t,r,i){(0,s["default"])(e,t,{get:r,set:function(e){i.call(this,e)},enumerable:!0,configurable:!0})}(u,d,function(){return u.__proxy__[d]},function(e){var t=u.__proxy__[d];if(0!==c&&u[d]&&(h(u[d])||f(u[d]))&&!u[d].__watchers__)for(var r=0;r<u.__watchers__[d].length;r++)_(u[d],u.__watchers__[d][r],void 0===c?c:c-1);t!==e&&(u.__proxy__[d]=e,g(u,d,e,t,"set"))})}()},_=function e(t,r,i){if("string"!=typeof t&&(t instanceof Object||f(t)))if(f(t)){if(u(t,"__watchall__",r,i),void 0===i||0<i)for(var n=0;n<t.length;n++)e(t[n],r,i)}else{var a=[];for(var o in t)!{}.hasOwnProperty.call(t,o)||a.push(o);c(t,a,r,i)}},d=function(e,t,r,i){"string"!=typeof e&&(e instanceof Object||f(e))&&(l(e[t])||(null!==e[t]&&(void 0===i||0<i)&&_(e[t],r,void 0!==i?i-1:i),u(e,t,r,i)))},c=function(e,t,r,i){if("string"!=typeof e&&(e instanceof Object||f(e)))for(var n=0;n<t.length;n++){var a=t[n];d(e,a,r,i)}},y=function(e,t,r){if(void 0!==e.__watchers__&&void 0!==e.__watchers__[t])if(void 0===r)delete e.__watchers__[t];else for(var i=0;i<e.__watchers__[t].length;i++)e.__watchers__[t][i]===r&&e.__watchers__[t].splice(i,1)},b=function(e,t,r){for(var i in t)t.hasOwnProperty(i)&&y(e,t[i],r)},E=function(e,t){if(!(e instanceof String||!e instanceof Object&&!f(e)))if(f(e)){for(var r=["__watchall__"],i=0;i<e.length;i++)r.push(i);b(e,r,t)}else!function e(t,r){var i=[];for(var n in t)t.hasOwnProperty(n)&&(t[n]instanceof Object&&e(t[n],r),i.push(n));b(t,i,r)}(e,t)}},function(e,t){var r=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=r)},function(e,t){var r=Object;e.exports={create:r.create,getProto:r.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:r.getOwnPropertyDescriptor,setDesc:r.defineProperty,setDescs:r.defineProperties,getKeys:r.keys,getNames:r.getOwnPropertyNames,getSymbols:r.getOwnPropertySymbols,each:[].forEach}},function(e,t,r){e.exports={default:r(5),__esModule:!0}},function(e,t,r){e.exports={default:r(6),__esModule:!0}},function(e,t,r){var i=r(2);e.exports=function(e,t,r){return i.setDesc(e,t,r)}},function(e,t,r){var i=r(2);r(17),e.exports=function(e,t){return i.getDesc(e,t)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var a=r(7);e.exports=function(i,n,e){if(a(i),void 0===n)return i;switch(e){case 1:return function(e){return i.call(n,e)};case 2:return function(e,t){return i.call(n,e,t)};case 3:return function(e,t,r){return i.call(n,e,t,r)}}return function(){return i.apply(n,arguments)}}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var p=r(13),g=r(1),m=r(9),v="prototype",_=function(e,t,r){var i,n,a,o=e&_.F,s=e&_.G,l=e&_.S,u=e&_.P,d=e&_.B,c=e&_.W,f=s?g:g[t]||(g[t]={}),h=s?p:l?p[t]:(p[t]||{})[v];for(i in s&&(r=t),r)(n=!o&&h&&i in h)&&i in f||(a=n?h[i]:r[i],f[i]=s&&"function"!=typeof h[i]?r[i]:d&&n?m(a,p):c&&h[i]==a?function(t){var e=function(e){return this instanceof t?new t(e):t(e)};return e[v]=t[v],e}(a):u&&"function"==typeof a?m(Function.call,a):a,u&&((f[v]||(f[v]={}))[i]=a))};_.F=1,_.G=2,_.S=4,_.P=8,_.B=16,_.W=32,e.exports=_},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){var i=r(8);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(11),a=r(1),o=r(12);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e],i={};i[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",i)}},function(e,t,r){var i=r(14),n=r(10);e.exports=function(e){return i(n(e))}},function(e,t,r){var i=r(16);r(15)("getOwnPropertyDescriptor",function(r){return function(e,t){return r(i(e),t)}})}])},function(e,t,r){"use strict";var i=r(0),n=r(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o=i(r(44)),s=n(r(13)),l=i(r(8)),u=i(r(1)),d=(a={},(0,o.default)(a,s.UPDATE_TOKEN,function(e,t){e.token=t}),(0,o.default)(a,s.UPDATE_API_DOMAIN,function(e,t){e.api.host=t}),(0,o.default)(a,s.UPDATE_EXT_CONFIG,function(e,t){e.extConfig=t}),(0,o.default)(a,s.UPDATE_INIT_DATA,function(e,t){e.global.data=t}),(0,o.default)(a,s.UPDATE_LIVE_DATA,function(e,t){var r=e.global.liveData;0<t.liveId&&(r.liveId=t.liveId),0<t.courseId&&(r.courseId=t.courseId),"stop"===t&&(r.liveId=0,r.courseId=0),e.global.liveData=r}),(0,o.default)(a,s.UPDATE_LIVE_MODE,function(e,t){e.global.curMode=t}),(0,o.default)(a,s.UPDATE_LIVE_STATUS,function(e,t){e.player.status=t}),(0,o.default)(a,s.UPDATE_TECH_ORDER,function(e,t){e.player.techOrder=t}),(0,o.default)(a,s.UPDATE_CAMERA_DOM,function(e,t){e.player.camera=t}),(0,o.default)(a,s.UPDATE_VIDEO_DOM,function(e,t){e.player.video=t}),(0,o.default)(a,s.UPDATE_WHITEBOARD_DOM,function(e,t){e.player.whiteboard=t}),(0,o.default)(a,s.UPDATE_STEP_DATA,function(e,t){e.global.data&&e.global.data.InitData&&t.step&&(1==t.step&&(e.global.data.InitData.action=t.type),e.global.data.InitData["step"+t.step]=t.command)}),a),c={commit:function(e,t){if(u.default.debug("Commit =>",e,t),d[s[e]])return d[s[e]].call(this,l.default,t);throw new Error("".concat(e," 未定义,请检查..."))}};t.default=c},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t,r){"use strict";var i,n,a;r(0)(r(4));n=[],void 0===(a="function"==typeof(i=function(){var i=window;function r(t){if(!/MicroMessenger/.test(window.navigator.userAgent)){return false}var r=this;i.WeixinJSBridge.invoke("getNetworkType",{},function(e){t&&t(r)},false)}return function e(t){if(i.WeixinJSBridge&&i.WeixinJSBridge.invoke){return r(t)}else{document.addEventListener("WeixinJSBridgeReady",function(){return r(t)})}}})?i.apply(t,n):i)||(e.exports=a)},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(4)),n=i(r(47)),o=i(r(5)),s=i(r(10)),l=i(r(16)),u=i(r(1)),d=i(r(32)),c=i(r(33)),f=i(r(34)),h=i(r(24)),p=i(r(2)),g={room:null,callback:null,obj:null,player:null,connectSuc:!1,trigger:function(e,t,r){switch(r.length){case 0:return void e.trigger(t,"");case 1:return void e.trigger(t,r[0]);case 2:return void e.trigger(t,r[0],r[1]);case 3:return void e.trigger(t,r[0],r[1],r[2]);default:e.trigger(t,r)}},destroy:function(){u.default.debug("socket on destroy!"),this.obj&&(this.obj.close(),this.obj.destroy())},getSocketServer:function(){var e=this.room.websocket.shift();return u.default.debug("[socket server get] ==>",e),e||(u.default.warn("socket => 错误,请刷新页面重试!"),p.default.get("socket:on:error")(),!1)},nativeEmitMatch:function(e){var t,r,i;switch(u.default.debug("native match===>",e),2===e.length?(t=e[0],i="function"==typeof e[1]?e[1]:""):3===e.length&&(t=e[0],r=e[1],i="function"==typeof e[2]?e[2]:""),t){case"question:ask":var n={action:"question",type:"question",typeId:"ask",replyId:r.replyId||"",content:r.msg};return c.default.quesPost("ask",n,i),!0;case"question:reply":n={action:"answer",type:"answer",typeId:"reply",replyId:r.replyId,content:r.msg};return c.default.quesPost("reply",n,i),!0;case"question:get:list":return c.default.getList(MT.room.access_token,i),!0;case"question:get:part":return c.default.getQuestionById(r.qid,i),!0}},emit:function(e){var t={cmd:null,args:[]},r=null;t.cmd=e;for(var i=1;i<arguments.length;i++)"function"==typeof arguments[i]?r=arguments[i]:t.args.push(arguments[i]);this.obj&&(t=f.default.deflate(JSON.stringify(t),{to:"string"}),this.obj.emit("income",t,function(e){if(void 0!==e.length)for(var t in e)e[t]=l.default.dealMemberAvatar(e[t]);else e.data&&void 0!==e.data.a?e.data=l.default.dealMemberAvatar(e.data):void 0!==e.a&&(e=l.default.dealMemberAvatar(e));void 0!==e.code&&-5===e.code?window.location.reload():r&&r(e)}))},onBroadcast:function(e){if("object"===(0,a.default)(e)){var t={},r=this.room.curUser.xid,i=this.room.curUser.sid;if(void 0!==r&&!(void 0!==e.nosid&&0<e.nosid.length&&u.default.in_array(i,e.nosid)||void 0!==e.noxid&&0<e.noxid.length&&u.default.in_array(r,e.noxid))){try{e.args=u.default.detectProtocol(JSON.stringify(e.args)),e.args=JSON.parse(e.args)}catch(e){u.default.debug("Broadcast-data parse Error => "+e)}u.default.debug("Socket on: ======> "+e.cmd,e.args),t.cmd=e.cmd;try{h.default.default.process(e)}catch(e){u.default.debug(e.message)}if("member:total"===e.cmd&&void 0!==e.ext){var n=e.args;t.args=e.ext,t.args.total=n}else t.args=e.args;return t}}},getQuestionList:function(e,t){c.default.getList(e,t)},loggerQueue:[],logTime:null,logger:function(e,t){var r=this,i=o.default.getters("getInitData").user,n={uri:this.obj.io.uri,socket_id:this.obj.id||0,status:e,xid:i.xid,roomid:i.roomid};t&&Object.assign(n,t),this.loggerQueue.push(n),u.default.debug("socket logger ==>",e,n),this.logTime||(this.logTime=setInterval(function(){var e=r.loggerQueue.shift();e&&s.default.socket(e)},550))},listenSystemCmd:function(e){var t=this,r=this.room.user,i=0;try{e.on("connect",function(){u.default.debug("服务器链接成功..."),t.connectSuc=!0,e.socket_id=e.id,t.logger("connect"),p.default.get("connect")()}),e.on("connect_failed",function(e){u.default.debug("[connect_failed]连接服务器失败,失败信息:"+e),p.default.get("connect_failed")(e),t.logger("connect_failed",{reason:e})}),e.on("connect_error",function(e){u.default.debug("[connect_error]连接服务器错误,错误信息:"+e+" ==> 错误统计次数:"+i),i+=1,t.reConnect(i),t.logger("connect_error",{reason:e}),p.default.get("connect_error")(e)}),e.on("disconnect",function(e){u.default.debug("[disconnect]正在重新连接:"+e),t.logger("disconnect",{reason:e}),p.default.get("disconnect")(e)}),e.on("reconnect",function(e){u.default.debug("[reconnect]正在重新连接:"+e),t.logger("reconnect",{number:e}),p.default.get("reconnect")(e)}),e.on("reconnecting",function(e){u.default.debug("[reconnecting]正在重新连接:"+e),t.logger("reconnecting",{number:e}),p.default.get("reconnecting")(e)}),e.on("reconnect_error",function(e){u.default.debug("[reconnect_error]重新连接失败!"),t.logger("reconnect_error",{reason:e}),p.default.get("reconnect_error")(e)}),e.on("reconnect_failed",function(){u.default.debug("[reconnect_failed]重新连接失败..."),t.logger("reconnect_failed"),p.default.get("reconnect_failed")()}),e.on("member:join:me",function(e){u.default.debug("初始化数据完成 ====> member:join:me"),u.default.debug(e);var t=r.xid;try{e=u.default.detectProtocol(JSON.stringify(e)),e=JSON.parse(e)}catch(e){u.default.debug("members data parse Error"+e)}l.default.onlineUsers(e,t),p.default.get("member:join:me")(e),u.default.isMobile()||e&&d.default.VoiceModelDispatch(e),this.roomInited||(this.roomInited=!0)})}catch(e){throw p.default.get("system:socket:error")("系统事件:"+e.message),new Error("系统事件:"+e.message)}},reConnect:function(e){if(3<e)try{this.obj.close();var t=this.getSocketServer();this.connect(t,this.callback)}catch(e){u.default.error("[connect_error]socket链接失败 => ".concat(e))}},connect:function(e,t){if(!e)return!1;var r=this.room,i=n.default.connect(e,{timeout:2e3,reconnection:!0,multiplex:!1,reconnectionDelay:1e3,reconnectionDelayMax:5e3,query:"access_token="+r.access_token+"&sessionid="+r.user.sessionid+"&xid="+r.user.xid});this.obj=i,window.__socket=i,this.listenSystemCmd(i),t(i)},init:function(e,t){var r=e;if(this.room=e,this.callback=t,!r.websocket||!r.access_token)return u.default.debug("获取聊天服务器地址失败！"),p.default.get("system:socket:error")("获取聊天服务器地址失败！"),!1;"string"==typeof this.room.websocket&&(this.room.websocket=[this.room.websocket]);var i=this.getSocketServer();this.connect(i,t)}};t.default=g},function(e,t,r){"use strict";r.r(t);var i=r(40),n=r.n(i);t.default=n.a},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(49)),a=i(r(50)),o=i(r(51)),s=i(r(53)),l=i(r(54)),u=r(29),d=i(r(7)),c=i(r(1)),f=function(e){function r(e){var t;return(0,n.default)(this,r),(t=(0,o.default)(this,(0,s.default)(r).call(this))).state={fullDom:e.fullDom,tplType:e.tplType,isFullscreenFlag:!1},t}return(0,l.default)(r,e),(0,a.default)(r,[{key:"componentDidUpdate",value:function(){c.default.debug("controls update...")}},{key:"componentDidMount",value:function(){this.fullScreenEvent()}},{key:"fullScreenEvent",value:function(){function e(){document.fullscreenElement||document.mozFullScreenElement||document.msFullScreenElement||document.webkitFullscreenElement?t.setState({isFullscreenFlag:!0}):t.setState({isFullscreenFlag:!1})}var t=this;document.addEventListener("fullscreenchange",function(){e()},!1),document.addEventListener("webkitfullscreenchange",function(){e()},!1)}},{key:"checkIosFullscreen",value:function(){var t=this;if(c.default.isIos())var r=setInterval(function(){var e=t.state.fullDom.querySelector("video");e&&!e.webkitDisplayingFullscreen&&(e.play(),clearInterval(r))},1e3)}},{key:"reload",value:function(){"video"===this.state.tplType?d.default.reload():window.location.reload()}},{key:"fullscreen",value:function(){if(this.state.isFullscreenFlag)c.default.exitFullscreen();else if(this.state.fullDom){var e=this.state.fullDom;c.default.isIos()&&e&&e.querySelector("video")&&(e=e.querySelector("video")),c.default.fullscreen(e),this.checkIosFullscreen()}}},{key:"render",value:function(e,t){var r=null;return r=t.isFullscreenFlag?(0,u.h)("svg",{t:"1577104736771",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6402",width:"24",height:"24"},(0,u.h)("path",{d:"M708.041567 370.800959l240.652278-240.652278-63.027978-63.027978-240.652278 240.652279v-245.56355H556.610711v396.994405h399.45004V370.800959zM67.939249 548.42526v88.402877h245.563549L75.306155 877.480416l63.027978 63.027977 240.652278-240.652278v245.563549h88.402878V548.42526z","p-id":"6403",fill:"#ffffff"})):(0,u.h)("svg",{t:"1577088691546",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"17525",width:"24",height:"24"},(0,u.h)("path",{d:"M793.988809 100.681055H512.409273v138.334133h181.717026L524.68745 405.179856l99.043965 97.406875L793.988809 336.422062v177.624301h140.789768V100.681055H793.988809zM500.131095 623.731415L400.268585 526.32454 230.011191 692.489209V514.046363H89.221423v413.365308h423.18785V789.896083H329.873701l170.257394-166.164668z","p-id":"17526",fill:"#ffffff"})),(0,u.h)("div",{class:"tf-player-controls"},(0,u.h)("div",{class:"tf-xplayer-inner"},(0,u.h)("span",{class:"tf-player-reload",onClick:this.reload.bind(this)},(0,u.h)("svg",{t:"1577087976556",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"16410",width:"24",height:"24"},(0,u.h)("path",{d:"M975.424746 367.758714H767.628836a48.055585 48.055585 0 1 1 0-95.888691h83.429835A415.36934 415.36934 0 1 0 927.59164 511.70299 48.055585 48.055585 0 1 1 1023.480331 511.70299a511.70299 511.70299 0 1 1-95.888691-297.677653V127.925747a48.055585 48.055585 0 1 1 95.888691 0v191.999861a48.055585 48.055585 0 0 1-48.055585 47.833106z",fill:"#ffffff","p-id":"16411"}))),(0,u.h)("span",{class:"tf-player-fullscreen",onClick:this.fullscreen.bind(this)},r)))}}]),r}(u.Component);t.default=f},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}},function(e,t,r){var i=r(4),n=r(52);e.exports=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?n(e):t}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}t.exports=r},function(e,t,r){var i=r(55);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}},function(r,e){function i(e,t){return r.exports=i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}r.exports=i},function(e,t,r){var i;"undefined"!=typeof window&&(i=function(){return(i={},n.m=r={"./node_modules/eventemitter3/index.js":function(e,t,r){"use strict";var i=Object.prototype.hasOwnProperty,h="~";function n(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,r,i,n){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,i||e,n),o=h?h+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],a]:e._events[o].push(a):(e._events[o]=a,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(h=!1)),o.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(h?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=h?h+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,n=r.length,a=new Array(n);i<n;i++)a[i]=r[i].fn;return a},o.prototype.listenerCount=function(e){var t=h?h+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,i,n,a){var o=h?h+e:e;if(!this._events[o])return!1;var s,l,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,n),!0;case 6:return u.fn.call(u.context,t,r,i,n,a),!0}for(l=1,s=new Array(d-1);l<d;l++)s[l-1]=arguments[l];u.fn.apply(u.context,s)}else{var c,f=u.length;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,i);break;default:if(!s)for(c=1,s=new Array(d-1);c<d;c++)s[c-1]=arguments[c];u[l].fn.apply(u[l].context,s)}}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,r,i){var n=h?h+e:e;if(!this._events[n])return this;if(!t)return u(this,n),this;var a=this._events[n];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||u(this,n);else{for(var o=0,s=[],l=a.length;o<l;o++)(a[o].fn!==t||i&&!a[o].once||r&&a[o].context!==r)&&s.push(a[o]);s.length?this._events[n]=1===s.length?s[0]:s:u(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=h?h+e:e,this._events[t]&&u(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=h,o.EventEmitter=o,e.exports=o},"./node_modules/node-libs-browser/node_modules/events/events.js":function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}function d(e){return void 0===e}((e.exports=i).EventEmitter=i).prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,r,i,n,a,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var s=new Error('Uncaught, unspecified "error" event. ('+t+")");throw s.context=t,s}if(d(r=this._events[e]))return!1;if(l(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),r.apply(this,n)}else if(u(r))for(n=Array.prototype.slice.call(arguments,1),i=(o=r.slice()).length,a=0;a<i;a++)o[a].apply(this,n);return!0},i.prototype.on=i.prototype.addListener=function(e,t){var r;if(!l(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,l(t.listener)?t.listener:t),this._events[e]?u(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,u(this._events[e])&&!this._events[e].warned&&(r=d(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.once=function(e,t){if(!l(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var r,i,n,a;if(!l(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=(r=this._events[e]).length,i=-1,r===t||l(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(u(r)){for(a=n;0<a--;)if(r[a]===t||r[a].listener&&r[a].listener===t){i=a;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(l(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?l(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(l(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,r){var i,d,n,a,c;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,d=/^([^\/?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,c={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var i=c.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=c.normalizePath(i.path),c.buildURLFromParts(i)}var n=c.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return r.alwaysNormalize?(n.path=c.normalizePath(n.path),c.buildURLFromParts(n)):t;var a=c.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var o=d.exec(a.path);a.netLoc=o[1],a.path=o[2]}a.netLoc&&!a.path&&(a.path="/");var s={scheme:a.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(s.netLoc=a.netLoc,"/"!==n.path[0]))if(n.path){var l=a.path,u=l.substring(0,l.lastIndexOf("/")+1)+n.path;s.path=c.normalizePath(u)}else s.path=a.path,n.params||(s.params=a.params,n.query||(s.query=a.query));return null===s.path&&(s.path=r.alwaysNormalize?c.normalizePath(n.path):n.path),c.buildURLFromParts(s)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=c},"./node_modules/webworkify-webpack/index.js":function(e,t,h){function l(r){var i={};function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=r,n.c=i,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var e=n(n.s=ENTRY_MODULE);return e.default||e}var p="[\\.|\\-|\\+|\\w|/|@]+",g="\\((/\\*.*?\\*/)?s?.*?("+p+").*?\\)";function m(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(e,t,r){var i={};i[r]=[];var n=t.toString(),a=n.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return i;for(var o,s=a[1],l=new RegExp("(\\\\n|\\W)"+m(s)+g,"g");o=l.exec(n);)"dll-reference"!==o[3]&&i[r].push(o[3]);for(l=new RegExp("\\("+m(s)+'\\("(dll-reference\\s('+p+'))"\\)\\)'+g,"g");o=l.exec(n);)e[o[2]]||(i[r].push(o[1]),e[o[2]]=h(o[1]).m),i[o[2]]=i[o[2]]||[],i[o[2]].push(o[4]);for(var u,d=Object.keys(i),c=0;c<d.length;c++)for(var f=0;f<i[d[c]].length;f++)u=i[d[c]][f],isNaN(1*u)||(i[d[c]][f]=1*i[d[c]][f]);return i}function v(r){return Object.keys(r).reduce(function(e,t){return e||0<r[t].length},!1)}e.exports=function(e,t){t=t||{};var r={main:h.m},i=t.all?{main:Object.keys(r.main)}:function(e,t){for(var r={main:[t]},i={main:[]},n={main:{}};v(r);)for(var a=Object.keys(r),o=0;o<a.length;o++){var s=a[o],l=r[s].pop();if(n[s]=n[s]||{},!n[s][l]&&e[s][l]){n[s][l]=!0,i[s]=i[s]||[],i[s].push(l);for(var u=f(e,e[s][l],s),d=Object.keys(u),c=0;c<d.length;c++)r[d[c]]=r[d[c]]||[],r[d[c]]=r[d[c]].concat(u[d[c]])}}return i}(r,e),n="";Object.keys(i).filter(function(e){return"main"!==e}).forEach(function(t){for(var e=0;i[t][e];)e++;i[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+t+" = ("+l.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i[t].map(function(e){return JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"}),n=n+"new (("+l.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i.main.map(function(e){return JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"}))(self);";var a=new window.Blob([n],{type:"text/javascript"});if(t.bare)return a;var o=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a),s=new window.Worker(o);return s.objectURL=o,s}},"./src/config.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./src/controller/abr-controller.js"),n=r("./src/controller/buffer-controller.js"),a=r("./src/controller/cap-level-controller.js"),o=r("./src/controller/fps-controller.js"),s=r("./src/utils/xhr-loader.js"),l=r("./src/controller/audio-track-controller.js"),u=r("./src/controller/audio-stream-controller.js"),d=r("./src/utils/cues.js"),c=r("./src/controller/timeline-controller.js"),f=r("./src/controller/subtitle-track-controller.js"),h=r("./src/controller/subtitle-stream-controller.js"),p=r("./src/controller/eme-controller.js"),g=r("./src/utils/mediakeys-helper.js");t.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:s.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:i.default,bufferController:n.default,capLevelController:a.default,fpsController:o.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:g.requestMediaKeySystemAccess},t.hlsDefaultConfig.subtitleStreamController=h.SubtitleStreamController,t.hlsDefaultConfig.subtitleTrackController=f.default,t.hlsDefaultConfig.timelineController=c.default,t.hlsDefaultConfig.cueHandler=d,t.hlsDefaultConfig.enableCEA708Captions=!0,t.hlsDefaultConfig.enableWebVTT=!0,t.hlsDefaultConfig.captionsTextTrack1Label="English",t.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",t.hlsDefaultConfig.captionsTextTrack2Label="Spanish",t.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",t.hlsDefaultConfig.audioStreamController=u.default,t.hlsDefaultConfig.audioTrackController=l.default,t.hlsDefaultConfig.emeController=p.default},"./src/controller/abr-controller.js":function(e,u,d){"use strict";(function(o){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(u,"__esModule",{value:!0});var r,y=d("./src/events.js"),t=d("./src/event-handler.js"),b=d("./src/utils/buffer-helper.js"),n=d("./src/errors.js"),E=d("./src/utils/logger.js"),s=d("./src/utils/ewma-bandwidth-estimator.js"),S=window.performance,a=(r=t.default,e(l,r),l.prototype.destroy=function(){this.clearTimer(),t.default.prototype.destroy.call(this)},l.prototype.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var r=this.hls,i=r.config,n=t.level,a=void 0,o=void 0;o=r.levels[n].details.live?(a=i.abrEwmaFastLive,i.abrEwmaSlowLive):(a=i.abrEwmaFastVoD,i.abrEwmaSlowVoD),this._bwEstimator=new s.default(r,o,a,i.abrEwmaDefaultEstimate)}},l.prototype._abandonRulesCheck=function(){var e=this.hls,t=e.media,r=this.fragCurrent;if(r){var i=r.loader,n=e.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return E.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var a=i.stats;if(t&&a&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var o=S.now()-a.trequest,s=Math.abs(t.playbackRate);if(o>500*r.duration/s){var l=e.levels,u=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/o),d=l[r.level],c=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,f=a.total?a.total:Math.max(a.loaded,Math.round(r.duration*c/8)),h=t.currentTime,p=(f-a.loaded)/u,g=(b.BufferHelper.bufferInfo(t,h,e.config.maxBufferHole).end-h)/s;if(g<2*r.duration/s&&g<p){var m=void 0,v=void 0;for(v=r.level-1;n<v;v--){var _=l[v].realBitrate?Math.max(l[v].realBitrate,l[v].bitrate):l[v].bitrate;if((m=r.duration*_/(6.4*u))<g)break}m<p&&(E.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+m.toFixed(1)+"<"+p.toFixed(1)+":"+g.toFixed(1)),e.nextLoadLevel=v,this._bwEstimator.sample(o,a.loaded),i.abort(),this.clearTimer(),e.trigger(y.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:a}))}}}}},l.prototype.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&o.isFinite(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[t.level],i=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,n=(r.loaded?r.loaded.duration:0)+e.frag.duration;r.loaded={bytes:i,duration:n},r.realBitrate=Math.round(8*i/n)}if(e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}},l.prototype.onFragBuffered=function(e){var t=e.stats,r=e.frag;if(!0!==t.aborted&&"main"===r.type&&o.isFinite(r.sn)&&(!r.bitrateTest||t.tload===t.tbuffered)){var i=t.tparsed-t.trequest;E.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(i,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},l.prototype.onError=function(e){switch(e.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},l.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(l.prototype,"nextAutoLevel",{get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var r=this._nextABRAutoLevel;return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"_nextABRAutoLevel",{get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.levels,i=e.config,n=e.minAutoLevel,a=e.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,c=(b.BufferHelper.bufferInfo(a,l,i.maxBufferHole).end-l)/u,f=this._findBestLevel(o,s,d,n,t,c,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(0<=f)return f;E.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var h=s?Math.min(s,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,g=i.abrBandWidthUpFactor;if(0==c){var m=this.bitrateTestDelay;m&&(h=(s?Math.min(s,i.maxLoadingDelay):i.maxLoadingDelay)-m,E.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*h)+" ms"),p=g=1)}return f=this._findBestLevel(o,s,d,n,t,c+h,p,g,r),Math.max(f,0)},enumerable:!0,configurable:!0}),l.prototype._findBestLevel=function(e,t,r,i,n,a,o,s,l){for(var u=n;i<=u;u--){var d=l[u];if(d){var c=d.details,f=c?c.totalduration/c.fragments.length:t,h=!!c&&c.live,p=void 0;p=u<=e?o*r:s*r;var g=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,m=g*f/p;if(E.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+g+"/"+f+"/"+a+"/"+m),g<p&&(!m||h&&!this.bitrateTestDelay||m<a))return u}}return-1},l);function l(e){var t=r.call(this,e,y.default.FRAG_LOADING,y.default.FRAG_LOADED,y.default.FRAG_BUFFERED,y.default.ERROR)||this;return t.lastLoadedFragLevel=0,t._nextAutoLevel=-1,t.hls=e,t.timer=null,t._bwEstimator=null,t.onCheck=t._abandonRulesCheck.bind(t),t}u.default=a}).call(this,d("./src/polyfills/number.js").Number)},"./src/controller/audio-stream-controller.js":function(e,o,s){"use strict";(function(x){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(o,"__esModule",{value:!0});var n,I=s("./src/utils/binary-search.js"),M=s("./src/utils/buffer-helper.js"),h=s("./src/demux/demuxer.js"),j=s("./src/events.js"),f=s("./src/controller/level-helper.js"),a=s("./src/utils/time-ranges.js"),p=s("./src/errors.js"),B=s("./src/utils/logger.js"),F=s("./src/utils/discontinuities.js"),N=s("./src/controller/fragment-tracker.js"),g=s("./src/loader/fragment.js"),U=s("./src/controller/base-stream-controller.js"),G=window.performance,t=(n=U.default,e(r,n),r.prototype.onInitPtsFound=function(e){var t=e.id,r=e.frag.cc,i=e.initPTS;"main"===t&&(this.initPTS[r]=i,this.videoTrackCC=r,B.logger.log("InitPTS for cc: "+r+" found from video track: "+i),this.state===U.State.WAITING_INIT_PTS&&this.tick())},r.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<t&&-1===e?(B.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=U.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=U.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=U.State.STOPPED},Object.defineProperty(r.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e,B.logger.log("audio stream:"+t+"->"+e)}},enumerable:!0,configurable:!0}),r.prototype.doTick=function(){var e,t,r,i=this.hls,n=i.config;switch(this.state){case U.State.ERROR:case U.State.PAUSED:case U.State.BUFFER_FLUSHING:break;case U.State.STARTING:this.state=U.State.WAITING_TRACK,this.loadedmetadata=!1;break;case U.State.IDLE:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!n.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var o=this.mediaBuffer?this.mediaBuffer:this.media,s=this.videoBuffer?this.videoBuffer:this.media,l=M.BufferHelper.bufferInfo(o,e,n.maxBufferHole),u=M.BufferHelper.bufferInfo(s,e,n.maxBufferHole),d=l.len,c=l.end,f=this.fragPrevious,h=Math.min(n.maxBufferLength,n.maxMaxBufferLength),p=Math.max(h,u.len),g=this.audioSwitch,m=this.trackId;if((d<p||g)&&m<a.length){if(void 0===(r=a[m].details)){this.state=U.State.WAITING_TRACK;break}if(!g&&this._streamEnded(l,r))return this.hls.trigger(j.default.BUFFER_EOS,{type:"audio"}),void(this.state=U.State.ENDED);var v=r.fragments,_=v.length,y=v[0].start,b=v[_-1].start+v[_-1].duration,E=void 0;if(g)if(r.live&&!r.PTSKnown)B.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),c=0;else if(c=e,r.PTSKnown&&e<y){if(!(l.end>y||l.nextStart))return;B.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=y+.05}if(r.initSegment&&!r.initSegment.data)E=r.initSegment;else if(c<=y){if(E=v[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=F.findFragWithCC(v,this.videoTrackCC)),r.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var S=l.nextStart?l.nextStart:y;return B.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(S+.05)),void(this.media.currentTime=S+.05)}}else{var w=void 0,T=n.maxFragLookUpTolerance,k=f?v[f.sn-v[0].sn+1]:void 0,A=function(e){var t=Math.min(T,e.duration);return e.start+e.duration-t<=c?1:e.start-t>c&&e.start?-1:0};(w=c<b?(b-T<c&&(T=0),k&&!A(k)?k:I.default.search(v,A)):v[_-1])&&(y=(E=w).start,f&&E.level===f.level&&E.sn===f.sn&&(E.sn<r.endSN?(E=v[E.sn+1-r.startSN],B.logger.log("SN just loaded, load next one: "+E.sn)):E=null))}E&&(E.encrypted?(B.logger.log("Loading key for "+E.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+m),this.state=U.State.KEY_LOADING,i.trigger(j.default.KEY_LOADING,{frag:E})):(B.logger.log("Loading "+E.sn+", cc: "+E.cc+" of ["+r.startSN+" ,"+r.endSN+"],track "+m+", currentTime:"+e+",bufferEnd:"+c.toFixed(3)),this.fragCurrent=E,!g&&this.fragmentTracker.getState(E)!==N.FragmentState.NOT_LOADED||(this.startFragRequested=!0,x.isFinite(E.sn)&&(this.nextLoadPosition=E.start+E.duration),i.trigger(j.default.FRAG_LOADING,{frag:E}),this.state=U.State.FRAG_LOADING)))}break;case U.State.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=U.State.IDLE);break;case U.State.FRAG_LOADING_WAITING_RETRY:var D=G.now(),R=this.retryDate,O=(o=this.media)&&o.seeking;(!R||R<=D||O)&&(B.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=U.State.IDLE);break;case U.State.WAITING_INIT_PTS:var L=this.videoTrackCC;if(void 0===this.initPTS[L])break;var C=this.waitingFragment;if(C){var P=C.frag.cc;L!==P?(t=this.tracks[this.trackId]).details&&t.details.live&&(B.logger.warn("Waiting fragment CC ("+P+") does not match video track CC ("+L+")"),this.waitingFragment=null,this.state=U.State.IDLE):(this.state=U.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=U.State.IDLE;break;case U.State.STOPPED:case U.State.FRAG_LOADING:case U.State.PARSING:case U.State.PARSED:case U.State.ENDED:}},r.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)},r.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(B.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},r.prototype.onAudioTracksUpdated=function(e){B.logger.log("audio tracks updated"),this.tracks=e.audioTracks},r.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=U.State.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=U.State.IDLE),this.tick()},r.prototype.onAudioTrackLoaded=function(e){var t=e.details,r=e.id,i=this.tracks[r],n=t.totalduration,a=0;if(B.logger.log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+n),t.live){var o=i.details;o&&0<t.fragments.length?(f.mergeDetails(o,t),a=t.fragments[0].start,t.PTSKnown?B.logger.log("live audio playlist sliding:"+a.toFixed(3)):B.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,B.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(i.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;x.isFinite(s)?(B.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===U.State.WAITING_TRACK&&(this.state=U.State.IDLE),this.tick()},r.prototype.onKeyLoaded=function(){this.state===U.State.KEY_LOADING&&(this.state=U.State.IDLE,this.tick())},r.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag;if(this.state===U.State.FRAG_LOADING&&t&&"audio"===r.type&&r.level===t.level&&r.sn===t.sn){var i=this.tracks[this.trackId],n=i.details,a=n.totalduration,o=t.level,s=t.sn,l=t.cc,u=this.config.defaultAudioCodec||i.audioCodec||"mp4a.40.2",d=this.stats=e.stats;if("initSegment"===s)this.state=U.State.IDLE,d.tparsed=d.tbuffered=G.now(),n.initSegment.data=e.payload,this.hls.trigger(j.default.FRAG_BUFFERED,{stats:d,frag:t,id:"audio"}),this.tick();else{this.state=U.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new h.default(this.hls,"audio"));var c=this.initPTS[l],f=n.initSegment?n.initSegment.data:[];n.initSegment||void 0!==c?(this.pendingBuffering=!0,B.logger.log("Demuxing "+s+" of ["+n.startSN+" ,"+n.endSN+"],track "+o),this.demuxer.push(e.payload,f,u,null,t,a,!1,c)):(B.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+s+" of ["+n.startSN+" ,"+n.endSN+"],track "+o),this.waitingFragment=e,this.state=U.State.WAITING_INIT_PTS)}}this.fragLoadError=0},r.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===U.State.PARSING){var i=e.tracks,n=void 0;if(i.video&&delete i.video,n=i.audio){n.levelCodec=n.codec,n.id=e.id,this.hls.trigger(j.default.BUFFER_CODECS,i),B.logger.log("audio track:audio,container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var a=n.initSegment;if(a){var o={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[o]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(j.default.BUFFER_APPENDING,o))}this.tick()}}},r.prototype.onFragParsingData=function(t){var r=this,e=this.fragCurrent,i=t.frag;if(e&&"audio"===t.id&&"audio"===t.type&&i.sn===e.sn&&i.level===e.level&&this.state===U.State.PARSING){var n=this.trackId,a=this.tracks[n],o=this.hls;x.isFinite(t.endPTS)||(t.endPTS=t.startPTS+e.duration,t.endDTS=t.startDTS+e.duration),e.addElementaryStream(g.default.ElementaryStreamTypes.AUDIO),B.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),f.updateFragPTSDTS(a.details,e,t.startPTS,t.endPTS);var s=this.audioSwitch,l=this.media,u=!1;if(s&&l)if(l.readyState){var d=l.currentTime;B.logger.log("switching audio track : currentTime:"+d),d>=t.startPTS&&(B.logger.log("switching audio track : flushing all audio"),this.state=U.State.BUFFER_FLUSHING,o.trigger(j.default.BUFFER_FLUSHING,{startOffset:0,endOffset:x.POSITIVE_INFINITY,type:"audio"}),u=!0,this.audioSwitch=!1,o.trigger(j.default.AUDIO_TRACK_SWITCHED,{id:n}))}else this.audioSwitch=!1,o.trigger(j.default.AUDIO_TRACK_SWITCHED,{id:n});var c=this.pendingData;if(!c)return B.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void o.trigger(j.default.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&c.push({type:t.type,data:e,parent:"audio",content:"data"})}),!u&&c.length&&(c.forEach(function(e){r.state===U.State.PARSING&&(r.pendingBuffering=!0,r.hls.trigger(j.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},r.prototype.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===U.State.PARSING&&(this.stats.tparsed=G.now(),this.state=U.State.PARSED,this._checkAppendedParsed())},r.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},r.prototype.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==U.State.PARSING&&t!==U.State.PARSED||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},r.prototype._checkAppendedParsed=function(){if(!(this.state!==U.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e,t.tbuffered=G.now(),r.trigger(j.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;B.logger.log("audio buffered : "+a.default.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(j.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=U.State.IDLE}this.tick()}},r.prototype.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:var r=e.frag;if(r&&"audio"!==r.type)break;if(!e.fatal){var i=this.fragLoadError;if(i?i++:i=1,i<=(a=this.config).fragLoadingMaxRetry){this.fragLoadError=i;var n=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);B.logger.warn("AudioStreamController: frag loading failed, retry in "+n+" ms"),this.retryDate=G.now()+n,this.state=U.State.FRAG_LOADING_WAITING_RETRY}else B.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=U.State.ERROR}break;case p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case p.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==U.State.ERROR&&(this.state=e.fatal?U.State.ERROR:U.State.IDLE,B.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===U.State.PARSING||this.state===U.State.PARSED)){var a,o=this.mediaBuffer,s=this.media.currentTime;o&&M.BufferHelper.isBuffered(o,s)&&M.BufferHelper.isBuffered(o,s+.5)?((a=this.config).maxMaxBufferLength>=a.maxBufferLength&&(a.maxMaxBufferLength/=2,B.logger.warn("AudioStreamController: reduce max buffer length to "+a.maxMaxBufferLength+"s")),this.state=U.State.IDLE):(B.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=U.State.BUFFER_FLUSHING,this.hls.trigger(j.default.BUFFER_FLUSHING,{startOffset:0,endOffset:x.POSITIVE_INFINITY,type:"audio"}))}}},r.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(B.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(e){t.hls.trigger(j.default.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=U.State.PARSED):(this.state=U.State.IDLE,this.fragPrevious=null,this.tick())},r);function r(e,t){var r=n.call(this,e,j.default.MEDIA_ATTACHED,j.default.MEDIA_DETACHING,j.default.AUDIO_TRACKS_UPDATED,j.default.AUDIO_TRACK_SWITCHING,j.default.AUDIO_TRACK_LOADED,j.default.KEY_LOADED,j.default.FRAG_LOADED,j.default.FRAG_PARSING_INIT_SEGMENT,j.default.FRAG_PARSING_DATA,j.default.FRAG_PARSED,j.default.ERROR,j.default.BUFFER_RESET,j.default.BUFFER_CREATED,j.default.BUFFER_APPENDED,j.default.BUFFER_FLUSHED,j.default.INIT_PTS_FOUND)||this;return r.fragmentTracker=t,r.config=e.config,r.audioCodecSwap=!1,r._state=U.State.STOPPED,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r}o.default=t}).call(this,s("./src/polyfills/number.js").Number)},"./src/controller/audio-track-controller.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,s=r("./src/events.js"),o=r("./src/task-loop.js"),l=r("./src/utils/logger.js"),u=r("./src/errors.js"),d=(a=o.default,n(c,a),c.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},c.prototype.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(s.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})},c.prototype.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)l.logger.warn("Invalid audio track id:",e.id);else{if(l.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},c.prototype.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},c.prototype.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var r=t.audioGroupIds[t.urlId];this.audioGroupId!==r&&(this.audioGroupId=r,this._selectInitialAudioTrack())}},c.prototype.onError=function(e){e.type===u.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(l.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},Object.defineProperty(c.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"audioTrack",{get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),c.prototype._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)l.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)l.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];l.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var r=t.url,i=t.type,n=t.id;this.hls.trigger(s.default.AUDIO_TRACK_SWITCHING,{id:n,type:i,url:r}),this._loadTrackDetailsIfNeeded(t)}},c.prototype.doTick=function(){this._updateTrack(this._trackId)},c.prototype._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var r=this.tracks[this._trackId],i=null;if(r&&(i=r.name),this._selectDefaultTrack){var n=e.filter(function(e){return e.default});n.length?e=n:l.logger.warn("No default audio tracks defined")}var a=!1,o=function(){e.forEach(function(e){a||t.audioGroupId&&e.groupId!==t.audioGroupId||i&&i!==e.name||(t._setAudioTrack(e.id),a=!0)})};o(),a||(i=null,o()),a||(l.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},c.prototype._needsTrackLoading=function(e){var t=e.details,r=e.url;return!(t&&!t.live||!r)},c.prototype._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,r=e.id;l.logger.log("loading audio-track playlist for id: "+r),this.hls.trigger(s.default.AUDIO_TRACK_LOADING,{url:t,id:r})}},c.prototype._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,l.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},c.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],r=t.name,i=t.language,n=t.groupId;l.logger.warn("Loading failed on audio track id: "+e+", group-id: "+n+', name/language: "'+r+'" / "'+i+'"');for(var a=e,o=0;o<this.tracks.length;o++)if(!this.trackIdBlacklist[o]&&this.tracks[o].name===r){a=o;break}a!==e?(l.logger.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)):l.logger.warn('No fallback audio-track found for name/language: "'+r+'" / "'+i+'"')},c);function c(e){var t=a.call(this,e,s.default.MANIFEST_LOADING,s.default.MANIFEST_PARSED,s.default.AUDIO_TRACK_LOADED,s.default.AUDIO_TRACK_SWITCHED,s.default.LEVEL_LOADED,s.default.ERROR)||this;return t._trackId=-1,t._selectDefaultTrack=!0,t.tracks=[],t.trackIdBlacklist=Object.create(null),t.audioGroupId=null,t}t.default=d},"./src/controller/base-stream-controller.js":function(e,h,s){"use strict";(function(d){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(h,"__esModule",{value:!0});var t=s("./src/task-loop.js"),a=s("./src/controller/fragment-tracker.js"),c=s("./src/utils/buffer-helper.js"),f=s("./src/utils/logger.js");h.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var r,n=(r=t.default,e(o,r),o.prototype.doTick=function(){},o.prototype.startLoad=function(){},o.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=h.State.STOPPED},o.prototype._streamEnded=function(e,t){var r=this.fragCurrent,i=this.fragmentTracker;if(t.live||!r||r.backtracked||r.sn!==t.endSN||e.nextStart)return!1;var n=i.getState(r);return n===a.FragmentState.PARTIAL||n===a.FragmentState.OK},o.prototype.onMediaSeeking=function(){var e=this.config,t=this.media,r=this.mediaBuffer,i=this.state,n=t?t.currentTime:null,a=c.BufferHelper.bufferInfo(r||t,n,this.config.maxBufferHole);if(d.isFinite(n)&&f.logger.log("media seeking to "+n.toFixed(3)),i===h.State.FRAG_LOADING){var o=this.fragCurrent;if(0===a.len&&o){var s=e.maxFragLookUpTolerance,l=o.start-s,u=o.start+o.duration+s;n<l||u<n?(o.loader&&(f.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=h.State.IDLE):f.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else i===h.State.ENDED&&(0===a.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=h.State.IDLE);t&&(this.lastCurrentTime=n),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=n),this.tick()},o.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},o.prototype.onHandlerDestroying=function(){this.stopLoad(),r.prototype.onHandlerDestroying.call(this)},o.prototype.onHandlerDestroyed=function(){this.state=h.State.STOPPED,this.fragmentTracker=null},o);function o(){return null!==r&&r.apply(this,arguments)||this}h.default=n}).call(this,s("./src/polyfills/number.js").Number)},"./src/controller/buffer-controller.js":function(e,c,f){"use strict";(function(i){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(c,"__esModule",{value:!0});var r,l=f("./src/events.js"),t=f("./src/event-handler.js"),u=f("./src/utils/logger.js"),d=f("./src/errors.js"),a=f("./src/utils/mediasource-helper.js").getMediaSource(),o=(r=t.default,e(s,r),s.prototype.destroy=function(){t.default.prototype.destroy.call(this)},s.prototype.onLevelPtsUpdated=function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){var i=this.sourceBuffer.audio;if(.1<Math.abs(i.timestampOffset-e.start)){var n=i.updating;try{i.abort()}catch(e){u.logger.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(u.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+e.start),i.timestampOffset=e.start)}}},s.prototype.onManifestParsed=function(e){this.bufferCodecEventsExpected=e.altAudio?2:1,u.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},s.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var r=this.mediaSource=new a;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),t.src=window.URL.createObjectURL(r),this._objectUrl=t.src}},s.prototype.onMediaDetaching=function(){u.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){u.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):u.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(l.default.MEDIA_DETACHED)},s.prototype.onMediaSourceOpen=function(){u.logger.log("media source opened"),this.hls.trigger(l.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},s.prototype.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,r=Object.keys(t).length;(r&&!e||2===r)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},s.prototype.onMediaSourceClose=function(){u.logger.log("media source closed")},s.prototype.onMediaSourceEnded=function(){u.logger.log("media source ended")},s.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;u.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var r=this.parent,t=this.segments.reduce(function(e,t){return t.parent===r?e+1:e},0),i={},n=this.sourceBuffer;for(var a in n)i[a]=n[a].buffered;this.hls.trigger(l.default.BUFFER_APPENDED,{parent:r,pending:t,timeRanges:i}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===t&&this.flushLiveBackBuffer()},s.prototype.onSBUpdateError=function(e){u.logger.error("sourceBuffer error:",e),this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},s.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},s.prototype.onBufferCodecs=function(t){var r=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(t).forEach(function(e){r.pendingTracks[e]=t[e]});var e=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),e&&"open"===e.readyState&&this.checkPendingTracks()}},s.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;for(var i in e)if(!t[i]){var n=e[i],a=n.levelCodec||n.codec,o=n.container+";codecs="+a;u.logger.log("creating sourceBuffer("+o+")");try{var s=t[i]=r.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[i]={codec:a,container:n.container},n.buffer=s}catch(e){u.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:o})}}this.hls.trigger(l.default.BUFFER_CREATED,{tracks:e})},s.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},s.prototype.onBufferAppendFail=function(e){u.logger.error("sourceBuffer error:",e.event),this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},s.prototype.onBufferEos=function(e){var t=this.sourceBuffer,r=e.type;for(var i in t)r&&i!==r||t[i].ended||(t[i].ended=!0,u.logger.log(i+" sourceBuffer now EOS"));this.checkEos()},s.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){var i=e[r];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}u.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){u.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},s.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},s.prototype.flushLiveBackBuffer=function(){if(this._live){var e=this.hls.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))for(var t=this.media.currentTime,r=this.sourceBuffer,i=Object.keys(r),n=t-Math.max(e,this._levelTargetDuration),a=i.length-1;0<=a;a--){var o=i[a],s=r[o].buffered;0<s.length&&n>s.start(0)&&this.removeBufferRange(o,r[o],0,n)}}},s.prototype.onLevelUpdated=function(e){var t=e.details;0<t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},s.prototype.updateMediaElementDuration=function(){var e,t=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(u.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!i.isFinite(e))&&(u.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},s.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var i in r)t+=r[i].buffered.length}catch(e){u.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(l.default.BUFFER_FLUSHED)}},s.prototype.doAppending=function(){var t=this.hls,r=this.segments,e=this.sourceBuffer;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void u.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(r&&r.length){var i=r.shift();try{var n=e[i.type];n?n.updating?r.unshift(i):(n.ended=!1,this.parent=i.parent,n.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){u.logger.error("error while trying to append buffer:"+e.message),r.unshift(i);var a={type:d.ErrorTypes.MEDIA_ERROR,parent:i.parent};22!==e.code?(this.appendError?this.appendError++:this.appendError=1,a.details=d.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry?(u.logger.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],a.fatal=!0):a.fatal=!1):(this.segments=[],a.details=d.ErrorDetails.BUFFER_FULL_ERROR,a.fatal=!1),t.trigger(l.default.ERROR,a)}}}},s.prototype.flushBuffer=function(e,t,r){var i,n=this.sourceBuffer;if(Object.keys(n).length){if(u.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var a in n)if(!r||a===r){if((i=n[a]).ended=!1,i.updating)return u.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(a,i,e,t))return this.flushBufferCounter++,!1}}else u.logger.warn("abort flushing too many retries");u.logger.log("buffer flushed")}return!0},s.prototype.removeBufferRange=function(e,t,r,i){try{for(var n=0;n<t.buffered.length;n++){var a=t.buffered.start(n),o=t.buffered.end(n),s=Math.max(a,r),l=Math.min(o,i);if(.5<Math.min(l,o)-s)return u.logger.log("sb remove "+e+" ["+s+","+l+"], of ["+a+","+o+"], pos:"+this.media.currentTime),t.remove(s,l),!0}}catch(e){u.logger.warn("removeBufferRange failed",e)}return!1},s);function s(e){var t=r.call(this,e,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_RESET,l.default.BUFFER_APPENDING,l.default.BUFFER_CODECS,l.default.BUFFER_EOS,l.default.BUFFER_FLUSHING,l.default.LEVEL_PTS_UPDATED,l.default.LEVEL_UPDATED)||this;return t._msDuration=null,t._levelDuration=null,t._levelTargetDuration=10,t._live=null,t._objectUrl=null,t.bufferCodecEventsExpected=0,t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t.pendingTracks={},t.tracks={},t}c.default=o}).call(this,f("./src/polyfills/number.js").Number)},"./src/controller/cap-level-controller.js":function(e,l,u){"use strict";(function(r){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(l,"__esModule",{value:!0});var n,a=u("./src/events.js"),t=u("./src/event-handler.js"),o=(n=t.default,e(s,n),s.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},s.prototype.onFpsDropLevelCapping=function(e){s.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},s.prototype.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},s.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this._startCapping()},s.prototype.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()},s.prototype.onLevelsUpdated=function(e){this.levels=e.levels},s.prototype.onMediaDetaching=function(){this._stopCapping()},s.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},s.prototype.getMaxLevel=function(r){var i=this;if(!this.levels)return-1;var e=this.levels.filter(function(e,t){return s.isLevelAllowed(t,i.restrictedLevels)&&t<=r});return s.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)},s.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=r.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=r.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(s.prototype,"mediaWidth",{get:function(){var e,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=s.contentScaleFactor),e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"mediaHeight",{get:function(){var e,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=s.contentScaleFactor),e},enumerable:!0,configurable:!0}),Object.defineProperty(s,"contentScaleFactor",{get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e},enumerable:!0,configurable:!0}),s.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},s.getMaxLevelByMediaSize=function(e,t,r){if(!e||e&&!e.length)return-1;for(var i,n,a=e.length-1,o=0;o<e.length;o+=1){var s=e[o];if((s.width>=t||s.height>=r)&&(i=s,!(n=e[o+1])||i.width!==n.width||i.height!==n.height)){a=o;break}}return a},s);function s(e){var t=n.call(this,e,a.default.FPS_DROP_LEVEL_CAPPING,a.default.MEDIA_ATTACHING,a.default.MANIFEST_PARSED,a.default.BUFFER_CODECS,a.default.MEDIA_DETACHING)||this;return t.autoLevelCapping=r.POSITIVE_INFINITY,t.firstLevel=null,t.levels=[],t.media=null,t.restrictedLevels=[],t.timer=null,t}l.default=o}).call(this,u("./src/polyfills/number.js").Number)},"./src/controller/eme-controller.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r("./src/event-handler.js"),s=r("./src/events.js"),l=r("./src/errors.js"),u=r("./src/utils/logger.js"),d=window.XMLHttpRequest,c="com.widevine.alpha",f="com.microsoft.playready",h=(a=o.default,n(p,a),p.prototype.getLicenseServerUrl=function(e){var t;switch(e){case c:t=this._widevineLicenseUrl;break;default:t=null}return t||(u.logger.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t},p.prototype._attemptKeySystemAccess=function(t,e,r){var i=this,n=function(e,t,r){switch(e){case c:return function(e,t){var r={videoCapabilities:[]};return t.forEach(function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[r]}(0,r);default:throw Error("Unknown key-system: "+e)}}(t,0,r);n?(u.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(t,n).then(function(e){i._onMediaKeySystemAccessObtained(t,e)}).catch(function(e){u.logger.error('Failed to obtain key-system "'+t+'" access:',e)})):u.logger.warn("Can not create config for key-system (maybe because platform is not supported):",t)},Object.defineProperty(p.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),p.prototype._onMediaKeySystemAccessObtained=function(t,e){var r=this;u.logger.log('Access for key-system "'+t+'" obtained');var i={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(i),e.createMediaKeys().then(function(e){i.mediaKeys=e,u.logger.log('Media-keys created for key-system "'+t+'"'),r._onMediaKeysCreated()}).catch(function(e){u.logger.error("Failed to create media-keys:",e)})},p.prototype._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},p.prototype._onNewMediaKeySession=function(t){var r=this;u.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",function(e){r._onKeySessionMessage(t,e.message)},!1)},p.prototype._onKeySessionMessage=function(t,e){u.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(e){u.logger.log("Received license data, updating key-session"),t.update(e)})},p.prototype._onMediaEncrypted=function(e,t){u.logger.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},p.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return u.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});u.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},p.prototype._generateRequestWithPreferredKeySession=function(){var t=this,e=this._mediaKeysList[0];if(!e)return u.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)u.logger.warn("Key-Session already initialized but requested again");else{var r=e.mediaKeysSession;r||(u.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var i=this._mediaEncryptionInitDataType,n=this._mediaEncryptionInitData;u.logger.log('Generating key-session request for "'+i+'" init data type'),e.mediaKeysSessionInitialized=!0,r.generateRequest(i,n).then(function(){u.logger.debug("Key-session generation succeeded")}).catch(function(e){u.logger.error("Error generating key-session request:",e),t.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},p.prototype._createLicenseXhr=function(t,e,r){var i=new d,n=this._licenseXhrSetup;try{if(n)try{n(i,t)}catch(e){i.open("POST",t,!0),n(i,t)}i.readyState||i.open("POST",t,!0)}catch(e){return u.logger.error("Error setting up key-system license XHR",e),void this.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,t,e,r),i},p.prototype._onLicenseRequestReadyStageChange=function(e,t,r,i){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,u.logger.log("License request succeeded"),i(e.response);else{if(u.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=3){var n=3-this._requestLicenseFailureCount+1;return u.logger.warn("Retrying license request, "+n+" attempts left"),void this._requestLicense(r,i)}this.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},p.prototype._generateLicenseRequestChallenge=function(e,t){var r;return e.mediaKeySystemDomain===f?u.logger.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===c?r=t:u.logger.error("Unsupported key-system:",e.mediaKeySystemDomain),r},p.prototype._requestLicense=function(e,t){u.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return u.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var i=this.getLicenseServerUrl(r.mediaKeySystemDomain),n=this._createLicenseXhr(i,e,t);u.logger.log("Sending license request to URL: "+i),n.send(this._generateLicenseRequestChallenge(r,e))},p.prototype.onMediaAttached=function(e){var t=this;if(this._emeEnabled){var r=e.media;(this._media=r).addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})}},p.prototype.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),r=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(c,t,r)}},p);function p(e){var t=a.call(this,e,s.default.MEDIA_ATTACHED,s.default.MANIFEST_PARSED)||this;return t._widevineLicenseUrl=e.config.widevineLicenseUrl,t._licenseXhrSetup=e.config.licenseXhrSetup,t._emeEnabled=e.config.emeEnabled,t._requestMediaKeySystemAccess=e.config.requestMediaKeySystemAccessFunc,t._mediaKeysList=[],t._media=null,t._hasSetMediaKeys=!1,t._isMediaEncrypted=!1,t._requestLicenseFailureCount=0,t}t.default=h},"./src/controller/fps-controller.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,d=r("./src/events.js"),o=r("./src/event-handler.js"),c=r("./src/utils/logger.js"),f=window.performance,s=(a=o.default,n(l,a),l.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},l.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},l.prototype.checkFPS=function(e,t,r){var i=f.now();if(t){if(this.lastTime){var n=i-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*a/n,l=this.hls;if(l.trigger(d.default.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),0<s&&a>l.config.fpsDroppedMonitoringThreshold*o){var u=l.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),0<u&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(d.default.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,l.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},l.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},l);function l(e){return a.call(this,e,d.default.MEDIA_ATTACHING)||this}t.default=s},"./src/controller/fragment-finders.js":function(e,t,r){"use strict";(function(a){Object.defineProperty(t,"__esModule",{value:!0});var o=r("./src/utils/binary-search.js");function s(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0);var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function l(e,t,r){var i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.endProgramDateTime-i>e}t.findFragmentByPDT=function(e,t,r){if(!Array.isArray(e)||!e.length||!a.isFinite(t))return null;if(t<e[0].programDateTime)return null;if(t>=e[e.length-1].endProgramDateTime)return null;r=r||0;for(var i=0;i<e.length;++i){var n=e[i];if(l(t,r,n))return n}return null},t.findFragmentByPTS=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=e?t[e.sn-t[0].sn+1]:null;return n&&!s(r,i,n)?n:o.default.search(t,s.bind(null,r,i))},t.fragmentWithinToleranceTest=s,t.pdtWithinToleranceTest=l}).call(this,r("./src/polyfills/number.js").Number)},"./src/controller/fragment-tracker.js":function(e,l,u){"use strict";(function(r){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(l,"__esModule",{value:!0});var t=u("./src/event-handler.js"),n=u("./src/events.js");l.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var a,o=(a=t.default,e(s,a),s.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,t.default.prototype.destroy.call(this),a.prototype.destroy.call(this)},s.prototype.getBufferedFrag=function(i,n){var a=this.fragments,e=Object.keys(a).filter(function(e){var t=a[e];if(t.body.type!==n)return!1;if(!t.buffered)return!1;var r=t.body;return r.startPTS<=i&&i<=r.endPTS});if(0===e.length)return null;var t=e.pop();return a[t].body},s.prototype.detectEvictedFragments=function(n,a){var o,s,l=this;Object.keys(this.fragments).forEach(function(e){var t=l.fragments[e];if(!0===t.buffered){var r=t.range[n];if(r){o=r.time;for(var i=0;i<o.length;i++)if(s=o[i],!1===l.isTimeBuffered(s.startPTS,s.endPTS,a)){l.removeFragment(t.body);break}}}})},s.prototype.detectPartialFragments=function(r){var i=this,e=this.getFragmentKey(r),n=this.fragments[e];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach(function(e){if(r.hasElementaryStream(e)){var t=i.timeRanges[e];n.range[e]=i.getBufferedTimes(r.startPTS,r.endPTS,t)}}))},s.prototype.getBufferedTimes=function(e,t,r){for(var i,n,a=[],o=!1,s=0;s<r.length;s++){if(i=r.start(s)-this.bufferPadding,n=r.end(s)+this.bufferPadding,i<=e&&t<=n){a.push({startPTS:Math.max(e,r.start(s)),endPTS:Math.min(t,r.end(s))});break}if(e<n&&i<t)a.push({startPTS:Math.max(e,r.start(s)),endPTS:Math.min(t,r.end(s))}),o=!0;else if(t<=i)break}return{time:a,partial:o}},s.prototype.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},s.prototype.getPartialFragment=function(r){var i,n,a,o=this,s=null,l=0;return Object.keys(this.fragments).forEach(function(e){var t=o.fragments[e];o.isPartial(t)&&(n=t.body.startPTS-o.bufferPadding,a=t.body.endPTS+o.bufferPadding,n<=r&&r<=a&&(i=Math.min(r-n,a-r),l<=i&&(s=t.body,l=i)))}),s},s.prototype.getState=function(e){var t=this.getFragmentKey(e),r=this.fragments[t],i=l.FragmentState.NOT_LOADED;return void 0!==r&&(i=r.buffered?!0===this.isPartial(r)?l.FragmentState.PARTIAL:l.FragmentState.OK:l.FragmentState.APPENDING),i},s.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},s.prototype.isTimeBuffered=function(e,t,r){for(var i,n,a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,n=r.end(a)+this.bufferPadding,i<=e&&t<=n)return!0;if(t<=i)return!1}return!1},s.prototype.onFragLoaded=function(e){var t=e.frag;r.isFinite(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},s.prototype.onBufferAppended=function(e){var r=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var t=r.timeRanges[e];r.detectEvictedFragments(e,t)})},s.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},s.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},s.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},s.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},s);function s(e){var t=a.call(this,e,n.default.BUFFER_APPENDED,n.default.FRAG_BUFFERED,n.default.FRAG_LOADED)||this;return t.bufferPadding=.2,t.fragments=Object.create(null),t.timeRanges=Object.create(null),t.config=e.config,t}l.FragmentTracker=o}).call(this,u("./src/polyfills/number.js").Number)},"./src/controller/gap-controller.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=r("./src/utils/buffer-helper.js"),s=r("./src/errors.js"),u=r("./src/events.js"),d=r("./src/utils/logger.js"),i=(n.prototype.poll=function(e,t){var r=this.config,i=this.media,n=i.currentTime,a=window.performance.now();if(n!==e)return this.stallReported&&(d.logger.warn("playback not stuck anymore @"+n+", after "+Math.round(a-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(i.ended||!i.buffered.length||2<i.readyState||i.seeking&&l.BufferHelper.isBuffered(i,n))){var o=a-this.stalled,s=l.BufferHelper.bufferInfo(i,n,r.maxBufferHole);this.stalled?(1e3<=o&&this._reportStall(s.len),this._tryFixBufferStall(s,o)):this.stalled=a}},n.prototype._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,n=this.media.currentTime,a=i.getPartialFragment(n);a&&this._trySkipBufferHole(a),.5<e.len&&t>1e3*r.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},n.prototype._reportStall=function(e){var t=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,d.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer"),t.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},n.prototype._trySkipBufferHole=function(e){for(var t=this.hls,r=this.media,i=r.currentTime,n=0,a=0;a<r.buffered.length;a++){var o=r.buffered.start(a);if(n<=i&&i<o)return r.currentTime=Math.max(o,r.currentTime+.1),d.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+r.currentTime),this.stalled=null,void t.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+r.currentTime,frag:e});n=r.buffered.end(a)}},n.prototype._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=r.currentTime,n=(this.nudgeRetry||0)+1;if((this.nudgeRetry=n)<e.nudgeMaxRetry){var a=i+n*e.nudgeOffset;d.logger.log("adjust currentTime from "+i+" to "+a),r.currentTime=a,t.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else d.logger.error("still stuck in high buffer @"+i+" after "+e.nudgeMaxRetry+", raise fatal error"),t.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},n);function n(e,t,r,i){this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i,this.stallReported=!1}t.default=i},"./src/controller/id3-track-controller.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r("./src/events.js"),s=r("./src/event-handler.js"),c=r("./src/demux/id3.js"),l=r("./src/utils/texttrack-utils.js"),u=(a=s.default,n(d,a),d.prototype.destroy=function(){s.default.prototype.destroy.call(this)},d.prototype.onMediaAttached=function(e){this.media=e.media,this.media},d.prototype.onMediaDetaching=function(){l.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},d.prototype.getID3Track=function(e){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return l.sendAddTrackEvent(r,this.media),r}return this.media.addTextTrack("metadata","id3")},d.prototype.onFragParsingMetadata=function(e){var t=e.frag,r=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<r.length;n++){var a=c.default.getID3Frames(r[n].data);if(a){var o=r[n].pts,s=n<r.length-1?r[n+1].pts:t.endPTS;o===s&&(s+=1e-4);for(var l=0;l<a.length;l++){var u=a[l];if(!c.default.isTimeStampFrame(u)){var d=new i(o,s,"");d.value=u,this.id3Track.addCue(d)}}}}},d);function d(e){var t=a.call(this,e,o.default.MEDIA_ATTACHED,o.default.MEDIA_DETACHING,o.default.FRAG_PARSING_METADATA)||this;return t.id3Track=void 0,t.media=void 0,t}t.default=u},"./src/controller/level-controller.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var u,a,d=r("./src/events.js"),o=r("./src/event-handler.js"),c=r("./src/utils/logger.js"),f=r("./src/errors.js"),h=r("./src/utils/codecs.js"),p=r("./src/controller/level-helper.js"),s=(window.performance,a=o.default,n(l,a),l.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},l.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},l.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},l.prototype.stopLoad=function(){this.canload=!1},l.prototype.onManifestLoaded=function(e){var t,r=[],i=[],n={},a=null,o=!1,s=!1;if(e.levels.forEach(function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,o=o||!!e.videoCodec,s=s||!!e.audioCodec,u&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(a=n[e.bitrate])?a.url.push(e.url):(e.url=[e.url],e.urlId=0,n[e.bitrate]=e,r.push(e)),t&&(t.AUDIO&&(s=!0,p.addGroupId(a||e,"audio",t.AUDIO)),t.SUBTITLES&&p.addGroupId(a||e,"text",t.SUBTITLES))}),o&&s&&(r=r.filter(function(e){return!!e.videoCodec})),r=r.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||h.isCodecSupportedInMp4(t,"audio"))&&(!r||h.isCodecSupportedInMp4(r,"video"))}),e.audioTracks&&(i=e.audioTracks.filter(function(e){return!e.audioCodec||h.isCodecSupportedInMp4(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),0<r.length){t=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r;for(var l=0;l<r.length;l++)if(r[l].bitrate===t){this._firstLevel=l,c.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(d.default.MANIFEST_PARSED,{levels:r,audioTracks:i,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:o,altAudio:i.some(function(e){return!!e.url})})}else this.hls.trigger(d.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(l.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))},enumerable:!0,configurable:!0}),l.prototype.setLevelInternal=function(e){var t=this._levels,r=this.hls;if(0<=e&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){c.logger.log("switching to level "+e);var i=t[this.currentLevelIndex=e];i.level=e,r.trigger(d.default.LEVEL_SWITCHING,i)}var n=t[e],a=n.details;if(!a||a.live){var o=n.urlId;r.trigger(d.default.LEVEL_LOADING,{url:n.url[o],level:e,id:o})}}else r.trigger(d.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(l.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(e){this._firstLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"startLevel",{get:function(){if(void 0!==this._startLevel)return this._startLevel;var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel},set:function(e){this._startLevel=e},enumerable:!0,configurable:!0}),l.prototype.onError=function(e){if(e.fatal)e.type===f.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,r=!1,i=!1;switch(e.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,i=!0;break;case f.ErrorDetails.LEVEL_LOAD_ERROR:case f.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,r=!0;break;case f.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,r=!0}void 0!==t&&this.recoverLevel(e,t,r,i)}},l.prototype.recoverLevel=function(e,t,r,i){var n,a,o,s=this,l=this.hls.config,u=e.details,d=this._levels[t];if(d.loadError++,d.fragmentError=i,r){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return c.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);a=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return s.loadLevel()},a),e.levelRetry=!0,this.levelRetryCount++,c.logger.warn("level controller, "+u+", retry in "+a+" ms, current retry count is "+this.levelRetryCount)}(r||i)&&(1<(n=d.url.length)&&d.loadError<n?(d.urlId=(d.urlId+1)%n,d.details=void 0,c.logger.warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+d.urlId)):-1===this.manualLevelIndex?(o=0===t?this._levels.length-1:t-1,c.logger.warn("level controller, "+u+": switch to "+o),this.hls.nextAutoLevel=this.currentLevelIndex=o):i&&(c.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},l.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var r=this._levels[t.level];void 0!==r&&(r.fragmentError=!1,r.loadError=0,this.levelRetryCount=0)}},l.prototype.onLevelLoaded=function(e){var t=this,r=e.level,i=e.details;if(r===this.currentLevelIndex){var n=this._levels[r];if(n.fragmentError||(n.loadError=0,this.levelRetryCount=0),i.live){var a=p.computeReloadInterval(n.details,i,e.stats.trequest);c.logger.log("live playlist, reload in "+Math.round(a)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},a)}else this.clearTimer()}},l.prototype.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var i=-1,n=0;n<r.audioGroupIds.length;n++)if(r.audioGroupIds[n]===t){i=n;break}i!==r.urlId&&(r.urlId=i,this.startLoad())}},l.prototype.loadLevel=function(){if(c.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&0<e.url.length){var t=this.currentLevelIndex,r=e.urlId,i=e.url[r];c.logger.log("Attempt loading level index "+t+" with URL-id "+r),this.hls.trigger(d.default.LEVEL_LOADING,{url:i,level:t,id:r})}}},Object.defineProperty(l.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)},enumerable:!0,configurable:!0}),l);function l(e){var t=a.call(this,e,d.default.MANIFEST_LOADED,d.default.LEVEL_LOADED,d.default.AUDIO_TRACK_SWITCHED,d.default.FRAG_LOADED,d.default.ERROR)||this;return t.canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,u=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t}t.default=s},"./src/controller/level-helper.js":function(e,t,r){"use strict";(function(h){Object.defineProperty(t,"__esModule",{value:!0});var o=r("./src/utils/logger.js");function p(e,t,r){var i=e[t],n=e[r],a=n.startPTS;h.isFinite(a)?t<r?(i.duration=a-i.start,i.duration<0&&o.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(n.duration=i.start-a,n.duration<0&&o.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):n.start=t<r?i.start+i.duration:Math.max(i.start-n.duration,0)}function s(e,t,r,i,n,a){var o=r;if(h.isFinite(t.startPTS)){var s=Math.abs(t.startPTS-r);h.isFinite(t.deltaPTS)?t.deltaPTS=Math.max(s,t.deltaPTS):t.deltaPTS=s,o=Math.max(r,t.startPTS),r=Math.min(r,t.startPTS),i=Math.max(i,t.endPTS),n=Math.min(n,t.startDTS),a=Math.max(a,t.endDTS)}var l=r-t.start;t.start=t.startPTS=r,t.maxStartPTS=o,t.endPTS=i,t.startDTS=n,t.endDTS=a,t.duration=i-r;var u,d,c,f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;for(u=f-e.startSN,(d=e.fragments)[u]=t,c=u;0<c;c--)p(d,c,c-1);for(c=u;c<d.length-1;c++)p(d,c,c+1);return e.PTSKnown=!0,l}function l(e,t,r){if(e&&t)for(var i=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,o=i;o<=n;o++){var s=e.fragments[a+o],l=t.fragments[o];if(!s||!l)break;r(s,l,o)}}function u(e,t){var r=t.startSN-e.startSN,i=e.fragments,n=t.fragments;if(!(r<0||r>i.length))for(var a=0;a<n.length;a++)n[a].start+=i[r].start}t.addGroupId=function(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}},t.updatePTS=p,t.updateFragPTSDTS=s,t.mergeDetails=function(e,r){r.initSegment&&e.initSegment&&(r.initSegment=e.initSegment);var i,n=0;if(l(e,r,function(e,t){n=e.cc-t.cc,h.isFinite(e.startPTS)&&(t.start=t.startPTS=e.startPTS,t.endPTS=e.endPTS,t.duration=e.duration,t.backtracked=e.backtracked,t.dropped=e.dropped,i=t),r.PTSKnown=!0}),r.PTSKnown){if(n){o.logger.log("discontinuity sliding from playlist, take drift into account");for(var t=r.fragments,a=0;a<t.length;a++)t[a].cc+=n}i?s(r,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):u(e,r),r.PTSKnown=e.PTSKnown}},t.mergeSubtitlePlaylists=function(e,t,r){void 0===r&&(r=0);var i=-1;l(e,t,function(e,t,r){t.start=e.start,i=r});var n=t.fragments;if(i<0)n.forEach(function(e){e.start+=r});else for(var a=i+1;a<n.length;a++)n[a].start=n[a-1].start+n[a-1].duration},t.mapFragmentIntersection=l,t.adjustSliding=u,t.computeReloadInterval=function(e,t,r){var i=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),n=i/2;return e&&t.endSN===e.endSN&&(i=n),r&&(i=Math.max(n,i-(window.performance.now()-r))),Math.round(i)}}).call(this,r("./src/polyfills/number.js").Number)},"./src/controller/stream-controller.js":function(e,E,S){"use strict";(function(u){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(E,"__esModule",{value:!0});var n,p=S("./src/utils/binary-search.js"),f=S("./src/utils/buffer-helper.js"),h=S("./src/demux/demuxer.js"),g=S("./src/events.js"),r=S("./src/controller/fragment-tracker.js"),d=S("./src/loader/fragment.js"),t=S("./src/loader/playlist-loader.js"),c=S("./src/controller/level-helper.js"),a=S("./src/utils/time-ranges.js"),o=S("./src/errors.js"),m=S("./src/utils/logger.js"),v=S("./src/utils/discontinuities.js"),_=S("./src/controller/fragment-finders.js"),s=S("./src/controller/gap-controller.js"),y=S("./src/controller/base-stream-controller.js"),l=(n=y.default,e(b,n),b.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(i=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}0<t&&-1===e&&(m.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=y.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=y.State.STOPPED},b.prototype.stopLoad=function(){this.forceStartLoad=!1,n.prototype.stopLoad.call(this)},b.prototype.doTick=function(){switch(this.state){case y.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case y.State.IDLE:this._doTickIdle();break;case y.State.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=y.State.IDLE);break;case y.State.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),r=this.retryDate;(!r||r<=t||this.media&&this.media.seeking)&&(m.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.State.IDLE);break;case y.State.ERROR:case y.State.STOPPED:case y.State.FRAG_LOADING:case y.State.PARSING:case y.State.PARSED:case y.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},b.prototype._doTickIdle=function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&t.startFragPrefetch)){var i;i=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var n=e.nextLoadLevel,a=this.levels[n];if(a){var o,s=a.bitrate;o=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,o=Math.min(o,t.maxMaxBufferLength);var l=f.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,t.maxBufferHole),u=l.len;if(!(o<=u)){m.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=n;var d=a.details;if(!d||d.live&&this.levelLastLoaded!==n)this.state=y.State.WAITING_LEVEL;else{if(this._streamEnded(l,d)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(g.default.BUFFER_EOS,c),void(this.state=y.State.ENDED)}this._fetchPayloadOrEos(i,l,d)}}}}},b.prototype._fetchPayloadOrEos=function(e,t,r){var i=this.fragPrevious,n=this.level,a=r.fragments,o=a.length;if(0!==o){var s,l=a[0].start,u=a[o-1].start+a[o-1].duration,d=t.end;if(r.initSegment&&!r.initSegment.data)s=r.initSegment;else if(r.live){var c=this.config.initialLiveManifestSize;if(o<c)return void m.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+c);if(null===(s=this._ensureFragmentAtLivePoint(r,d,l,u,i,a,o)))return}else d<l&&(s=a[0]);(s=s||this._findFragment(l,i,o,a,d,u,r))&&(s.encrypted?(m.logger.log("Loading key for "+s.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+n),this._loadKey(s)):(m.logger.log("Loading "+s.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+n+", currentTime:"+e.toFixed(3)+",bufferEnd:"+d.toFixed(3)),this._loadFragment(s)))}},b.prototype._ensureFragmentAtLivePoint=function(e,t,r,i,n,a,o){var s,l=this.hls.config,u=this.media,d=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-l.maxFragLookUpTolerance,i-d)){var c=this.liveSyncPosition=this.computeLivePosition(r,e);m.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+c.toFixed(3)),t=c,u&&u.readyState&&u.duration>c&&(u.currentTime=c),this.nextLoadPosition=c}if(e.PTSKnown&&i<t&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(n)if(e.hasProgramDateTime)m.logger.log("live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),s=_.findFragmentByPDT(a,n.endProgramDateTime,l.maxFragLookUpTolerance);else{var f=n.sn+1;if(f>=e.startSN&&f<=e.endSN){var h=a[f-e.startSN];n.cc===h.cc&&(s=h,m.logger.log("live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=p.default.search(a,function(e){return n.cc-e.cc}))&&m.logger.log("live playlist, switching playlist, load frag with same CC: "+s.sn)}s||(s=a[Math.min(o-1,Math.round(o/2))],m.logger.log("live playlist, switching playlist, unknown, load middle frag : "+s.sn))}return s},b.prototype._findFragment=function(e,t,r,i,n,a,o){var s,l=this.hls.config;if(n<a){var u=n>a-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance;s=_.findFragmentByPTS(t,i,n,u)}else s=i[r-1];if(s){var d=s.sn-o.startSN,c=t&&s.level===t.level,f=i[d-1],h=i[1+d];if(t&&s.sn===t.sn)if(c&&!s.backtracked)if(s.sn<o.endSN){var p=t.deltaPTS;p&&p>l.maxBufferHole&&t.dropped&&d?(s=f,m.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(s=h,m.logger.log("SN just loaded, load next one: "+s.sn,s))}else s=null;else s.backtracked&&(h&&h.backtracked?(m.logger.warn("Already backtracked from fragment "+h.sn+", will not backtrack to fragment "+s.sn+". Loading fragment "+h.sn),s=h):(m.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),s.dropped=0,f?(s=f).backtracked=!0:d&&(s=null)))}return s},b.prototype._loadKey=function(e){this.state=y.State.KEY_LOADING,this.hls.trigger(g.default.KEY_LOADING,{frag:e})},b.prototype._loadFragment=function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,u.isFinite(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===r.FragmentState.NOT_LOADED||t===r.FragmentState.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(g.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new h.default(this.hls,"main")),this.state=y.State.FRAG_LOADING):t===r.FragmentState.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},Object.defineProperty(b.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e,m.logger.log("main stream:"+t+"->"+e),this.hls.trigger(g.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},enumerable:!0,configurable:!0}),b.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,t.default.LevelType.MAIN)},Object.defineProperty(b.prototype,"currentLevel",{get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextBufferedFrag",{get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null},enumerable:!0,configurable:!0}),b.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},Object.defineProperty(b.prototype,"nextLevel",{get:function(){var e=this.nextBufferedFrag;return e?e.level:-1},enumerable:!0,configurable:!0}),b.prototype._checkFragmentChanged=function(){var e,t,r=this.media;if(r&&r.readyState&&!1===r.seeking&&((t=r.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),f.BufferHelper.isBuffered(r,t)?e=this.getBufferedFrag(t):f.BufferHelper.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var i=e;if(i!==this.fragPlaying){this.hls.trigger(g.default.FRAG_CHANGED,{frag:i});var n=i.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(g.default.LEVEL_SWITCHED,{level:n}),this.fragPlaying=i}}},b.prototype.immediateLevelSwitch=function(){if(m.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,u.POSITIVE_INFINITY)},b.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.BufferHelper.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},b.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,r=void 0,i=void 0;if((t=this.getBufferedFrag(e.currentTime))&&1<t.startPTS&&this.flushMainBuffer(0,t.startPTS-1),e.paused)r=0;else{var n=this.hls.nextLoadLevel,a=this.levels[n],o=this.fragLastKbps;r=o&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*o)+1:0}if(i=(i=this.getBufferedFrag(e.currentTime+r))&&this.followingBufferedFrag(i)){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.maxStartPTS,u.POSITIVE_INFINITY)}}},b.prototype.flushMainBuffer=function(e,t){this.state=y.State.BUFFER_FLUSHING;var r={startOffset:e,endOffset:t};this.altAudio&&(r.type="video"),this.hls.trigger(g.default.BUFFER_FLUSHING,r)},b.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition),this.gapController=new s.default(r,t,this.fragmentTracker,this.hls)},b.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(m.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},b.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;u.isFinite(t)&&m.logger.log("media seeked to "+t.toFixed(3)),this.tick()},b.prototype.onManifestLoading=function(){m.logger.log("trigger BUFFER_RESET"),this.hls.trigger(g.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},b.prototype.onManifestParsed=function(e){var t,r=!1,i=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(r=!0),-1!==t.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&m.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},b.prototype.onLevelLoaded=function(e){var t=e.details,r=e.level,i=this.levels[this.levelLastLoaded],n=this.levels[r],a=t.totalduration,o=0;if(m.logger.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live){var s=n.details;s&&0<t.fragments.length?(c.mergeDetails(s,t),o=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,s),t.PTSKnown&&u.isFinite(o)?m.logger.log("live playlist sliding:"+o.toFixed(3)):(m.logger.log("live playlist - outdated PTS, unknown sliding"),v.alignStream(this.fragPrevious,i,t))):(m.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,v.alignStream(this.fragPrevious,i,t))}else t.PTSKnown=!1;if(n.details=t,this.levelLastLoaded=r,this.hls.trigger(g.default.LEVEL_UPDATED,{details:t,level:r}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var l=t.startTimeOffset;u.isFinite(l)?(l<0&&(m.logger.log("negative start time offset "+l+", count from end of last fragment"),l=o+a+l),m.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l):t.live?(this.startPosition=this.computeLivePosition(o,t),m.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===y.State.WAITING_LEVEL&&(this.state=y.State.IDLE),this.tick()},b.prototype.onKeyLoaded=function(){this.state===y.State.KEY_LOADING&&(this.state=y.State.IDLE,this.tick())},b.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=this.hls,i=this.levels,n=this.media,a=e.frag;if(this.state===y.State.FRAG_LOADING&&t&&"main"===a.type&&a.level===t.level&&a.sn===t.sn){var o=e.stats,s=i[t.level],l=s.details;if(this.bitrateTest=!1,this.stats=o,m.logger.log("Loaded "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level),a.bitrateTest&&r.nextLoadLevel)this.state=y.State.IDLE,this.startFragRequested=!1,o.tparsed=o.tbuffered=window.performance.now(),r.trigger(g.default.FRAG_BUFFERED,{stats:o,frag:t,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=y.State.IDLE,o.tparsed=o.tbuffered=window.performance.now(),l.initSegment.data=e.payload,r.trigger(g.default.FRAG_BUFFERED,{stats:o,frag:t,id:"main"}),this.tick();else{m.logger.log("Parsing "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level+", cc "+t.cc),this.state=y.State.PARSING,this.pendingBuffering=!0,this.appended=!1,a.bitrateTest&&(a.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:a}));var u=!(n&&n.seeking)&&(l.PTSKnown||!l.live),d=l.initSegment?l.initSegment.data:[],c=this._getAudioCodec(s);(this.demuxer=this.demuxer||new h.default(this.hls,"main")).push(e.payload,d,c,s.videoCodec,t,l.totalduration,u)}}this.fragLoadError=0},b.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===y.State.PARSING){var i=e.tracks,n=void 0,a=void 0;if(i.audio&&this.altAudio&&delete i.audio,a=i.audio){var o=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(m.logger.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===s.indexOf("firefox")&&(o="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==a.container&&(o="mp4a.40.2",m.logger.log("Android: force audio codec to "+o)),a.levelCodec=o,a.id=e.id}for(n in(a=i.video)&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=e.id),this.hls.trigger(g.default.BUFFER_CODECS,i),i){a=i[n],m.logger.log("main track:"+n+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var l=a.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(g.default.BUFFER_APPENDING,{type:n,data:l,parent:"main",content:"initSegment"}))}this.tick()}},b.prototype.onFragParsingData=function(t){var r=this,e=this.fragCurrent,i=t.frag;if(e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&("audio"!==t.type||!this.altAudio)&&this.state===y.State.PARSING){var n=this.levels[this.level],a=e;if(u.isFinite(t.endPTS)||(t.endPTS=t.startPTS+e.duration,t.endDTS=t.startDTS+e.duration),!0===t.hasAudio&&a.addElementaryStream(d.default.ElementaryStreamTypes.AUDIO),!0===t.hasVideo&&a.addElementaryStream(d.default.ElementaryStreamTypes.VIDEO),m.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(a.dropped=t.dropped,a.dropped)if(a.backtracked)m.logger.warn("Already backtracked on this fragment, appending with the gap",a.sn);else{var o=n.details;if(!o||a.sn!==o.startSN)return m.logger.warn("missing video frame(s), backtracking fragment",a.sn),this.fragmentTracker.removeFragment(a),a.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=y.State.IDLE,this.fragPrevious=a,void this.tick();m.logger.warn("missing video frame(s) on first frag, appending with gap",a.sn)}else a.backtracked=!1;var s=c.updateFragPTSDTS(n.details,a,t.startPTS,t.endPTS,t.startDTS,t.endDTS),l=this.hls;l.trigger(g.default.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:s,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(e){e&&e.length&&r.state===y.State.PARSING&&(r.appended=!0,r.pendingBuffering=!0,l.trigger(g.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"}))}),this.tick()}},b.prototype.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===y.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=y.State.PARSED,this._checkAppendedParsed())},b.prototype.onAudioTrackSwitching=function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){m.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(m.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.State.IDLE}var n=this.hls;n.trigger(g.default.BUFFER_FLUSHING,{startOffset:0,endOffset:u.POSITIVE_INFINITY,type:"audio"}),n.trigger(g.default.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}},b.prototype.onAudioTrackSwitched=function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(m.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()},b.prototype.onBufferCreated=function(e){var t,r,i=e.tracks,n=!1;for(var a in i){var o=i[a];"main"===o.id?(t=o,"video"===(r=a)&&(this.videoBuffer=i[a].buffer)):n=!0}n&&t?(m.logger.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},b.prototype.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==y.State.PARSING&&t!==y.State.PARSED||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},b.prototype._checkAppendedParsed=function(){if(!(this.state!==y.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;m.logger.log("main buffered : "+a.default.toString(t.buffered)),this.fragPrevious=e;var r=this.stats;r.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*r.total/(r.tbuffered-r.tfirst)),this.hls.trigger(g.default.FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.state=y.State.IDLE}this.tick()}},b.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r=!!this.media&&f.BufferHelper.isBuffered(this.media,this.media.currentTime)&&f.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var i=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);m.logger.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=window.performance.now()+i,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=y.State.FRAG_LOADING_WAITING_RETRY}else m.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=y.State.ERROR;break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.State.ERROR&&(e.fatal?(this.state=y.State.ERROR,m.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==y.State.WAITING_LEVEL||(this.state=y.State.IDLE));break;case o.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==y.State.PARSING&&this.state!==y.State.PARSED||(r?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=y.State.IDLE):(m.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,u.POSITIVE_INFINITY)))}}},b.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,m.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},b.prototype._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},b.prototype.onFragLoadEmergencyAborted=function(){this.state=y.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},b.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(d.default.ElementaryStreamTypes.VIDEO,e.buffered),this.state=y.State.IDLE,this.fragPrevious=null},b.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},b.prototype.computeLivePosition=function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)},b.prototype._seekToStartPos=function(){var e=this.media,t=e.currentTime,r=e.seeking?t:this.startPosition;t!==r&&(m.logger.log("target start position not buffered, seek to buffered.start(0) "+r+" from current time "+t+" "),e.currentTime=r)},b.prototype._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(m.logger.log("swapping playlist audio codec"),t=t&&(-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},Object.defineProperty(b.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e},enumerable:!0,configurable:!0}),b);function b(e,t){var r=n.call(this,e,g.default.MEDIA_ATTACHED,g.default.MEDIA_DETACHING,g.default.MANIFEST_LOADING,g.default.MANIFEST_PARSED,g.default.LEVEL_LOADED,g.default.KEY_LOADED,g.default.FRAG_LOADED,g.default.FRAG_LOAD_EMERGENCY_ABORTED,g.default.FRAG_PARSING_INIT_SEGMENT,g.default.FRAG_PARSING_DATA,g.default.FRAG_PARSED,g.default.ERROR,g.default.AUDIO_TRACK_SWITCHING,g.default.AUDIO_TRACK_SWITCHED,g.default.BUFFER_CREATED,g.default.BUFFER_APPENDED,g.default.BUFFER_FLUSHED)||this;return r.fragmentTracker=t,r.config=e.config,r.audioCodecSwap=!1,r._state=y.State.STOPPED,r.stallReported=!1,r.gapController=null,r}E.default=l}).call(this,S("./src/polyfills/number.js").Number)},"./src/controller/subtitle-stream-controller.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,v=r("./src/events.js"),_=r("./src/utils/logger.js"),o=r("./src/crypt/decrypter.js"),y=r("./src/utils/buffer-helper.js"),b=r("./src/controller/fragment-finders.js"),E=r("./src/controller/fragment-tracker.js"),S=r("./src/controller/base-stream-controller.js"),s=r("./src/controller/level-helper.js"),l=window.performance,u=(a=S.default,n(d,a),d.prototype.onSubtitleFragProcessed=function(e){var t=e.frag,r=e.success;if(this.fragPrevious=t,this.state=S.State.IDLE,r){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var n,a=t.start,o=0;o<i.length;o++)if(a>=i[o].start&&a<=i[o].end){n=i[o];break}var s=t.start+t.duration;n?n.end=s:(n={start:a,end:s},i.push(n))}}},d.prototype.onMediaAttached=function(e){var t=e.media;(this.media=t).addEventListener("seeking",this._onMediaSeeking),this.state=S.State.IDLE},d.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=S.State.STOPPED},d.prototype.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=S.State.IDLE)},d.prototype.onSubtitleTracksUpdated=function(e){var t=this;_.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})},d.prototype.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},d.prototype.onSubtitleTrackLoaded=function(e){var t=e.id,r=e.details,i=this.currentTrackId,n=this.tracks,a=n[i];t>=n.length||t!==i||!a||(r.live&&s.mergeSubtitlePlaylists(a.details,r,this.lastAVStart),a.details=r,this.setInterval(500))},d.prototype.onKeyLoaded=function(){this.state===S.State.KEY_LOADING&&(this.state=S.State.IDLE)},d.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag.decryptdata,i=e.frag,n=this.hls;if(this.state===S.State.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&0<e.payload.byteLength&&r&&r.key&&"AES-128"===r.method){var a=l.now();this.decrypter.decrypt(e.payload,r.key.buffer,r.iv.buffer,function(e){var t=l.now();n.trigger(v.default.FRAG_DECRYPTED,{frag:i,payload:e,stats:{tstart:a,tdecrypt:t}})})}},d.prototype.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},d.prototype.doTick=function(){if(this.media)switch(this.state){case S.State.IDLE:var e=this.config,t=this.currentTrackId,r=this.fragmentTracker,i=this.media,n=this.tracks;if(!n||!n[t]||!n[t].details)break;var a=e.maxBufferHole,o=e.maxFragLookUpTolerance,s=Math.min(e.maxBufferLength,e.maxMaxBufferLength),l=y.BufferHelper.bufferedInfo(this._getBuffered(),i.currentTime,a),u=l.end,d=l.len,c=n[t].details,f=c.fragments,h=f.length,p=f[h-1].start+f[h-1].duration;if(s<d)return;var g=void 0,m=this.fragPrevious;(g=u<p?(m&&c.hasProgramDateTime&&(g=b.findFragmentByPDT(f,m.endProgramDateTime,o)),g||b.findFragmentByPTS(m,f,u,o)):f[h-1])&&g.encrypted?(_.logger.log("Loading key for "+g.sn),this.state=S.State.KEY_LOADING,this.hls.trigger(v.default.KEY_LOADING,{frag:g})):g&&r.getState(g)===E.FragmentState.NOT_LOADED&&(this.fragCurrent=g,this.state=S.State.FRAG_LOADING,this.hls.trigger(v.default.FRAG_LOADING,{frag:g}))}else this.state=S.State.IDLE},d.prototype.stopLoad=function(){this.lastAVStart=0,a.prototype.stopLoad.call(this)},d.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},d.prototype.onMediaSeeking=function(){this.fragPrevious=null},d);function d(e,t){var r=a.call(this,e,v.default.MEDIA_ATTACHED,v.default.MEDIA_DETACHING,v.default.ERROR,v.default.KEY_LOADED,v.default.FRAG_LOADED,v.default.SUBTITLE_TRACKS_UPDATED,v.default.SUBTITLE_TRACK_SWITCH,v.default.SUBTITLE_TRACK_LOADED,v.default.SUBTITLE_FRAG_PROCESSED,v.default.LEVEL_UPDATED)||this;return r.fragmentTracker=t,r.config=e.config,r.state=S.State.STOPPED,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new o.default(e,e.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(r),r}t.SubtitleStreamController=u},"./src/controller/subtitle-track-controller.js":function(e,c,f){"use strict";(function(i){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(c,"__esModule",{value:!0});var r,a=f("./src/events.js"),t=f("./src/event-handler.js"),l=f("./src/utils/logger.js"),u=f("./src/controller/level-helper.js"),o=(r=t.default,e(s,r),s.prototype.destroy=function(){t.default.prototype.destroy.call(this)},s.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},s.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},s.prototype.onManifestLoaded=function(e){var t=this,r=e.subtitles||[];this.tracks=r,this.hls.trigger(a.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:r}),r.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},s.prototype.onSubtitleTrackLoaded=function(e){var t=this,r=e.id,i=e.details,n=this.trackId,a=this.tracks,o=a[n];if(r>=a.length||r!==n||!o||this.stopped)this._clearReloadTimer();else if(l.logger.log("subtitle track "+r+" loaded"),i.live){var s=u.computeReloadInterval(o.details,i,e.stats.trequest);l.logger.log("Reloading live subtitle playlist in "+s+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},s)}else this._clearReloadTimer()},s.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},s.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(s.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))},enumerable:!0,configurable:!0}),s.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},s.prototype._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,r=this.hls,i=t[e];e<0||!i||i.details&&!i.details.live||(l.logger.log("Loading subtitle track "+e),r.trigger(a.default.SUBTITLE_TRACK_LOADING,{url:i.url,id:e}))},s.prototype._toggleTrackModes=function(e){var t=this.media,r=this.subtitleDisplay,i=this.trackId;if(t){var n=d(t.textTracks);if(-1===e)[].slice.call(n).forEach(function(e){e.mode="disabled"});else{var a=n[i];a&&(a.mode="disabled")}var o=n[e];o&&(o.mode=r?"showing":"hidden")}},s.prototype._setSubtitleTrackInternal=function(e){var t=this.hls,r=this.tracks;!i.isFinite(e)||e<-1||e>=r.length||(this.trackId=e,l.logger.log("Switching to subtitle track "+e),t.trigger(a.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},s.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=d(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack=e}},s);function s(e){var t=r.call(this,e,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.MANIFEST_LOADED,a.default.SUBTITLE_TRACK_LOADED)||this;return t.tracks=[],t.trackId=-1,t.media=null,t.stopped=!0,t.subtitleDisplay=!0,t}function d(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];"subtitles"===i.kind&&i.label&&t.push(e[r])}return t}c.default=o}).call(this,f("./src/polyfills/number.js").Number)},"./src/controller/timeline-controller.js":function(e,h,p){"use strict";(function(o){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(h,"__esModule",{value:!0});var s=p("./src/events.js"),t=p("./src/event-handler.js"),n=p("./src/utils/cea-608-parser.js"),a=p("./src/utils/output-filter.js"),l=p("./src/utils/webvtt-parser.js"),u=p("./src/utils/logger.js"),d=p("./src/utils/texttrack-utils.js");var c,r=(c=t.default,e(f,c),f.prototype.addCues=function(e,t,r,i){for(var n,a,o,s,l=this.cueRanges,u=!1,d=l.length;d--;){var c=l[d],f=(n=c[0],a=c[1],o=t,s=r,Math.min(a,s)-Math.max(n,o));if(0<=f&&(c[0]=Math.min(c[0],t),c[1]=Math.max(c[1],r),u=!0,.5<f/(r-t)))return}u||l.push([t,r]),this.Cues.newCue(this.captionsTracks[e],t,r,i)},f.prototype.onInitPtsFound=function(e){var t=this;if("main"===e.id&&(this.initPTS[e.frag.cc]=e.initPTS),this.unparsedVttFrags.length){var r=this.unparsedVttFrags;this.unparsedVttFrags=[],r.forEach(function(e){t.onFragLoaded(e)})}},f.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e])return i}return null},f.prototype.createCaptionsTrack=function(e){var t=this.captionsProperties[e],r=t.label,i=t.languageCode,n=this.captionsTracks;if(!n[e]){var a=this.getExistingTrack(e);if(a)n[e]=a,d.clearCurrentCues(n[e]),d.sendAddTrackEvent(n[e],this.media);else{var o=this.createTextTrack("captions",r,i);o&&(o[e]=!0,n[e]=o)}}},f.prototype.createTextTrack=function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)},f.prototype.destroy=function(){t.default.prototype.destroy.call(this)},f.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},f.prototype.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){d.clearCurrentCues(t[e]),delete t[e]})},f.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},f.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)d.clearCurrentCues(t[r])}},f.prototype.onManifestLoaded=function(e){var s=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,t){var r,i,n;if(t<l.length){for(var a=null,o=0;o<l.length;o++)if(i=l[o],n=e,i&&i.label===n.name&&!i.textTrack1&&!i.textTrack2){a=l[o];break}a&&(r=a)}r=r||s.createTextTrack("subtitles",e.name,e.lang),e.default?r.mode=s.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",s.textTracks.push(r)})}},f.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},f.prototype.onFragLoaded=function(e){var t=e.frag,r=e.payload;if("main"===t.type){var i=t.sn;if(i!==this.lastSn+1){var n=this.cea608Parser;n&&n.reset()}this.lastSn=i}else if("subtitle"===t.type)if(r.byteLength){if(!o.isFinite(this.initPTS[t.cc]))return this.unparsedVttFrags.push(e),void(this.initPTS.length&&this.hls.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var a=t.decryptdata;null!=a&&null!=a.key&&"AES-128"===a.method||this._parseVTTs(t,r)}else this.hls.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},f.prototype._parseVTTs=function(t,e){var r=this.vttCCs;r[t.cc]||(r[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var n=this.textTracks,a=this.hls;l.default.parse(e,this.initPTS[t.cc],r,t.cc,function(e){var i=n[t.level];"disabled"!==i.mode?(e.forEach(function(t){if(!i.cues.getCueById(t.id))try{i.addCue(t)}catch(e){var r=new window.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,i.addCue(r)}}),a.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})):a.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},function(e){u.logger.log("Failed to parse VTT cue: "+e),a.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},f.prototype.onFragDecrypted=function(e){var t=e.payload,r=e.frag;if("subtitle"===r.type){if(!o.isFinite(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(r,t)}},f.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var r=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,r)}},f.prototype.extractCea608Data=function(e){for(var t,r,i,n=31&e[0],a=2,o=[],s=0;s<n;s++)t=e[a++],r=127&e[a++],i=127&e[a++],0==r&&0==i||0!=(4&t)&&0==(3&t)&&(o.push(r),o.push(i));return o},f);function f(e){var t=c.call(this,e,s.default.MEDIA_ATTACHING,s.default.MEDIA_DETACHING,s.default.FRAG_PARSING_USERDATA,s.default.FRAG_DECRYPTED,s.default.MANIFEST_LOADING,s.default.MANIFEST_LOADED,s.default.FRAG_LOADED,s.default.LEVEL_SWITCHING,s.default.INIT_PTS_FOUND)||this;if(t.hls=e,t.config=e.config,t.enabled=!0,t.Cues=e.config.cueHandler,t.textTracks=[],t.tracks=[],t.unparsedVttFrags=[],t.initPTS=[],t.cueRanges=[],t.captionsTracks={},t.captionsProperties={textTrack1:{label:t.config.captionsTextTrack1Label,languageCode:t.config.captionsTextTrack1LanguageCode},textTrack2:{label:t.config.captionsTextTrack2Label,languageCode:t.config.captionsTextTrack2LanguageCode}},t.config.enableCEA708Captions){var r=new a.default(t,"textTrack1"),i=new a.default(t,"textTrack2");t.cea608Parser=new n.default(0,r,i)}return t}h.default=r}).call(this,p("./src/polyfills/number.js").Number)},"./src/crypt/aes-crypto.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},n);function n(e,t){this.subtle=e,this.aesIV=t}t.default=i},"./src/crypt/aes-decryptor.js":function(e,t,r){"use strict";function I(e){var t=e.byteLength,r=t&&new DataView(e).getUint8(t-1);return r?e.slice(0,t-r):e}Object.defineProperty(t,"__esModule",{value:!0}),t.removePadding=I;var i=(n.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},n.prototype.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],a=r[2],o=r[3],s=this.invSubMix,l=s[0],u=s[1],d=s[2],c=s[3],f=new Uint32Array(256),h=0,p=0,g=0;for(g=0;g<256;g++)f[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var m=p^p<<1^p<<2^p<<3^p<<4;m=m>>>8^255&m^99;var v=f[t[e[h]=m]=h],_=f[v],y=f[_],b=257*f[m]^16843008*m;i[h]=b<<24|b>>>8,n[h]=b<<16|b>>>16,a[h]=b<<8|b>>>24,o[h]=b,b=16843009*y^65537*_^257*v^16843008*h,l[m]=b<<24|b>>>8,u[m]=b<<16|b>>>16,d[m]=b<<8|b>>>24,c[m]=b,h?(h=v^f[f[f[y^v]]],p^=f[f[p]]):h=p=1}},n.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a,o,s,l,u=this.ksRows=4*(n+6+1),d=this.keySchedule=new Uint32Array(u),c=this.invKeySchedule=new Uint32Array(u),f=this.sBox,h=this.rcon,p=this.invSubMix,g=p[0],m=p[1],v=p[2],_=p[3];for(a=0;a<u;a++)a<n?s=d[a]=t[a]:(l=s,a%n==0?(l=f[(l=l<<8|l>>>24)>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[255&l],l^=h[a/n|0]<<24):6<n&&a%n==4&&(l=f[l>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[255&l]),d[a]=s=(d[a-n]^l)>>>0);for(o=0;o<u;o++)a=u-o,l=3&o?d[a]:d[a-4],c[o]=o<4||a<=4?l:g[f[l>>>24]]^m[f[l>>>16&255]]^v[f[l>>>8&255]]^_[f[255&l]],c[o]=c[o]>>>0}},n.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},n.prototype.decrypt=function(e,t,r,i){for(var n,a,o,s,l,u,d,c,f,h,p,g,m,v,_=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,E=this.invSubMix,S=E[0],w=E[1],T=E[2],k=E[3],A=this.uint8ArrayToUint32Array_(r),D=A[0],R=A[1],O=A[2],L=A[3],C=new Int32Array(e),P=new Int32Array(C.length),x=this.networkToHostOrderSwap;t<C.length;){for(f=x(C[t]),h=x(C[t+1]),p=x(C[t+2]),g=x(C[t+3]),l=f^y[0],u=g^y[1],d=p^y[2],c=h^y[3],m=4,v=1;v<_;v++)n=S[l>>>24]^w[u>>16&255]^T[d>>8&255]^k[255&c]^y[m],a=S[u>>>24]^w[d>>16&255]^T[c>>8&255]^k[255&l]^y[m+1],o=S[d>>>24]^w[c>>16&255]^T[l>>8&255]^k[255&u]^y[m+2],s=S[c>>>24]^w[l>>16&255]^T[u>>8&255]^k[255&d]^y[m+3],l=n,u=a,d=o,c=s,m+=4;n=b[l>>>24]<<24^b[u>>16&255]<<16^b[d>>8&255]<<8^b[255&c]^y[m],a=b[u>>>24]<<24^b[d>>16&255]<<16^b[c>>8&255]<<8^b[255&l]^y[m+1],o=b[d>>>24]<<24^b[c>>16&255]<<16^b[l>>8&255]<<8^b[255&u]^y[m+2],s=b[c>>>24]<<24^b[l>>16&255]<<16^b[u>>8&255]<<8^b[255&d]^y[m+3],m+=3,P[t]=x(n^D),P[t+1]=x(s^R),P[t+2]=x(o^O),P[t+3]=x(a^L),D=f,R=h,O=p,L=g,t+=4}return i?I(P.buffer):P.buffer},n.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},n);function n(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}t.default=i},"./src/crypt/decrypter.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("./src/crypt/aes-crypto.js"),l=r("./src/crypt/fast-aes-key.js"),u=r("./src/crypt/aes-decryptor.js"),a=r("./src/errors.js"),d=r("./src/utils/logger.js"),o=r("./src/events.js"),c=r("./src/utils/get-self-scope.js").getSelfScope(),i=(n.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},n.prototype.decrypt=function(t,r,i,n){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(d.logger.log("JS AES decrypt"),this.logEnabled=!1);var e=this.decryptor;e||(this.decryptor=e=new u.default),e.expandKey(r),n(e.decrypt(t,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(d.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var o=this.subtle;this.key!==r&&(this.key=r,this.fastAesKey=new l.default(o,r)),this.fastAesKey.expandKey().then(function(e){new s.default(o,i).decrypt(t,e).catch(function(e){a.onWebCryptoError(e,t,r,i,n)}).then(function(e){n(e)})}).catch(function(e){a.onWebCryptoError(e,t,r,i,n)})}},n.prototype.onWebCryptoError=function(e,t,r,i,n){this.config.enableSoftwareAES?(d.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,i,n)):(d.logger.error("decrypting error : "+e.message),this.observer.trigger(o.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},n.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},n);function n(e,t,r){var i=(void 0===r?{}:r).removePKCS7Padding,n=void 0===i||i;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=n)try{var a=c.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}t.default=i},"./src/crypt/fast-aes-key.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},n);function n(e,t){this.subtle=e,this.key=t}t.default=i},"./src/demux/aacdemuxer.js":function(e,r,i){"use strict";(function(p){Object.defineProperty(r,"__esModule",{value:!0});var g=i("./src/demux/adts.js"),m=i("./src/utils/logger.js"),v=i("./src/demux/id3.js"),e=(t.prototype.resetInitSegment=function(e,t,r,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:i,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(e){if(!e)return!1;for(var t=(v.default.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(g.probe(e,t))return m.logger.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(e,t,r,i){for(var n=this._audioTrack,a=v.default.getID3Data(e,0)||[],o=v.default.getTimeStamp(a),s=p.isFinite(o)?90*o:9e4*t,l=0,u=s,d=e.length,c=a.length,f=[{pts:u,dts:u,data:a}];c<d-1;)if(g.isHeader(e,c)&&c+5<d){g.initTrackConfig(n,this.observer,e,c,n.manifestCodec);var h=g.appendFrame(n,e,c,s,l);if(!h){m.logger.log("Unable to parse AAC frame");break}c+=h.length,u=h.sample.pts,l++}else v.default.isHeader(e,c)?(a=v.default.getID3Data(e,c),f.push({pts:u,dts:u,data:a}),c+=a.length):c++;this.remuxer.remux(n,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,r,i)},t.prototype.destroy=function(){},t);function t(e,t,r){this.observer=e,this.config=r,this.remuxer=t}r.default=e}).call(this,i("./src/polyfills/number.js").Number)},"./src/demux/adts.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=r("./src/utils/logger.js"),h=r("./src/errors.js"),p=r("./src/events.js");function o(e,t,r,i){var n,a,o,s,l,u=navigator.userAgent.toLowerCase(),d=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(n=1+((192&t[r+2])>>>6),a=(60&t[r+2])>>>2,!(c.length-1<a))return s=(1&t[r+2])<<2,s|=(192&t[r+3])>>>6,f.logger.log("manifest codec:"+i+",ADTS data:type:"+n+",sampleingIndex:"+a+"["+c[a]+"Hz],channelConfig:"+s),o=/firefox/i.test(u)?6<=a?(n=5,l=new Array(4),a-3):(n=2,l=new Array(2),a):-1!==u.indexOf("android")?(n=2,l=new Array(2),a):(n=5,l=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&6<=a?a-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(6<=a&&1==s||/vivaldi/i.test(u))||!i&&1==s)&&(n=2,l=new Array(2)),a)),l[0]=n<<3,l[0]|=(14&a)>>1,l[1]|=(1&a)<<7,l[1]|=s<<3,5===n&&(l[1]|=(14&o)>>1,l[2]=(1&o)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:c[a],channelCount:s,codec:"mp4a.40."+n,manifestCodec:d};e.trigger(p.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a})}function n(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function u(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function d(e){return 9216e4/e}function c(e,t,r,i,n){var a,o,s=e.length;if(a=l(e,t),o=u(e,t),0<(o-=a)&&t+a+o<=s)return{headerLength:a,frameLength:o,stamp:r+i*n}}t.getAudioConfig=o,t.isHeaderPattern=n,t.getHeaderLength=l,t.getFullFrameLength=u,t.isHeader=function(e,t){return!!(t+1<e.length&&n(e,t))},t.probe=function(e,t){if(t+1<e.length&&n(e,t)){var r=l(e,t);t+5<e.length&&(r=u(e,t));var i=t+r;if(i===e.length||i+1<e.length&&n(e,i))return!0}return!1},t.initTrackConfig=function(e,t,r,i,n){if(!e.samplerate){var a=o(t,r,i,n);e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,f.logger.log("parsed codec:"+e.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)}},t.getFrameDuration=d,t.parseFrameHeader=c,t.appendFrame=function(e,t,r,i,n){var a=c(t,r,i,n,d(e.samplerate));if(a){var o=a.stamp,s=a.headerLength,l=a.frameLength,u={unit:t.subarray(r+s,r+s+l),pts:o,dts:o};return e.samples.push(u),e.len+=l,{sample:u,length:l+s}}}},"./src/demux/demuxer-inline.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g,w=r("./src/events.js"),T=r("./src/errors.js"),m=r("./src/crypt/decrypter.js"),k=r("./src/demux/aacdemuxer.js"),A=r("./src/demux/mp4demuxer.js"),D=r("./src/demux/tsdemuxer.js"),R=r("./src/demux/mp3demuxer.js"),O=r("./src/remux/mp4-remuxer.js"),L=r("./src/remux/passthrough-remuxer.js"),i=r("./src/utils/get-self-scope.js"),n=r("./src/utils/logger.js"),a=i.getSelfScope();try{g=a.performance.now.bind(a.performance)}catch(e){n.logger.debug("Unable to use Performance API on this environment"),g=a.Date.now}var o=(s.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},s.prototype.push=function(e,r,i,n,a,o,s,l,u,d,c,f){var h=this;if(0<e.byteLength&&null!=r&&null!=r.key&&"AES-128"===r.method){var t=this.decrypter;null==t&&(t=this.decrypter=new m.default(this.observer,this.config));var p=g();t.decrypt(e,r.key.buffer,r.iv.buffer,function(e){var t=g();h.observer.trigger(w.default.FRAG_DECRYPTED,{stats:{tstart:p,tdecrypt:t}}),h.pushDecrypted(new Uint8Array(e),r,new Uint8Array(i),n,a,o,s,l,u,d,c,f)})}else this.pushDecrypted(new Uint8Array(e),r,new Uint8Array(i),n,a,o,s,l,u,d,c,f)},s.prototype.pushDecrypted=function(e,t,r,i,n,a,o,s,l,u,d,c){var f=this.demuxer;if(!f||(o||s)&&!this.probe(e)){for(var h=this.observer,p=this.typeSupported,g=this.config,m=[{demux:D.default,remux:O.default},{demux:A.default,remux:L.default},{demux:k.default,remux:O.default},{demux:R.default,remux:O.default}],v=0,_=m.length;v<_;v++){var y=m[v],b=y.demux.probe;if(b(e)){var E=this.remuxer=new y.remux(h,g,p,this.vendor);f=new y.demux(h,E,g,p),this.probe=b;break}}if(!f)return void h.trigger(w.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=f}var S=this.remuxer;(o||s)&&(f.resetInitSegment(r,i,n,u),S.resetInitSegment()),o&&(f.resetTimeStamp(c),S.resetTimeStamp(c)),"function"==typeof f.setDecryptData&&f.setDecryptData(t),f.append(e,a,l,d)},s);function s(e,t,r,i){this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i}t.default=o},"./src/demux/demuxer-worker.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("./src/demux/demuxer-inline.js"),s=r("./src/events.js"),l=r("./src/utils/logger.js"),u=r("./node_modules/node-libs-browser/node_modules/events/events.js");t.default=function(n){var i=new u.EventEmitter;i.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.emit.apply(i,[e,e].concat(t))},i.off=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.removeListener.apply(i,[e].concat(t))};function a(e,t){n.postMessage({event:e,data:t})}n.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":var r=JSON.parse(t.config);n.demuxer=new o.default(i,t.typeSupported,r,t.vendor),l.enableLogs(r.debug),a("init",null);break;case"demux":n.demuxer.push(t.data,t.decryptdata,t.initSegment,t.audioCodec,t.videoCodec,t.timeOffset,t.discontinuity,t.trackSwitch,t.contiguous,t.duration,t.accurateTimeOffset,t.defaultInitPTS)}}),i.on(s.default.FRAG_DECRYPTED,a),i.on(s.default.FRAG_PARSING_INIT_SEGMENT,a),i.on(s.default.FRAG_PARSED,a),i.on(s.default.ERROR,a),i.on(s.default.FRAG_PARSING_METADATA,a),i.on(s.default.FRAG_PARSING_USERDATA,a),i.on(s.default.INIT_PTS_FOUND,a),i.on(s.default.FRAG_PARSING_DATA,function(e,t){var r=[],i={event:e,data:t};t.data1&&(i.data1=t.data1.buffer,r.push(t.data1.buffer),delete t.data1),t.data2&&(i.data2=t.data2.buffer,r.push(t.data2.buffer),delete t.data2),n.postMessage(i,r)})}},"./src/demux/demuxer.js":function(e,n,a){"use strict";(function(v){Object.defineProperty(n,"__esModule",{value:!0});var u=a("./node_modules/webworkify-webpack/index.js"),d=a("./src/events.js"),c=a("./src/demux/demuxer-inline.js"),_=a("./src/utils/logger.js"),f=a("./src/errors.js"),e=a("./src/utils/mediasource-helper.js"),t=a("./src/utils/get-self-scope.js"),h=a("./src/observer.js"),p=t.getSelfScope(),g=e.getMediaSource(),r=(i.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)},i.prototype.push=function(e,t,r,i,n,a,o,s){var l=this.w,u=v.isFinite(n.startPTS)?n.startPTS:n.start,d=n.decryptdata,c=this.frag,f=!(c&&n.cc===c.cc),h=!(c&&n.level===c.level),p=c&&n.sn===c.sn+1,g=!h&&p;if(f&&_.logger.log(this.id+":discontinuity detected"),h&&_.logger.log(this.id+":switch detected"),this.frag=n,l)l.postMessage({cmd:"demux",data:e,decryptdata:d,initSegment:t,audioCodec:r,videoCodec:i,timeOffset:u,discontinuity:f,trackSwitch:h,contiguous:g,duration:a,accurateTimeOffset:o,defaultInitPTS:s},e instanceof ArrayBuffer?[e]:[]);else{var m=this.demuxer;m&&m.push(e,d,t,r,i,u,f,h,g,a,o,s)}},i.prototype.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":p.URL.revokeObjectURL(this.w.objectURL);break;case d.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},i);function i(r,e){var i=this;this.hls=r,this.id=e;function t(e,t){(t=t||{}).frag=i.frag,t.id=i.id,r.trigger(e,t)}var n=this.observer=new h.Observer,a=r.config;n.on(d.default.FRAG_DECRYPTED,t),n.on(d.default.FRAG_PARSING_INIT_SEGMENT,t),n.on(d.default.FRAG_PARSING_DATA,t),n.on(d.default.FRAG_PARSED,t),n.on(d.default.ERROR,t),n.on(d.default.FRAG_PARSING_METADATA,t),n.on(d.default.FRAG_PARSING_USERDATA,t),n.on(d.default.INIT_PTS_FOUND,t);var o={mp4:g.isTypeSupported("video/mp4"),mpeg:g.isTypeSupported("audio/mpeg"),mp3:g.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(a.enableWorker&&"undefined"!=typeof Worker){_.logger.log("demuxing in webworker");var l=void 0;try{l=this.w=u("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(e){r.trigger(d.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},l.postMessage({cmd:"init",typeSupported:o,vendor:s,id:e,config:JSON.stringify(a)})}catch(e){_.logger.warn("Error in worker:",e),_.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),l&&p.URL.revokeObjectURL(l.objectURL),this.demuxer=new c.default(n,o,a,s),this.w=void 0}}else this.demuxer=new c.default(n,o,a,s)}n.default=r}).call(this,a("./src/polyfills/number.js").Number)},"./src/demux/exp-golomb.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./src/utils/logger.js"),n=(a.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},a.prototype.skipBits=function(e){var t;this.bitsAvailable>e||(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e},a.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return 32<e&&i.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?r<<t|this.readBits(t):r},a.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},a.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},a.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},a.prototype.readBoolean=function(){return 1===this.readBits(1)},a.prototype.readUByte=function(){return this.readBits(8)},a.prototype.readUShort=function(){return this.readBits(16)},a.prototype.readUInt=function(){return this.readBits(32)},a.prototype.skipScalingList=function(e){var t,r=8,i=8;for(t=0;t<e;t++)0!==i&&(i=(r+this.readEG()+256)%256),r=0===i?r:i},a.prototype.readSPS=function(){var e,t,r,i,n,a,o,s=0,l=0,u=0,d=0,c=this.readUByte.bind(this),f=this.readBits.bind(this),h=this.readUEG.bind(this),p=this.readBoolean.bind(this),g=this.skipBits.bind(this),m=this.skipEG.bind(this),v=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if(c(),e=c(),f(5),g(3),c(),v(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var y=h();if(3===y&&g(1),v(),v(),g(1),p())for(a=3!==y?8:12,o=0;o<a;o++)p()&&_(o<6?16:64)}v();var b=h();if(0===b)h();else if(1===b)for(g(1),m(),m(),t=h(),o=0;o<t;o++)m();v(),g(1),r=h(),i=h(),0===(n=f(1))&&g(1),g(1),p()&&(s=h(),l=h(),u=h(),d=h());var E=[1,1];if(p()&&p())switch(c()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[c()<<8|c(),c()<<8|c()]}return{width:Math.ceil(16*(r+1)-2*s-2*l),height:(2-n)*(i+1)*16-(n?2:4)*(u+d),pixelRatio:E}},a.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a);function a(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}t.default=n},"./src/demux/id3.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(s.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},s.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},s.getID3Data=function(e,t){for(var r=t,i=0;s.isHeader(e,t);)i+=10,i+=s._readSize(e,t+6),s.isFooter(e,t+10)&&(i+=10),t+=i;if(0<i)return e.subarray(r,r+i)},s._readSize=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3]},s.getTimeStamp=function(e){for(var t=s.getID3Frames(e),r=0;r<t.length;r++){var i=t[r];if(s.isTimeStampFrame(i))return s._readTimeStamp(i)}},s.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},s._getFrameData=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=s._readSize(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},s.getID3Frames=function(e){for(var t=0,r=[];s.isHeader(e,t);){for(var i=s._readSize(e,t+6),n=(t+=10)+i;t+8<n;){var a=s._getFrameData(e.subarray(t)),o=s._decodeFrame(a);o&&r.push(o),t+=a.size+10}s.isFooter(e,t)&&(t+=10)}return r},s._decodeFrame=function(e){return"PRIV"===e.type?s._decodePrivFrame(e):"T"===e.type[0]?s._decodeTextFrame(e):"W"===e.type[0]?s._decodeURLFrame(e):void 0},s._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},s._decodePrivFrame=function(e){if(!(e.size<2)){var t=s._utf8ArrayToStr(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},s._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=s._utf8ArrayToStr(e.data.subarray(t));t+=r.length+1;var i=s._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=s._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:n}}},s._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=s._utf8ArrayToStr(e.data.subarray(t));t+=r.length+1;var i=s._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=s._utf8ArrayToStr(e.data);return{key:e.type,data:n}},s._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);for(var r,i,n,a=e.length,o="",s=0;s<a;){if(0===(r=e[s++])&&t)return o;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:i=e[s++],o+=String.fromCharCode((31&r)<<6|63&i);break;case 14:i=e[s++],n=e[s++],o+=String.fromCharCode((15&r)<<12|(63&i)<<6|(63&n)<<0)}}return o},s);function s(){}var n=i._utf8ArrayToStr;t.utf8ArrayToStr=n,t.default=i},"./src/demux/mp3demuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=r("./src/demux/id3.js"),n=r("./src/utils/logger.js"),g=r("./src/demux/mpegaudio.js"),i=(a.prototype.resetInitSegment=function(e,t,r,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:i,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(e){var t,r,i=p.default.getID3Data(e,0);if(i&&void 0!==p.default.getTimeStamp(i))for(t=i.length,r=Math.min(e.length-1,t+100);t<r;t++)if(g.default.probe(e,t))return n.logger.log("MPEG Audio sync word found !"),!0;return!1},a.prototype.append=function(e,t,r,i){for(var n=p.default.getID3Data(e,0),a=p.default.getTimeStamp(n),o=a?90*a:9e4*t,s=n.length,l=e.length,u=0,d=0,c=this._audioTrack,f=[{pts:o,dts:o,data:n}];s<l;)if(g.default.isHeader(e,s)){var h=g.default.appendFrame(c,e,s,o,u);if(!h)break;s+=h.length,d=h.sample.pts,u++}else p.default.isHeader(e,s)?(n=p.default.getID3Data(e,s),f.push({pts:d,dts:d,data:n}),s+=n.length):s++;this.remuxer.remux(c,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,r,i)},a.prototype.destroy=function(){},a);function a(e,t,r){this.observer=e,this.config=r,this.remuxer=t}t.default=i},"./src/demux/mp4demuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=r("./src/utils/logger.js"),l=r("./src/events.js"),s=Math.pow(2,32)-1,i=(g.prototype.resetTimeStamp=function(e){this.initPTS=e},g.prototype.resetInitSegment=function(e,t,r,i){if(e&&e.byteLength){var n=this.initData=g.parseInitSegment(e);null==t&&(t="mp4a.40.5"),null==r&&(r="avc1.42e01e");var a={};n.audio&&n.video?a.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:i?e:null}:(n.audio&&(a.audio={container:"audio/mp4",codec:t,initSegment:i?e:null}),n.video&&(a.video={container:"video/mp4",codec:r,initSegment:i?e:null})),this.observer.trigger(l.default.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else t&&(this.audioCodec=t),r&&(this.videoCodec=r)},g.probe=function(e){return 0<g.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length},g.bin2str=function(e){return String.fromCharCode.apply(null,e)},g.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<8|e[t+1];return r<0?65536+r:r},g.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r},g.writeUint32=function(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},g.findBox=function(e,t){var r,i,n,a,o,s,l=[];if(e.data?(o=e.start,n=e.end,e=e.data):(o=0,n=e.byteLength),!t.length)return null;for(r=o;r<n;)s=1<(i=g.readUint32(e,r))?r+i:n,g.bin2str(e.subarray(r+4,r+8))===t[0]&&(1===t.length?l.push({data:e,start:r+8,end:s}):(a=g.findBox({data:e,start:r+8,end:s},t.slice(1))).length&&(l=l.concat(a))),r=s;return l},g.parseSegmentIndex=function(e){var t,r=g.findBox(e,["moov"])[0],i=r?r.end:null,n=0,a=g.findBox(e,["sidx"]);if(!a||!a[0])return null;t=[];var o=(a=a[0]).data[0],s=g.readUint32(a,n=0===o?8:16);n+=4,n+=0===o?8:16,n+=2;var l=a.end+0,u=g.readUint16(a,n);n+=2;for(var d=0;d<u;d++){var c=n,f=g.readUint32(a,c);c+=4;var h=2147483647&f;if(1==(2147483648&f)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var p=g.readUint32(a,c);c+=4,t.push({referenceSize:h,subsegmentDuration:p,info:{duration:p/s,start:l,end:l+h-1}}),l+=h,n=c+=4}return{earliestPresentationTime:0,timescale:s,version:o,referencesCount:u,references:t,moovEndOffset:i}},g.parseInitSegment=function(e){var c=[];return g.findBox(e,["moov","trak"]).forEach(function(e){var t=g.findBox(e,["tkhd"])[0];if(t){var r=t.data[t.start],i=0===r?12:20,n=g.readUint32(t,i),a=g.findBox(e,["mdia","mdhd"])[0];if(a){r=a.data[a.start];var o=g.readUint32(a,i=0===r?12:20),s=g.findBox(e,["mdia","hdlr"])[0];if(s){var l={soun:"audio",vide:"video"}[g.bin2str(s.data.subarray(s.start+8,s.start+12))];if(l){var u=g.findBox(e,["mdia","minf","stbl","stsd"]);if(u.length){u=u[0];var d=g.bin2str(u.data.subarray(u.start+12,u.start+16));f.logger.log("MP4Demuxer:"+l+":"+d+" found")}c[n]={timescale:o,type:l},c[l]={timescale:o,id:n}}}}}}),c},g.getStartDTS=function(n,e){var t,r,i;return t=g.findBox(e,["moof","traf"]),r=[].concat.apply([],t.map(function(i){return g.findBox(i,["tfhd"]).map(function(e){var t,r;return t=g.readUint32(e,4),r=n[t].timescale||9e4,g.findBox(i,["tfdt"]).map(function(e){var t,r;return t=e.data[e.start],r=g.readUint32(e,4),1===t&&(r*=Math.pow(2,32),r+=g.readUint32(e,8)),r})[0]/r})})),i=Math.min.apply(null,r),isFinite(i)?i:0},g.offsetStartDTS=function(i,e,o){g.findBox(e,["moof","traf"]).map(function(r){return g.findBox(r,["tfhd"]).map(function(e){var t=g.readUint32(e,4),a=i[t].timescale||9e4;g.findBox(r,["tfdt"]).map(function(e){var t=e.data[e.start],r=g.readUint32(e,4);if(0===t)g.writeUint32(e,4,r-o*a);else{r*=Math.pow(2,32),r+=g.readUint32(e,8),r-=o*a,r=Math.max(r,0);var i=Math.floor(r/(1+s)),n=Math.floor(r%(1+s));g.writeUint32(e,4,i),g.writeUint32(e,8,n)}})})})},g.prototype.append=function(e,t,r,i){var n=this.initData;n||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),n=this.initData);var a,o=this.initPTS;if(void 0===o){var s=g.getStartDTS(n,e);this.initPTS=o=s-t,this.observer.trigger(l.default.INIT_PTS_FOUND,{initPTS:o})}g.offsetStartDTS(n,e,o),a=g.getStartDTS(n,e),this.remuxer.remux(n.audio,n.video,null,null,a,r,i,e)},g.prototype.destroy=function(){},g);function g(e,t){this.observer=e,this.remuxer=t}t.default=i},"./src/demux/mpegaudio.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,i,n){if(!(r+24>t.length)){var a=this.parseHeader(t,r);if(a&&r+a.frameLength<=t.length){var o=i+n*(9e4*a.samplesPerFrame/a.sampleRate),s={unit:t.subarray(r,r+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(s),e.len+=a.frameLength,{sample:s,length:a.frameLength}}}},parseHeader:function(e,t){var r=e[t+1]>>3&3,i=e[t+1]>>1&3,n=e[t+2]>>4&15,a=e[t+2]>>2&3,o=e[t+2]>>1&1;if(1!=r&&0!=n&&15!=n&&3!=a){var s=3==r?3-i:3==i?3:4,l=1e3*g.BitratesMap[14*s+n-1],u=3==r?0:2==r?1:2,d=g.SamplingRateMap[3*u+a],c=e[t+3]>>6==3?1:2,f=g.SamplesCoefficients[r][i],h=g.BytesInSlot[i],p=8*f*h;return{sampleRate:d,channelCount:c,frameLength:parseInt(f*l/d+o,10)*h,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var r=this.parseHeader(e,t),i=4;r&&r.frameLength&&(i=r.frameLength);var n=t+i;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}};t.default=g},"./src/demux/sample-aes.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/crypt/decrypter.js"),i=(a.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},a.prototype.decryptAacSample=function(t,r,i,n){var a=t[r].unit,e=a.subarray(16,a.length-a.length%16),o=e.buffer.slice(e.byteOffset,e.byteOffset+e.length),s=this;this.decryptBuffer(o,function(e){e=new Uint8Array(e),a.set(e,16),n||s.decryptAacSamples(t,r+1,i)})},a.prototype.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,i),!i)return}}},a.prototype.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,n=32;n<=e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r},a.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var r=0,i=32;i<=e.length-16;i+=160,r+=16)e.set(t.subarray(r,r+16),i);return e},a.prototype.decryptAvcSample=function(t,r,i,n,a,o){var s=this.discardEPB(a.data),e=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(e.buffer,function(e){a.data=l.getAvcDecryptedUnit(s,e),o||l.decryptAvcSamples(t,r,i+1,n)})},a.prototype.decryptAvcSamples=function(e,t,r,i){for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;!(r>=n.length);r++){var a=n[r];if(!(a.length<=48||1!==a.type&&5!==a.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,i,a,o),!o)return}}}},a);function a(e,t,r,i){this.decryptdata=r,this.discardEPB=i,this.decrypter=new n.default(e,t,{removePKCS7Padding:!1})}t.default=i},"./src/demux/tsdemuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=r("./src/demux/adts.js"),s=r("./src/demux/mpegaudio.js"),C=r("./src/events.js"),T=r("./src/demux/exp-golomb.js"),i=r("./src/demux/sample-aes.js"),P=r("./src/utils/logger.js"),x=r("./src/errors.js"),n={video:1,audio:2,id3:3,text:4},a=(I.prototype.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new i.default(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},I.probe=function(e){var t=I._syncOffset(e);return!(t<0||(t&&P.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),0))},I._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},I.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:n[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},I.prototype.resetInitSegment=function(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=I.createTrack("video",i),this._audioTrack=I.createTrack("audio",i),this._id3Track=I.createTrack("id3",i),this._txtTrack=I.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=r,this._duration=i},I.prototype.resetTimeStamp=function(){},I.prototype.append=function(e,t,r,i){var n,a,o,s,l,u=e.length,d=!1;this.contiguous=r;var c=this.pmtParsed,f=this._avcTrack,h=this._audioTrack,p=this._id3Track,g=f.pid,m=h.pid,v=p.pid,_=this._pmtId,y=f.pesData,b=h.pesData,E=p.pesData,S=this._parsePAT,w=this._parsePMT,T=this._parsePES,k=this._parseAVCPES.bind(this),A=this._parseAACPES.bind(this),D=this._parseMPEGPES.bind(this),R=this._parseID3PES.bind(this),O=I._syncOffset(e);for(u-=(u+O)%188,n=O;n<u;n+=188)if(71===e[n]){if(a=!!(64&e[n+1]),o=((31&e[n+1])<<8)+e[n+2],1<(48&e[n+3])>>4){if((s=n+5+e[n+4])===n+188)continue}else s=n+4;switch(o){case g:a&&(y&&(l=T(y))&&void 0!==l.pts&&k(l,!1),y={data:[],size:0}),y&&(y.data.push(e.subarray(s,n+188)),y.size+=n+188-s);break;case m:a&&(b&&(l=T(b))&&void 0!==l.pts&&(h.isAAC?A(l):D(l)),b={data:[],size:0}),b&&(b.data.push(e.subarray(s,n+188)),b.size+=n+188-s);break;case v:a&&(E&&(l=T(E))&&void 0!==l.pts&&R(l),E={data:[],size:0}),E&&(E.data.push(e.subarray(s,n+188)),E.size+=n+188-s);break;case 0:a&&(s+=e[s]+1),_=this._pmtId=S(e,s);break;case _:a&&(s+=e[s]+1);var L=w(e,s,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(g=L.avc)&&(f.pid=g),0<(m=L.audio)&&(h.pid=m,h.isAAC=L.isAAC),0<(v=L.id3)&&(p.pid=v),d&&!c&&(P.logger.log("reparse from beginning"),d=!1,n=O-188),c=this.pmtParsed=!0;break;case 17:case 8191:break;default:d=!0}}else this.observer.trigger(C.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});y&&(l=T(y))&&void 0!==l.pts?(k(l,!0),f.pesData=null):f.pesData=y,b&&(l=T(b))&&void 0!==l.pts?(h.isAAC?A(l):D(l),h.pesData=null):(b&&b.size&&P.logger.log("last AAC PES packet truncated,might overlap between fragments"),h.pesData=b),E&&(l=T(E))&&void 0!==l.pts?(R(l),p.pesData=null):p.pesData=E,null==this.sampleAes?this.remuxer.remux(h,f,p,this._txtTrack,t,r,i):this.decryptAndRemux(h,f,p,this._txtTrack,t,r,i)},I.prototype.decryptAndRemux=function(e,t,r,i,n,a,o){if(e.samples&&e.isAAC){var s=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){s.decryptAndRemuxAvc(e,t,r,i,n,a,o)})}else this.decryptAndRemuxAvc(e,t,r,i,n,a,o)},I.prototype.decryptAndRemuxAvc=function(e,t,r,i,n,a,o){if(t.samples){var s=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){s.remuxer.remux(e,t,r,i,n,a,o)})}else this.remuxer.remux(e,t,r,i,n,a,o)},I.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},I.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},I.prototype._parsePMT=function(e,t,r,i){var n,a,o={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!i){P.logger.log("unkown stream type:"+e[t]);break}case 15:-1===o.audio&&(o.audio=a);break;case 21:-1===o.id3&&(o.id3=a);break;case 219:if(!i){P.logger.log("unkown stream type:"+e[t]);break}case 27:-1===o.avc&&(o.avc=a);break;case 3:case 4:r?-1===o.audio&&(o.audio=a,o.isAAC=!1):P.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:P.logger.warn("HEVC stream type found, not supported for now");break;default:P.logger.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return o},I.prototype._parsePES=function(e){var t,r,i,n,a,o,s,l,u=0,d=e.data;if(!e||0===e.size)return null;for(;d[0].length<19&&1<d.length;){var c=new Uint8Array(d[0].length+d[1].length);c.set(d[0]),c.set(d[1],d[0].length),d[0]=c,d.splice(1,1)}if(1!==((t=d[0])[0]<<16)+(t[1]<<8)+t[2])return null;if((i=(t[4]<<8)+t[5])&&i>e.size-6)return null;192&(r=t[7])&&(4294967295<(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2)&&(o-=8589934592),64&r?(4294967295<(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)&&(s-=8589934592),54e5<o-s&&(P.logger.warn(Math.round((o-s)/9e4)+"s delta between PTS and DTS, align them"),o=s)):s=o),l=(n=t[8])+9,e.size-=l,a=new Uint8Array(e.size);for(var f=0,h=d.length;f<h;f++){var p=(t=d[f]).byteLength;if(l){if(p<l){l-=p;continue}t=t.subarray(l),p-=l,l=0}a.set(t,u),u+=p}return i&&(i-=n+3),{data:a,pts:o,dts:s,len:i}},I.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var r=t.samples,i=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(i||this.contiguous)?(e.id=i,r.push(e)):t.dropped++}e.debug.length&&P.logger.log(e.pts+"/"+e.dts+":"+e.debug)},I.prototype._parseAVCPES=function(p,e){function g(e,t,r,i){return{key:e,pts:t,dts:r,units:[],debug:i}}var m,v,_,y=this,b=this._avcTrack,t=this._parseAVCNALu(p.data),E=this.avcSample,S=!1,w=this.pushAccesUnit.bind(this);p.data=null,E&&t.length&&!b.audFound&&(w(E,b),E=this.avcSample=g(!1,p.pts,p.dts,"")),t.forEach(function(e){switch(e.type){case 1:v=!0,(E=E||(y.avcSample=g(!0,p.pts,p.dts,""))).frame=!0;var t=e.data;if(S&&4<t.length){var r=new T.default(t).readSliceType();2!==r&&4!==r&&7!==r&&9!==r||(E.key=!0)}break;case 5:v=!0,(E=E||(y.avcSample=g(!0,p.pts,p.dts,""))).key=!0,E.frame=!0;break;case 6:v=!0,(m=new T.default(y.discardEPB(e.data))).readUByte();for(var i=0,n=0,a=!1,o=0;!a&&1<m.bytesAvailable;){for(i=0;i+=o=m.readUByte(),255===o;);for(n=0;n+=o=m.readUByte(),255===o;);if(4===i&&0!==m.bytesAvailable){if(a=!0,181===m.readUByte()&&49===m.readUShort()&&1195456820===m.readUInt()&&3===m.readUByte()){var s=m.readUByte(),l=31&s,u=[s,m.readUByte()];for(_=0;_<l;_++)u.push(m.readUByte()),u.push(m.readUByte()),u.push(m.readUByte());y._insertSampleInOrder(y._txtTrack.samples,{type:3,pts:p.pts,bytes:u})}}else if(n<m.bytesAvailable)for(_=0;_<n;_++)m.readUByte()}break;case 7:if(S=v=!0,!b.sps){var d=(m=new T.default(e.data)).readSPS();b.width=d.width,b.height=d.height,b.pixelRatio=d.pixelRatio,b.sps=[e.data],b.duration=y._duration;var c=e.data.subarray(1,4),f="avc1.";for(_=0;_<3;_++){var h=c[_].toString(16);h.length<2&&(h="0"+h),f+=h}b.codec=f}break;case 8:v=!0,b.pps||(b.pps=[e.data]);break;case 9:v=!1,b.audFound=!0,E&&w(E,b),E=y.avcSample=g(!1,p.pts,p.dts,"");break;case 12:v=!1;break;default:v=!1,E&&(E.debug+="unknown NAL "+e.type+" ")}E&&v&&E.units.push(e)}),e&&E&&(w(E,b),this.avcSample=null)},I.prototype._insertSampleInOrder=function(e,t){var r=e.length;if(0<r){if(t.pts>=e[r-1].pts)e.push(t);else for(var i=r-1;0<=i;i--)if(t.pts<e[i].pts){e.splice(i,0,t);break}}else e.push(t)},I.prototype._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var r=this._avcTrack.samples;t=r[r.length-1]}if(t){var i=t.units;e=i[i.length-1]}return e},I.prototype._parseAVCNALu=function(e){var t,r,i,n,a=0,o=e.byteLength,s=this._avcTrack,l=s.naluState||0,u=l,d=[],c=-1;for(-1===l&&(n=31&e[c=0],l=0,a=1);a<o;)if(t=e[a++],l)if(1!==l)if(t)if(1===t){var f,h;0<=c?(i={data:e.subarray(c,a-l-1),type:n},d.push(i)):(f=this._getLastNalUnit())&&(u&&a<=4-u&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-u)),0<(r=a-l-1)&&((h=new Uint8Array(f.data.byteLength+r)).set(f.data,0),h.set(e.subarray(0,r),f.data.byteLength),f.data=h)),l=a<o?(n=31&e[c=a],0):-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;return 0<=c&&0<=l&&(i={data:e.subarray(c,o),type:n,state:l},d.push(i)),0!==d.length||(f=this._getLastNalUnit())&&((h=new Uint8Array(f.data.byteLength+e.byteLength)).set(f.data,0),h.set(e,f.data.byteLength),f.data=h),s.naluState=l,d},I.prototype.discardEPB=function(e){for(var t,r,i=e.byteLength,n=[],a=1;a<i-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(n.push(a+2),a+=2):a++;if(0===n.length)return e;t=i-n.length,r=new Uint8Array(t);var o=0;for(a=0;a<t;o++,a++)o===n[0]&&(o++,n.shift()),r[a]=e[o];return r},I.prototype._parseAACPES=function(e){var t,r,i,n,a,o=this._audioTrack,s=e.data,l=e.pts,u=this.aacOverFlow,d=this.aacLastPTS;if(u){var c=new Uint8Array(u.byteLength+s.byteLength);c.set(u,0),c.set(s,u.byteLength),s=c}for(i=0,a=s.length;i<a-1&&!m.isHeader(s,i);i++);if(i){var f=void 0,h=void 0;if(h=i<a-1?(f="AAC PES did not start with ADTS header,offset:"+i,!1):(f="no ADTS header found in AAC PES",!0),P.logger.warn("parsing error:"+f),this.observer.trigger(C.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_PARSING_ERROR,fatal:h,reason:f}),h)return}if(m.initTrackConfig(o,this.observer,s,i,this.audioCodec),r=0,t=m.getFrameDuration(o.samplerate),u&&d){var p=d+t;1<Math.abs(p-l)&&(P.logger.log("AAC: align PTS for overlapping frames by "+Math.round((p-l)/90)),l=p)}for(;i<a;)if(m.isHeader(s,i)&&i+5<a){var g=m.appendFrame(o,s,i,l,r);if(!g)break;i+=g.length,n=g.sample.pts,r++}else i++;u=i<a?s.subarray(i,a):null,this.aacOverFlow=u,this.aacLastPTS=n},I.prototype._parseMPEGPES=function(e){for(var t=e.data,r=t.length,i=0,n=0,a=e.pts;n<r;)if(s.default.isHeader(t,n)){var o=s.default.appendFrame(this._audioTrack,t,n,a,i);if(!o)break;n+=o.length,i++}else n++},I.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},I);function I(e,t,r,i){this.observer=e,this.config=r,this.typeSupported=i,this.remuxer=t,this.sampleAes=null}t.default=a},"./src/errors.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},t.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./src/utils/logger.js"),n=r("./src/errors.js"),a=r("./src/events.js"),o={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},s=(l.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},l.prototype.onHandlerDestroying=function(){},l.prototype.onHandlerDestroyed=function(){},l.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},l.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(o[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},l.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},l.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},l.prototype.onEventGeneric=function(t,e){try{(function(e,t){var r="on"+e.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)}).call(this,t,e).call()}catch(e){i.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(a.default.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},l);function l(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.hls=e,this.onEvent=this.onEvent.bind(this),this.handledEvents=t,this.useGenericHandler=!0,this.registerListeners()}t.default=s},"./src/events.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},"./src/hls.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var b,a=r("./node_modules/url-toolkit/src/url-toolkit.js"),o=r("./src/errors.js"),E=r("./src/loader/playlist-loader.js"),S=r("./src/loader/fragment-loader.js"),w=r("./src/loader/key-loader.js"),T=r("./src/controller/fragment-tracker.js"),k=r("./src/controller/stream-controller.js"),A=r("./src/controller/level-controller.js"),D=r("./src/controller/id3-track-controller.js"),s=r("./src/is-supported.js"),R=r("./src/utils/logger.js"),l=r("./src/config.js"),u=r("./src/events.js"),d=r("./src/observer.js"),c=(b=d.Observer,n(O,b),Object.defineProperty(O,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),O.isSupported=function(){return s.isSupported()},Object.defineProperty(O,"Events",{get:function(){return u.default},enumerable:!0,configurable:!0}),Object.defineProperty(O,"ErrorTypes",{get:function(){return o.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(O,"ErrorDetails",{get:function(){return o.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(O,"DefaultConfig",{get:function(){return O.defaultConfig?O.defaultConfig:l.hlsDefaultConfig},set:function(e){O.defaultConfig=e},enumerable:!0,configurable:!0}),O.prototype.destroy=function(){R.logger.log("destroy"),this.trigger(u.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},O.prototype.attachMedia=function(e){R.logger.log("attachMedia"),this.media=e,this.trigger(u.default.MEDIA_ATTACHING,{media:e})},O.prototype.detachMedia=function(){R.logger.log("detachMedia"),this.trigger(u.default.MEDIA_DETACHING),this.media=null},O.prototype.loadSource=function(e){e=a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),R.logger.log("loadSource:"+e),this.url=e,this.trigger(u.default.MANIFEST_LOADING,{url:e})},O.prototype.startLoad=function(t){void 0===t&&(t=-1),R.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},O.prototype.stopLoad=function(){R.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},O.prototype.swapAudioCodec=function(){R.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},O.prototype.recoverMediaError=function(){R.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},Object.defineProperty(O.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(e){R.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(e){R.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(e){R.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){R.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(e){R.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(e){R.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"minAutoLevel",{get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,r=e?e.length:0,i=0;i<r;i++)if(t<(e[i].realBitrate?Math.max(e[i].realBitrate,e[i].bitrate):e[i].bitrate))return i;return 0},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"maxAutoLevel",{get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"nextAutoLevel",{get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"audioTracks",{get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"audioTrack",{get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"subtitleTracks",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"subtitleTrack",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"subtitleDisplay",{get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)},enumerable:!0,configurable:!0}),O);function O(e){void 0===e&&(e={});var t=b.call(this)||this,r=O.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var i in r)i in e||(e[i]=r[i]);if(void 0!==e.liveMaxLatencyDurationCount&&e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(e.liveMaxLatencyDuration<=e.liveSyncDuration||void 0===e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');R.enableLogs(e.debug),t.config=e,t._autoLevelCapping=-1;var n=t.abrController=new e.abrController(t),a=new e.bufferController(t),o=new e.capLevelController(t),s=new e.fpsController(t),l=new E.default(t),u=new S.default(t),d=new w.default(t),c=new D.default(t),f=t.levelController=new A.default(t),h=new T.FragmentTracker(t),p=[f,t.streamController=new k.default(t,h)],g=e.audioStreamController;g&&p.push(new g(t,h)),t.networkControllers=p;var m=[l,u,d,n,a,o,s,c,h];if(g=e.audioTrackController){var v=new g(t);t.audioTrackController=v,m.push(v)}if(g=e.subtitleTrackController){var _=new g(t);t.subtitleTrackController=_,p.push(_)}if(g=e.emeController){var y=new g(t);t.emeController=y,m.push(y)}return(g=e.subtitleStreamController)&&p.push(new g(t,h)),(g=e.timelineController)&&m.push(new g(t)),t.coreComponents=m,t}t.default=c},"./src/is-supported.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/mediasource-helper.js");t.isSupported=function(){var e=n.getMediaSource(),t=window.SourceBuffer||window.WebKitSourceBuffer,r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!i}},"./src/loader/fragment-loader.js":function(e,l,u){"use strict";(function(h){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(l,"__esModule",{value:!0});var n,o=u("./src/events.js"),t=u("./src/event-handler.js"),a=u("./src/errors.js"),p=u("./src/utils/logger.js"),r=(n=t.default,e(s,n),s.prototype.destroy=function(){var e=this.loaders;for(var t in e){var r=e[t];r&&r.destroy()}this.loaders={},n.prototype.destroy.call(this)},s.prototype.onFragLoading=function(e){var t=e.frag,r=t.type,i=this.loaders,n=this.hls.config,a=n.fLoader,o=n.loader;t.loaded=0;var s,l,u,d=i[r];d&&(p.logger.warn("abort previous fragment loader for type: "+r),d.abort()),d=i[r]=t.loader=n.fLoader?new a(n):new o(n),s={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var c=t.byteRangeStartOffset,f=t.byteRangeEndOffset;h.isFinite(c)&&h.isFinite(f)&&(s.rangeStart=c,s.rangeEnd=f),l={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(s,l,u)},s.prototype.loadsuccess=function(e,t,r,i){void 0===i&&(i=null);var n=e.data,a=r.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(o.default.FRAG_LOADED,{payload:n,frag:a,stats:t,networkDetails:i})},s.prototype.loaderror=function(e,t,r){void 0===r&&(r=null);var i=t.frag,n=i.loader;n&&n.abort(),this.loaders[i.type]=void 0,this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:r})},s.prototype.loadtimeout=function(e,t,r){void 0===r&&(r=null);var i=t.frag,n=i.loader;n&&n.abort(),this.loaders[i.type]=void 0,this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:r})},s.prototype.loadprogress=function(e,t,r,i){void 0===i&&(i=null);var n=t.frag;n.loaded=e.loaded,this.hls.trigger(o.default.FRAG_LOAD_PROGRESS,{frag:n,stats:e,networkDetails:i})},s);function s(e){var t=n.call(this,e,o.default.FRAG_LOADING)||this;return t.loaders={},t}l.default=r}).call(this,u("./src/polyfills/number.js").Number)},"./src/loader/fragment.js":function(e,a,o){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0});var e=o("./node_modules/url-toolkit/src/url-toolkit.js"),i=o("./src/loader/level-key.js"),r=(Object.defineProperty(n,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=e.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var r=this.lastByteRangeEndOffset;e[0]=r||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endProgramDateTime",{get:function(){if(!t.isFinite(this.programDateTime))return null;var e=t.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),n.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},n.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},n.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},n.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&((r=new i.default).method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r},n);function n(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((e={})[n.ElementaryStreamTypes.AUDIO]=!1,e[n.ElementaryStreamTypes.VIDEO]=!1,e)}a.default=r}).call(this,o("./src/polyfills/number.js").Number)},"./src/loader/key-loader.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,d=r("./src/events.js"),o=r("./src/event-handler.js"),s=r("./src/errors.js"),c=r("./src/utils/logger.js"),l=(a=o.default,n(u,a),u.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},o.default.prototype.destroy.call(this)},u.prototype.onKeyLoading=function(e){var t=e.frag,r=t.type,i=this.loaders[r],n=t.decryptdata,a=n.uri;if(a!==this.decrypturl||null===this.decryptkey){var o,s,l,u=this.hls.config;i&&(c.logger.warn("abort previous key loader for type:"+r),i.abort()),t.loader=this.loaders[r]=new u.loader(u),this.decrypturl=a,this.decryptkey=null,o={url:a,frag:t,responseType:"arraybuffer"},s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(o,s,l)}else this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(d.default.KEY_LOADED,{frag:t}))},u.prototype.loadsuccess=function(e,t,r){var i=r.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(e.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(d.default.KEY_LOADED,{frag:i})},u.prototype.loaderror=function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(d.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},u.prototype.loadtimeout=function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(d.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},u);function u(e){var t=a.call(this,e,d.default.KEY_LOADING)||this;return t.loaders={},t.decryptkey=null,t.decrypturl=null,t}t.default=l},"./src/loader/level-key.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./node_modules/url-toolkit/src/url-toolkit.js"),n=(Object.defineProperty(a.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=i.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),a);function a(){this.method=null,this.key=null,this.iv=null,this._uri=null}t.default=n},"./src/loader/level.js":function(e,i,t){"use strict";(function(e){Object.defineProperty(i,"__esModule",{value:!0});var t=(Object.defineProperty(r.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!e.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),r);function r(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}i.default=t}).call(this,t("./src/polyfills/number.js").Number)},"./src/loader/m3u8-parser.js":function(e,t,i){"use strict";(function(O){Object.defineProperty(t,"__esModule",{value:!0});var r=i("./node_modules/url-toolkit/src/url-toolkit.js"),L=i("./src/loader/fragment.js"),C=i("./src/loader/level.js"),P=i("./src/loader/level-key.js"),x=i("./src/utils/attr-list.js"),I=i("./src/utils/logger.js"),l=i("./src/utils/codecs.js"),u=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,d=/#EXT-X-MEDIA:(.*)/g,M=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),j=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,B=/\.(mp4|m4s|m4v|m4a)$/i,e=(c.findGroup=function(e,t){if(!e)return null;for(var r=null,i=0;i<e.length;i++){var n=e[i];n.id===t&&(r=n)}return r},c.convertAVC1ToAVCOTI=function(e){var t,r=e.split(".");return 2<r.length?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t},c.resolve=function(e,t){return r.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},c.parseMasterPlaylist=function(e,t){var r,i=[];function n(i,n){["video","audio"].forEach(function(t){var r=i.filter(function(e){return l.isCodecType(e,t)});if(r.length){var e=r.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});n[t+"Codec"]=0<e.length?e[0]:r[0],i=i.filter(function(e){return-1===r.indexOf(e)})}}),n.unknownCodecs=i}for(u.lastIndex=0;null!=(r=u.exec(e));){var a={},o=a.attrs=new x.default(r[1]);a.url=c.resolve(r[2],t);var s=o.decimalResolution("RESOLUTION");s&&(a.width=s.width,a.height=s.height),a.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),a.name=o.NAME,n([].concat((o.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=c.convertAVC1ToAVCOTI(a.videoCodec)),i.push(a)}return i},c.parseMasterPlaylistMedia=function(e,t,r,i){var n;void 0===i&&(i=[]);var a=[],o=0;for(d.lastIndex=0;null!==(n=d.exec(e));){var s={},l=new x.default(n[1]);if(l.TYPE===r){if(s.groupId=l["GROUP-ID"],s.name=l.NAME,s.type=r,s.default="YES"===l.DEFAULT,s.autoselect="YES"===l.AUTOSELECT,s.forced="YES"===l.FORCED,l.URI&&(s.url=c.resolve(l.URI,t)),s.lang=l.LANGUAGE,s.name||(s.name=s.lang),i.length){var u=c.findGroup(i,s.groupId);s.audioCodec=u?u.codec:i[0].codec}s.id=o++,a.push(s)}}return a},c.parseLevelPlaylist=function(e,t,r,i,n){var a,o,s=0,l=0,u=new C.default(t),d=new P.default,c=0,f=null,h=new L.default,p=null;for(M.lastIndex=0;null!==(a=M.exec(e));){var g=a[1];if(g){h.duration=parseFloat(g);var m=(" "+a[2]).slice(1);h.title=m||null,h.tagList.push(m?["INF",g,m]:["INF",g])}else if(a[3]){if(O.isFinite(h.duration)){var v=s++;h.type=i,h.start=l,h.levelkey=d,h.sn=v,h.level=r,h.cc=c,h.urlId=n,h.baseurl=t,h.relurl=(" "+a[3]).slice(1),F(h,f),u.fragments.push(h),l+=(f=h).duration,h=new L.default}}else if(a[4]){if(h.rawByteRange=(" "+a[4]).slice(1),f){var _=f.byteRangeEndOffset;_&&(h.lastByteRangeEndOffset=_)}}else if(a[5])h.rawProgramDateTime=(" "+a[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]),null===p&&(p=u.fragments.length);else{for(a=a[0].match(j),o=1;o<a.length&&void 0===a[o];o++);var y=(" "+a[o+1]).slice(1),b=(" "+a[o+2]).slice(1);switch(a[o]){case"#":h.tagList.push(b?[y,b]:[y]);break;case"PLAYLIST-TYPE":u.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":s=u.startSN=parseInt(y);break;case"TARGETDURATION":u.targetduration=parseFloat(y);break;case"VERSION":u.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":c++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(y);break;case"KEY":var E=y,S=new x.default(E),w=S.enumeratedString("METHOD"),T=S.URI,k=S.hexadecimalInteger("IV");w&&(d=new P.default,T&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(w)&&(d.method=w,d.baseuri=t,d.reluri=T,d.key=null,d.iv=k));break;case"START":var A=y,D=new x.default(A).decimalFloatingPoint("TIME-OFFSET");O.isFinite(D)&&(u.startTimeOffset=D);break;case"MAP":var R=new x.default(y);h.relurl=R.URI,h.rawByteRange=R.BYTERANGE,h.baseurl=t,h.level=r,h.type=i,h.sn="initSegment",u.initSegment=h,(h=new L.default).rawProgramDateTime=u.initSegment.rawProgramDateTime;break;default:I.logger.warn("line parsed but not handled: "+a)}}}return(h=f)&&!h.relurl&&(u.fragments.pop(),l-=h.duration),u.totalduration=l,u.averagetargetduration=l/u.fragments.length,u.endSN=s-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=c,!u.initSegment&&u.fragments.length&&u.fragments.every(function(e){return B.test(e.relurl)})&&(I.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(h=new L.default).relurl=u.fragments[0].relurl,h.baseurl=t,h.level=r,h.type=i,h.sn="initSegment",u.initSegment=h,u.needSidxRanges=!0),p&&function(e,t){for(var r=e[t],i=t-1;0<=i;i--){var n=e[i];n.programDateTime=r.programDateTime-1e3*n.duration,r=n}}(u.fragments,p),u},c);function c(){}function F(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),O.isFinite(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}t.default=e}).call(this,i("./src/polyfills/number.js").Number)},"./src/loader/playlist-loader.js":function(e,s,u){"use strict";(function(g){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(s,"__esModule",{value:!0});var r,m=u("./src/events.js"),t=u("./src/event-handler.js"),l=u("./src/errors.js"),f=u("./src/utils/logger.js"),a=u("./src/demux/mp4demuxer.js"),v=u("./src/loader/m3u8-parser.js"),_=window.performance,y={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},n={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},o=(r=t.default,e(b,r),Object.defineProperty(b,"ContextType",{get:function(){return y},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LevelType",{get:function(){return n},enumerable:!0,configurable:!0}),b.canHaveQualityLevels=function(e){return e!==y.AUDIO_TRACK&&e!==y.SUBTITLE_TRACK},b.mapContextToLevelType=function(e){switch(e.type){case y.AUDIO_TRACK:return n.AUDIO;case y.SUBTITLE_TRACK:return n.SUBTITLE;default:return n.MAIN}},b.getResponseUrl=function(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r},b.prototype.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,n=new(r||i)(t);return e.loader=n,this.loaders[e.type]=n},b.prototype.getInternalLoader=function(e){return this.loaders[e.type]},b.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},b.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},b.prototype.destroy=function(){this.destroyInternalLoaders(),r.prototype.destroy.call(this)},b.prototype.onManifestLoading=function(e){this.load(e.url,{type:y.MANIFEST,level:0,id:null})},b.prototype.onLevelLoading=function(e){this.load(e.url,{type:y.LEVEL,level:e.level,id:e.id})},b.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:y.AUDIO_TRACK,level:null,id:e.id})},b.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:y.SUBTITLE_TRACK,level:null,id:e.id})},b.prototype.load=function(e,t){var r=this.hls.config;f.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var i,n,a,o,s=this.getInternalLoader(t);if(s){var l=s.context;if(l&&l.url===e)return f.logger.trace("playlist request ongoing"),!1;f.logger.warn("aborting previous loader for type: "+t.type),s.abort()}switch(t.type){case y.MANIFEST:i=r.manifestLoadingMaxRetry,n=r.manifestLoadingTimeOut,a=r.manifestLoadingRetryDelay,o=r.manifestLoadingMaxRetryTimeout;break;case y.LEVEL:i=0,n=r.levelLoadingTimeOut;break;default:i=r.levelLoadingMaxRetry,n=r.levelLoadingTimeOut,a=r.levelLoadingRetryDelay,o=r.levelLoadingMaxRetryTimeout}s=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var u={timeout:n,maxRetry:i,retryDelay:a,maxRetryDelay:o},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return f.logger.debug("Calling internal loader delegate for URL: "+e),s.load(t,u,d),!0},b.prototype.loadsuccess=function(e,t,r,i){if(void 0===i&&(i=null),r.isSidxRequest)return this._handleSidxRequest(e,r),void this._handlePlaylistLoaded(e,t,r,i);this.resetInternalLoader(r.type);var n=e.data;t.tload=_.now(),0===n.indexOf("#EXTM3U")?0<n.indexOf("#EXTINF:")||0<n.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(e,t,r,i):this._handleMasterPlaylist(e,t,r,i):this._handleManifestParsingError(e,r,"no EXTM3U delimiter",i)},b.prototype.loaderror=function(e,t,r){void 0===r&&(r=null),this._handleNetworkError(t,r,!1,e)},b.prototype.loadtimeout=function(e,t,r){void 0===r&&(r=null),this._handleNetworkError(t,r,!0)},b.prototype._handleMasterPlaylist=function(e,t,r,i){var n=this.hls,a=e.data,o=b.getResponseUrl(e,r),s=v.default.parseMasterPlaylist(a,o);if(s.length){var l=s.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),u=v.default.parseMasterPlaylistMedia(a,o,"AUDIO",l),d=v.default.parseMasterPlaylistMedia(a,o,"SUBTITLES");if(u.length){var c=!1;u.forEach(function(e){e.url||(c=!0)}),!1===c&&s[0].audioCodec&&!s[0].attrs.AUDIO&&(f.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main"}))}n.trigger(m.default.MANIFEST_LOADED,{levels:s,audioTracks:u,subtitles:d,url:o,stats:t,networkDetails:i})}else this._handleManifestParsingError(e,r,"no level found in manifest",i)},b.prototype._handleTrackOrLevelPlaylist=function(e,t,r,i){var n=this.hls,a=r.id,o=r.level,s=r.type,l=b.getResponseUrl(e,r),u=g.isFinite(a)?a:0,d=g.isFinite(o)?o:u,c=b.mapContextToLevelType(r),f=v.default.parseLevelPlaylist(e.data,l,d,c,u);if(f.tload=t.tload,s===y.MANIFEST){var h={url:l,details:f};n.trigger(m.default.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:l,stats:t,networkDetails:i})}if(t.tparsed=_.now(),f.needSidxRanges){var p=f.initSegment.url;this.load(p,{isSidxRequest:!0,type:s,level:o,levelDetails:f,id:a,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else r.levelDetails=f,this._handlePlaylistLoaded(e,t,r,i)},b.prototype._handleSidxRequest=function(e,t){var r=a.default.parseSegmentIndex(new Uint8Array(e.data));if(r){var i=r.references,n=t.levelDetails;i.forEach(function(e,t){var r=e.info,i=n.fragments[t];0===i.byteRange.length&&(i.rawByteRange=String(1+r.end-r.start)+"@"+String(r.start))}),n.initSegment.rawByteRange=String(r.moovEndOffset)+"@0"}},b.prototype._handleManifestParsingError=function(e,t,r,i){this.hls.trigger(m.default.ERROR,{type:l.ErrorTypes.NETWORK_ERROR,details:l.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:r,networkDetails:i})},b.prototype._handleNetworkError=function(e,t,r,i){var n,a;void 0===r&&(r=!1),void 0===i&&(i=null),f.logger.info("A network error occured while loading a "+e.type+"-type playlist");var o=this.getInternalLoader(e);switch(e.type){case y.MANIFEST:n=r?l.ErrorDetails.MANIFEST_LOAD_TIMEOUT:l.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case y.LEVEL:n=r?l.ErrorDetails.LEVEL_LOAD_TIMEOUT:l.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case y.AUDIO_TRACK:n=r?l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}o&&(o.abort(),this.resetInternalLoader(e.type));var s={type:l.ErrorTypes.NETWORK_ERROR,details:n,fatal:a,url:o.url,loader:o,context:e,networkDetails:t};i&&(s.response=i),this.hls.trigger(m.default.ERROR,s)},b.prototype._handlePlaylistLoaded=function(e,t,r,i){var n=r.type,a=r.level,o=r.id,s=r.levelDetails;if(s.targetduration)if(b.canHaveQualityLevels(r.type))this.hls.trigger(m.default.LEVEL_LOADED,{details:s,level:a||0,id:o||0,stats:t,networkDetails:i});else switch(n){case y.AUDIO_TRACK:this.hls.trigger(m.default.AUDIO_TRACK_LOADED,{details:s,id:o,stats:t,networkDetails:i});break;case y.SUBTITLE_TRACK:this.hls.trigger(m.default.SUBTITLE_TRACK_LOADED,{details:s,id:o,stats:t,networkDetails:i})}else this._handleManifestParsingError(e,r,"invalid target duration",i)},b);function b(e){var t=r.call(this,e,m.default.MANIFEST_LOADING,m.default.LEVEL_LOADING,m.default.AUDIO_TRACK_LOADING,m.default.SUBTITLE_TRACK_LOADING)||this;return t.loaders={},t}s.default=o}).call(this,u("./src/polyfills/number.js").Number)},"./src/observer.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r("./node_modules/eventemitter3/index.js"),s=(a=o.EventEmitter,n(l,a),l.prototype.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(t))},l);function l(){return null!==a&&a.apply(this,arguments)||this}t.Observer=s},"./src/polyfills/number.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./src/utils/get-self-scope.js").getSelfScope().Number;(t.Number=i).isFinite=i.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},"./src/remux/aac-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},n);function n(){}t.default=i},"./src/remux/mp4-generator.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=Math.pow(2,32)-1,i=(f.init=function(){var e;for(e in f.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})f.types.hasOwnProperty(e)&&(f.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);f.HDLR_TYPES={video:t,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);f.STTS=f.STSC=f.STCO=n,f.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),f.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),f.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),f.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),s=new Uint8Array([0,0,0,1]);f.FTYP=f.box(f.types.ftyp,a,s,a,o),f.DINF=f.box(f.types.dinf,f.box(f.types.dref,i))},f.box=function(e){for(var t,r=Array.prototype.slice.call(arguments,1),i=8,n=r.length,a=n;n--;)i+=r[n].byteLength;for((t=new Uint8Array(i))[0]=i>>24&255,t[1]=i>>16&255,t[2]=i>>8&255,t[3]=255&i,t.set(e,4),n=0,i=8;n<a;n++)t.set(r[n],i),i+=r[n].byteLength;return t},f.hdlr=function(e){return f.box(f.types.hdlr,f.HDLR_TYPES[e])},f.mdat=function(e){return f.box(f.types.mdat,e)},f.mdhd=function(e,t){t*=e;var r=Math.floor(t/(1+s)),i=Math.floor(t%(1+s));return f.box(f.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},f.mdia=function(e){return f.box(f.types.mdia,f.mdhd(e.timescale,e.duration),f.hdlr(e.type),f.minf(e))},f.mfhd=function(e){return f.box(f.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},f.minf=function(e){return"audio"===e.type?f.box(f.types.minf,f.box(f.types.smhd,f.SMHD),f.DINF,f.stbl(e)):f.box(f.types.minf,f.box(f.types.vmhd,f.VMHD),f.DINF,f.stbl(e))},f.moof=function(e,t,r){return f.box(f.types.moof,f.mfhd(e),f.traf(r,t))},f.moov=function(e){for(var t=e.length,r=[];t--;)r[t]=f.trak(e[t]);return f.box.apply(null,[f.types.moov,f.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(f.mvex(e)))},f.mvex=function(e){for(var t=e.length,r=[];t--;)r[t]=f.trex(e[t]);return f.box.apply(null,[f.types.mvex].concat(r))},f.mvhd=function(e,t){t*=e;var r=Math.floor(t/(1+s)),i=Math.floor(t%(1+s)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return f.box(f.types.mvhd,n)},f.sdtp=function(e){var t,r,i=e.samples||[],n=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)t=i[r].flags,n[r+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return f.box(f.types.sdtp,n)},f.stbl=function(e){return f.box(f.types.stbl,f.stsd(e),f.box(f.types.stts,f.STTS),f.box(f.types.stsc,f.STSC),f.box(f.types.stsz,f.STSZ),f.box(f.types.stco,f.STCO))},f.avc1=function(e){var t,r,i,n=[],a=[];for(t=0;t<e.sps.length;t++)i=(r=e.sps[t]).byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)i=(r=e.pps[t]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));var o=f.box(f.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(a))),s=e.width,l=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return f.box(f.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,f.box(f.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),f.box(f.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},f.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},f.mp4a=function(e){var t=e.samplerate;return f.box(f.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),f.box(f.types.esds,f.esds(e)))},f.mp3=function(e){var t=e.samplerate;return f.box(f.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))},f.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?f.box(f.types.stsd,f.STSD,f.mp4a(e)):f.box(f.types.stsd,f.STSD,f.mp3(e)):f.box(f.types.stsd,f.STSD,f.avc1(e))},f.tkhd=function(e){var t=e.id,r=e.duration*e.timescale,i=e.width,n=e.height,a=Math.floor(r/(1+s)),o=Math.floor(r%(1+s));return f.box(f.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,n>>8&255,255&n,0,0]))},f.traf=function(e,t){var r=f.sdtp(e),i=e.id,n=Math.floor(t/(1+s)),a=Math.floor(t%(1+s));return f.box(f.types.traf,f.box(f.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),f.box(f.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a])),f.trun(e,r.length+16+20+8+16+8+8),r)},f.trak=function(e){return e.duration=e.duration||4294967295,f.box(f.types.trak,f.tkhd(e),f.mdia(e))},f.trex=function(e){var t=e.id;return f.box(f.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},f.trun=function(e,t){var r,i,n,a,o,s,l=e.samples||[],u=l.length,d=12+16*u,c=new Uint8Array(d);for(t+=8+d,c.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),r=0;r<u;r++)n=(i=l[r]).duration,a=i.size,o=i.flags,s=i.cts,c.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,s>>>24&255,s>>>16&255,s>>>8&255,255&s],12+16*r);return f.box(f.types.trun,c)},f.initSegment=function(e){f.types||f.init();var t,r=f.moov(e);return(t=new Uint8Array(f.FTYP.byteLength+r.byteLength)).set(f.FTYP),t.set(r,f.FTYP.byteLength),t},f);function f(){}t.default=i},"./src/remux/mp4-remuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var H=r("./src/remux/aac-helper.js"),X=r("./src/remux/mp4-generator.js"),J=r("./src/events.js"),Q=r("./src/errors.js"),Z=r("./src/utils/logger.js"),i=(n.prototype.destroy=function(){},n.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},n.prototype.resetInitSegment=function(){this.ISGenerated=!1},n.prototype.remux=function(e,t,r,i,n,a,o){if(this.ISGenerated||this.generateIS(e,t,n),this.ISGenerated){var s=e.samples.length,l=t.samples.length,u=n,d=n;if(s&&l){var c=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;u+=Math.max(0,c),d+=Math.max(0,-c)}if(s){e.timescale||(Z.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,n));var f=this.remuxAudio(e,u,a,o);if(l){var h=void 0;f&&(h=f.endPTS-f.startPTS),t.timescale||(Z.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,n)),this.remuxVideo(t,d,a,h,o)}}else if(l){var p=this.remuxVideo(t,d,a,0,o);p&&e.codec&&this.remuxEmptyAudio(e,u,a,p)}}r.samples.length&&this.remuxID3(r,n),i.samples.length&&this.remuxText(i,n),this.observer.trigger(J.default.FRAG_PARSED)},n.prototype.generateIS=function(e,t,r){var i,n,a=this.observer,o=e.samples,s=t.samples,l=this.typeSupported,u="audio/mp4",d={},c={tracks:d},f=void 0===this._initPTS;if(f&&(i=n=1/0),e.config&&o.length&&(e.timescale=e.samplerate,Z.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(l.mpeg?(u="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3")),d.audio={container:u,codec:e.codec,initSegment:!e.isAAC&&l.mpeg?new Uint8Array:X.default.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(i=n=o[0].pts-e.inputTimeScale*r)),t.sps&&t.pps&&s.length){var h=t.inputTimeScale;t.timescale=h,d.video={container:"video/mp4",codec:t.codec,initSegment:X.default.initSegment([t]),metadata:{width:t.width,height:t.height}},f&&(i=Math.min(i,s[0].pts-h*r),n=Math.min(n,s[0].dts-h*r),this.observer.trigger(J.default.INIT_PTS_FOUND,{initPTS:i}))}Object.keys(d).length?(a.trigger(J.default.FRAG_PARSING_INIT_SEGMENT,c),this.ISGenerated=!0,f&&(this._initPTS=i,this._initDTS=n)):a.trigger(J.default.ERROR,{type:Q.ErrorTypes.MEDIA_ERROR,details:Q.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},n.prototype.remuxVideo=function(e,t,r,i,n){var a,o,s,l,u,d,c,f=8,h=e.timescale,p=e.samples,g=[],m=p.length,v=this._PTSNormalize,_=this._initPTS,y=this.nextAvcDts,b=this.isSafari;if(0!==m){b&&(r|=p.length&&y&&(n&&Math.abs(t-y/h)<.1||Math.abs(p[0].pts-y-_)<h/5)),r||(y=t*h),p.forEach(function(e){e.pts=v(e.pts-_,y),e.dts=v(e.dts-_,y)}),p.sort(function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i||e.id-t.id});var E=p.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(E<0){Z.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(E/90)+" ms to overcome this issue");for(var S=0;S<p.length;S++)p[S].dts+=E}var w=p[0];u=Math.max(w.dts,0),l=Math.max(w.pts,0);var T=Math.round((u-y)/90);r&&T&&(1<T?Z.logger.log("AVC:"+T+" ms hole between fragments detected,filling it"):T<-1&&Z.logger.log("AVC:"+-T+" ms overlapping between fragments detected"),u=y,p[0].dts=u,l=Math.max(l-T,y),p[0].pts=l,Z.logger.log("Video/PTS/DTS adjusted: "+Math.round(l/90)+"/"+Math.round(u/90)+",delta:"+T+" ms")),w=p[p.length-1],c=Math.max(w.dts,0),d=Math.max(w.pts,0,c),b&&(a=Math.round((c-u)/(p.length-1)));var k=0,A=0;for(S=0;S<m;S++){for(var D=p[S],R=D.units,O=R.length,L=0,C=0;C<O;C++)L+=R[C].data.length;A+=L,k+=O,D.length=L,D.dts=b?u+S*a:Math.max(D.dts,u),D.pts=Math.max(D.pts,D.dts)}var P=A+4*k+8;try{o=new Uint8Array(P)}catch(e){return void this.observer.trigger(J.default.ERROR,{type:Q.ErrorTypes.MUX_ERROR,details:Q.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:P,reason:"fail allocating video mdat "+P})}var x=new DataView(o.buffer);for(x.setUint32(0,P),o.set(X.default.types.mdat,4),S=0;S<m;S++){var I=p[S],M=I.units,j=0,B=void 0;for(C=0,O=M.length;C<O;C++){var F=M[C],N=F.data,U=F.data.byteLength;x.setUint32(f,U),f+=4,o.set(N,f),f+=U,j+=4+U}if(b)B=Math.max(0,a*Math.round((I.pts-I.dts)/a));else{if(S<m-1)a=p[S+1].dts-I.dts;else{var G=this.config,V=I.dts-p[0<S?S-1:S].dts;if(G.stretchShortVideoTrack){var H=G.maxBufferHole,q=Math.floor(H*h),K=(i?l+i*h:this.nextAudioPts)-I.pts;q<K?((a=K-V)<0&&(a=V),Z.logger.log("It is approximately "+K/90+" ms to the next segment; using duration "+a/90+" ms for the last video frame.")):a=V}else a=V}B=Math.round(I.pts-I.dts)}g.push({size:j,duration:a,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:I.key?2:1,isNonSync:I.key?0:1}})}this.nextAvcDts=c+a;var z=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,g.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")){var W=g[0].flags;W.dependsOn=2,W.isNonSync=0}e.samples=g,s=X.default.moof(e.sequenceNumber++,u,e),e.samples=[];var Y={data1:s,data2:o,startPTS:l/h,endPTS:(d+a)/h,startDTS:u/h,endDTS:this.nextAvcDts/h,type:"video",hasAudio:!1,hasVideo:!0,nb:g.length,dropped:z};return this.observer.trigger(J.default.FRAG_PARSING_DATA,Y),Y}},n.prototype.remuxAudio=function(e,t,r,i){var n,a,o,s,l,u,d,c=e.inputTimeScale,f=e.timescale,h=c/f,p=(e.isAAC?1024:1152)*h,g=this._PTSNormalize,m=this._initPTS,v=!e.isAAC&&this.typeSupported.mpeg,_=e.samples,y=[],b=this.nextAudioPts;if(r|=_.length&&b&&(i&&Math.abs(t-b/c)<.1||Math.abs(_[0].pts-b-m)<20*p),_.forEach(function(e){e.pts=e.dts=g(e.pts-m,t*c)}),0!==(_=_.filter(function(e){return 0<=e.pts})).length){if(r||(b=i?t*c:_[0].pts),e.isAAC)for(var E=this.config.maxAudioFramesDrift,S=0,w=b;S<_.length;){var T,k=_[S];T=(x=k.pts)-w;var A=Math.abs(1e3*T/c);if(T<=-E*p)Z.logger.warn("Dropping 1 audio frame @ "+(w/c).toFixed(3)+"s due to "+Math.round(A)+" ms overlap."),_.splice(S,1),e.len-=k.unit.length;else if(E*p<=T&&A<1e4&&w){var D=Math.round(T/p);Z.logger.warn("Injecting "+D+" audio frame @ "+(w/c).toFixed(3)+"s due to "+Math.round(1e3*T/c)+" ms gap.");for(var R=0;R<D;R++){var O=Math.max(w,0);(o=H.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(Z.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),o=k.unit.subarray()),_.splice(S,0,{unit:o,pts:O,dts:O}),e.len+=o.length,w+=p,S++}k.pts=k.dts=w,w+=p,S++}else Math.abs(T),k.pts=k.dts=w,w+=p,S++}R=0;for(var L=_.length;R<L;R++){var C=_[R],P=C.unit,x=C.pts;if(void 0!==d)a.duration=Math.round((x-d)/h);else{var I=Math.round(1e3*(x-b)/c),M=0;if(r&&e.isAAC&&I){if(0<I&&I<1e4)M=Math.round((x-b)/p),Z.logger.log(I+" ms hole between AAC samples detected,filling it"),0<M&&(o=(o=H.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||P.subarray(),e.len+=M*o.length);else if(I<-12){Z.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(b/c).toFixed(3)+"s/"+(x/c).toFixed(3)+"s/"+-I+"ms"),e.len-=P.byteLength;continue}x=b}if(u=x,!(0<e.len))return;var j=v?e.len:e.len+8;n=v?0:8;try{s=new Uint8Array(j)}catch(e){return void this.observer.trigger(J.default.ERROR,{type:Q.ErrorTypes.MUX_ERROR,details:Q.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:j,reason:"fail allocating audio mdat "+j})}for(v||(new DataView(s.buffer).setUint32(0,j),s.set(X.default.types.mdat,4)),S=0;S<M;S++)(o=H.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(Z.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),o=P.subarray()),s.set(o,n),n+=o.byteLength,a={size:o.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(a)}s.set(P,n);var B=P.byteLength;n+=B,a={size:B,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(a),d=x}var F=0,N=y.length;if(2<=N&&(F=y[N-2].duration,a.duration=F),N){this.nextAudioPts=b=d+h*F,e.len=0,e.samples=y,l=v?new Uint8Array:X.default.moof(e.sequenceNumber++,u/h,e),e.samples=[];var U=u/c,G=b/c,V={data1:l,data2:s,startPTS:U,endPTS:G,startDTS:U,endDTS:G,type:"audio",hasAudio:!0,hasVideo:!1,nb:N};return this.observer.trigger(J.default.FRAG_PARSING_DATA,V),V}return null}},n.prototype.remuxEmptyAudio=function(e,t,r,i){var n=e.inputTimeScale,a=n/(e.samplerate?e.samplerate:n),o=this.nextAudioPts,s=(void 0!==o?o:i.startDTS*n)+this._initDTS,l=i.endDTS*n+this._initDTS,u=1024*a,d=Math.ceil((l-s)/u),c=H.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(Z.logger.warn("remux empty Audio"),c){for(var f=[],h=0;h<d;h++){var p=s+h*u;f.push({unit:c,pts:p,dts:p}),e.len+=c.length}e.samples=f,this.remuxAudio(e,t,r)}else Z.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},n.prototype.remuxID3=function(e){var t,r=e.samples.length,i=e.inputTimeScale,n=this._initPTS,a=this._initDTS;if(r){for(var o=0;o<r;o++)(t=e.samples[o]).pts=(t.pts-n)/i,t.dts=(t.dts-a)/i;this.observer.trigger(J.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},n.prototype.remuxText=function(e){e.samples.sort(function(e,t){return e.pts-t.pts});var t,r=e.samples.length,i=e.inputTimeScale,n=this._initPTS;if(r){for(var a=0;a<r;a++)(t=e.samples[a]).pts=(t.pts-n)/i;this.observer.trigger(J.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},n.prototype._PTSNormalize=function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=r;return e},n);function n(e,t,r,i){this.observer=e,this.config=t,this.typeSupported=r;var n=navigator.userAgent;this.isSafari=i&&-1<i.indexOf("Apple")&&n&&!n.match("CriOS"),this.ISGenerated=!1}t.default=i},"./src/remux/passthrough-remuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=r("./src/events.js"),i=(n.prototype.destroy=function(){},n.prototype.resetTimeStamp=function(){},n.prototype.resetInitSegment=function(){},n.prototype.remux=function(e,t,r,i,n,a,o,s){var l=this.observer,u="";e&&(u+="audio"),t&&(u+="video"),l.trigger(d.default.FRAG_PARSING_DATA,{data1:s,startPTS:n,startDTS:n,type:u,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),l.trigger(d.default.FRAG_PARSED)},n);function n(e){this.observer=e}t.default=i},"./src/task-loop.js":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r("./src/event-handler.js"),s=(a=o.default,n(l,a),l.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},l.prototype.hasInterval=function(){return!!this._tickInterval},l.prototype.hasNextTick=function(){return!!this._tickTimer},l.prototype.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)},l.prototype.clearInterval=function(){return!(!this._tickInterval||(clearInterval(this._tickInterval),this._tickInterval=null))},l.prototype.clearNextTick=function(){return!(!this._tickTimer||(clearTimeout(this._tickTimer),this._tickTimer=null))},l.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},l.prototype.doTick=function(){},l);function l(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=a.apply(this,[e].concat(t))||this;return i._tickInterval=null,i._tickTimer=null,i._tickCallCount=0,i._boundTick=i.tick.bind(i),i}t.default=s},"./src/utils/attr-list.js":function(e,t,r){"use strict";(function(r){Object.defineProperty(t,"__esModule",{value:!0});var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,e=(a.prototype.decimalInteger=function(e){var t=parseInt(this[e],10);return t>r.MAX_SAFE_INTEGER?1/0:t},a.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},a.prototype.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>r.MAX_SAFE_INTEGER?1/0:t},a.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},a.prototype.enumeratedString=function(e){return this[e]},a.prototype.decimalResolution=function(e){var t=i.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},a.parseAttrList=function(e){var t,r={};for(n.lastIndex=0;null!==(t=n.exec(e));){var i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r},a);function a(e){for(var t in"string"==typeof e&&(e=a.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}t.default=e}).call(this,r("./src/polyfills/number.js").Number)},"./src/utils/binary-search.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={search:function(e,t){for(var r=0,i=e.length-1,n=null,a=null;r<=i;){var o=t(a=e[n=(r+i)/2|0]);if(0<o)r=n+1;else{if(!(o<0))return a;i=n-1}}return null}}},"./src/utils/buffer-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.isBuffered=function(e,t){try{if(e)for(var r=e.buffered,i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0}catch(e){}return!1},n.bufferInfo=function(e,t,r){try{if(e){var i=e.buffered,n=[],a=void 0;for(a=0;a<i.length;a++)n.push({start:i.start(a),end:i.end(a)});return this.bufferedInfo(n,t,r)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},n.bufferedInfo=function(e,t,r){var i,n,a,o,s,l=[];for(e.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end}),s=0;s<e.length;s++){var u=l.length;if(u){var d=l[u-1].end;e[s].start-d<r?e[s].end>d&&(l[u-1].end=e[s].end):l.push(e[s])}else l.push(e[s])}for(i=s=0,n=a=t;s<l.length;s++){var c=l[s].start,f=l[s].end;if(c<=t+r&&t<f)n=c,i=(a=f)-t;else if(t+r<c){o=c;break}}return{len:i,start:n,end:a,nextStart:o}},n);function n(){}t.BufferHelper=i},"./src/utils/cea-608-parser.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function s(e){var t=e;return i.hasOwnProperty(e)&&(t=i[e]),String.fromCharCode(t)}function l(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t}var i={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},o={17:2,18:4,21:6,22:8,23:10,19:13,20:15},u={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},d={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],f={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e];this.verboseLevel}},h=(n.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.prototype.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}},n.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},n.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},n.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},n.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},n);function n(e,t,r,i,n){this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=n||!1}var p=(g.prototype.reset=function(){this.uchar=" ",this.penState.reset()},g.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},g.prototype.setPenState=function(e){this.penState.copy(e)},g.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},g.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},g.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},g);function g(e,t,r,i,n,a){this.uchar=e||" ",this.penState=new h(t,r,i,n,a)}var m=(v.prototype.equals=function(e){for(var t=!0,r=0;r<100;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},v.prototype.copy=function(e){for(var t=0;t<100;t++)this.chars[t].copy(e.chars[t])},v.prototype.isEmpty=function(){for(var e=!0,t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},v.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(f.log("ERROR","Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(f.log("ERROR","Too large cursor position "+this.pos),this.pos=100)},v.prototype.moveCursor=function(e){var t=this.pos+e;if(1<e)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},v.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},v.prototype.insertChar=function(e){144<=e&&this.backSpace();var t=s(e);100<=this.pos?f.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},v.prototype.clearFromPos=function(e){var t;for(t=e;t<100;t++)this.chars[t].reset()},v.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},v.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},v.prototype.getTextString=function(){for(var e=[],t=!0,r=0;r<100;r++){var i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")},v.prototype.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},v);function v(){this.chars=[];for(var e=0;e<100;e++)this.chars.push(new p);this.pos=0,this.currPenState=new h}var _=(y.prototype.reset=function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14},y.prototype.equals=function(e){for(var t=!0,r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},y.prototype.copy=function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])},y.prototype.isEmpty=function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},y.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},y.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},y.prototype.insertChar=function(e){this.rows[this.currRow].insertChar(e)},y.prototype.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},y.prototype.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},y.prototype.setCursor=function(e){f.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},y.prototype.setPAC=function(e){f.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<15;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var a=n.rows[i].cueStartTime;if(a&&a<f.time)for(r=0;r<this.nrRollUpRows;r++)this.rows[t-this.nrRollUpRows+r+1].copy(n.rows[i+r])}}this.currRow=t;var o=this.rows[this.currRow];if(null!==e.indent){var s=e.indent,l=Math.max(s-1,0);o.setCursor(e.indent),e.color=o.chars[l].penState.foreground}var u={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(u)},y.prototype.setBkgData=function(e){f.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},y.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},y.prototype.rollUp=function(){if(null!==this.nrRollUpRows){f.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),f.log("INFO","Rolling up")}else f.log("DEBUG","roll_up but nrRollUpRows not set yet")},y.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],r="",i=-1,n=0;n<15;n++){var a=this.rows[n].getTextString();a&&(i=n+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return 0<t.length&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},y.prototype.getTextAndFormat=function(){return this.rows},y);function y(){this.rows=[];for(var e=0;e<15;e++)this.rows.push(new m);this.currRow=14,this.nrRollUpRows=null,this.reset()}var b=(E.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},E.prototype.getHandler=function(){return this.outputFilter},E.prototype.setHandler=function(e){this.outputFilter=e},E.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},E.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},E.prototype.setMode=function(e){e!==this.mode&&(this.mode=e,f.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},E.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";f.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(f.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},E.prototype.ccRCL=function(){f.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},E.prototype.ccBS=function(){f.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},E.prototype.ccAOF=function(){},E.prototype.ccAON=function(){},E.prototype.ccDER=function(){f.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},E.prototype.ccRU=function(e){f.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},E.prototype.ccFON=function(){f.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},E.prototype.ccRDC=function(){f.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},E.prototype.ccTR=function(){f.log("INFO","TR"),this.setMode("MODE_TEXT")},E.prototype.ccRTD=function(){f.log("INFO","RTD"),this.setMode("MODE_TEXT")},E.prototype.ccEDM=function(){f.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},E.prototype.ccCR=function(){f.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},E.prototype.ccENM=function(){f.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},E.prototype.ccEOC=function(){if(f.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,f.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},E.prototype.ccTO=function(e){f.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},E.prototype.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=46<=e,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}f.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},E.prototype.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=f.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},E.prototype.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},E);function E(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new _,this.nonDisplayedMemory=new _,this.lastOutputScreen=new _,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}var S=(w.prototype.getHandler=function(e){return this.channels[e].getHandler()},w.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},w.prototype.addData=function(e,t){var r,i,n,a=!1;this.lastTime=e,f.setTime(e);for(var o=0;o<t.length;o+=2)i=127&t[o],n=127&t[o+1],0!=i||0!=n?(f.log("DATA","["+l([t[o],t[o+1]])+"] -> ("+l([i,n])+")"),(r=(r=(r=(r=this.parseCmd(i,n))||this.parseMidrow(i,n))||this.parsePAC(i,n))||this.parseBackgroundAttributes(i,n))||(a=this.parseChars(i,n))&&(this.currChNr&&0<=this.currChNr?this.channels[this.currChNr-1].insertChars(a):f.log("WARNING","No channel found yet. TEXT-MODE?")),r?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,f.log("WARNING","Couldn't parse cleaned data "+l([i,n])+" orig: "+l([t[o],t[o+1]])))):this.dataCounters.padding+=2},w.prototype.parseCmd=function(e,t){var r=null;if(!((20===e||28===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,f.log("DEBUG","Repeated command ("+l([e,t])+") is dropped"),!0;r=20===e||23===e?1:2;var i=this.channels[r-1];return 20===e||28===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},w.prototype.parseMidrow=function(e,t){var r=null;return(17===e||25===e)&&32<=t&&t<=47&&((r=17===e?1:2)!==this.currChNr?(f.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[r-1].ccMIDROW(t),f.log("DEBUG","MIDROW ("+l([e,t])+")"),!0))},w.prototype.parsePAC=function(e,t){var r,i=null;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,!(this.lastCmdB=null);r=e<=23?1:2,i=64<=t&&t<=95?1==r?a[e]:u[e]:1==r?o[e]:d[e];var n=this.interpretPAC(i,t);return this.channels[r-1].setPAC(n),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},w.prototype.interpretPAC=function(e,t){var r=t,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=95<t?t-96:t-64,i.underline=1==(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},w.prototype.parseChars=function(e,t){var r=null,i=null,n=null;if(17<=(n=25<=e?(r=2,e-8):(r=1,e))&&n<=19){var a=t;a=17===n?t+80:18===n?t+112:t+144,f.log("INFO","Special char '"+s(a)+"' in channel "+r),i=[a]}else 32<=e&&e<=127&&(i=0===t?[e]:[e,t]);if(i){var o=l(i);f.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return i},w.prototype.parseBackgroundAttributes=function(e,t){var r,i,n;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(r={},16===e||24===e?(i=Math.floor((t-32)/2),r.background=c[i],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),n=e<24?1:2,this.channels[n-1].setBkgData(r),this.lastCmdA=null,!(this.lastCmdB=null))},w.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},w.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},w);function w(e,t,r){this.field=e||1,this.outputs=[t,r],this.channels=[new b(1,t),new b(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}t.default=S},"./src/utils/codecs.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};t.isCodecType=function(e,t){var r=i[t];return!!r&&!0===r[e.slice(0,4)]},t.isCodecSupportedInMp4=function(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=r("./src/utils/vttparser.js");t.newCue=function(e,t,r,i){for(var n,a,o,s,l,u=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(o=!0,s=0,l="",!(n=i.rows[d]).isEmpty()){for(var c=0;c<n.chars.length;c++)n.chars[c].uchar.match(/\s/)&&o?s++:(l+=n.chars[c].uchar,o=!1);(n.cueStartTime=t)===r&&(r+=1e-4),a=new u(t,r,f.fixLineBreaks(l.trim())),16<=s?s--:s++,navigator.userAgent.match(/Firefox\//)?a.line=d+1:a.line=7<d?d-2:d+1,a.align="left",a.position=Math.max(0,Math.min(100,s/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}}},"./src/utils/discontinuities.js":function(e,t,c){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0});var r=c("./src/utils/binary-search.js"),a=c("./src/utils/logger.js");function o(e,t){for(var r=null,i=0;i<e.length;i+=1){var n=e[i];if(n&&n.cc===t){r=n;break}}return r}function s(e,t,r){var i=!1;return t&&t.details&&r&&(r.endCC>r.startCC||e&&e.cc<r.startCC)&&(i=!0),i}function l(e,t){var r=e.fragments,i=t.fragments;if(i.length&&r.length){var n=o(r,i[0].cc);if(n&&(!n||n.startPTS))return n;a.logger.log("No frag in previous level to align on")}else a.logger.log("No fragments to align")}function u(r,e){e.fragments.forEach(function(e){if(e){var t=e.start+r;e.start=e.startPTS=t,e.endPTS=t+e.duration}}),e.PTSKnown=!0}function i(e,t,r){if(s(e,r,t)){var i=l(r.details,t);i&&(a.logger.log("Adjusting PTS using last level due to CC increase within current level"),u(i.start,t))}}function d(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var r=t.fragments[0].programDateTime,i=(e.fragments[0].programDateTime-r)/1e3+t.fragments[0].start;n.isFinite(i)&&(a.logger.log("adjusting PTS using programDateTime delta, sliding:"+i.toFixed(3)),u(i,e))}}t.findFirstFragWithCC=o,t.findFragWithCC=function(e,t){return r.default.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})},t.shouldAlignOnDiscontinuities=s,t.findDiscontinuousReferenceFrag=l,t.adjustPts=u,t.alignStream=function(e,t,r){i(e,r,t),!r.PTSKnown&&t&&d(r,t.details)},t.alignDiscontinuities=i,t.alignPDT=d}).call(this,c("./src/polyfills/number.js").Number)},"./src/utils/ewma-bandwidth-estimator.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/ewma.js"),i=(a.prototype.sample=function(e,t){var r=8e3*t/(e=Math.max(e,this.minDelayMs_)),i=e/1e3;this.fast_.sample(i,r),this.slow_.sample(i,r)},a.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},a.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.prototype.destroy=function(){},a);function a(e,t,r,i){this.hls=e,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n.default(t),this.fast_=new n.default(r)}t.default=i},"./src/utils/ewma.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},n.prototype.getTotalWeight=function(){return this.totalWeight_},n.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},n);function n(e){this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}t.default=i},"./src/utils/get-self-scope.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},"./src/utils/logger.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./src/utils/get-self-scope.js");function n(){}var a={trace:n,debug:n,log:n,warn:n,info:n,error:n},o=a;var s=i.getSelfScope();function l(r){var i=s.console[r];return i?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e[0]&&(e[0]=function(e,t){return t="["+e+"] > "+t}(r,e[0])),i.apply(s.console,e)}:n}t.enableLogs=function(e){if(!0===e||"object"==typeof e){!function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];e.forEach(function(e){o[e]=t[e]?t[e].bind(t):l(e)})}(e,"debug","log","info","warn","error");try{o.log()}catch(e){o=a}}else o=a},t.logger=o},"./src/utils/mediakeys-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;t.requestMediaKeySystemAccess=i},"./src/utils/mediasource-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},"./src/utils/output-filter.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},n.prototype.newCue=function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},n);function n(e,t){this.timelineController=e,this.trackName=t,this.startTime=null,this.endTime=null,this.screen=null}t.default=i},"./src/utils/texttrack-utils.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendAddTrackEvent=function(e,t){var r=null;try{r=new window.Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)},t.clearCurrentCues=function(e){if(e&&e.cues)for(;0<e.cues.length;)e.removeCue(e.cues[0])}},"./src/utils/time-ranges.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={toString:function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="["+e.start(i).toFixed(3)+","+e.end(i).toFixed(3)+"]";return t}}},"./src/utils/vttcue.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var b={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function E(e){return"string"==typeof e&&(!!t[e.toLowerCase()]&&e.toLowerCase())}function S(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]=r[i]}return e}function e(e,t,r){var i=this,n=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),a={};n?i=document.createElement("custom"):a.enumerable=!0,i.hasBeenReset=!1;var o="",s=!1,l=e,u=t,d=r,c=null,f="",h=!0,p="auto",g="start",m=50,v="middle",_=50,y="middle";if(Object.defineProperty(i,"id",S({},a,{get:function(){return o},set:function(e){o=""+e}})),Object.defineProperty(i,"pauseOnExit",S({},a,{get:function(){return s},set:function(e){s=!!e}})),Object.defineProperty(i,"startTime",S({},a,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"endTime",S({},a,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"text",S({},a,{get:function(){return d},set:function(e){d=""+e,this.hasBeenReset=!0}})),Object.defineProperty(i,"region",S({},a,{get:function(){return c},set:function(e){c=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"vertical",S({},a,{get:function(){return f},set:function(e){var t=function(e){return"string"==typeof e&&(!!b[e.toLowerCase()]&&e.toLowerCase())}(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"snapToLines",S({},a,{get:function(){return h},set:function(e){h=!!e,this.hasBeenReset=!0}})),Object.defineProperty(i,"line",S({},a,{get:function(){return p},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"lineAlign",S({},a,{get:function(){return g},set:function(e){var t=E(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"position",S({},a,{get:function(){return m},set:function(e){if(e<0||100<e)throw new Error("Position must be between 0 and 100.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"positionAlign",S({},a,{get:function(){return v},set:function(e){var t=E(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"size",S({},a,{get:function(){return _},set:function(e){if(e<0||100<e)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"align",S({},a,{get:function(){return y},set:function(e){var t=E(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),i.displayState=void 0,n)return i}return e.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},e}()},"./src/utils/vttparser.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function i(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}var s=r("./src/utils/vttcue.js");function n(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[]}function l(){this.values=Object.create(null)}function u(e,t,r,i){var n=i?e.split(i):[e];for(var a in n)if("string"==typeof n[a]){var o=n[a].split(r);if(2===o.length)t(o[0],o[1])}}l.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(t=parseFloat(t))&&t<=100)&&(this.set(e,t),!0)}};var d=new s.default(0,0,0),c="middle"===d.align?"middle":"center";function f(t,e,o){var r=t;function i(){var e=function(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+(0|i)/1e3}var r=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return r?r[3]?t(r[1],r[2],r[3].replace(":",""),r[4]):59<r[1]?t(r[1],r[2],0,r[4]):t(0,r[1],r[2],r[4]):null}(t);if(null===e)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function n(){t=t.replace(/^\s+/,"")}if(n(),e.startTime=i(),n(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);t=t.substr(3),n(),e.endTime=i(),n(),function(e,t){var a=new l;u(e,function(e,t){switch(e){case"region":for(var r=o.length-1;0<=r;r--)if(o[r].id===t){a.set(e,o[r].region);break}break;case"vertical":a.alt(e,t,["rl","lr"]);break;case"line":var i=t.split(","),n=i[0];a.integer(e,n),a.percent(e,n)&&a.set("snapToLines",!1),a.alt(e,n,["auto"]),2===i.length&&a.alt("lineAlign",i[1],["start",c,"end"]);break;case"position":i=t.split(","),a.percent(e,i[0]),2===i.length&&a.alt("positionAlign",i[1],["start",c,"end","line-left","line-right","auto"]);break;case"size":a.percent(e,t);break;case"align":a.alt(e,t,["start",c,"end","left","right"])}},/:/,/\s/),t.region=a.get("region",null),t.vertical=a.get("vertical","");var r=a.get("line","auto");"auto"===r&&-1===d.line&&(r=-1),t.line=r,t.lineAlign=a.get("lineAlign","start"),t.snapToLines=a.get("snapToLines",!0),t.size=a.get("size",100),t.align=a.get("align",c);var i=a.get("position","auto");"auto"===i&&50===d.position&&(i="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=i}(t,e)}function h(e){return e.replace(/<br(?: \/)?>/gi,"\n")}t.fixLineBreaks=h,n.prototype={parse:function(e){var i=this;function t(){var e=i.buffer,t=0;for(e=h(e);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,i.buffer=e.substr(t),r}e&&(i.buffer+=i.decoder.decode(e,{stream:!0}));try{var r=void 0;if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var n=(r=t()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var a=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(a?a=!1:r=t(),i.state){case"HEADER":/:/.test(r)?u(r,function(e,t){e},/:/):r||(i.state="ID");continue;case"NOTE":r||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){i.state="NOTE";break}if(!r)continue;if(i.cue=new s.default(0,0,""),i.state="CUE",-1===r.indexOf("--\x3e")){i.cue.id=r;continue}case"CUE":try{f(r,i.cue,i.regionList)}catch(e){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var o=-1!==r.indexOf("--\x3e");if(!r||o&&(a=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+="\n"),i.cue.text+=r;continue;case"BADCUE":r||(i.state="ID");continue}}}catch(e){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),!this.cue&&"HEADER"!==this.state||(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}},t.default=n},"./src/utils/webvtt-parser.js":function(e,t,r){"use strict";(function(g){Object.defineProperty(t,"__esModule",{value:!0});function m(e,t,r){return e.substr(r||0,t.length)===t}function v(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()}var _=r("./src/utils/vttparser.js"),y=r("./src/demux/id3.js"),e={parse:function(e,r,i,n,t,a){var o,s=y.utf8ArrayToStr(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),l="00:00.000",u=0,d=0,c=0,f=[],h=!0,p=new _.default;p.oncue=function(e){var t=i[n],r=i.ccOffset;t&&t.new&&(void 0!==d?r=i.ccOffset=t.start:function(e,t,r){var i=e[t],n=e[i.prevCC];if(!n||!n.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,i.new=!1;for(;n&&n.new;)e.ccOffset+=i.start-n.start,i.new=!1,n=e[(i=n).prevCC];e.presentationOffset=r}(i,n,c)),c&&(r=c-i.presentationOffset),e.startTime+=r-d,e.endTime+=r-d,e.id=v(e.startTime.toString())+v(e.endTime.toString())+v(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),0<e.endTime&&f.push(e)},p.onparsingerror=function(e){o=e},p.onflush=function(){o&&a?a(o):t(f)},s.forEach(function(t){if(h){if(m(t,"X-TIMESTAMP-MAP=")){h=!1,t.substr(16).split(",").forEach(function(e){m(e,"LOCAL:")?l=e.substr(6):m(e,"MPEGTS:")&&(u=parseInt(e.substr(7)))});try{r+(9e4*i[n].start||0)<0&&(r+=8589934592),u-=r,d=function(e){var t=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),i=parseInt(e.substr(-9,2)),n=9<e.length?parseInt(e.substr(0,e.indexOf(":"))):0;return g.isFinite(t)&&g.isFinite(r)&&g.isFinite(i)&&g.isFinite(n)?(t+=1e3*r,t+=6e4*i,t+=36e5*n):-1}(l)/1e3,c=u/9e4,-1===d&&(o=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){o=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(h=!1)}p.parse(t+"\n")}),p.flush()}};t.default=e}).call(this,r("./src/polyfills/number.js").Number)},"./src/utils/xhr-loader.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=r("./src/utils/logger.js"),c=window.performance,n=window.XMLHttpRequest,i=(a.prototype.destroy=function(){this.abort(),this.loader=null},a.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},a.prototype.load=function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:c.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},a.prototype.loadInternal=function(){var t,r=this.context;t=this.loader=new n;var e=this.stats;e.tfirst=0,e.loaded=0;var i=this.xhrSetup;try{if(i)try{i(t,r.url)}catch(e){t.open("GET",r.url,!0),i(t,r.url)}t.readyState||t.open("GET",r.url,!0)}catch(e){return void this.callbacks.onError({code:t.status,text:e.message},r,t)}r.rangeEnd&&t.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=r.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},a.prototype.readystatechange=function(e){var t=e.currentTarget,r=t.readyState,i=this.stats,n=this.context,a=this.config;if(!i.aborted&&2<=r)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(c.now(),i.trequest)),4===r){var o=t.status;if(200<=o&&o<300){i.tload=Math.max(i.tfirst,c.now());var s=void 0,l=void 0;l="arraybuffer"===n.responseType?(s=t.response).byteLength:(s=t.responseText).length,i.loaded=i.total=l;var u={url:t.responseURL,data:s};this.callbacks.onSuccess(u,i,n,t)}else i.retry>=a.maxRetry||400<=o&&o<499?(d.logger.error(o+" while loading "+n.url),this.callbacks.onError({code:o,text:t.statusText},n,t)):(d.logger.warn(o+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout)},a.prototype.loadtimeout=function(){d.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},a.prototype.loadprogress=function(e){var t=e.currentTarget,r=this.stats;r.loaded=e.loaded,e.lengthComputable&&(r.total=e.total);var i=this.callbacks.onProgress;i&&i(r,this.context,null,t)},a);function a(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}t.default=i}},n.c=i,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s="./src/hls.js")).default;function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var r,i},e.exports=i())},function(t,e,r){(function(e){var c;t.exports=function(){var n;return function a(o,s,l){function u(r,e){if(!s[r]){if(!o[r]){var t="function"==typeof c&&c;if(!e&&t)return c(r,!0);if(d)return d(r,!0);var i=new Error("Cannot find module '"+r+"'");throw i.code="MODULE_NOT_FOUND",i}var n=s[r]={exports:{}};o[r][0].call(n.exports,function(e){var t=o[r][1][e];return u(t||e)},n,n.exports,a,o,s,l)}return s[r].exports}for(var d="function"==typeof c&&c,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(ne,r,i){(function(re,ie){!function(e,t){"object"==typeof i&&void 0!==r?r.exports=t():"function"==typeof n&&n.amd?n(t):e.ES6Promise=t()}(this,function(){"use strict";function r(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function u(e){return"function"==typeof e}function e(e){N=e}function t(e){U=e}function i(){return void 0!==F?function(){F(a)}:n()}function n(){var e=setTimeout;return function(){return e(a,1)}}function a(){for(var e=0;e<B;e+=2){(0,z[e])(z[e+1]),z[e]=void 0,z[e+1]=void 0}B=0}function o(e,t){var r=this,i=new this.constructor(l);void 0===i[Y]&&D(i);var n=r._state;if(n){var a=arguments[n-1];U(function(){return T(n,i,a,r._result)})}else E(r,i,e,t);return i}function s(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(l);return v(r,e),r}function l(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function c(){return new TypeError("A promises callback cannot return that same promise.")}function f(e){try{return e.then}catch(e){return Z.error=e,Z}}function h(e,t,r,i){try{e.call(t,r,i)}catch(e){return e}}function p(e,i,n){U(function(t){var r=!1,e=h(n,i,function(e){r||(r=!0,i!==e?v(t,e):y(t,e))},function(e){r||(r=!0,b(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&e&&(r=!0,b(t,e))},e)}function g(t,e){e._state===J?y(t,e._result):e._state===Q?b(t,e._result):E(e,void 0,function(e){return v(t,e)},function(e){return b(t,e)})}function m(e,t,r){t.constructor===e.constructor&&r===o&&t.constructor.resolve===s?g(e,t):r===Z?(b(e,Z.error),Z.error=null):void 0===r?y(e,t):u(r)?p(e,t,r):y(e,t)}function v(e,t){e===t?b(e,d()):r(t)?m(e,t,f(t)):y(e,t)}function _(e){e._onerror&&e._onerror(e._result),S(e)}function y(e,t){e._state===X&&(e._result=t,e._state=J,0!==e._subscribers.length&&U(S,e))}function b(e,t){e._state===X&&(e._state=Q,e._result=t,U(_,e))}function E(e,t,r,i){var n=e._subscribers,a=n.length;e._onerror=null,n[a]=t,n[a+J]=r,n[a+Q]=i,0===a&&e._state&&U(S,e)}function S(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var i=void 0,n=void 0,a=e._result,o=0;o<t.length;o+=3)i=t[o],n=t[o+r],i?T(r,i,n,a):n(a);e._subscribers.length=0}}function w(e,t){try{return e(t)}catch(e){return Z.error=e,Z}}function T(e,t,r,i){var n=u(r),a=void 0,o=void 0,s=void 0,l=void 0;if(n){if(a=w(r,i),a===Z?(l=!0,o=a.error,a.error=null):s=!0,t===a)return void b(t,c())}else a=i,s=!0;t._state!==X||(n&&s?v(t,a):l?b(t,o):e===J?y(t,a):e===Q&&b(t,a))}function k(t,e){try{e(function(e){v(t,e)},function(e){b(t,e)})}catch(e){b(t,e)}}function A(){return $++}function D(e){e[Y]=$++,e._state=void 0,e._result=void 0,e._subscribers=[]}function R(){return new Error("Array Methods must be provided an Array")}function O(e){return new ee(this,e).promise}function L(n){var a=this;return new a(j(n)?function(e,t){for(var r=n.length,i=0;i<r;i++)a.resolve(n[i]).then(e,t)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function C(e){var t=this,r=new t(l);return b(r,e),r}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function x(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function I(){var e=void 0;if(void 0!==ie)e=ie;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=te}var M=void 0;M=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var j=M,B=0,F=void 0,N=void 0,U=function(e,t){z[B]=e,z[B+1]=t,2===(B+=2)&&(N?N(a):W())},G="undefined"!=typeof window?window:void 0,V=G||{},H=V.MutationObserver||V.WebKitMutationObserver,q="undefined"==typeof self&&void 0!==re&&"[object process]"==={}.toString.call(re),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,z=new Array(1e3),W=void 0;W=q?function(){return function(){return re.nextTick(a)}}():H?function(){var e=0,t=new H(a),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():K?function(){var e=new MessageChannel;return e.port1.onmessage=a,function(){return e.port2.postMessage(0)}}():void 0===G&&"function"==typeof ne?function(){try{var e=Function("return this")().require("vertx");return F=e.runOnLoop||e.runOnContext,i()}catch(e){return n()}}():n();var Y=Math.random().toString(36).substring(2),X=void 0,J=1,Q=2,Z={error:null},$=0,ee=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(l),this.promise[Y]||D(this.promise),j(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?y(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&y(this.promise,this._result))):b(this.promise,R())}return e.prototype._enumerate=function(e){for(var t=0;this._state===X&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,i=r.resolve;if(i===s){var n=f(t);if(n===o&&t._state!==X)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(r===te){var a=new r(l);m(a,t,n),this._willSettleAt(a,e)}else this._willSettleAt(new r(function(e){return e(t)}),e)}else this._willSettleAt(i(t),e)},e.prototype._settledAt=function(e,t,r){var i=this.promise;i._state===X&&(this._remaining--,e===Q?b(i,r):this._result[t]=r),0===this._remaining&&y(i,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;E(e,void 0,function(e){return r._settledAt(J,t,e)},function(e){return r._settledAt(Q,t,e)})},e}(),te=function(){function t(e){this[Y]=A(),this._result=this._state=void 0,this._subscribers=[],l!==e&&("function"!=typeof e&&P(),this instanceof t?k(this,e):x())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var e=this,r=e.constructor;return u(t)?e.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return te.prototype.then=o,te.all=O,te.race=L,te.resolve=s,te.reject=C,te._setScheduler=e,te._setAsap=t,te._asap=U,te.polyfill=I,te.Promise=te,te})}).call(this,ne("_process"),"undefined"!=typeof e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(e,t,r){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(e){return"function"==typeof e}function n(e){return"number"==typeof e}function u(e){return"object"==typeof e&&null!==e}function d(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,r,i,n,a,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var s=new Error('Uncaught, unspecified "error" event. ('+t+")");throw s.context=t,s}if(r=this._events[e],d(r))return!1;if(l(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),r.apply(this,n)}else if(u(r))for(n=Array.prototype.slice.call(arguments,1),o=r.slice(),i=o.length,a=0;a<i;a++)o[a].apply(this,n);return!0},i.prototype.addListener=function(e,t){var r;if(!l(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,l(t.listener)?t.listener:t),this._events[e]?u(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,u(this._events[e])&&!this._events[e].warned&&(r=d(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(!l(t))throw TypeError("listener must be a function");var i=!1;return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){var r,i,n,a;if(!l(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],n=r.length,i=-1,r===t||l(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(u(r)){for(a=n;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){i=a;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],l(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?l(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(l(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],3:[function(e,t,r){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function a(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(t){if(f===clearTimeout)return clearTimeout(t);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function s(){m&&p&&(m=!1,p.length?g=p.concat(g):v=-1,g.length&&l())}function l(){if(!m){var e=a(s);m=!0;for(var t=g.length;t;){for(p=g,g=[];++v<t;)p&&p[v].run();v=-1,t=g.length}p=null,m=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function d(){}var c,f,h=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(e){c=i}try{f="function"==typeof clearTimeout?clearTimeout:n}catch(e){f=n}}();var p,g=[],m=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];g.push(new u(e,t)),1!==g.length||m||a(l)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=d,h.addListener=d,h.once=d,h.off=d,h.removeListener=d,h.removeAllListeners=d,h.emit=d,h.prependListener=d,h.prependOnceListener=d,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],4:[function(e,t,r){var _=arguments[3],y=arguments[4],b=arguments[5],E=JSON.stringify;t.exports=function(e,t){function i(e){f[e]=!0;for(var t in y[e][1]){var r=y[e][1][t];f[r]||i(r)}}for(var r,n=Object.keys(b),a=0,o=n.length;a<o;a++){var s=n[a],l=b[s].exports;if(l===e||l&&l.default===e){r=s;break}}if(!r){r=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var u={},a=0,o=n.length;a<o;a++){var s=n[a];u[s]=s}y[r]=["function(require,module,exports){"+e+"(self); }",u]}var d=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[r]=r,y[d]=["function(require,module,exports){var f = require("+E(r)+");(f.default ? f.default : f)(self);}",c];var f={};i(d);var h="("+_+")({"+Object.keys(f).map(function(e){return E(e)+":["+y[e][0]+","+E(y[e][1])+"]"}).join(",")+"},{},["+E(d)+"])",p=window.URL||window.webkitURL||window.mozURL||window.msURL,g=new Blob([h],{type:"text/javascript"});if(t&&t.bare)return g;var m=p.createObjectURL(g),v=new Worker(m);return v.objectURL=m,v}},{}],5:[function(e,t,r){"use strict";function i(){return Object.assign({},n)}Object.defineProperty(r,"__esModule",{value:!0}),r.createDefaultConfig=i;var n=r.defaultConfig={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0}},{}],6:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=e("../io/io-controller.js"),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=e("../config.js"),l=function(){function r(){i(this,r)}return n(r,null,[{key:"supportMSEH264Playback",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function(){var e=new o.default({},(0,s.createDefaultConfig)()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t}},{key:"getNetworkLoaderTypeName",value:function(){var e=new o.default({},(0,s.createDefaultConfig)()),t=e.loaderType;return e.destroy(),t}},{key:"supportNativeMediaPlayback",value:function(e){void 0==r.videoElement&&(r.videoElement=window.document.createElement("video"));var t=r.videoElement.canPlayType(e);return"probably"===t||"maybe"==t}},{key:"getFeatureList",value:function(){var e={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return e.mseFlvPlayback=r.supportMSEH264Playback(),e.networkStreamIO=r.supportNetworkStreamIO(),e.networkLoaderName=r.getNetworkLoaderTypeName(),e.mseLiveFlvPlayback=e.mseFlvPlayback&&e.networkStreamIO,e.nativeMP4H264Playback=r.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),e.nativeWebmVP8Playback=r.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),e.nativeWebmVP9Playback=r.supportNativeMediaPlayback('video/webm; codecs="vp9"'),e}}]),r}();r.default=l},{"../config.js":5,"../io/io-controller.js":23}],7:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=function(){function e(){i(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return n(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,r=this._search(t.times,e);return{index:r,milliseconds:t.times[r],fileposition:t.filepositions[r]}}},{key:"_search",value:function(e,t){var r=0,i=e.length-1,n=0,a=0,o=i;for(t<e[0]&&(r=0,a=o+1);a<=o;){if((n=a+Math.floor((o-a)/2))===i||t>=e[n]&&t<e[n+1]){r=n;break}e[n]<t?a=n+1:o=n-1}return r}}]),e}();r.default=a},{}],8:[function(e,t,r){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}();r.SampleInfo=function e(t,r,i,n,a){o(this,e),this.dts=t,this.pts=r,this.duration=i,this.originalDts=n,this.isSyncPoint=a,this.fileposition=null},r.MediaSegmentInfo=function(){function e(){o(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return i(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),r.IDRSampleList=function(){function e(){o(this,e),this._list=[]}return i(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,r=0,i=t.length-1,n=0,a=0,o=i;for(e<t[0].dts&&(r=0,a=o+1);a<=o;){if((n=a+Math.floor((o-a)/2))===i||e>=t[n].dts&&e<t[n+1].dts){r=n;break}t[n].dts<e?a=n+1:o=n-1}return this._list[r]}}]),e}(),r.MediaSegmentInfoList=function(){function t(e){o(this,t),this._type=e,this._list=[],this._lastAppendLocation=-1}return i(t,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var r=t.length-1,i=0,n=0,a=r,o=0;if(e<t[0].originalBeginDts)return o=-1;for(;n<=a;){if((i=n+Math.floor((a-n)/2))===r||e>t[i].lastSample.originalDts&&e<t[i+1].originalBeginDts){o=i;break}t[i].originalBeginDts<e?n=i+1:a=i-1}return o}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,r=e,i=this._lastAppendLocation,n=0;-1!==i&&i<t.length&&r.originalBeginDts>=t[i].lastSample.originalDts&&(i===t.length-1||i<t.length-1&&r.originalBeginDts<t[i+1].originalBeginDts)?n=i+1:t.length>0&&(n=this._searchNearestSegmentBefore(r.originalBeginDts)+1),this._lastAppendLocation=n,this._list.splice(n,0,r)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),r=this._list[t].syncPoints;0===r.length&&t>0;)t--,r=this._list[t].syncPoints;return r.length>0?r[r.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),t}()},{}],9:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),o=e("events"),s=i(o),l=e("../utils/logger.js"),u=i(l),d=e("../utils/browser.js"),c=i(d),f=e("./mse-events.js"),h=i(f),p=e("./media-segment-info.js"),g=e("../utils/exception.js"),m=function(){function t(e){n(this,t),this.TAG="MSEController",this._config=e,this._emitter=new s.default,this._config.isLive&&void 0==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new p.IDRSampleList}return a(t,[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaSource)throw new g.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var r=this._pendingSegments[t];r.splice(0,r.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var i=this._sourceBuffers[t];if(i){if("closed"!==e.readyState){try{e.removeSourceBuffer(i)}catch(e){u.default.e(this.TAG,e.message)}i.removeEventListener("error",this.e.onSourceBufferError),i.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(e){u.default.e(this.TAG,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"appendInitSegment",value:function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var r=e,i=""+r.container;r.codec&&r.codec.length>0&&(i+=";codecs="+r.codec);var n=!1;if(u.default.v(this.TAG,"Received Initialization Segment, mimeType: "+i),this._lastInitSegments[r.type]=r,i!==this._mimeTypes[r.type]){if(this._mimeTypes[r.type])u.default.v(this.TAG,"Notice: "+r.type+" mimeType changed, origin: "+this._mimeTypes[r.type]+", target: "+i);else{n=!0;try{var a=this._sourceBuffers[r.type]=this._mediaSource.addSourceBuffer(i);a.addEventListener("error",this.e.onSourceBufferError),a.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){return u.default.e(this.TAG,e.message),void this._emitter.emit(h.default.ERROR,{code:e.code,msg:e.message})}}this._mimeTypes[r.type]=i}t||this._pendingSegments[r.type].push(r),n||this._sourceBuffers[r.type]&&!this._sourceBuffers[r.type].updating&&this._doAppendSegments(),c.default.safari&&"audio/mpeg"===r.container&&r.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=r.mediaDuration/1e3,this._updateMediaSourceDuration())}},{key:"appendMediaSegment",value:function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var r=this._sourceBuffers[t.type];!r||r.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()}},{key:"seek",value:function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var r=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{r.abort()}catch(e){u.default.e(this.TAG,e.message)}this._idrList.clear();var i=this._pendingSegments[t];if(i.splice(0,i.length),"closed"!==this._mediaSource.readyState){for(var n=0;n<r.buffered.length;n++){var a=r.buffered.start(n),o=r.buffered.end(n);this._pendingRemoveRanges[t].push({start:a,end:o})}if(r.updating||this._doRemoveRanges(),c.default.safari){var s=this._lastInitSegments[t];s&&(this._pendingSegments[t].push(s),r.updating||this._doAppendSegments())}}}}},{key:"endOfStream",value:function(){var e=this._mediaSource,t=this._sourceBuffers;if(!e||"open"!==e.readyState)return void(e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0));t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream())}},{key:"getNearestKeyframe",value:function(e){return this._idrList.getLastSyncPointBeforeDts(e)}},{key:"_needCleanupSourceBuffer",value:function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){var i=r.buffered;if(i.length>=1&&e-i.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){for(var i=r.buffered,n=!1,a=0;a<i.length;a++){var o=i.start(a),s=i.end(a);if(o<=e&&e<s+3){if(e-o>=this._config.autoCleanupMaxBackwardDuration){n=!0;var l=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:o,end:l})}}else s<e&&(n=!0,this._pendingRemoveRanges[t].push({start:o,end:s}))}n&&!r.updating&&this._doRemoveRanges()}}}},{key:"_updateMediaSourceDuration",value:function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,r=this._pendingMediaDuration;r>0&&(isNaN(t)||r>t)&&(u.default.v(this.TAG,"Update MediaSource duration from "+t+" to "+r),this._mediaSource.duration=r),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}}},{key:"_doRemoveRanges",value:function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],r=this._pendingRemoveRanges[e];r.length&&!t.updating;){var i=r.shift();t.remove(i.start,i.end)}}},{key:"_doAppendSegments",value:function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var r=e[t].shift();if(r.timestampOffset){var i=this._sourceBuffers[t].timestampOffset,n=r.timestampOffset/1e3,a=Math.abs(i-n);a>.1&&(u.default.v(this.TAG,"Update MPEG audio timestampOffset from "+i+" to "+n),this._sourceBuffers[t].timestampOffset=n),delete r.timestampOffset}if(!r.data||0===r.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(r.data),this._isBufferFull=!1,"video"===t&&r.hasOwnProperty("info")&&this._idrList.appendArray(r.info.syncPoints)}catch(e){this._pendingSegments[t].unshift(r),22===e.code?(this._isBufferFull||this._emitter.emit(h.default.BUFFER_FULL),this._isBufferFull=!0):(u.default.e(this.TAG,e.message),this._emitter.emit(h.default.ERROR,{code:e.code,msg:e.message}))}}}},{key:"_onSourceOpen",value:function(){if(u.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(h.default.SOURCE_OPEN)}},{key:"_onSourceEnded",value:function(){u.default.v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function(){u.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"_hasPendingSegments",value:function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(h.default.UPDATE_END)}},{key:"_onSourceBufferError",value:function(e){u.default.e(this.TAG,"SourceBuffer Error: "+e)}}]),t}();r.default=m},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./media-segment-info.js":8,"./mse-events.js":10,events:2}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};r.default=i},{}],11:[function(a,e,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),n=a("events"),s=r(n),l=a("../utils/logger.js"),u=r(l),d=a("../utils/logging-control.js"),c=r(d),f=a("./transmuxing-controller.js"),h=r(f),p=a("./transmuxing-events.js"),g=r(p),m=a("./transmuxing-worker.js"),v=r(m),_=a("./media-info.js"),y=r(_),b=function(){function n(t,r){if(o(this,n),this.TAG="Transmuxer",this._emitter=new s.default,r.enableWorker&&"undefined"!=typeof Worker)try{var e=a("webworkify");this._worker=e(v.default),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[t,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},c.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:c.default.getConfig()})}catch(e){u.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new h.default(t,r)}else this._controller=new h.default(t,r);if(this._controller){var i=this._controller;i.on(g.default.IO_ERROR,this._onIOError.bind(this)),i.on(g.default.DEMUX_ERROR,this._onDemuxError.bind(this)),i.on(g.default.INIT_SEGMENT,this._onInitSegment.bind(this)),i.on(g.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),i.on(g.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),i.on(g.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),i.on(g.default.MEDIA_INFO,this._onMediaInfo.bind(this)),i.on(g.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),i.on(g.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),i.on(g.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),i.on(g.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return i(n,[{key:"destroy",value:function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),c.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"hasWorker",value:function(){return null!=this._worker}},{key:"open",value:function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()}},{key:"close",value:function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()}},{key:"seek",value:function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)}},{key:"pause",value:function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()}},{key:"resume",value:function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()}},{key:"_onInitSegment",value:function(e,t){var r=this;Promise.resolve().then(function(){r._emitter.emit(g.default.INIT_SEGMENT,e,t)})}},{key:"_onMediaSegment",value:function(e,t){var r=this;Promise.resolve().then(function(){r._emitter.emit(g.default.MEDIA_SEGMENT,e,t)})}},{key:"_onLoadingComplete",value:function(){var e=this;Promise.resolve().then(function(){e._emitter.emit(g.default.LOADING_COMPLETE)})}},{key:"_onRecoveredEarlyEof",value:function(){var e=this;Promise.resolve().then(function(){e._emitter.emit(g.default.RECOVERED_EARLY_EOF)})}},{key:"_onMediaInfo",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(g.default.MEDIA_INFO,e)})}},{key:"_onMetaDataArrived",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(g.default.METADATA_ARRIVED,e)})}},{key:"_onScriptDataArrived",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(g.default.SCRIPTDATA_ARRIVED,e)})}},{key:"_onStatisticsInfo",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(g.default.STATISTICS_INFO,e)})}},{key:"_onIOError",value:function(e,t){var r=this;Promise.resolve().then(function(){r._emitter.emit(g.default.IO_ERROR,e,t)})}},{key:"_onDemuxError",value:function(e,t){var r=this;Promise.resolve().then(function(){r._emitter.emit(g.default.DEMUX_ERROR,e,t)})}},{key:"_onRecommendSeekpoint",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(g.default.RECOMMEND_SEEKPOINT,e)})}},{key:"_onLoggingConfigChanged",value:function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})}},{key:"_onWorkerMessage",value:function(e){var t=e.data,r=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case g.default.INIT_SEGMENT:case g.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,r.type,r.data);break;case g.default.LOADING_COMPLETE:case g.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case g.default.MEDIA_INFO:Object.setPrototypeOf(r,y.default.prototype),this._emitter.emit(t.msg,r);break;case g.default.METADATA_ARRIVED:case g.default.SCRIPTDATA_ARRIVED:case g.default.STATISTICS_INFO:this._emitter.emit(t.msg,r);break;case g.default.IO_ERROR:case g.default.DEMUX_ERROR:this._emitter.emit(t.msg,r.type,r.info);break;case g.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,r);break;case"logcat_callback":u.default.emitter.emit("log",r.type,r.logcat)}}}]),n}();t.default=b},{"../utils/logger.js":41,"../utils/logging-control.js":42,"./media-info.js":7,"./transmuxing-controller.js":12,"./transmuxing-events.js":13,"./transmuxing-worker.js":14,events:2,webworkify:4}],12:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),o=e("events"),s=i(o),l=e("../utils/logger.js"),u=i(l),d=e("../utils/browser.js"),c=i(d),f=e("./media-info.js"),h=i(f),p=e("../demux/flv-demuxer.js"),g=i(p),m=e("../remux/mp4-remuxer.js"),v=i(m),_=e("../demux/demux-errors.js"),y=i(_),b=e("../io/io-controller.js"),E=i(b),S=e("./transmuxing-events.js"),w=i(S),T=(e("../io/loader.js"),function(){function e(t,r){n(this,e),this.TAG="TransmuxingController",this._emitter=new s.default,this._config=r,t.segments||(t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]),"boolean"!=typeof t.cors&&(t.cors=!0),"boolean"!=typeof t.withCredentials&&(t.withCredentials=!1),this._mediaDataSource=t,this._currentSegmentIndex=0;var i=0;this._mediaDataSource.segments.forEach(function(e){e.timestampBase=i,i+=e.duration,e.cors=t.cors,e.withCredentials=t.withCredentials,r.referrerPolicy&&(e.referrerPolicy=r.referrerPolicy)}),isNaN(i)||this._mediaDataSource.duration===i||(this._mediaDataSource.duration=i),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return a(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"start",value:function(){this._loadSegment(0),this._enableStatisticsReporter()}},{key:"_loadSegment",value:function(e,t){this._currentSegmentIndex=e;var r=this._mediaDataSource.segments[e],i=this._ioctl=new E.default(r,this._config,e);i.onError=this._onIOException.bind(this),i.onSeeked=this._onIOSeeked.bind(this),i.onComplete=this._onIOComplete.bind(this),i.onRedirect=this._onIORedirect.bind(this),i.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):i.onDataArrival=this._onInitChunkArrival.bind(this),i.open(t)}},{key:"stop",value:function(){this._internalAbort(),this._disableStatisticsReporter()}},{key:"_internalAbort",value:function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)}},{key:"pause",value:function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())}},{key:"resume",value:function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())}},{key:"seek",value:function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var r=this._mediaInfo.segments[t];if(void 0==r)this._pendingSeekTime=e;else{var i=r.getNearestKeyframe(e);this._remuxer.seek(i.milliseconds),this._ioctl.seek(i.fileposition),this._pendingResolveSeekPoint=i.milliseconds}}else{var n=this._mediaInfo.segments[t];if(void 0==n)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t);else{var a=n.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(t)}}this._enableStatisticsReporter()}}},{key:"_searchSegmentIndexContains",value:function(e){for(var t=this._mediaDataSource.segments,r=t.length-1,i=0;i<t.length;i++)if(e<t[i].timestampBase){r=i-1;break}return r}},{key:"_onInitChunkArrival",value:function(e,t){var r=this,i=null,n=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,n=this._demuxer.parseChunks(e,t);else if((i=g.default.probe(e)).match){this._demuxer=new g.default(i,this._config),this._remuxer||(this._remuxer=new v.default(this._config));var a=this._mediaDataSource;void 0==a.duration||isNaN(a.duration)||(this._demuxer.overridedDuration=a.duration),"boolean"==typeof a.hasAudio&&(this._demuxer.overridedHasAudio=a.hasAudio),"boolean"==typeof a.hasVideo&&(this._demuxer.overridedHasVideo=a.hasVideo),this._demuxer.timestampBase=a.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),n=this._demuxer.parseChunks(e,t)}else i=null,u.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){r._internalAbort()}),this._emitter.emit(w.default.DEMUX_ERROR,y.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),n=0;return n}},{key:"_onMediaInfo",value:function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,h.default.prototype));var r=Object.assign({},e);Object.setPrototypeOf(r,h.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=r,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then(function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)})}},{key:"_onMetaDataArrived",value:function(e){this._emitter.emit(w.default.METADATA_ARRIVED,e)}},{key:"_onScriptDataArrived",value:function(e){this._emitter.emit(w.default.SCRIPTDATA_ARRIVED,e)}},{key:"_onIOSeeked",value:function(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function(e){var t=e,r=t+1;r<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(r)):(this._remuxer.flushStashedSamples(),this._emitter.emit(w.default.LOADING_COMPLETE),this._disableStatisticsReporter())}},{key:"_onIORedirect",value:function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e}},{key:"_onIORecoveredEarlyEof",value:function(){this._emitter.emit(w.default.RECOVERED_EARLY_EOF)}},{key:"_onIOException",value:function(e,t){u.default.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(w.default.IO_ERROR,e,t),this._disableStatisticsReporter()}},{key:"_onDemuxException",value:function(e,t){u.default.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(w.default.DEMUX_ERROR,e,t)}},{key:"_onRemuxerInitSegmentArrival",value:function(e,t){this._emitter.emit(w.default.INIT_SEGMENT,e,t)}},{key:"_onRemuxerMediaSegmentArrival",value:function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(w.default.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var r=t.info.syncPoints,i=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,c.default.safari&&r.length>0&&r[0].originalDts===i&&(i=r[0].pts),this._emitter.emit(w.default.RECOMMEND_SEEKPOINT,i)}}},{key:"_enableStatisticsReporter",value:function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))}},{key:"_disableStatisticsReporter",value:function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"_reportSegmentMediaInfo",value:function(e){var t=this._mediaInfo.segments[e],r=Object.assign({},t);r.duration=this._mediaInfo.duration,r.segmentCount=this._mediaInfo.segmentCount,delete r.segments,delete r.keyframesIndex,this._emitter.emit(w.default.MEDIA_INFO,r)}},{key:"_reportStatisticsInfo",value:function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(w.default.STATISTICS_INFO,e)}}]),e}());r.default=T},{"../demux/demux-errors.js":16,"../demux/flv-demuxer.js":18,"../io/io-controller.js":23,"../io/loader.js":24,"../remux/mp4-remuxer.js":38,"../utils/browser.js":39,"../utils/logger.js":41,"./media-info.js":7,"./transmuxing-events.js":13,events:2}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};r.default=i},{}],14:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var n=e("../utils/logger.js"),a=(i(n),e("../utils/logging-control.js")),m=i(a),o=e("../utils/polyfill.js"),v=i(o),s=e("./transmuxing-controller.js"),_=i(s),l=e("./transmuxing-events.js"),y=i(l),u=function(i){function r(e,t){var r={msg:y.default.INIT_SEGMENT,data:{type:e,data:t}};i.postMessage(r,[t.data])}function n(e,t){var r={msg:y.default.MEDIA_SEGMENT,data:{type:e,data:t}};i.postMessage(r,[t.data])}function a(){var e={msg:y.default.LOADING_COMPLETE};i.postMessage(e)}function o(){var e={msg:y.default.RECOVERED_EARLY_EOF};i.postMessage(e)}function s(e){var t={msg:y.default.MEDIA_INFO,data:e};i.postMessage(t)}function l(e){var t={msg:y.default.METADATA_ARRIVED,data:e};i.postMessage(t)}function u(e){var t={msg:y.default.SCRIPTDATA_ARRIVED,data:e};i.postMessage(t)}function d(e){var t={msg:y.default.STATISTICS_INFO,data:e};i.postMessage(t)}function c(e,t){i.postMessage({msg:y.default.IO_ERROR,data:{type:e,info:t}})}function f(e,t){i.postMessage({msg:y.default.DEMUX_ERROR,data:{type:e,info:t}})}function h(e){i.postMessage({msg:y.default.RECOMMEND_SEEKPOINT,data:e})}function e(e,t){i.postMessage({msg:"logcat_callback",data:{type:e,logcat:t}})}var p=null,g=e.bind(this);v.default.install(),i.addEventListener("message",function(e){switch(e.data.cmd){case"init":p=new _.default(e.data.param[0],e.data.param[1]),p.on(y.default.IO_ERROR,c.bind(this)),p.on(y.default.DEMUX_ERROR,f.bind(this)),p.on(y.default.INIT_SEGMENT,r.bind(this)),p.on(y.default.MEDIA_SEGMENT,n.bind(this)),p.on(y.default.LOADING_COMPLETE,a.bind(this)),p.on(y.default.RECOVERED_EARLY_EOF,o.bind(this)),p.on(y.default.MEDIA_INFO,s.bind(this)),p.on(y.default.METADATA_ARRIVED,l.bind(this)),p.on(y.default.SCRIPTDATA_ARRIVED,u.bind(this)),p.on(y.default.STATISTICS_INFO,d.bind(this)),p.on(y.default.RECOMMEND_SEEKPOINT,h.bind(this));break;case"destroy":p&&(p.destroy(),p=null),i.postMessage({msg:"destroyed"});break;case"start":p.start();break;case"stop":p.stop();break;case"seek":p.seek(e.data.param);break;case"pause":p.pause();break;case"resume":p.resume();break;case"logging_config":var t=e.data.param;m.default.applyConfig(t),!0===t.enableCallback?m.default.addLogListener(g):m.default.removeLogListener(g)}})};r.default=u},{"../utils/logger.js":41,"../utils/logging-control.js":42,"../utils/polyfill.js":43,"./transmuxing-controller.js":12,"./transmuxing-events.js":13}],15:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),o=e("../utils/logger.js"),y=i(o),s=e("../utils/utf8-conv.js"),l=i(s),b=e("../utils/exception.js"),E=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),u=function(){function _(){n(this,_)}return a(_,null,[{key:"parseScriptData",value:function(e,t,r){var i={};try{var n=_.parseValue(e,t,r),a=_.parseValue(e,t+n.size,r-n.size);i[n.data]=a.data}catch(e){y.default.e("AMF",e.toString())}return i}},{key:"parseObject",value:function(e,t,r){if(r<3)throw new b.IllegalStateException("Data not enough when parse ScriptDataObject");var i=_.parseString(e,t,r),n=_.parseValue(e,t+i.size,r-i.size),a=n.objectEnd;return{data:{name:i.data,value:n.data},size:i.size+n.size,objectEnd:a}}},{key:"parseVariable",value:function(e,t,r){return _.parseObject(e,t,r)}},{key:"parseString",value:function(e,t,r){if(r<2)throw new b.IllegalStateException("Data not enough when parse String");var i=new DataView(e,t,r),n=i.getUint16(0,!E),a=void 0;return a=n>0?(0,l.default)(new Uint8Array(e,t+2,n)):"",{data:a,size:2+n}}},{key:"parseLongString",value:function(e,t,r){if(r<4)throw new b.IllegalStateException("Data not enough when parse LongString");var i=new DataView(e,t,r),n=i.getUint32(0,!E),a=void 0;return a=n>0?(0,l.default)(new Uint8Array(e,t+4,n)):"",{data:a,size:4+n}}},{key:"parseDate",value:function(e,t,r){if(r<10)throw new b.IllegalStateException("Data size invalid when parse Date");var i=new DataView(e,t,r),n=i.getFloat64(0,!E);return n+=60*i.getInt16(8,!E)*1e3,{data:new Date(n),size:10}}},{key:"parseValue",value:function(e,t,r){if(r<1)throw new b.IllegalStateException("Data not enough when parse Value");var i=new DataView(e,t,r),n=1,a=i.getUint8(0),o=void 0,s=!1;try{switch(a){case 0:o=i.getFloat64(1,!E),n+=8;break;case 1:o=!!i.getUint8(1),n+=1;break;case 2:var l=_.parseString(e,t+1,r-1);o=l.data,n+=l.size;break;case 3:o={};var u=0;for(9==(16777215&i.getUint32(r-4,!E))&&(u=3);n<r-4;){var d=_.parseObject(e,t+n,r-n-u);if(d.objectEnd)break;o[d.data.name]=d.data.value,n+=d.size}if(n<=r-3){9===(16777215&i.getUint32(n-1,!E))&&(n+=3)}break;case 8:o={},n+=4;var c=0;for(9==(16777215&i.getUint32(r-4,!E))&&(c=3);n<r-8;){var f=_.parseVariable(e,t+n,r-n-c);if(f.objectEnd)break;o[f.data.name]=f.data.value,n+=f.size}if(n<=r-3){9===(16777215&i.getUint32(n-1,!E))&&(n+=3)}break;case 9:o=void 0,n=1,s=!0;break;case 10:o=[];var h=i.getUint32(1,!E);n+=4;for(var p=0;p<h;p++){var g=_.parseValue(e,t+n,r-n);o.push(g.data),n+=g.size}break;case 11:var m=_.parseDate(e,t+1,r-1);o=m.data,n+=m.size;break;case 12:var v=_.parseString(e,t+1,r-1);o=v.data,n+=v.size;break;default:n=r,y.default.w("AMF","Unsupported AMF value type "+a)}}catch(e){y.default.e("AMF",e.toString())}return{data:o,size:n,objectEnd:s}}}]),_}();r.default=u},{"../utils/exception.js":40,"../utils/logger.js":41,"../utils/utf8-conv.js":44}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};r.default=i},{}],17:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),o=e("../utils/exception.js"),a=function(){function t(e){i(this,t),this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}return n(t,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new o.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new o.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var i=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(i,this._current_word_bits_left),a=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,r=r<<n|a}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),t}();r.default=a},{"../utils/exception.js":40}],18:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}Object.defineProperty(r,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),s=e("../utils/logger.js"),k=i(s),l=e("./amf-parser.js"),d=i(l),c=e("./sps-parser.js"),A=i(c),f=e("./demux-errors.js"),D=i(f),h=e("../core/media-info.js"),g=i(h),m=e("../utils/exception.js"),p=function(){function p(e,t){n(this,p),this.TAG="FLVDemuxer",this._config=t,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new g.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return a(p,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null}},{key:"bindDataSource",value:function(e){return e.onDataArrival=this.parseChunks.bind(this),this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new g.default}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(e,t){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new m.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var r=0,i=this._littleEndian;if(0===t){if(!(e.byteLength>13))return 0;r=p.probe(e).dataOffset}if(this._firstParse){this._firstParse=!1,t+r!==this._dataOffset&&k.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");0!==new DataView(e,r).getUint32(0,!i)&&k.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),r+=4}for(;r<e.byteLength;){this._dispatch=!0;var n=new DataView(e,r);if(r+11+4>e.byteLength)break;var a=n.getUint8(0),o=16777215&n.getUint32(0,!i);if(r+11+o+4>e.byteLength)break;if(8===a||9===a||18===a){var s=n.getUint8(4),l=n.getUint8(5),u=n.getUint8(6),d=n.getUint8(7),c=u|l<<8|s<<16|d<<24;0!==(16777215&n.getUint32(7,!i))&&k.default.w(this.TAG,"Meet tag which has StreamID != 0!");var f=r+11;switch(a){case 8:this._parseAudioData(e,f,o,c);break;case 9:this._parseVideoData(e,f,o,c,t+r);break;case 18:this._parseScriptData(e,f,o)}var h=n.getUint32(11+o,!i);h!==11+o&&k.default.w(this.TAG,"Invalid PrevTagSize "+h),r+=11+o+4}else k.default.w(this.TAG,"Unsupported tag type "+a+", skipped"),r+=11+o+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),r}},{key:"_parseScriptData",value:function(e,t,r){var i=d.default.parseScriptData(e,t,r);if(i.hasOwnProperty("onMetaData")){if(null==i.onMetaData||"object"!==u(i.onMetaData))return void k.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&k.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=i;var n=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},n)),"boolean"==typeof n.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=n.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof n.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=n.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof n.audiodatarate&&(this._mediaInfo.audioDataRate=n.audiodatarate),"number"==typeof n.videodatarate&&(this._mediaInfo.videoDataRate=n.videodatarate),"number"==typeof n.width&&(this._mediaInfo.width=n.width),"number"==typeof n.height&&(this._mediaInfo.height=n.height),"number"==typeof n.duration){if(!this._durationOverrided){var a=Math.floor(n.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof n.framerate){var o=Math.floor(1e3*n.framerate);if(o>0){var s=o/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=s,this._referenceFrameRate.fps_num=o,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=s}}if("object"===u(n.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var l=n.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(l),n.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=n,k.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(i).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},i))}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],r=[],i=1;i<e.times.length;i++){var n=this._timestampBase+Math.floor(1e3*e.times[i]);t.push(n),r.push(e.filepositions[i])}return{times:t,filepositions:r}}},{key:"_parseAudioData",value:function(e,t,r,i){if(r<=1)return void k.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){var n=(this._littleEndian,new DataView(e,t,r)),a=n.getUint8(0),o=a>>>4;if(2!==o&&10!==o)return void this._onError(D.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+o);var s=0,l=(12&a)>>>2;if(!(l>=0&&l<=4))return void this._onError(D.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l);s=this._flvSoundRateTable[l];var u=1&a,d=this._audioMetadata,c=this._audioTrack;if(d||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),d=this._audioMetadata={},d.type="audio",d.id=c.id,d.timescale=this._timescale,d.duration=this._duration,d.audioSampleRate=s,d.channelCount=0===u?1:2),10===o){var f=this._parseAACAudioData(e,t+1,r-1);if(void 0==f)return;if(0===f.packetType){d.config&&k.default.w(this.TAG,"Found another AudioSpecificConfig!");var h=f.data;d.audioSampleRate=h.samplingRate,d.channelCount=h.channelCount,d.codec=h.codec,d.originalCodec=h.originalCodec,d.config=h.config,d.refSampleDuration=1024/d.audioSampleRate*d.timescale,k.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",d);var p=this._mediaInfo;p.audioCodec=d.originalCodec,p.audioSampleRate=d.audioSampleRate,p.audioChannelCount=d.channelCount,p.hasVideo?null!=p.videoCodec&&(p.mimeType='video/x-flv; codecs="'+p.videoCodec+","+p.audioCodec+'"'):p.mimeType='video/x-flv; codecs="'+p.audioCodec+'"',p.isComplete()&&this._onMediaInfo(p)}else if(1===f.packetType){var g=this._timestampBase+i,m={unit:f.data,length:f.data.byteLength,dts:g,pts:g};c.samples.push(m),c.length+=f.data.length}else k.default.e(this.TAG,"Flv: Unsupported AAC data type "+f.packetType)}else if(2===o){if(!d.codec){var v=this._parseMP3AudioData(e,t+1,r-1,!0);if(void 0==v)return;d.audioSampleRate=v.samplingRate,d.channelCount=v.channelCount,d.codec=v.codec,d.originalCodec=v.originalCodec,d.refSampleDuration=1152/d.audioSampleRate*d.timescale,k.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",d);var _=this._mediaInfo;_.audioCodec=d.codec,_.audioSampleRate=d.audioSampleRate,_.audioChannelCount=d.channelCount,_.audioDataRate=v.bitRate,_.hasVideo?null!=_.videoCodec&&(_.mimeType='video/x-flv; codecs="'+_.videoCodec+","+_.audioCodec+'"'):_.mimeType='video/x-flv; codecs="'+_.audioCodec+'"',_.isComplete()&&this._onMediaInfo(_)}var y=this._parseMP3AudioData(e,t+1,r-1,!1);if(void 0==y)return;var b=this._timestampBase+i,E={unit:y,length:y.byteLength,dts:b,pts:b};c.samples.push(E),c.length+=y.length}}}},{key:"_parseAACAudioData",value:function(e,t,r){if(r<=1)return void k.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");var i={},n=new Uint8Array(e,t,r);return i.packetType=n[0],0===n[0]?i.data=this._parseAACAudioSpecificConfig(e,t+1,r-1):i.data=n.subarray(1),i}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,r){var i=new Uint8Array(e,t,r),n=null,a=0,o=0,s=0,l=null;if(a=o=i[0]>>>3,(s=(7&i[0])<<1|i[1]>>>7)<0||s>=this._mpegSamplingRates.length)return void this._onError(D.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");var u=this._mpegSamplingRates[s],d=(120&i[1])>>>3;if(d<0||d>=8)return void this._onError(D.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");5===a&&(l=(7&i[1])<<1|i[2]>>>7,i[2]);var c=self.navigator.userAgent.toLowerCase();return-1!==c.indexOf("firefox")?s>=6?(a=5,n=new Array(4),l=s-3):(a=2,n=new Array(2),l=s):-1!==c.indexOf("android")?(a=2,n=new Array(2),l=s):(a=5,l=s,n=new Array(4),s>=6?l=s-3:1===d&&(a=2,n=new Array(2),l=s)),n[0]=a<<3,n[0]|=(15&s)>>>1,n[1]=(15&s)<<7,n[1]|=(15&d)<<3,5===a&&(n[1]|=(15&l)>>>1,n[2]=(1&l)<<7,n[2]|=8,n[3]=0),{config:n,samplingRate:u,channelCount:d,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+o}}},{key:"_parseMP3AudioData",value:function(e,t,r,i){if(r<4)return void k.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");var n=(this._littleEndian,new Uint8Array(e,t,r)),a=null;if(i){if(255!==n[0])return;var o=n[1]>>>3&3,s=(6&n[1])>>1,l=(240&n[2])>>>4,u=(12&n[2])>>>2,d=n[3]>>>6&3,c=3!==d?2:1,f=0,h=0;switch(o){case 0:f=this._mpegAudioV25SampleRateTable[u];break;case 2:f=this._mpegAudioV20SampleRateTable[u];break;case 3:f=this._mpegAudioV10SampleRateTable[u]}switch(s){case 1:34,l<this._mpegAudioL3BitRateTable.length&&(h=this._mpegAudioL3BitRateTable[l]);break;case 2:33,l<this._mpegAudioL2BitRateTable.length&&(h=this._mpegAudioL2BitRateTable[l]);break;case 3:32,l<this._mpegAudioL1BitRateTable.length&&(h=this._mpegAudioL1BitRateTable[l])}a={bitRate:h,samplingRate:f,channelCount:c,codec:"mp3",originalCodec:"mp3"}}else a=n;return a}},{key:"_parseVideoData",value:function(e,t,r,i,n){if(r<=1)return void k.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var a=new Uint8Array(e,t,r)[0],o=(240&a)>>>4,s=15&a;if(7!==s)return void this._onError(D.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+s);this._parseAVCVideoPacket(e,t+1,r-1,i,n,o)}}},{key:"_parseAVCVideoPacket",value:function(e,t,r,i,n,a){if(r<4)return void k.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var o=this._littleEndian,s=new DataView(e,t,r),l=s.getUint8(0),u=16777215&s.getUint32(0,!o),d=u<<8>>8;if(0===l)this._parseAVCDecoderConfigurationRecord(e,t+4,r-4);else if(1===l)this._parseAVCVideoData(e,t+4,r-4,i,n,a,d);else if(2!==l)return void this._onError(D.default.FORMAT_ERROR,"Flv: Invalid video packet type "+l)}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,r){if(r<7)return void k.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");var i=this._videoMetadata,n=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,r);i?void 0!==i.avcc&&k.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),i=this._videoMetadata={},i.type="video",i.id=n.id,i.timescale=this._timescale,i.duration=this._duration);var s=o.getUint8(0),l=o.getUint8(1);o.getUint8(2),o.getUint8(3);if(1!==s||0===l)return void this._onError(D.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");if(this._naluLengthSize=1+(3&o.getUint8(4)),3!==this._naluLengthSize&&4!==this._naluLengthSize)return void this._onError(D.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));var u=31&o.getUint8(5);if(0===u)return void this._onError(D.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");u>1&&k.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+u);for(var d=6,c=0;c<u;c++){var f=o.getUint16(d,!a);if(d+=2,0!==f){var h=new Uint8Array(e,t+d,f);d+=f;var p=A.default.parseSPS(h);if(0===c){i.codecWidth=p.codec_size.width,i.codecHeight=p.codec_size.height,i.presentWidth=p.present_size.width,i.presentHeight=p.present_size.height,i.profile=p.profile_string,i.level=p.level_string,i.bitDepth=p.bit_depth,i.chromaFormat=p.chroma_format,i.sarRatio=p.sar_ratio,i.frameRate=p.frame_rate,!1!==p.frame_rate.fixed&&0!==p.frame_rate.fps_num&&0!==p.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var g=i.frameRate.fps_den,m=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(g/m);for(var v=h.subarray(1,4),_="avc1.",y=0;y<3;y++){var b=v[y].toString(16);b.length<2&&(b="0"+b),_+=b}i.codec=_;var E=this._mediaInfo;E.width=i.codecWidth,E.height=i.codecHeight,E.fps=i.frameRate.fps,E.profile=i.profile,E.level=i.level,E.refFrames=p.ref_frames,E.chromaFormat=p.chroma_format_string,E.sarNum=i.sarRatio.width,E.sarDen=i.sarRatio.height,E.videoCodec=_,E.hasAudio?null!=E.audioCodec&&(E.mimeType='video/x-flv; codecs="'+E.videoCodec+","+E.audioCodec+'"'):E.mimeType='video/x-flv; codecs="'+E.videoCodec+'"',E.isComplete()&&this._onMediaInfo(E)}}}var S=o.getUint8(d);if(0===S)return void this._onError(D.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");S>1&&k.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+S),d++;for(var w=0;w<S;w++){var T=o.getUint16(d,!a);d+=2,0!==T&&(d+=T)}i.avcc=new Uint8Array(r),i.avcc.set(new Uint8Array(e,t,r),0),k.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}},{key:"_parseAVCVideoData",value:function(e,t,r,i,n,a,o){for(var s=this._littleEndian,l=new DataView(e,t,r),u=[],d=0,c=0,f=this._naluLengthSize,h=this._timestampBase+i,p=1===a;c<r;){if(c+4>=r){k.default.w(this.TAG,"Malformed Nalu near timestamp "+h+", offset = "+c+", dataSize = "+r);break}var g=l.getUint32(c,!s);if(3===f&&(g>>>=8),g>r-f)return void k.default.w(this.TAG,"Malformed Nalus near timestamp "+h+", NaluSize > DataSize!");var m=31&l.getUint8(c+f);5===m&&(p=!0);var v=new Uint8Array(e,t+c,f+g),_={type:m,data:v};u.push(_),d+=v.byteLength,c+=f+g}if(u.length){var y=this._videoTrack,b={units:u,length:d,isKeyframe:p,dts:h,cts:o,pts:h+o};p&&(b.fileposition=n),y.samples.push(b),y.length+=d}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e}},{key:"onMetaDataArrived",get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e}},{key:"onScriptDataArrived",get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}},{key:"overridedDuration",get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e}},{key:"overridedHasAudio",set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e}},{key:"overridedHasVideo",set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e}}],[{key:"probe",value:function(e){var t=new Uint8Array(e),r={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return r;var i=(4&t[4])>>>2!=0,n=0!=(1&t[4]),a=o(t,5);return a<9?r:{match:!0,consumed:a,dataOffset:a,hasAudioTrack:i,hasVideoTrack:n}}}]),p}();r.default=p},{"../core/media-info.js":7,"../utils/exception.js":40,"../utils/logger.js":41,"./amf-parser.js":15,"./demux-errors.js":16,"./sps-parser.js":19}],19:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=e("./exp-golomb.js"),q=function(e){return e&&e.__esModule?e:{default:e}}(a),o=function(){function H(){i(this,H)}return n(H,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),n=0,a=0;a<r;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(i[n]=t[a],n++);return new Uint8Array(i.buffer,0,n)}},{key:"parseSPS",value:function(e){var t=H._ebsp2rbsp(e),r=new q.default(t);r.readByte();var i=r.readByte();r.readByte();var n=r.readByte();r.readUEG();var a=H.getProfileString(i),o=H.getLevelString(n),s=1,l=420,u=[0,420,422,444],d=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(s=r.readUEG(),3===s&&r.readBits(1),s<=3&&(l=u[s]),d=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var c=3!==s?8:12,f=0;f<c;f++)r.readBool()&&(f<6?H._skipScalingList(r,16):H._skipScalingList(r,64));r.readUEG();var h=r.readUEG();if(0===h)r.readUEG();else if(1===h){r.readBits(1),r.readSEG(),r.readSEG();for(var p=r.readUEG(),g=0;g<p;g++)r.readSEG()}var m=r.readUEG();r.readBits(1);var v=r.readUEG(),_=r.readUEG(),y=r.readBits(1);0===y&&r.readBits(1),r.readBits(1);var b=0,E=0,S=0,w=0;r.readBool()&&(b=r.readUEG(),E=r.readUEG(),S=r.readUEG(),w=r.readUEG());var T=1,k=1,A=0,D=!0,R=0,O=0;if(r.readBool()){if(r.readBool()){var L=r.readByte(),C=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],P=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];L>0&&L<16?(T=C[L-1],k=P[L-1]):255===L&&(T=r.readByte()<<8|r.readByte(),k=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var x=r.readBits(32),I=r.readBits(32);D=r.readBool(),R=I,O=2*x,A=R/O}}var M=1;1===T&&1===k||(M=T/k);var j=0,B=0;if(0===s)j=1,B=2-y;else{var F=3===s?1:2,N=1===s?2:1;j=F,B=N*(2-y)}var U=16*(v+1),G=16*(_+1)*(2-y);U-=(b+E)*j,G-=(S+w)*B;var V=Math.ceil(U*M);return r.destroy(),r=null,{profile_string:a,level_string:o,bit_depth:d,ref_frames:m,chroma_format:l,chroma_format_string:H.getChromaFormatString(l),frame_rate:{fixed:D,fps:A,fps_den:O,fps_num:R},sar_ratio:{width:T,height:k},codec_size:{width:U,height:G},present_size:{width:V,height:G}}}},{key:"_skipScalingList",value:function(e,t){for(var r=8,i=8,n=0,a=0;a<t;a++)0!==i&&(n=e.readSEG(),i=(r+n+256)%256),r=0===i?r:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),H}();r.default=o},{"./exp-golomb.js":17}],20:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){var r=e;if(null==r||"object"!==(void 0===r?"undefined":s(r)))throw new S.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!r.hasOwnProperty("type"))throw new S.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(r.type){case"flv":return new p.default(r,t);default:return new m.default(r,t)}}function a(){return c.default.supportMSEH264Playback()}function o(){return c.default.getFeatureList()}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=e("./utils/polyfill.js"),u=i(l),d=e("./core/features.js"),c=i(d),f=e("./io/loader.js"),h=e("./player/flv-player.js"),p=i(h),g=e("./player/native-player.js"),m=i(g),v=e("./player/player-events.js"),_=i(v),y=e("./player/player-errors.js"),b=e("./utils/logging-control.js"),E=i(b),S=e("./utils/exception.js");u.default.install();var w={};w.createPlayer=n,w.isSupported=a,w.getFeatureList=o,w.BaseLoader=f.BaseLoader,w.LoaderStatus=f.LoaderStatus,w.LoaderErrors=f.LoaderErrors,w.Events=_.default,w.ErrorTypes=y.ErrorTypes,w.ErrorDetails=y.ErrorDetails,w.FlvPlayer=p.default,w.NativePlayer=m.default,w.LoggingControl=E.default,Object.defineProperty(w,"version",{enumerable:!0,get:function(){return"1.5.0"}}),r.default=w},{"./core/features.js":6,"./io/loader.js":24,"./player/flv-player.js":32,"./player/native-player.js":33,"./player/player-errors.js":34,"./player/player-events.js":35,"./utils/exception.js":40,"./utils/logging-control.js":42,"./utils/polyfill.js":43}],21:[function(e,t,r){"use strict";t.exports=e("./flv.js").default},{"./flv.js":20}],22:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},l=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),u=e("../utils/logger.js"),c=(i(u),e("../utils/browser.js")),f=i(c),h=e("./loader.js"),p=e("../utils/exception.js"),g=function(e){function i(e,t){n(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"fetch-stream-loader"));return r.TAG="FetchStreamLoader",r._seekHandler=e,r._config=t,r._needStash=!0,r._requestAbort=!1,r._contentLength=null,r._receivedLength=0,r}return o(i,e),l(i,null,[{key:"isSupported",value:function(){try{var e=f.default.msedge&&f.default.version.minor>=15048,t=!f.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}}}]),l(i,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){var i=this;this._dataSource=e,this._range=t;var r=e.url;this._config.reuseRedirectedURL&&void 0!=e.redirectedURL&&(r=e.redirectedURL);var n=this._seekHandler.getConfig(r,t),a=new self.Headers;if("object"===d(n.headers)){var o=n.headers;for(var s in o)o.hasOwnProperty(s)&&a.append(s,o[s])}var l={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"===d(this._config.headers))for(var u in this._config.headers)a.append(u,this._config.headers[u]);!1===e.cors&&(l.mode="same-origin"),e.withCredentials&&(l.credentials="include"),e.referrerPolicy&&(l.referrerPolicy=e.referrerPolicy),this._status=h.LoaderStatus.kConnecting,self.fetch(n.url,l).then(function(e){if(i._requestAbort)return i._requestAbort=!1,void(i._status=h.LoaderStatus.kIdle);if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==n.url&&i._onURLRedirect){var t=i._seekHandler.removeURLParameters(e.url);i._onURLRedirect(t)}var r=e.headers.get("Content-Length");return null!=r&&(i._contentLength=parseInt(r),0!==i._contentLength&&i._onContentLengthKnown&&i._onContentLengthKnown(i._contentLength)),i._pump.call(i,e.body.getReader())}if(i._status=h.LoaderStatus.kError,!i._onError)throw new p.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);i._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}).catch(function(e){if(i._status=h.LoaderStatus.kError,!i._onError)throw e;i._onError(h.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})})}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"_pump",value:function(a){var o=this;return a.read().then(function(e){if(e.done)if(null!==o._contentLength&&o._receivedLength<o._contentLength){o._status=h.LoaderStatus.kError;var t=h.LoaderErrors.EARLY_EOF,r={code:-1,msg:"Fetch stream meet Early-EOF"};if(!o._onError)throw new p.RuntimeException(r.msg);o._onError(t,r)}else o._status=h.LoaderStatus.kComplete,o._onComplete&&o._onComplete(o._range.from,o._range.from+o._receivedLength-1);else{if(!0===o._requestAbort)return o._requestAbort=!1,o._status=h.LoaderStatus.kComplete,a.cancel();o._status=h.LoaderStatus.kBuffering;var i=e.value.buffer,n=o._range.from+o._receivedLength;o._receivedLength+=i.byteLength,o._onDataArrival&&o._onDataArrival(i,n,o._receivedLength),o._pump(a)}}).catch(function(e){if(11!==e.code||!f.default.msedge){o._status=h.LoaderStatus.kError;var t=0,r=null;if(19!==e.code&&"network error"!==e.message||!(null===o._contentLength||null!==o._contentLength&&o._receivedLength<o._contentLength)?(t=h.LoaderErrors.EXCEPTION,r={code:e.code,msg:e.message}):(t=h.LoaderErrors.EARLY_EOF,r={code:e.code,msg:"Fetch stream meet Early-EOF"}),!o._onError)throw new p.RuntimeException(r.msg);o._onError(t,r)}})}}]),i}(h.BaseLoader);r.default=g},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],23:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),o=e("../utils/logger.js"),s=i(o),l=e("./speed-sampler.js"),u=i(l),d=e("./loader.js"),c=e("./fetch-stream-loader.js"),f=i(c),h=e("./xhr-moz-chunked-loader.js"),p=i(h),g=e("./xhr-msstream-loader.js"),m=(i(g),e("./xhr-range-loader.js")),v=i(m),_=e("./websocket-loader.js"),y=i(_),b=e("./range-seek-handler.js"),E=i(b),S=e("./param-seek-handler.js"),w=i(S),T=e("../utils/exception.js"),k=function(){function i(e,t,r){n(this,i),this.TAG="IOController",this._config=t,this._extraData=r,this._stashInitialSize=393216,void 0!=t.stashInitialSize&&t.stashInitialSize>0&&(this._stashInitialSize=t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===t.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new u.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return a(i,[{key:"destroy",value:function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null}},{key:"isWorking",value:function(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function(){return this._paused}},{key:"_selectSeekHandler",value:function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new E.default(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",r=e.seekParamEnd||"bend";this._seekHandler=new w.default(t,r)}else{if("custom"!==e.seekType)throw new T.InvalidArgumentException("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new T.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}}},{key:"_selectLoader",value:function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=y.default;else if(f.default.isSupported())this._loaderClass=f.default;else if(p.default.isSupported())this._loaderClass=p.default;else{if(!v.default.isSupported())throw new T.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=v.default}}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)}},{key:"open",value:function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))}},{key:"abort",value:function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)}},{key:"pause",value:function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)}},{key:"resume",value:function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}}},{key:"seek",value:function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)}},{key:"_internalSeek",value:function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var r={from:e,to:-1};this._currentRange={from:r.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,r),this._onSeeked&&this._onSeeked()}},{key:"updateUrl",value:function(e){if(!e||"string"!=typeof e||0===e.length)throw new T.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e}},{key:"_expandBuffer",value:function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var r=new ArrayBuffer(t);if(this._stashUsed>0){var i=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(r,0,t).set(i,0)}this._stashBuffer=r,this._bufferSize=t}}},{key:"_normalizeSpeed",value:function(e){var t=this._speedNormalizeList,r=t.length-1,i=0,n=0,a=r;if(e<t[0])return t[0];for(;n<=a;){if((i=n+Math.floor((a-n)/2))===r||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?n=i+1:a=i-1}}},{key:"_adjustStashSize",value:function(e){var t=0;(t=this._config.isLive?e:e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var r=1024*t+1048576;this._bufferSize<r&&this._expandBuffer(r),this._stashSize=1024*t}},{key:"_dispatchChunks",value:function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)}},{key:"_onURLRedirect",value:function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)}},{key:"_onContentLengthKnown",value:function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)}},{key:"_onLoaderChunkArrival",value:function(e,t,r){if(!this._onDataArrival)throw new T.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var i=this._speedSampler.lastSecondKBps;if(0!==i){var n=this._normalizeSpeed(i);this._speedNormalized!==n&&(this._speedNormalized=n,this._adjustStashSize(n))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize){var a=new Uint8Array(this._stashBuffer,0,this._stashSize);a.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var o=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed),l=this._dispatchChunks(s,this._stashByteStart);if(l<s.byteLength){if(l>0){var u=new Uint8Array(s,l);o.set(u,0),this._stashUsed=u.byteLength,this._stashByteStart+=l}}else this._stashUsed=0,this._stashByteStart+=l;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var d=this._dispatchChunks(e,t);if(d<e.byteLength){var c=e.byteLength-d;c>this._bufferSize&&(this._expandBuffer(c),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,d),0),this._stashUsed+=c,this._stashByteStart=t+d}}}else if(0===this._stashUsed){var f=this._dispatchChunks(e,t);if(f<e.byteLength){var h=e.byteLength-f;h>this._bufferSize&&this._expandBuffer(h);var p=new Uint8Array(this._stashBuffer,0,this._bufferSize);p.set(new Uint8Array(e,f),0),this._stashUsed+=h,this._stashByteStart=t+f}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var g=new Uint8Array(this._stashBuffer,0,this._bufferSize);g.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var m=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(m<this._stashUsed&&m>0){var v=new Uint8Array(this._stashBuffer,m);g.set(v,0)}this._stashUsed-=m,this._stashByteStart+=m}}}},{key:"_flushStashBuffer",value:function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),r=this._dispatchChunks(t,this._stashByteStart),i=t.byteLength-r;if(r<t.byteLength){if(!e){if(r>0){var n=new Uint8Array(this._stashBuffer,0,this._bufferSize),a=new Uint8Array(t,r);n.set(a,0),this._stashUsed=a.byteLength,this._stashByteStart+=r}return 0}s.default.w(this.TAG,i+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,i}return 0}},{key:"_onLoaderComplete",value:function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)}},{key:"_onLoaderError",value:function(e,t){switch(s.default.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case d.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var r=this._currentRange.to+1;return void(r<this._totalLength&&(s.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(r,!1)))}e=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;case d.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case d.LoaderErrors.CONNECTING_TIMEOUT:case d.LoaderErrors.HTTP_STATUS_CODE_INVALID:case d.LoaderErrors.EXCEPTION:}if(!this._onError)throw new T.RuntimeException("IOException: "+t.msg);this._onError(e,t)}},{key:"status",get:function(){return this._loader.status}},{key:"extraData",get:function(){return this._extraData},set:function(e){this._extraData=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onSeeked",get:function(){return this._onSeeked},set:function(e){this._onSeeked=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}},{key:"onRedirect",get:function(){return this._onRedirect},set:function(e){this._onRedirect=e}},{key:"onRecoveredEarlyEof",get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e}},{key:"currentURL",get:function(){return this._dataSource.url}},{key:"hasRedirect",get:function(){return null!=this._redirectedURL||void 0!=this._dataSource.redirectedURL}},{key:"currentRedirectedURL",get:function(){return this._redirectedURL||this._dataSource.redirectedURL}},{key:"currentSpeed",get:function(){return this._loaderClass===v.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function(){return this._loader.type}}]),i}();r.default=k},{"../utils/exception.js":40,"../utils/logger.js":41,"./fetch-stream-loader.js":22,"./loader.js":24,"./param-seek-handler.js":25,"./range-seek-handler.js":26,"./speed-sampler.js":27,"./websocket-loader.js":28,"./xhr-moz-chunked-loader.js":29,"./xhr-msstream-loader.js":30,"./xhr-range-loader.js":31}],24:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.BaseLoader=r.LoaderErrors=r.LoaderStatus=void 0;var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=e("../utils/exception.js"),o=r.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};r.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},r.BaseLoader=function(){function t(e){i(this,t),this._type=e||"undefined",this._status=o.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return n(t,[{key:"destroy",value:function(){this._status=o.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===o.kConnecting||this._status===o.kBuffering}},{key:"open",value:function(e,t){throw new a.NotImplementedException("Unimplemented abstract function!")}},{key:"abort",value:function(){throw new a.NotImplementedException("Unimplemented abstract function!")}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),t}()},{"../utils/exception.js":40}],25:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=function(){function r(e,t){i(this,r),this._startName=e,this._endName=t}return n(r,[{key:"getConfig",value:function(e,t){var r=e;if(0!==t.from||-1!==t.to){var i=!0;-1===r.indexOf("?")&&(r+="?",i=!1),i&&(r+="&"),r+=this._startName+"="+t.from.toString(),-1!==t.to&&(r+="&"+this._endName+"="+t.to.toString())}return{url:r,headers:{}}}},{key:"removeURLParameters",value:function(e){var t=e.split("?")[0],r=void 0,i=e.indexOf("?");-1!==i&&(r=e.substring(i+1));var n="";if(void 0!=r&&r.length>0)for(var a=r.split("&"),o=0;o<a.length;o++){var s=a[o].split("="),l=o>0;s[0]!==this._startName&&s[0]!==this._endName&&(l&&(n+="&"),n+=a[o])}return 0===n.length?t:t+"?"+n}}]),r}();r.default=a},{}],26:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=function(){function t(e){i(this,t),this._zeroStart=e||!1}return n(t,[{key:"getConfig",value:function(e,t){var r={};if(0!==t.from||-1!==t.to){var i=void 0;i=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",r.Range=i}else this._zeroStart&&(r.Range="bytes=0-");return{url:e,headers:r}}},{key:"removeURLParameters",value:function(e){return e}}]),t}();r.default=a},{}],27:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=function(){function e(){i(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return n(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}},{key:"averageKBps",get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024}}]),e}();r.default=a},{}],28:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},s=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),l=e("../utils/logger.js"),u=(function(e){e&&e.__esModule}(l),e("./loader.js")),d=e("../utils/exception.js"),c=function(e){function t(){i(this,t);var e=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"websocket-loader"));return e.TAG="WebSocketLoader",e._needStash=!0,e._ws=null,e._requestAbort=!1,e._receivedLength=0,e}return a(t,e),s(t,null,[{key:"isSupported",value:function(){try{return void 0!==self.WebSocket}catch(e){return!1}}}]),s(t,[{key:"destroy",value:function(){this._ws&&this.abort(),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=u.LoaderStatus.kConnecting}catch(e){this._status=u.LoaderStatus.kError;var r={code:e.code,msg:e.message};if(!this._onError)throw new d.RuntimeException(r.msg);this._onError(u.LoaderErrors.EXCEPTION,r)}}},{key:"abort",value:function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=u.LoaderStatus.kComplete}},{key:"_onWebSocketOpen",value:function(e){this._status=u.LoaderStatus.kBuffering}},{key:"_onWebSocketClose",value:function(e){if(!0===this._requestAbort)return void(this._requestAbort=!1);this._status=u.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)}},{key:"_onWebSocketMessage",value:function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var r=new FileReader;r.onload=function(){t._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(e.data)}else{this._status=u.LoaderStatus.kError;var i={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new d.RuntimeException(i.msg);this._onError(u.LoaderErrors.EXCEPTION,i)}}},{key:"_dispatchArrayBuffer",value:function(e){var t=e,r=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)}},{key:"_onWebSocketError",value:function(e){this._status=u.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new d.RuntimeException(t.msg);this._onError(u.LoaderErrors.EXCEPTION,t)}}]),t}(u.BaseLoader);r.default=c},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],29:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},l=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),i=e("../utils/logger.js"),d=function(e){return e&&e.__esModule?e:{default:e}}(i),c=e("./loader.js"),f=e("../utils/exception.js"),h=function(e){function i(e,t){n(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"xhr-moz-chunked-loader"));return r.TAG="MozChunkedLoader",r._seekHandler=e,r._config=t,r._needStash=!0,r._xhr=null,r._requestAbort=!1,r._contentLength=null,r._receivedLength=0,r}return o(i,e),l(i,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return d.default.w("MozChunkedLoader",e.message),!1}}}]),l(i,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t;var r=e.url;this._config.reuseRedirectedURL&&void 0!=e.redirectedURL&&(r=e.redirectedURL);var i=this._seekHandler.getConfig(r,t);this._requestURL=i.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",i.url,!0),n.responseType="moz-chunked-arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),e.withCredentials&&(n.withCredentials=!0),"object"===u(i.headers)){var a=i.headers;for(var o in a)a.hasOwnProperty(o)&&n.setRequestHeader(o,a[o])}if("object"===u(this._config.headers)){var s=this._config.headers;for(var l in s)s.hasOwnProperty(l)&&n.setRequestHeader(l,s[l])}this._status=c.LoaderStatus.kConnecting,n.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=c.LoaderStatus.kComplete}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var r=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(r)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=c.LoaderStatus.kError,!this._onError)throw new f.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=c.LoaderStatus.kBuffering}}},{key:"_onProgress",value:function(e){if(this._status!==c.LoaderStatus.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)}}},{key:"_onLoadEnd",value:function(e){if(!0===this._requestAbort)return void(this._requestAbort=!1);this._status!==c.LoaderStatus.kError&&(this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},{key:"_onXhrError",value:function(e){this._status=c.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&e.loaded<this._contentLength?(t=c.LoaderErrors.EARLY_EOF,r={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=c.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new f.RuntimeException(r.msg);this._onError(t,r)}}]),i}(c.BaseLoader);r.default=h},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],30:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},l=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),i=e("../utils/logger.js"),u=function(e){return e&&e.__esModule?e:{default:e}}(i),f=e("./loader.js"),d=e("../utils/exception.js"),h=function(e){function i(e,t){n(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"xhr-msstream-loader"));return r.TAG="MSStreamLoader",r._seekHandler=e,r._config=t,r._needStash=!0,r._xhr=null,r._reader=null,r._totalRange=null,r._currentRange=null,r._currentRequestURL=null,r._currentRedirectedURL=null,r._contentLength=null,r._receivedLength=0,r._bufferLimit=16777216,r._lastTimeBufferSize=0,r._isReconnecting=!1,r}return o(i,e),l(i,null,[{key:"isSupported",value:function(){try{if(void 0===self.MSStream||void 0===self.MSStreamReader)return!1;var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="ms-stream","ms-stream"===e.responseType}catch(e){return u.default.w("MSStreamLoader",e.message),!1}}}]),l(i,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._internalOpen(e,t,!1)}},{key:"_internalOpen",value:function(e,t,r){this._dataSource=e,r?this._currentRange=t:this._totalRange=t;var i=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?i=this._currentRedirectedURL:void 0!=e.redirectedURL&&(i=e.redirectedURL));var n=this._seekHandler.getConfig(i,t);this._currentRequestURL=n.url;var a=this._reader=new self.MSStreamReader;a.onprogress=this._msrOnProgress.bind(this),a.onload=this._msrOnLoad.bind(this),a.onerror=this._msrOnError.bind(this);var o=this._xhr=new XMLHttpRequest;if(o.open("GET",n.url,!0),o.responseType="ms-stream",o.onreadystatechange=this._xhrOnReadyStateChange.bind(this),o.onerror=this._xhrOnError.bind(this),e.withCredentials&&(o.withCredentials=!0),"object"===c(n.headers)){var s=n.headers;for(var l in s)s.hasOwnProperty(l)&&o.setRequestHeader(l,s[l])}if("object"===c(this._config.headers)){var u=this._config.headers;for(var d in u)u.hasOwnProperty(d)&&o.setRequestHeader(d,u[d])}this._isReconnecting?this._isReconnecting=!1:this._status=f.LoaderStatus.kConnecting,o.send()}},{key:"abort",value:function(){this._internalAbort(),this._status=f.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)}},{key:"_xhrOnReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState)if(t.status>=200&&t.status<=299){if(this._status=f.LoaderStatus.kBuffering,void 0!=t.responseURL){var r=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&r!==this._currentRedirectedURL&&(this._currentRedirectedURL=r,this._onURLRedirect&&this._onURLRedirect(r))}var i=t.getResponseHeader("Content-Length");if(null!=i&&null==this._contentLength){var n=parseInt(i);n>0&&(this._contentLength=n,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=f.LoaderStatus.kError,!this._onError)throw new d.RuntimeException("MSStreamLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else if(3===t.readyState&&t.status>=200&&t.status<=299){this._status=f.LoaderStatus.kBuffering;var a=t.response;this._reader.readAsArrayBuffer(a)}}},{key:"_xhrOnError",value:function(e){this._status=f.LoaderStatus.kError;var t=f.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type};if(!this._onError)throw new d.RuntimeException(r.msg);this._onError(t,r)}},{key:"_msrOnProgress",value:function(e){var t=e.target,r=t.result;if(null==r)return void this._doReconnectIfNeeded();var i=r.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=r.byteLength;var n=this._totalRange.from+this._receivedLength;this._receivedLength+=i.byteLength,this._onDataArrival&&this._onDataArrival(i,n,this._receivedLength),r.byteLength>=this._bufferLimit&&(u.default.v(this.TAG,"MSStream buffer exceeded max size near "+(n+i.byteLength)+", reconnecting..."),this._doReconnectIfNeeded())}},{key:"_doReconnectIfNeeded",value:function(){if(null==this._contentLength||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var e={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,e,!0)}}},{key:"_msrOnLoad",value:function(e){this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)}},{key:"_msrOnError",value:function(e){this._status=f.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&this._receivedLength<this._contentLength?(t=f.LoaderErrors.EARLY_EOF,r={code:-1,msg:"MSStream meet Early-Eof"}):(t=f.LoaderErrors.EARLY_EOF,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new d.RuntimeException(r.msg);this._onError(t,r)}}]),i}(f.BaseLoader);r.default=h},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],31:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},l=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),d=e("../utils/logger.js"),c=i(d),f=e("./speed-sampler.js"),h=i(f),p=e("./loader.js"),g=e("../utils/exception.js"),m=function(e){function i(e,t){n(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"xhr-range-loader"));return r.TAG="RangeLoader",r._seekHandler=e,r._config=t,r._needStash=!1,r._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],r._currentChunkSizeKB=384,r._currentSpeedNormalized=0,r._zeroSpeedChunkCount=0,r._xhr=null,r._speedSampler=new h.default,r._requestAbort=!1,r._waitForTotalLength=!1,r._totalLengthReceived=!1,r._currentRequestURL=null,r._currentRedirectedURL=null,r._currentRequestRange=null,r._totalLength=null,r._contentLength=null,r._receivedLength=0,r._lastTimeLoaded=0,r}return o(i,e),l(i,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return c.default.w("RangeLoader",e.message),!1}}}]),l(i,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t,this._status=p.LoaderStatus.kConnecting;var r=!1;void 0!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(r=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||r?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))}},{key:"_openSubRange",value:function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,r=t+e;null!=this._contentLength&&r-this._range.from>=this._contentLength&&(r=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:r},this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function(e,t){this._lastTimeLoaded=0;var r=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?r=this._currentRedirectedURL:void 0!=e.redirectedURL&&(r=e.redirectedURL));var i=this._seekHandler.getConfig(r,t);this._currentRequestURL=i.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",i.url,!0),n.responseType="arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onload=this._onLoad.bind(this),n.onerror=this._onXhrError.bind(this),e.withCredentials&&(n.withCredentials=!0),"object"===u(i.headers)){var a=i.headers;for(var o in a)a.hasOwnProperty(o)&&n.setRequestHeader(o,a[o])}if("object"===u(this._config.headers)){var s=this._config.headers;for(var l in s)s.hasOwnProperty(l)&&n.setRequestHeader(l,s[l])}n.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._internalAbort(),this._status=p.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL){var r=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&r!==this._currentRedirectedURL&&(this._currentRedirectedURL=r,this._onURLRedirect&&this._onURLRedirect(r))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=p.LoaderStatus.kBuffering}else{if(this._status=p.LoaderStatus.kError,!this._onError)throw new g.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(p.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}}},{key:"_onProgress",value:function(e){if(this._status!==p.LoaderStatus.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var r=e.total;this._internalAbort(),null!=r&0!==r&&(this._totalLength=r)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(i)}}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,r=t.length-1,i=0,n=0,a=r;if(e<t[0])return t[0];for(;n<=a;){if((i=n+Math.floor((a-n)/2))===r||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?n=i+1:a=i-1}}},{key:"_onLoad",value:function(e){if(this._status!==p.LoaderStatus.kError){if(this._waitForTotalLength)return void(this._waitForTotalLength=!1);this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&++this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps),0!==t){var r=this._normalizeSpeed(t);this._currentSpeedNormalized!==r&&(this._currentSpeedNormalized=r,this._currentChunkSizeKB=r)}var i=e.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(i,n,this._receivedLength),a&&(this._status=p.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}}},{key:"_onXhrError",value:function(e){this._status=p.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=p.LoaderErrors.EARLY_EOF,r={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=p.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new g.RuntimeException(r.msg);this._onError(t,r)}},{key:"currentSpeed",get:function(){return this._speedSampler.lastSecondKBps}}]),i}(p.BaseLoader);r.default=m},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24,"./speed-sampler.js":27}],32:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),s=e("events"),l=i(s),u=e("../utils/logger.js"),d=i(u),c=e("../utils/browser.js"),f=i(c),h=e("./player-events.js"),p=i(h),g=e("../core/transmuxer.js"),m=i(g),v=e("../core/transmuxing-events.js"),_=i(v),y=e("../core/mse-controller.js"),b=i(y),E=e("../core/mse-events.js"),S=i(E),w=e("./player-errors.js"),T=e("../config.js"),k=e("../utils/exception.js"),A=function(){function i(e,t){if(n(this,i),this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new l.default,this._config=(0,T.createDefaultConfig)(),"object"===(void 0===t?"undefined":a(t))&&Object.assign(this._config,t),"flv"!==e.type.toLowerCase())throw new k.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===e.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=e,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var r=f.default.chrome&&(f.default.version.major<50||50===f.default.version.major&&f.default.version.build<2661);this._alwaysSeekKeyframe=!!(r||f.default.msedge||f.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return o(i,[{key:"destroy",value:function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var r=this;e===p.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then(function(){r._emitter.emit(p.default.MEDIA_INFO,r.mediaInfo)}):e===p.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then(function(){r._emitter.emit(p.default.STATISTICS_INFO,r.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new b.default(this._config),this._msectl.on(S.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(S.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(S.default.SOURCE_OPEN,function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())}),this._msectl.on(S.default.ERROR,function(e){t._emitter.emit(p.default.ERROR,w.ErrorTypes.MEDIA_ERROR,w.ErrorDetails.MEDIA_MSE_ERROR,e)}),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)}},{key:"load",value:function(){var i=this;if(!this._mediaElement)throw new k.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new k.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened)return void(this._hasPendingLoad=!0);this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new m.default(this._mediaDataSource,this._config),this._transmuxer.on(_.default.INIT_SEGMENT,function(e,t){i._msectl.appendInitSegment(t)}),this._transmuxer.on(_.default.MEDIA_SEGMENT,function(e,t){if(i._msectl.appendMediaSegment(t),i._config.lazyLoad&&!i._config.isLive){var r=i._mediaElement.currentTime;t.info.endDts>=1e3*(r+i._config.lazyLoadMaxDuration)&&null==i._progressChecker&&(d.default.v(i.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),i._suspendTransmuxer())}}),this._transmuxer.on(_.default.LOADING_COMPLETE,function(){i._msectl.endOfStream(),i._emitter.emit(p.default.LOADING_COMPLETE)}),this._transmuxer.on(_.default.RECOVERED_EARLY_EOF,function(){i._emitter.emit(p.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(_.default.IO_ERROR,function(e,t){i._emitter.emit(p.default.ERROR,w.ErrorTypes.NETWORK_ERROR,e,t)}),this._transmuxer.on(_.default.DEMUX_ERROR,function(e,t){i._emitter.emit(p.default.ERROR,w.ErrorTypes.MEDIA_ERROR,e,{code:-1,msg:t})}),this._transmuxer.on(_.default.MEDIA_INFO,function(e){i._mediaInfo=e,i._emitter.emit(p.default.MEDIA_INFO,Object.assign({},e))}),this._transmuxer.on(_.default.METADATA_ARRIVED,function(e){i._emitter.emit(p.default.METADATA_ARRIVED,e)}),this._transmuxer.on(_.default.SCRIPTDATA_ARRIVED,function(e){i._emitter.emit(p.default.SCRIPTDATA_ARRIVED,e)}),this._transmuxer.on(_.default.STATISTICS_INFO,function(e){i._statisticsInfo=i._fillStatisticsInfo(e),i._emitter.emit(p.default.STATISTICS_INFO,Object.assign({},i._statisticsInfo))}),this._transmuxer.on(_.default.RECOMMEND_SEEKPOINT,function(e){i._mediaElement&&!i._config.accurateSeek&&(i._requestSetTime=!0,i._mediaElement.currentTime=e/1e3)}),this._transmuxer.open()}}},{key:"unload",value:function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_fillStatisticsInfo",value:function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();r=n.totalVideoFrames,i=n.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=i),e}},{key:"_onmseUpdateEnd",value:function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,r=0,i=0;i<e.length;i++){var n=e.start(i),a=e.end(i);if(n<=t&&t<a){n,r=a;break}}r>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(d.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}}},{key:"_onmseBufferFull",value:function(){d.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()}},{key:"_suspendTransmuxer",value:function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))}},{key:"_checkProgressAndResume",value:function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,r=!1,i=0;i<t.length;i++){var n=t.start(i),a=t.end(i);if(e>=n&&e<a){e>=a-this._config.lazyLoadRecoverDuration&&(r=!0);break}}r&&(window.clearInterval(this._progressChecker),this._progressChecker=null,r&&(d.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))}},{key:"_isTimepointBuffered",value:function(e){for(var t=this._mediaElement.buffered,r=0;r<t.length;r++){var i=t.start(r),n=t.end(r);if(e>=i&&e<n)return!0}return!1}},{key:"_internalSeek",value:function(e){var t=this._isTimepointBuffered(e),r=!1,i=0;if(e<1&&this._mediaElement.buffered.length>0){var n=this._mediaElement.buffered.start(0);(n<1&&e<n||f.default.safari)&&(r=!0,i=f.default.safari?.1:n)}if(r)this._requestSetTime=!0,this._mediaElement.currentTime=i;else if(t){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=a?a.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_checkAndResumeStuckPlayback",value:function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var r=t.buffered;r.length>0&&t.currentTime<r.start(0)&&(d.default.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+r.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=r.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeking",value:function(e){var t=this._mediaElement.currentTime,r=this._mediaElement.buffered;if(this._requestSetTime)return void(this._requestSetTime=!1);if(t<1&&r.length>0){var i=r.start(0);if(i<1&&t<i||f.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=f.default.safari?.1:i)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var n=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=n&&(this._requestSetTime=!0,this._mediaElement.currentTime=n.dts/1e3)}return void(null!=this._progressChecker&&this._checkProgressAndResume())}this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_onvCanPlay",value:function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function(e){this._checkAndResumeStuckPlayback(!0)}},{key:"_onvProgress",value:function(e){this._checkAndResumeStuckPlayback()}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){return Object.assign({},this._mediaInfo)}},{key:"statisticsInfo",get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)}}]),i}();r.default=A},{"../config.js":5,"../core/mse-controller.js":9,"../core/mse-events.js":10,"../core/transmuxer.js":11,"../core/transmuxing-events.js":13,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./player-errors.js":34,"./player-events.js":35,events:2}],33:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),s=e("events"),l=i(s),u=e("./player-events.js"),d=i(u),c=e("../config.js"),f=e("../utils/exception.js"),h=function(){function r(e,t){if(n(this,r),this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new l.default,this._config=(0,c.createDefaultConfig)(),"object"===(void 0===t?"undefined":a(t))&&Object.assign(this._config,t),"flv"===e.type.toLowerCase())throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(e.hasOwnProperty("segments"))throw new f.InvalidArgumentException("NativePlayer("+e.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null}return o(r,[{key:"destroy",value:function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var r=this;e===d.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){r._emitter.emit(d.default.MEDIA_INFO,r.mediaInfo)}):e===d.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){r._emitter.emit(d.default.STATISTICS_INFO,r.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"load",value:function(){if(!this._mediaElement)throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(d.default.MEDIA_INFO,this.mediaInfo)}},{key:"_reportStatisticsInfo",value:function(){this._emitter.emit(d.default.STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){var e=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",t={mimeType:e+this._mediaDataSource.type};return this._mediaElement&&(t.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(t.width=this._mediaElement.videoWidth,t.height=this._mediaElement.videoHeight)),t}},{key:"statisticsInfo",get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();r=n.totalVideoFrames,i=n.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=i),e}}]),r}();r.default=h},{"../config.js":5,"../utils/exception.js":40,"./player-events.js":35,events:2}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorDetails=r.ErrorTypes=void 0;var i=e("../io/loader.js"),n=e("../demux/demux-errors.js"),a=function(e){return e&&e.__esModule?e:{default:e}}(n);r.ErrorTypes={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},r.ErrorDetails={NETWORK_EXCEPTION:i.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:i.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:i.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:i.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:a.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:a.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:a.default.CODEC_UNSUPPORTED}},{"../demux/demux-errors.js":16,"../io/loader.js":24}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};r.default=i},{}],36:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=function(){function e(){i(this,e)}return n(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();r.default=a},{}],37:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=function(){function c(){i(this,c)}return n(c,null,[{key:"init",value:function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var e in c.types)c.types.hasOwnProperty(e)&&(c.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=c.constants={};t.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),t.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),t.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSC=t.STCO=t.STTS,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),t.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,r=null,i=Array.prototype.slice.call(arguments,1),n=i.length,a=0;a<n;a++)t+=i[a].byteLength;r=new Uint8Array(t),r[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);for(var o=8,s=0;s<n;s++)r.set(i[s],o),o+=i[s].byteLength;return r}},{key:"generateInitSegment",value:function(e){var t=c.box(c.types.ftyp,c.constants.FTYP),r=c.moov(e),i=new Uint8Array(t.byteLength+r.byteLength);return i.set(t,0),i.set(r,t.byteLength),i}},{key:"moov",value:function(e){var t=c.mvhd(e.timescale,e.duration),r=c.trak(e),i=c.mvex(e);return c.box(c.types.moov,t,r,i)}},{key:"mvhd",value:function(e,t){return c.box(c.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(e){return c.box(c.types.trak,c.tkhd(e),c.mdia(e))}},{key:"tkhd",value:function(e){var t=e.id,r=e.duration,i=e.presentWidth,n=e.presentHeight;return c.box(c.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,255&i,0,0,n>>>8&255,255&n,0,0]))}},{key:"mdia",value:function(e){return c.box(c.types.mdia,c.mdhd(e),c.hdlr(e),c.minf(e))}},{key:"mdhd",value:function(e){var t=e.timescale,r=e.duration;return c.box(c.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,85,196,0,0]))}},{key:"hdlr",value:function(e){var t=null;return t="audio"===e.type?c.constants.HDLR_AUDIO:c.constants.HDLR_VIDEO,c.box(c.types.hdlr,t)}},{key:"minf",value:function(e){var t=null;return t="audio"===e.type?c.box(c.types.smhd,c.constants.SMHD):c.box(c.types.vmhd,c.constants.VMHD),c.box(c.types.minf,t,c.dinf(),c.stbl(e))}},{key:"dinf",value:function(){return c.box(c.types.dinf,c.box(c.types.dref,c.constants.DREF))}},{key:"stbl",value:function(e){return c.box(c.types.stbl,c.stsd(e),c.box(c.types.stts,c.constants.STTS),c.box(c.types.stsc,c.constants.STSC),c.box(c.types.stsz,c.constants.STSZ),c.box(c.types.stco,c.constants.STCO))}},{key:"stsd",value:function(e){return"audio"===e.type?"mp3"===e.codec?c.box(c.types.stsd,c.constants.STSD_PREFIX,c.mp3(e)):c.box(c.types.stsd,c.constants.STSD_PREFIX,c.mp4a(e)):c.box(c.types.stsd,c.constants.STSD_PREFIX,c.avc1(e))}},{key:"mp3",value:function(e){var t=e.channelCount,r=e.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return c.box(c.types[".mp3"],i)}},{key:"mp4a",value:function(e){var t=e.channelCount,r=e.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return c.box(c.types.mp4a,i,c.esds(e))}},{key:"esds",value:function(e){var t=e.config||[],r=t.length,i=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t).concat([6,1,2]));return c.box(c.types.esds,i)}},{key:"avc1",value:function(e){var t=e.avcc,r=e.codecWidth,i=e.codecHeight,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,i>>>8&255,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return c.box(c.types.avc1,n,c.box(c.types.avcC,t))}},{key:"mvex",value:function(e){return c.box(c.types.mvex,c.trex(e))}},{key:"trex",value:function(e){var t=e.id,r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return c.box(c.types.trex,r)}},{key:"moof",value:function(e,t){return c.box(c.types.moof,c.mfhd(e.sequenceNumber),c.traf(e,t))}},{key:"mfhd",value:function(e){var t=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return c.box(c.types.mfhd,t)}},{key:"traf",value:function(e,t){var r=e.id,i=c.box(c.types.tfhd,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),n=c.box(c.types.tfdt,new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t])),a=c.sdtp(e),o=c.trun(e,a.byteLength+16+16+8+16+8+8);return c.box(c.types.traf,i,n,o,a)}},{key:"sdtp",value:function(e){for(var t=e.samples||[],r=t.length,i=new Uint8Array(4+r),n=0;n<r;n++){var a=t[n].flags;i[n+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return c.box(c.types.sdtp,i)}},{key:"trun",value:function(e,t){var r=e.samples||[],i=r.length,n=12+16*i,a=new Uint8Array(n);t+=8+n,a.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0);for(var o=0;o<i;o++){var s=r[o].duration,l=r[o].size,u=r[o].flags,d=r[o].cts;a.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,l>>>24&255,l>>>16&255,l>>>8&255,255&l,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.isNonSync,0,0,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*o)}return c.box(c.types.trun,a)}},{key:"mdat",value:function(e){return c.box(c.types.mdat,e)}}]),c}();a.init(),r.default=a},{}],38:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),o=e("../utils/logger.js"),J=i(o),s=e("./mp4-generator.js"),Q=i(s),l=e("./aac-silent.js"),Z=i(l),u=e("../utils/browser.js"),$=i(u),ee=e("../core/media-segment-info.js"),d=e("../utils/exception.js"),c=function(){function t(e){n(this,t),this.TAG="MP4Remuxer",this._config=e,this._isLive=!0===e.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new ee.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new ee.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!$.default.chrome||!($.default.version.major<50||50===$.default.version.major&&$.default.version.build<2661)),this._fillSilentAfterSeek=$.default.msedge||$.default.msie,this._mp3UseMpegAudio=!$.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return a(t,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(e,t){if(!this._onMediaSegment)throw new d.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"_onTrackMetadataReceived",value:function(e,t){var r=null,i="mp4",n=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(i="mpeg",n="",r=new Uint8Array):r=Q.default.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,r=Q.default.generateInitSegment(t)}if(!this._onInitSegment)throw new d.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:r.buffer,codec:n,container:e+"/"+i,mediaDuration:t.duration})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"flushStashedSamples",value:function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,r={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(r.samples.push(e),r.length=e.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(i.samples.push(t),i.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(r,!0),this._remuxAudio(i,!0)}},{key:"_remuxAudio",value:function(e,t){if(null!=this._audioMeta){var r=e,i=r.samples,n=void 0,a=-1,o=-1,s=this._audioMeta.refSampleDuration,l="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,u=this._dtsBaseInited&&void 0===this._audioNextDts,d=!1;if(i&&0!==i.length&&(1!==i.length||t)){var c=0,f=null,h=0;l?(c=0,h=r.length):(c=8,h=8+r.length);var p=null;if(i.length>1&&(p=i.pop(),h-=p.length),null!=this._audioStashedLastSample){var g=this._audioStashedLastSample;this._audioStashedLastSample=null,i.unshift(g),h+=g.length}null!=p&&(this._audioStashedLastSample=p);var m=i[0].dts-this._dtsBase;if(this._audioNextDts)n=m-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())n=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(d=!0);else{var v=this._audioSegmentInfoList.getLastSampleBefore(m);if(null!=v){var _=m-(v.originalDts+v.duration);_<=3&&(_=0);var y=v.dts+v.duration+_;n=m-y}else n=0}if(d){var b=m-n,E=this._videoSegmentInfoList.getLastSegmentBefore(m);if(null!=E&&E.beginDts<b){var S=Z.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(S){var w=E.beginDts,T=b-E.beginDts;J.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+w+", duration: "+T),i.unshift({unit:S,dts:w,pts:w}),h+=S.byteLength}}else d=!1}for(var k=[],A=0;A<i.length;A++){var D=i[A],R=D.unit,O=D.dts-this._dtsBase,L=O-n;-1===a&&(a=L);var C=0;if(A!==i.length-1){C=i[A+1].dts-this._dtsBase-n-L}else if(null!=p){var P=p.dts-this._dtsBase-n;C=P-L}else C=k.length>=1?k[k.length-1].duration:Math.floor(s);var x=!1,I=null;if(C>1.5*s&&"mp3"!==this._audioMeta.codec&&this._fillAudioTimestampGap&&!$.default.safari){x=!0;var M=Math.abs(C-s),j=Math.ceil(M/s),B=L+s;J.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\ndts: "+(L+C)+" ms, expected: "+(L+Math.round(s))+" ms, delta: "+Math.round(M)+" ms, generate: "+j+" frames");var F=Z.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==F&&(J.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),F=R),I=[];for(var N=0;N<j;N++){var U=Math.round(B);if(I.length>0){var G=I[I.length-1];G.duration=U-G.dts}var V={dts:U,pts:U,cts:0,unit:F,size:F.byteLength,duration:0,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};I.push(V),h+=V.size,B+=s}var H=I[I.length-1];H.duration=L+C-H.dts,C=Math.round(s)}k.push({dts:L,pts:L,cts:0,unit:D.unit,size:D.unit.byteLength,duration:C,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),x&&k.push.apply(k,I)}l?f=new Uint8Array(h):(f=new Uint8Array(h),f[0]=h>>>24&255,f[1]=h>>>16&255,f[2]=h>>>8&255,f[3]=255&h,f.set(Q.default.types.mdat,4));for(var q=0;q<k.length;q++){var K=k[q].unit;f.set(K,c),c+=K.byteLength}var z=k[k.length-1];o=z.dts+z.duration,this._audioNextDts=o;var W=new ee.MediaSegmentInfo;W.beginDts=a,W.endDts=o,W.beginPts=a,W.endPts=o,W.originalBeginDts=k[0].originalDts,W.originalEndDts=z.originalDts+z.duration,W.firstSample=new ee.SampleInfo(k[0].dts,k[0].pts,k[0].duration,k[0].originalDts,!1),W.lastSample=new ee.SampleInfo(z.dts,z.pts,z.duration,z.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(W),r.samples=k,r.sequenceNumber++;var Y=null;Y=l?new Uint8Array:Q.default.moof(r,a),r.samples=[],r.length=0;var X={type:"audio",data:this._mergeBoxes(Y,f).buffer,sampleCount:k.length,info:W};l&&u&&(X.timestampOffset=a),this._onMediaSegment("audio",X)}}}},{key:"_remuxVideo",value:function(e,t){if(null!=this._videoMeta){var r=e,i=r.samples,n=void 0,a=-1,o=-1,s=-1,l=-1;if(i&&0!==i.length&&(1!==i.length||t)){var u=8,d=null,c=8+e.length,f=null;if(i.length>1&&(f=i.pop(),c-=f.length),null!=this._videoStashedLastSample){var h=this._videoStashedLastSample;this._videoStashedLastSample=null,i.unshift(h),c+=h.length}null!=f&&(this._videoStashedLastSample=f);var p=i[0].dts-this._dtsBase;if(this._videoNextDts)n=p-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())n=0;else{var g=this._videoSegmentInfoList.getLastSampleBefore(p);if(null!=g){var m=p-(g.originalDts+g.duration);m<=3&&(m=0);var v=g.dts+g.duration+m;n=p-v}else n=0}for(var _=new ee.MediaSegmentInfo,y=[],b=0;b<i.length;b++){var E=i[b],S=E.dts-this._dtsBase,w=E.isKeyframe,T=S-n,k=E.cts,A=T+k;-1===a&&(a=T,s=A);var D=0;if(b!==i.length-1){D=i[b+1].dts-this._dtsBase-n-T}else if(null!=f){var R=f.dts-this._dtsBase-n;D=R-T}else D=y.length>=1?y[y.length-1].duration:Math.floor(this._videoMeta.refSampleDuration);if(w){var O=new ee.SampleInfo(T,A,D,E.dts,!0);O.fileposition=E.fileposition,_.appendSyncPoint(O)}y.push({dts:T,pts:A,cts:k,units:E.units,size:E.length,isKeyframe:w,duration:D,originalDts:S,flags:{isLeading:0,dependsOn:w?2:1,isDependedOn:w?1:0,hasRedundancy:0,isNonSync:w?0:1}})}d=new Uint8Array(c),d[0]=c>>>24&255,d[1]=c>>>16&255,d[2]=c>>>8&255,d[3]=255&c,d.set(Q.default.types.mdat,4);for(var L=0;L<y.length;L++)for(var C=y[L].units;C.length;){var P=C.shift(),x=P.data;d.set(x,u),u+=x.byteLength}var I=y[y.length-1];if(o=I.dts+I.duration,l=I.pts+I.duration,this._videoNextDts=o,_.beginDts=a,_.endDts=o,_.beginPts=s,_.endPts=l,_.originalBeginDts=y[0].originalDts,_.originalEndDts=I.originalDts+I.duration,_.firstSample=new ee.SampleInfo(y[0].dts,y[0].pts,y[0].duration,y[0].originalDts,y[0].isKeyframe),_.lastSample=new ee.SampleInfo(I.dts,I.pts,I.duration,I.originalDts,I.isKeyframe),this._isLive||this._videoSegmentInfoList.append(_),r.samples=y,r.sequenceNumber++,this._forceFirstIDR){var M=y[0].flags;M.dependsOn=2,M.isNonSync=0}var j=Q.default.moof(r,a);r.samples=[],r.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(j,d).buffer,sampleCount:y.length,info:_})}}}},{key:"_mergeBoxes",value:function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),t}();r.default=c},{"../core/media-segment-info.js":8,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./aac-silent.js":36,"./mp4-generator.js":37}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},n={};if(i.browser){n[i.browser]=!0;var a=i.majorVersion.split(".");n.version={major:parseInt(i.majorVersion,10),string:i.version},a.length>1&&(n.version.minor=parseInt(a[1],10)),a.length>2&&(n.version.build=parseInt(a[2],10))}i.platform&&(n[i.platform]=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),(n.rv||n.iemobile)&&(n.rv&&delete n.rv,i.browser="msie",n.msie=!0),n.edge&&(delete n.edge,i.browser="msedge",n.msedge=!0),n.opr&&(i.browser="opera",n.opera=!0),n.safari&&n.android&&(i.browser="android",n.android=!0),n.name=i.browser,n.platform=i.platform;for(var o in s)s.hasOwnProperty(o)&&delete s[o];Object.assign(s,n)}(),r.default=s},{}],40:[function(e,t,r){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),s=r.RuntimeException=function(){function t(e){a(this,t),this._message=e}return o(t,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),t}();r.IllegalStateException=function(e){function t(e){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return n(t,e),o(t,[{key:"name",get:function(){return"IllegalStateException"}}]),t}(s),r.InvalidArgumentException=function(e){function t(e){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return n(t,e),o(t,[{key:"name",get:function(){return"InvalidArgumentException"}}]),t}(s),r.NotImplementedException=function(e){function t(e){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return n(t,e),o(t,[{key:"name",get:function(){return"NotImplementedException"}}]),t}(s)},{}],41:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),i=e("events"),o=function(e){return e&&e.__esModule?e:{default:e}}(i),s=function(){function i(){n(this,i)}return a(i,null,[{key:"e",value:function(e,t){e&&!i.FORCE_GLOBAL_TAG||(e=i.GLOBAL_TAG);var r="["+e+"] > "+t;i.ENABLE_CALLBACK&&i.emitter.emit("log","error",r),i.ENABLE_ERROR&&(console.error?console.error(r):console.warn?console.warn(r):console.log(r))}},{key:"i",value:function(e,t){e&&!i.FORCE_GLOBAL_TAG||(e=i.GLOBAL_TAG);var r="["+e+"] > "+t;i.ENABLE_CALLBACK&&i.emitter.emit("log","info",r),i.ENABLE_INFO&&(console.info?console.info(r):console.log(r))}},{key:"w",value:function(e,t){e&&!i.FORCE_GLOBAL_TAG||(e=i.GLOBAL_TAG);var r="["+e+"] > "+t;i.ENABLE_CALLBACK&&i.emitter.emit("log","warn",r),i.ENABLE_WARN&&(console.warn?console.warn(r):console.log(r))}},{key:"d",value:function(e,t){e&&!i.FORCE_GLOBAL_TAG||(e=i.GLOBAL_TAG);var r="["+e+"] > "+t;i.ENABLE_CALLBACK&&i.emitter.emit("log","debug",r),i.ENABLE_DEBUG&&(console.debug?console.debug(r):console.log(r))}},{key:"v",value:function(e,t){e&&!i.FORCE_GLOBAL_TAG||(e=i.GLOBAL_TAG);var r="["+e+"] > "+t;i.ENABLE_CALLBACK&&i.emitter.emit("log","verbose",r),i.ENABLE_VERBOSE&&console.log(r)}}]),i}();s.GLOBAL_TAG="flv.js",s.FORCE_GLOBAL_TAG=!1,s.ENABLE_ERROR=!0,s.ENABLE_INFO=!0,s.ENABLE_WARN=!0,s.ENABLE_DEBUG=!0,s.ENABLE_VERBOSE=!0,s.ENABLE_CALLBACK=!1,s.emitter=new o.default,r.default=s},{events:2}],42:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),o=e("events"),s=i(o),l=e("./logger.js"),u=i(l),d=function(){function r(){n(this,r)}return a(r,null,[{key:"getConfig",value:function(){return{globalTag:u.default.GLOBAL_TAG,forceGlobalTag:u.default.FORCE_GLOBAL_TAG,enableVerbose:u.default.ENABLE_VERBOSE,enableDebug:u.default.ENABLE_DEBUG,enableInfo:u.default.ENABLE_INFO,enableWarn:u.default.ENABLE_WARN,enableError:u.default.ENABLE_ERROR,enableCallback:u.default.ENABLE_CALLBACK}}},{key:"applyConfig",value:function(e){u.default.GLOBAL_TAG=e.globalTag,u.default.FORCE_GLOBAL_TAG=e.forceGlobalTag,u.default.ENABLE_VERBOSE=e.enableVerbose,u.default.ENABLE_DEBUG=e.enableDebug,u.default.ENABLE_INFO=e.enableInfo,u.default.ENABLE_WARN=e.enableWarn,u.default.ENABLE_ERROR=e.enableError,u.default.ENABLE_CALLBACK=e.enableCallback}},{key:"_notifyChange",value:function(){var e=r.emitter;if(e.listenerCount("change")>0){var t=r.getConfig();e.emit("change",t)}}},{key:"registerListener",value:function(e){r.emitter.addListener("change",e)}},{key:"removeListener",value:function(e){r.emitter.removeListener("change",e)}},{key:"addLogListener",value:function(e){u.default.emitter.addListener("log",e),u.default.emitter.listenerCount("log")>0&&(u.default.ENABLE_CALLBACK=!0,r._notifyChange())}},{key:"removeLogListener",value:function(e){u.default.emitter.removeListener("log",e),0===u.default.emitter.listenerCount("log")&&(u.default.ENABLE_CALLBACK=!1,r._notifyChange())}},{key:"forceGlobalTag",get:function(){return u.default.FORCE_GLOBAL_TAG},set:function(e){u.default.FORCE_GLOBAL_TAG=e,r._notifyChange()}},{key:"globalTag",get:function(){return u.default.GLOBAL_TAG},set:function(e){u.default.GLOBAL_TAG=e,r._notifyChange()}},{key:"enableAll",get:function(){return u.default.ENABLE_VERBOSE&&u.default.ENABLE_DEBUG&&u.default.ENABLE_INFO&&u.default.ENABLE_WARN&&u.default.ENABLE_ERROR},set:function(e){u.default.ENABLE_VERBOSE=e,u.default.ENABLE_DEBUG=e,u.default.ENABLE_INFO=e,u.default.ENABLE_WARN=e,u.default.ENABLE_ERROR=e,r._notifyChange()}},{key:"enableDebug",get:function(){return u.default.ENABLE_DEBUG},set:function(e){u.default.ENABLE_DEBUG=e,r._notifyChange()}},{key:"enableVerbose",get:function(){return u.default.ENABLE_VERBOSE},set:function(e){u.default.ENABLE_VERBOSE=e,r._notifyChange()}},{key:"enableInfo",get:function(){return u.default.ENABLE_INFO},set:function(e){u.default.ENABLE_INFO=e,r._notifyChange()}},{key:"enableWarn",get:function(){return u.default.ENABLE_WARN},set:function(e){u.default.ENABLE_WARN=e,r._notifyChange()}},{key:"enableError",get:function(){return u.default.ENABLE_ERROR},set:function(e){u.default.ENABLE_ERROR=e,r._notifyChange()}}]),r}();d.emitter=new s.default,r.default=d},{"./logger.js":41,events:2}],43:[function(t,e,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),a=function(){function e(){i(this,e)}return n(e,null,[{key:"install",value:function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(void 0!==i&&null!==i)for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t},"function"!=typeof self.Promise&&t("es6-promise").polyfill()}}]),e}();a.install(),r.default=a},{"es6-promise":1}],44:[function(e,t,r){"use strict";function l(e,t,r){var i=e;if(t+r<i.length){for(;r--;)if(128!=(192&i[++t]))return!1;return!0}return!1}function i(e){for(var t=[],r=e,i=0,n=e.length;i<n;)if(r[i]<128)t.push(String.fromCharCode(r[i])),++i;else{if(r[i]<192);else if(r[i]<224){if(l(r,i,1)){var a=(31&r[i])<<6|63&r[i+1];if(a>=128){t.push(String.fromCharCode(65535&a)),i+=2;continue}}}else if(r[i]<240){if(l(r,i,2)){var o=(15&r[i])<<12|(63&r[i+1])<<6|63&r[i+2];if(o>=2048&&55296!=(63488&o)){t.push(String.fromCharCode(65535&o)),i+=3;continue}}}else if(r[i]<248&&l(r,i,3)){var s=(7&r[i])<<18|(63&r[i+1])<<12|(63&r[i+2])<<6|63&r[i+3];if(s>65536&&s<1114112){s-=65536,t.push(String.fromCharCode(s>>>10|55296)),t.push(String.fromCharCode(1023&s|56320)),i+=4;continue}}t.push(String.fromCharCode(65533)),++i}return t.join("")}Object.defineProperty(r,"__esModule",{value:!0}),r.default=i},{}]},{},[21])(21)}()}).call(this,r(58))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var i;void 0===(i=function(){var K=function(){var l,u,d,c,s,f,b="undefined",E="object",h="Shockwave Flash",p="application/x-shockwave-flash",g="SWFObjectExprInst",t="onreadystatechange",m=window,v=document,_=navigator,y=!1,n=[],S=[],w=[],o=[],a=!1,T=!1,k=!0,A=!1,D=function(){var e=typeof v.getElementById!=b&&typeof v.getElementsByTagName!=b&&typeof v.createElement!=b,t=_.userAgent.toLowerCase(),r=_.platform.toLowerCase(),i=/win/.test(r||t),n=/mac/.test(r||t),a=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),o="Microsoft Internet Explorer"===_.appName,s=[0,0,0],l=null;if(typeof _.plugins!=b&&typeof _.plugins[h]==E)(l=_.plugins[h].description)&&typeof _.mimeTypes!=b&&_.mimeTypes[p]&&_.mimeTypes[p].enabledPlugin&&(o=!(y=!0),l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),s[0]=U(l.replace(/^(.*)\..*$/,"$1")),s[1]=U(l.replace(/^.*\.(.*)\s.*$/,"$1")),s[2]=/[a-zA-Z]/.test(l)?U(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof m.ActiveXObject!=b)try{var u=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");u&&(l=u.GetVariable("$version"))&&(o=!0,s=[U((l=l.split(" ")[1].split(","))[0]),U(l[1]),U(l[2])])}catch(e){}return{w3:e,pv:s,wk:a,ie:o,win:i,mac:n}}();D.w3&&((typeof v.readyState!=b&&("complete"===v.readyState||"interactive"===v.readyState)||typeof v.readyState==b&&(v.getElementsByTagName("body")[0]||v.body))&&r(),a||(typeof v.addEventListener!=b&&v.addEventListener("DOMContentLoaded",r,!1),D.ie&&(v.attachEvent(t,function e(){"complete"==v.readyState&&(v.detachEvent(t,e),r())}),m==top&&function t(){if(!a){try{v.documentElement.doScroll("left")}catch(e){return void setTimeout(t,0)}r()}}()),D.wk&&function e(){a||(/loaded|complete/.test(v.readyState)?r():setTimeout(e,0))}()));function r(){if(!a&&document.getElementsByTagName("body")[0]){try{var e,t=N("span");t.style.display="none",(e=v.getElementsByTagName("body")[0].appendChild(t)).parentNode.removeChild(e),t=e=null}catch(e){return}a=!0;for(var r=n.length,i=0;i<r;i++)n[i]()}}function e(e){a?e():n[n.length]=e}function R(){var e=S.length;if(0<e)for(var t=0;t<e;t++){var r=S[t].id,i=S[t].callbackFn,n={success:!1,id:r};if(0<D.pv[0]){var a=F(r);if(a)if(!G(S[t].swfVersion)||D.wk&&D.wk<312)if(S[t].expressInstall&&L()){var o={};o.data=S[t].expressInstall,o.width=a.getAttribute("width")||"0",o.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(o.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(o.align=a.getAttribute("align"));for(var s={},l=a.getElementsByTagName("param"),u=l.length,d=0;d<u;d++)"movie"!=l[d].getAttribute("name").toLowerCase()&&(s[l[d].getAttribute("name")]=l[d].getAttribute("value"));C(o,s,r,i)}else P(a),i&&i(n);else H(r,!0),i&&(n.success=!0,n.ref=O(r),n.id=r,i(n))}else if(H(r,!0),i){var c=O(r);c&&typeof c.SetVariable!=b&&(n.success=!0,n.ref=c,n.id=c.id),i(n)}}}function O(e){var t=null,r=F(e);return r&&"OBJECT"===r.nodeName.toUpperCase()&&(t=typeof r.SetVariable!==b?r:r.getElementsByTagName(E)[0]||r),t}function L(){return!T&&G("6.0.65")&&(D.win||D.mac)&&!(D.wk&&D.wk<312)}function C(e,t,r,i){var n=F(r);if(r=B(r),d=i||null,c={success:!(T=!0),id:r},n){u="OBJECT"==n.nodeName.toUpperCase()?(l=x(n),null):(l=n,r),e.id=g,(typeof e.width==b||!/%$/.test(e.width)&&U(e.width)<310)&&(e.width="310"),(typeof e.height==b||!/%$/.test(e.height)&&U(e.height)<137)&&(e.height="137");var a=D.ie?"ActiveX":"PlugIn",o="MMredirectURL="+encodeURIComponent(m.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+a+"&MMdoctitle="+encodeURIComponent(v.title.slice(0,47)+" - Flash Player Installation");if(typeof t.flashvars!=b?t.flashvars+="&"+o:t.flashvars=o,D.ie&&4!=n.readyState){var s=N("div");r+="SWFObjectNew",s.setAttribute("id",r),n.parentNode.insertBefore(s,n),n.style.display="none",j(n)}I(e,t,r)}}function P(e){if(D.ie&&4!=e.readyState){e.style.display="none";var t=N("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(x(e),t),j(e)}else e.parentNode.replaceChild(x(e),e)}function x(e){var t=N("div");if(D.win&&D.ie)t.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(E)[0];if(r){var i=r.childNodes;if(i)for(var n=i.length,a=0;a<n;a++)1==i[a].nodeType&&"PARAM"==i[a].nodeName||8==i[a].nodeType||t.appendChild(i[a].cloneNode(!0))}}return t}function I(e,t,r){var i,n=F(r);if(r=B(r),D.wk&&D.wk<312)return i;if(n){var a,o,s,l=D.ie?N("div"):N(E);for(s in typeof e.id==b&&(e.id=r),t)t.hasOwnProperty(s)&&"movie"!==s.toLowerCase()&&M(l,s,t[s]);for(a in D.ie&&(l=function(e,t){var r=N("div");return r.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+e+"'>"+t+"</object>",r.firstChild}(e.data,l.innerHTML)),e)e.hasOwnProperty(a)&&("styleclass"===(o=a.toLowerCase())?l.setAttribute("class",e[a]):"classid"!==o&&"data"!==o&&l.setAttribute(a,e[a]));D.ie?w[w.length]=e.id:(l.setAttribute("type",p),l.setAttribute("data",e.data)),n.parentNode.replaceChild(l,n),i=l}return i}function M(e,t,r){var i=N("param");i.setAttribute("name",t),i.setAttribute("value",r),e.appendChild(i)}function j(e){var r=F(e);r&&"OBJECT"==r.nodeName.toUpperCase()&&(D.ie?(r.style.display="none",function e(){if(4==r.readyState){for(var t in r)"function"==typeof r[t]&&(r[t]=null);r.parentNode.removeChild(r)}else setTimeout(e,10)}()):r.parentNode.removeChild(r))}function i(e){return e&&e.nodeType&&1===e.nodeType}function B(e){return i(e)?e.id:e}function F(e){if(i(e))return e;var t=null;try{t=v.getElementById(e)}catch(e){}return t}function N(e){return v.createElement(e)}function U(e){return parseInt(e,10)}function G(e){e+="";var t=D.pv,r=e.split(".");return r[0]=U(r[0]),r[1]=U(r[1])||0,r[2]=U(r[2])||0,t[0]>r[0]||t[0]==r[0]&&t[1]>r[1]||t[0]==r[0]&&t[1]==r[1]&&t[2]>=r[2]}function V(e,t,r,i){var n=v.getElementsByTagName("head")[0];if(n){var a="string"==typeof r?r:"screen";if(i&&(f=s=null),!s||f!=a){var o=N("style");o.setAttribute("type","text/css"),o.setAttribute("media",a),s=n.appendChild(o),D.ie&&typeof v.styleSheets!=b&&0<v.styleSheets.length&&(s=v.styleSheets[v.styleSheets.length-1]),f=a}s&&(typeof s.addRule!=b?s.addRule(e,t):typeof v.createTextNode!=b&&s.appendChild(v.createTextNode(e+" {"+t+"}")))}}function H(e,t){if(k){var r=t?"visible":"hidden",i=F(e);a&&i?i.style.visibility=r:"string"==typeof e&&V("#"+e,"visibility:"+r)}}function q(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=b?encodeURIComponent(e):e}n[0]=function(){y?function(){var r=v.getElementsByTagName("body")[0],i=N(E);i.setAttribute("style","visibility: hidden;"),i.setAttribute("type",p);var n=r.appendChild(i);if(n){var a=0;!function e(){if(typeof n.GetVariable!=b)try{var t=n.GetVariable("$version");t&&(t=t.split(" ")[1].split(","),D.pv=[U(t[0]),U(t[1]),U(t[2])])}catch(e){D.pv=[8,0,0]}else if(a<10)return a++,void setTimeout(e,10);r.removeChild(i),n=null,R()}()}else R()}():R()};D.ie&&window.attachEvent("onunload",function(){for(var e=o.length,t=0;t<e;t++)o[t][0].detachEvent(o[t][1],o[t][2]);for(var r=w.length,i=0;i<r;i++)j(w[i]);for(var n in D)D[n]=null;for(var a in D=null,K)K[a]=null;K=null});return{registerObject:function(e,t,r,i){if(D.w3&&e&&t){var n={};n.id=e,n.swfVersion=t,n.expressInstall=r,n.callbackFn=i,S[S.length]=n,H(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){if(D.w3)return O(e)},embedSWF:function(l,u,d,c,f,h,p,g,m,v){var _=B(u),y={success:!1,id:_};D.w3&&!(D.wk&&D.wk<312)&&l&&u&&d&&c&&f?(H(_,!1),e(function(){d+="",c+="";var e={};if(m&&typeof m===E)for(var t in m)e[t]=m[t];e.data=l,e.width=d,e.height=c;var r={};if(g&&typeof g===E)for(var i in g)r[i]=g[i];if(p&&typeof p===E)for(var n in p)if(p.hasOwnProperty(n)){var a=A?encodeURIComponent(n):n,o=A?encodeURIComponent(p[n]):p[n];typeof r.flashvars!=b?r.flashvars+="&"+a+"="+o:r.flashvars=a+"="+o}if(G(f)){var s=I(e,r,u);e.id==_&&H(_,!0),y.success=!0,y.ref=s,y.id=s.id}else{if(h&&L())return e.data=h,void C(e,r,u,v);H(_,!0)}v&&v(y)})):v&&v(y)},switchOffAutoHideShow:function(){k=!1},enableUriEncoding:function(e){A=typeof e===b||e},ua:D,getFlashPlayerVersion:function(){return{major:D.pv[0],minor:D.pv[1],release:D.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(e,t,r){return D.w3?I(e,t,r):void 0},showExpressInstall:function(e,t,r,i){D.w3&&L()&&C(e,t,r,i)},removeSWF:function(e){D.w3&&j(e)},createCSS:function(e,t,r,i){D.w3&&V(e,t,r,i)},addDomLoadEvent:e,addLoadEvent:function(e){if(typeof m.addEventListener!=b)m.addEventListener("load",e,!1);else if(typeof v.addEventListener!=b)v.addEventListener("load",e,!1);else if(typeof m.attachEvent!=b)!function(e,t,r){e.attachEvent(t,r),o[o.length]=[e,t,r]}(m,"onload",e);else if("function"==typeof m.onload){var t=m.onload;m.onload=function(){t(),e()}}else m.onload=e},getQueryParamValue:function(e){var t=v.location.search||v.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return q(t);for(var r=t.split("&"),i=0;i<r.length;i++)if(r[i].substring(0,r[i].indexOf("="))==e)return q(r[i].substring(r[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(T){var e=F(g);e&&l&&(e.parentNode.replaceChild(l,e),u&&(H(u,!0),D.ie&&(l.style.display="block")),d&&d(c)),T=!1}},version:"2.3"}}();return K}.apply(t,[]))||(e.exports=i)},function(e,t,r){var i;void 0===(i=function(e){var a={ajax:r(26)},o={version:1010,isStartUp:!1,config:{debug:!0,host:"http://127.0.0.1",posts:["8500","8500","8500","8501","8502"],post:"8500"},ajax:function(e,t,r){e=JSON.stringify(e),e=encodeURIComponent(e),a.ajax({url:o.config.host+":"+o.config.post+"/maituo?json="+e,method:"GET",dataType:"jsonp",timeout:1e3,success:t||function(){},error:r||function(){}})}};return o.tool={debug:function(e){"undefined"!=typeof console&&o.config.debug&&console.debug(e)}},o.log=function(e){"undefined"!=typeof console&&o.config.debug&&(e=JSON.stringify(e),console.log(e))},o.check={status:!1,isChecked:!1,isVoiceChecked:!1,isPlugin:function(e){var t=function(){o.check.isChecked?o.check.isVoiceChecked?e(!0):e(!1):setTimeout(function(){t()},100)};t()},reCheckPlugins:function(){var e,t=o.config.posts[0],r=(o.config.posts,{act:"MC_GET_VERSION"});r=JSON.stringify(r),r=encodeURIComponent(r),e=function(){a.ajax({url:o.config.host+":"+t+"/maituo?json="+r,dataType:"jsonp",timeout:3500,success:function(e){0===e.code&&window.location.reload()},error:function(e){o.log(e)}})},setInterval(function(){e()},1e3)},checkVoice:function(r){r=r||o.config.posts;var i=0,n=function(){var t=r[i];!function(e,t,r,i){t=JSON.stringify(t),t=encodeURIComponent(t),a.ajax({url:o.config.host+":"+e+"/maituo?json="+t,dataType:"jsonp",timeout:500,success:r||function(){},error:i||function(){}})}(t,{act:"MC_GET_VERSION"},function(e){o.log("VOICE PLUGINS CONNECTINO_SUCCESS",e),0===e.code&&(o.config.post=t,e.value>=o.version?o.check.isVoiceChecked=!0:o.check.isVoiceChecked=!1,o.check.isChecked=!0)},function(e){++i+1>r.length?(o.check.isVoiceChecked=!1,o.check.isChecked=!0):n()})};n()},hasInit:!1,init:function(t,r){if(t){var i=function(){o.ajax({act:"CONNECTION_STATUS"},function(e){0==e.code&&3==e.value?(o.log("CONNECTION_STATUS success!"),o.check.status=!0,o.check.hasInit=!0,r()):setTimeout(function(){i()},500)})};o.ajax({act:"CONNECTION_OPEN",url:t,location:window.location.href},function(e){0==e.code?(o.log("CONNECTION_OPEN success!"),o.ajax({act:"CONNECTION_CAPTURE",value:0},function(e){0==e.code&&(o.log("CONNECTION_CAPTURE success!"),i())})):(o.log("Voice init false.  This is for Test."),alert("连接服务器失败,错误码："+e.code+", url:"+t))},function(){try{o.log("Voice init false.  This is for Test."),alert("连接服务器失败,错误码："+ret.code+", url:"+t)}catch(e){o.log(e)}})}}},o.op={getInputVolume:function(t){1==o.check.status&&o.ajax({act:"GET_INPUT_VOLUME"},function(e){o.log(e),0==e.code?(a("#debug").prepend("<p>getInputVolume: "+e.value+"</p>"),t(e.value)):t(0)})},setInputVolume:function(e,t){if(1==o.check.status){var r=parseInt(e,10);if(NaN===r)return!1;r<0?r=0:100<r&&(r=100),o.ajax({act:"SET_INPUT_VOLUME",value:r},function(e){o.log(e),0==e.code?t(r):t(0)})}},getOutVolume:function(t){1==o.check.status&&o.ajax({act:"GET_OUTPUT_VOLUME"},function(e){o.log(e),0==e.code?(a("#debug").prepend("<p>getOutVolume: "+e.value+"</p>"),t(e.value)):t(0)})},setOutVolume:function(e,t){if(1==o.check.status){var r=parseInt(e,10);if(NaN===r)return!1;r<0?r=0:100<r&&(r=100),o.ajax({act:"SET_OUTPUT_VOLUME",value:r},function(e){o.log(e),0==e.code?t(r):t(0)})}},setConfig:function(){1==o.check.status&&o.ajax({act:"MC_OPEN_SETTING"})},getPower:function(t){1==o.check.status&&o.ajax({act:"CONNECTION_GET_POWER"},function(e){0==e.code?t(e.value):t(0)})},getSpeaking:function(t){1==o.check.status&&o.ajax({act:"CONNECTION_GET_SPEAKING"},function(e){0==e.code?t(e.value):t(0)})},getPowerSpeaking:function(t){1==o.check.status&&o.ajax({act:"CONNECTION_GET_POWER_SPEAKING"},function(e){0==e.code&&t(e.power,e.value)})},setCapture:function(e,t){1==o.check.status&&o.ajax({act:"CONNECTION_CAPTURE",value:e},function(e){0==e.code&&void 0!==t&&t(!0)})},playSysSound:function(t,r){var i=t?1:0;o.op;1==o.check.status&&o.ajax({act:"SET_MIX_HARD",value:i},function(e){o.log(e),0==e.code?(a("#debug").prepend("<p>mix_hard: "+i+"</p>"),o.ajax({act:"QUALITY_SET",value:t?"sing_high2":"normal"}),r(!0)):r(!1)})},setIgnore:function(t,r,i){t=parseInt(t,10),1==o.check.status&&o.ajax({act:"IGNORE_XID_VOICE",xid:t,value:r},function(e){o.log(e),0==e.code?(a("#debug").prepend("<p>setIgnore --\x3e xid: "+t+", isIgnore: "+r+"</p>"),i(!0)):i(!1)})},checkStatus:function(e,t){e=parseInt(e,10),o.ajax({act:"CONNECTION_STATUS",xid:e},function(e){0==e.code?void 0!==e.heartbeat&&1==e.heartbeat?t(!1):t(!0):t(!1)},function(){t(!1)})}},o}.call(t,r,t,e))||(e.exports=i)},function(e,t,r){"use strict";var i;void 0===(i=function(e){return{set:function(e,t){var r=arguments,i=r.length,n=2<i?r[2]:null,a=3<i?r[3]:"/",o=4<i?r[4]:null,s=5<i&&r[5];document.cookie=e+"="+escape(t)+(null===n?"":"; expires="+n.toGMTString())+(null===a?"":"; path="+a)+(null===o?"":"; domain="+o)+(!0===s?"; secure":"")},get:function(e,t){t=void 0===t;for(var r=e+"=",i=r.length,n=document.cookie,a=n.length,o=0,s=0;o<a;){if(s=o+i,n.substring(o,s)==r)return this.getVal(s,t);if(0===(o=n.indexOf(" ",o)+1))break}return null},getVal:function(e,t){var r=document.cookie,i=r.indexOf(";",e);return-1==i&&(i=r.length),t?unescape(r.substring(e,i)):r.substring(e,i)}}}.call(t,r,t,e))||(e.exports=i)},function(e,t,r){"use strict";var i;void 0===(i=function(e){return{init:function(e,t){t&&e.modifyOneVoicePrower(t.xid,t.voice)}}}.call(t,r,t,e))||(e.exports=i)},function(e,t,r){"use strict";var i;void 0===(i=function(e){var o=r(2),s=r(1);return{managerList:[],getCanTalkList:function(e){for(var t=e.onlineXids,r=e.userList,i=[],n=0;n<t.length;n++){var a=t[n];r[a]&&("admin"!==r[a].role&&"spadmin"!==r[a].role||i.push(r[a]))}s.debug("====>chairman",i),o.get("voice:chairman:list")(i)},init:function(e){this.getCanTalkList(e)}}}.call(t,r,t,e))||(e.exports=i)},function(e,t,a){"use strict";var r;void 0===(r=function(e){var r=a(2),i=a(1),n={defaults:{allow:!1,modeType:3},handsList:[],inList:function(e){for(var t=this.handsList,r=!1,i=0;i<t.length;i++){if(t[i].xid==e){r=!0;break}r=!1}return r},addOne:function(e){if(this.inList(e.xid))return!1;this.handsList.push(e),r.get("voice:hand:change")(this.handsList)},removeOne:function(e){if(this.inList(e.xid)){this.handsList;for(var t=0;t<this.handsList.length;t++)this.handsList[t].xid==e.xid&&this.handsList.splice(t,1);r.get("voice:hand:change")(this.handsList)}},clear:function(e){if(e){var t={xids:e.voicePower,mode:this.defaults.modeType};this.Voice.modeVoiceProwers(t)}this.handsList.splice(0,this.handsList.length),r.get("voice:hand:reset")(this.handsList)},modifyPower:function(e,t){for(var r=this.handsList,i=0,n=r.length;i<n;i++)r[i].xid==e&&(this.handsList[i].voice.enable=t.enable)},handInit:function(){this.MT.get("voice:hand:reset",this.handsList)},setIntoHandlist:function(e){if(r.get("voice:hand:init")(e),i.in_array(e,this.handsList))return!1;for(var t in e)this.handsList.push(e[t]);this.handInit(this.handsList)},eventAppoint:function(e,t){this.MT;var r=n.operation;switch(e){case"voice:hand:up":r._join(t.args);break;case"voice:hand:leave":r._leave(t.args);break;case"voice:hand:allow":r._allow(t.args);break;case"voice:hand:forbid":r._forbid(t.args);break;case"voice:hand:remove":r._remove(t.args);break;case"voice:hand:clear":r._clear(t.args)}},init:function(e,t,r){this.handsList=[],this.MT=e,this.Voice=t,this.setIntoHandlist(r),n.operation.VoiceOperation=t.VoiceCloudOperation,n.operation.Voice=t,n.operation.Parent=this,window.__handsList=this.handsList}};return n.operation={_modify:function(e){var t=e.data,r=this.Parent;this.Voice.modifyUserVoicePrower(t.xid,t.voice),r.modifyPower(t.xid,t.voice)},_join:function(e){0===e.code&&n.addOne(e.data)},_leave:function(e){0===e.code&&(n.removeOne(e.data),this._modify(e))},_allow:function(e){0===e.code&&this._modify(e)},_forbid:function(e){0===e.code&&this._modify(e)},_remove:function(e){0===e.code&&(n.removeOne(e.data),this._modify(e))},_clear:function(e){0===e.code&&this.Parent.clear(e)}},n}.call(t,a,t,e))||(e.exports=r)},function(e,t,r){"use strict";var i;void 0===(i=function(e){var o=r(2),s=r(1),i={defaults:{modeType:2,micState:"close",currentQuser:{}},queueList:[],queueObj:{},inList:function(e){for(var t=this.queueList,r=!1,i=0;i<t.length;i++)if(t[i].xid){if(t[i].xid==e){r=!0;break}r=!1}return r},addOne:function(e){if(this.inList(e.xid))return!1;this.queueList.push(e),this.queueObj[e.xid]=e,o.get("voice:queue:change")(this.queueList)},removeOne:function(e){if(this.inList(e.xid)){this.defaults.currentQuser.xid==e.xid&&this.stopCountdown();for(var t=0;t<this.queueList.length;t++)this.queueList[t].xid==e.xid&&(this.queueList.splice(t,1),delete this.queueObj[e.xid])}o.get("voice:queue:change")(this.queueList)},addTime:function(e){e.xid;var t=e.sec;this.curUserSecond=t},clear:function(e){if(e){var t={xids:e.voicePower,mode:this.defaults.modeType};this.Voice.modeVoiceProwers(t)}this.queueList.splice(0,this.queueList.length),this.queueObj={},this.stopCountdown(),o.get("voice:queue:reset")(this.queueList)},modifyPower:function(e,t){for(var r=this.queueList,i=0,n=r.length;i<n;i++)r[i].xid==e&&(r[i].voice.enable=t.enable)},queueInit:function(){this.MT.get("voice:queue:reset",this.queueList),window.__queueList=this.queueList,window.__qobj=this.queueObj,window.__curQuser=this.defaults.currentQuser},initQueue:function(e){if(e.action){var t=e.action,r=e.data,i=this.sortVoiceQueue(r);if(this.queueList=i,this.queueInit(this.queueList),this.defaults.micState=r.memberState,s.debug("麦序语音列表===>",i,this.queueObj),o.get("voice:queue:init")(e),o.get("voice:queue:vlist")(this.queueList),e.voicePower){var n={xids:e.voicePower,mode:this.defaults.modeType};this.Voice.modeVoiceProwers(n)}if("start"===t&&(this.queueList.length&&0<this.queueList.length?(this.defaults.currentQuser=this.queueObj[i[0].xid],this.startCountdown(i[0].xid)):this.curUserSecond=0),"pause"===t&&0<this.queueList.length){var a=this.queueList[0].xid;this.stopCountdown(a)}}},queueTimer:null,curUserSecond:0,countDown:function(e){var t=this,r=e;if(s.debug("倒计时开始===> ",r),r&&0<r.sec){this.curUserSecond=r.sec;!function e(){0<t.curUserSecond?t.queueTimer=setTimeout(function(){t.curUserSecond--,t.queueObj[r.xid].sec=t.curUserSecond,o.get("voice:queue:countdown")(t.curUserSecond),e()},1e3):(clearTimeout(t.queueTimer),o.get("voice:queue:countdown")(""))}()}},stopCountdown:function(e){var t=0;s.debug("停止倒计时===>"+e),clearTimeout(this.queueTimer),this.curUserSecond=0,t=e?this.queueObj[e].sec:"",o.get("voice:queue:countdown")(t)},startCountdown:function(e){var t=this.queueObj[e];t&&this.countDown(t)},sortVoiceQueue:function(e){var t=[];if(void 0===e.length)for(var r in e)if(this.addOne(e[r]),0==t.length)t.push(e[r]);else for(var i=0,n=t.length;i<n;i++){if(e[r].turn<t[i].turn){t.splice(i,0,e[r]);break}if(void 0===t[i+1]){t.push(e[r]);break}if(t[i+1].turn>e[r].turn){t.splice(i+1,0,e[r]);break}}else t=new Array;return t},eventAppoint:function(e,t){this.MT;var r=i.operation;switch(e){case"voice:queue:list":r._qlist(t.args);break;case"voice:queue:join":r._join(t.args);break;case"voice:queue:leave":r._leave(t.args);break;case"voice:queue:move":case"voice:queue:moveto":r._move(t.args);break;case"voice:queue:time":r._addTime(t.args);break;case"voice:queue:remove":r._remove(t.args);break;case"voice:queue:control":r._control(t.args);break;case"voice:queue:clear":r._clear(t.args)}},init:function(e,t,r){(this.operation.Parent=this).queueList=[],this.MT=e,this.Voice=t,this.initQueue(r),this.operation.VoiceOperation=t.VoiceCloudOperation,this.operation.Voice=t}};return i.operation={_modify:function(e){var t=e.data,r=this.Parent;this.Voice.modifyUserVoicePrower(t.xid,t.voice),r.modifyPower(t.xid,t.voice)},_qlist:function(e){e.action,e.data,e.voicePower;this.Parent.initQueue(e)},_join:function(e){0===e.code&&i.addOne(e.data)},_leave:function(e){0===e.code&&(i.removeOne(e.data),this._modify(e))},_remove:function(e){0===e.code&&(i.removeOne(e.data),this._modify(e))},_addTime:function(e){this.Parent.addTime(e)},_control:function(e){var t=e.action,r=e.current||{},i=this.Parent;s.debug("control===>",e),"pause"===t&&r&&(this.Voice.modifyUserVoicePrower(r.xid,r.voice),i.stopCountdown(r.xid))},_move:function(e){console.warn(e)},_allow:function(e){0===e.code&&this._modify(e)},_forbid:function(e){0===e.code&&this._modify(e)},_clear:function(e){e&&this.Parent.clear(e)}},i}.call(t,r,t,e))||(e.exports=i)},function(e,t,r){"use strict";var o=r(67),s=r(11),l=r(37),n=r(23),a=r(38),u=Object.prototype.toString,d=0,c=-1,f=0,h=8;function p(e){if(!(this instanceof p))return new p(e);this.options=s.assign({level:c,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var r=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==d)throw new Error(n[r]);if(t.header&&o.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?l.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=o.deflateSetDictionary(this.strm,i))!==d)throw new Error(n[r]);this._dict_set=!0}}function i(e,t){var r=new p(t);if(r.push(e,!0),r.err)throw r.msg||n[r.err];return r.result}p.prototype.push=function(e,t){var r,i,n=this.strm,a=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=l.string2buf(e):"[object ArrayBuffer]"===u.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new s.Buf8(a),n.next_out=0,n.avail_out=a),1!==(r=o.deflate(n,i))&&r!==d)return this.onEnd(r),!(this.ended=!0);0!==n.avail_out&&(0!==n.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(l.buf2binstring(s.shrinkBuf(n.output,n.next_out))):this.onData(s.shrinkBuf(n.output,n.next_out)))}while((0<n.avail_in||0===n.avail_out)&&1!==r);return 4===i?(r=o.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===d):2!==i||(this.onEnd(d),!(n.avail_out=0))},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===d&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=p,t.deflate=i,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,i(e,t)}},function(e,t,r){"use strict";var l,f=r(11),u=r(68),h=r(35),p=r(36),i=r(23),d=0,c=4,g=0,m=-2,v=-1,_=4,n=2,y=8,b=9,a=286,o=30,s=19,E=2*a+1,S=15,w=3,T=258,k=T+w+1,A=42,D=113,R=1,O=2,L=3,C=4;function P(e,t){return e.msg=i[t],t}function x(e){return(e<<1)-(4<e?9:0)}function I(e){for(var t=e.length;0<=--t;)e[t]=0}function M(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(f.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function j(e,t){u._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,M(e.strm)}function B(e,t){e.pending_buf[e.pending++]=t}function F(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function N(e,t){var r,i,n=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-k?e.strstart-(e.w_size-k):0,u=e.window,d=e.w_mask,c=e.prev,f=e.strstart+T,h=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+o]===p&&u[r+o-1]===h&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<f);if(i=T-(f-a),a=f-T,o<i){if(e.match_start=t,s<=(o=i))break;h=u[a+o-1],p=u[a+o]}}}while((t=c[t&d])>l&&0!=--n);return o<=e.lookahead?o:e.lookahead}function U(e){var t,r,i,n,a,o,s,l,u,d,c=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=c+(c-k)){for(f.arraySet(e.window,e.window,c,c,0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=r=e.hash_size;i=e.head[--t],e.head[t]=c<=i?i-c:0,--r;);for(t=r=c;i=e.prev[--t],e.prev[t]=c<=i?i-c:0,--r;);n+=c}if(0===e.strm.avail_in)break;if(o=e.strm,s=e.window,l=e.strstart+e.lookahead,u=n,d=void 0,d=o.avail_in,u<d&&(d=u),r=0===d?0:(o.avail_in-=d,f.arraySet(s,o.input,o.next_in,d,l),1===o.state.wrap?o.adler=h(o.adler,s,d,l):2===o.state.wrap&&(o.adler=p(o.adler,s,d,l)),o.next_in+=d,o.total_in+=d,d),e.lookahead+=r,e.lookahead+e.insert>=w)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+w-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<w)););}while(e.lookahead<k&&0!==e.strm.avail_in)}function G(e,t){for(var r,i;;){if(e.lookahead<k){if(U(e),e.lookahead<k&&t===d)return R;if(0===e.lookahead)break}if(r=0,e.lookahead>=w&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+w-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-k&&(e.match_length=N(e,r)),e.match_length>=w)if(i=u._tr_tally(e,e.strstart-e.match_start,e.match_length-w),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=w){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+w-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(j(e,!1),0===e.strm.avail_out))return R}return e.insert=e.strstart<w-1?e.strstart:w-1,t===c?(j(e,!0),0===e.strm.avail_out?L:C):e.last_lit&&(j(e,!1),0===e.strm.avail_out)?R:O}function V(e,t){for(var r,i,n;;){if(e.lookahead<k){if(U(e),e.lookahead<k&&t===d)return R;if(0===e.lookahead)break}if(r=0,e.lookahead>=w&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+w-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=w-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-k&&(e.match_length=N(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===w&&4096<e.strstart-e.match_start)&&(e.match_length=w-1)),e.prev_length>=w&&e.match_length<=e.prev_length){for(n=e.strstart+e.lookahead-w,i=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-w),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+w-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=w-1,e.strstart++,i&&(j(e,!1),0===e.strm.avail_out))return R}else if(e.match_available){if((i=u._tr_tally(e,0,e.window[e.strstart-1]))&&j(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return R}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=u._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<w-1?e.strstart:w-1,t===c?(j(e,!0),0===e.strm.avail_out?L:C):e.last_lit&&(j(e,!1),0===e.strm.avail_out)?R:O}function H(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new f.Buf16(2*E),this.dyn_dtree=new f.Buf16(2*(2*o+1)),this.bl_tree=new f.Buf16(2*(2*s+1)),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new f.Buf16(S+1),this.heap=new f.Buf16(2*a+1),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new f.Buf16(2*a+1),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function K(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=n,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?A:D,e.adler=2===t.wrap?0:1,t.last_flush=d,u._tr_init(t),g):P(e,m)}function z(e){var t=K(e);return t===g&&function(e){e.window_size=2*e.w_size,I(e.head),e.max_lazy_match=l[e.level].max_lazy,e.good_match=l[e.level].good_length,e.nice_match=l[e.level].nice_length,e.max_chain_length=l[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=w-1,e.match_available=0,e.ins_h=0}(e.state),t}function W(e,t,r,i,n,a){if(!e)return m;var o=1;if(t===v&&(t=6),i<0?(o=0,i=-i):15<i&&(o=2,i-=16),n<1||b<n||r!==y||i<8||15<i||t<0||9<t||a<0||_<a)return P(e,m);8===i&&(i=9);var s=new q;return(e.state=s).strm=e,s.wrap=o,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+w-1)/w),s.window=new f.Buf8(2*s.w_size),s.head=new f.Buf16(s.hash_size),s.prev=new f.Buf16(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new f.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=r,z(e)}l=[new H(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(U(e),0===e.lookahead&&t===d)return R;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,j(e,!1),0===e.strm.avail_out))return R;if(e.strstart-e.block_start>=e.w_size-k&&(j(e,!1),0===e.strm.avail_out))return R}return e.insert=0,t===c?(j(e,!0),0===e.strm.avail_out?L:C):(e.strstart>e.block_start&&(j(e,!1),e.strm.avail_out),R)}),new H(4,4,8,4,G),new H(4,5,16,8,G),new H(4,6,32,32,G),new H(4,4,16,16,V),new H(8,16,32,32,V),new H(8,16,128,128,V),new H(8,32,128,256,V),new H(32,128,258,1024,V),new H(32,258,258,4096,V)],t.deflateInit=function(e,t){return W(e,t,y,15,8,0)},t.deflateInit2=W,t.deflateReset=z,t.deflateResetKeep=K,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?m:(e.state.gzhead=t,g):m},t.deflate=function(e,t){var r,i,n,a;if(!e||!e.state||5<t||t<0)return e?P(e,m):m;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&t!==c)return P(e,0===e.avail_out?-5:m);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===A)if(2===i.wrap)e.adler=0,B(i,31),B(i,139),B(i,8),i.gzhead?(B(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),B(i,255&i.gzhead.time),B(i,i.gzhead.time>>8&255),B(i,i.gzhead.time>>16&255),B(i,i.gzhead.time>>24&255),B(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),B(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(B(i,255&i.gzhead.extra.length),B(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=p(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(B(i,0),B(i,0),B(i,0),B(i,0),B(i,0),B(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),B(i,3),i.status=D);else{var o=y+(i.w_bits-8<<4)<<8;o|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(o|=32),o+=31-o%31,i.status=D,F(i,o),0!==i.strstart&&(F(i,e.adler>>>16),F(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>n&&(e.adler=p(e.adler,i.pending_buf,i.pending-n,n)),M(e),n=i.pending,i.pending!==i.pending_buf_size));)B(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(e.adler=p(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=p(e.adler,i.pending_buf,i.pending-n,n)),M(e),n=i.pending,i.pending===i.pending_buf_size)){a=1;break}a=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,B(i,a)}while(0!==a);i.gzhead.hcrc&&i.pending>n&&(e.adler=p(e.adler,i.pending_buf,i.pending-n,n)),0===a&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=p(e.adler,i.pending_buf,i.pending-n,n)),M(e),n=i.pending,i.pending===i.pending_buf_size)){a=1;break}a=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,B(i,a)}while(0!==a);i.gzhead.hcrc&&i.pending>n&&(e.adler=p(e.adler,i.pending_buf,i.pending-n,n)),0===a&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&M(e),i.pending+2<=i.pending_buf_size&&(B(i,255&e.adler),B(i,e.adler>>8&255),e.adler=0,i.status=D)):i.status=D),0!==i.pending){if(M(e),0===e.avail_out)return i.last_flush=-1,g}else if(0===e.avail_in&&x(t)<=x(r)&&t!==c)return P(e,-5);if(666===i.status&&0!==e.avail_in)return P(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==d&&666!==i.status){var s=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(U(e),0===e.lookahead)){if(t===d)return R;break}if(e.match_length=0,r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(j(e,!1),0===e.strm.avail_out))return R}return e.insert=0,t===c?(j(e,!0),0===e.strm.avail_out?L:C):e.last_lit&&(j(e,!1),0===e.strm.avail_out)?R:O}(i,t):3===i.strategy?function(e,t){for(var r,i,n,a,o=e.window;;){if(e.lookahead<=T){if(U(e),e.lookahead<=T&&t===d)return R;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=w&&0<e.strstart&&(i=o[n=e.strstart-1])===o[++n]&&i===o[++n]&&i===o[++n]){a=e.strstart+T;do{}while(i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&n<a);e.match_length=T-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=w?(r=u._tr_tally(e,1,e.match_length-w),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(j(e,!1),0===e.strm.avail_out))return R}return e.insert=0,t===c?(j(e,!0),0===e.strm.avail_out?L:C):e.last_lit&&(j(e,!1),0===e.strm.avail_out)?R:O}(i,t):l[i.level].func(i,t);if(s!==L&&s!==C||(i.status=666),s===R||s===L)return 0===e.avail_out&&(i.last_flush=-1),g;if(s===O&&(1===t?u._tr_align(i):5!==t&&(u._tr_stored_block(i,0,0,!1),3===t&&(I(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),M(e),0===e.avail_out))return i.last_flush=-1,g}return t!==c?g:i.wrap<=0?1:(2===i.wrap?(B(i,255&e.adler),B(i,e.adler>>8&255),B(i,e.adler>>16&255),B(i,e.adler>>24&255),B(i,255&e.total_in),B(i,e.total_in>>8&255),B(i,e.total_in>>16&255),B(i,e.total_in>>24&255)):(F(i,e.adler>>>16),F(i,65535&e.adler)),M(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?g:1)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==A&&69!==t&&73!==t&&91!==t&&103!==t&&t!==D&&666!==t?P(e,m):(e.state=null,t===D?P(e,-3):g):m},t.deflateSetDictionary=function(e,t){var r,i,n,a,o,s,l,u,d=t.length;if(!e||!e.state)return m;if(2===(a=(r=e.state).wrap)||1===a&&r.status!==A||r.lookahead)return m;for(1===a&&(e.adler=h(e.adler,t,d,0)),r.wrap=0,d>=r.w_size&&(0===a&&(I(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new f.Buf8(r.w_size),f.arraySet(u,t,d-r.w_size,r.w_size,0),t=u,d=r.w_size),o=e.avail_in,s=e.next_in,l=e.input,e.avail_in=d,e.next_in=0,e.input=t,U(r);r.lookahead>=w;){for(i=r.strstart,n=r.lookahead-(w-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+w-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,--n;);r.strstart=i,r.lookahead=w-1,U(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=w-1,r.match_available=0,e.next_in=s,e.input=l,e.avail_in=o,r.wrap=a,g},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";var n=r(11),s=0,l=1;function i(e){for(var t=e.length;0<=--t;)e[t]=0}var a=0,o=29,u=256,d=u+1+o,c=30,f=19,m=2*d+1,v=15,h=16,p=7,g=256,_=16,y=17,b=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(d+2));i(k);var A=new Array(2*c);i(A);var D=new Array(512);i(D);var R=new Array(256);i(R);var O=new Array(o);i(O);var L,C,P,x=new Array(c);function I(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}function M(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function j(e){return e<256?D[e]:D[256+(e>>>7)]}function B(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function F(e,t,r){e.bi_valid>h-r?(e.bi_buf|=t<<e.bi_valid&65535,B(e,e.bi_buf),e.bi_buf=t>>h-e.bi_valid,e.bi_valid+=r-h):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function N(e,t,r){F(e,r[2*t],r[2*t+1])}function U(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function G(e,t,r){var i,n,a=new Array(v+1),o=0;for(i=1;i<=v;i++)a[i]=o=o+r[i-1]<<1;for(n=0;n<=t;n++){var s=e[2*n+1];0!==s&&(e[2*n]=U(a[s]++,s))}}function V(e){var t;for(t=0;t<d;t++)e.dyn_ltree[2*t]=0;for(t=0;t<c;t++)e.dyn_dtree[2*t]=0;for(t=0;t<f;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*g]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function H(e){8<e.bi_valid?B(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function q(e,t,r,i){var n=2*t,a=2*r;return e[n]<e[a]||e[n]===e[a]&&i[t]<=i[r]}function K(e,t,r){for(var i=e.heap[r],n=r<<1;n<=e.heap_len&&(n<e.heap_len&&q(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!q(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i}function z(e,t,r){var i,n,a,o,s=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],n=e.pending_buf[e.l_buf+s],s++,0===i?N(e,n,t):(N(e,(a=R[n])+u+1,t),0!==(o=E[a])&&F(e,n-=O[a],o),N(e,a=j(--i),r),0!==(o=S[a])&&F(e,i-=x[a],o)),s<e.last_lit;);N(e,g,t)}function W(e,t){var r,i,n,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=m,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(n=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[n]=0,e.opt_len--,s&&(e.static_len-=o[2*n+1]);for(t.max_code=u,r=e.heap_len>>1;1<=r;r--)K(e,a,r);for(n=l;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,a[2*n]=a[2*r]+a[2*i],e.depth[n]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,a[2*r+1]=a[2*i+1]=n,e.heap[1]=n++,K(e,a,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,i,n,a,o,s,l=t.dyn_tree,u=t.max_code,d=t.stat_desc.static_tree,c=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(a=0;a<=v;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<m;r++)p<(a=l[2*l[2*(i=e.heap[r])+1]+1]+1)&&(a=p,g++),l[2*i+1]=a,u<i||(e.bl_count[a]++,o=0,h<=i&&(o=f[i-h]),s=l[2*i],e.opt_len+=s*(a+o),c&&(e.static_len+=s*(d[2*i+1]+o)));if(0!==g){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,g-=2}while(0<g);for(a=p;0!==a;a--)for(i=e.bl_count[a];0!==i;)u<(n=e.heap[--r])||(l[2*n+1]!==a&&(e.opt_len+=(a-l[2*n+1])*l[2*n],l[2*n+1]=a),i--)}}(e,t),G(a,u,e.bl_count)}function Y(e,t,r){var i,n,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=o,o=t[2*(i+1)+1],++s<l&&n===o||(s<u?e.bl_tree[2*n]+=s:0!==n?(n!==a&&e.bl_tree[2*n]++,e.bl_tree[2*_]++):s<=10?e.bl_tree[2*y]++:e.bl_tree[2*b]++,a=n,u=(s=0)===o?(l=138,3):n===o?(l=6,3):(l=7,4))}function X(e,t,r){var i,n,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),i=0;i<=r;i++)if(n=o,o=t[2*(i+1)+1],!(++s<l&&n===o)){if(s<u)for(;N(e,n,e.bl_tree),0!=--s;);else 0!==n?(n!==a&&(N(e,n,e.bl_tree),s--),N(e,_,e.bl_tree),F(e,s-3,2)):s<=10?(N(e,y,e.bl_tree),F(e,s-3,3)):(N(e,b,e.bl_tree),F(e,s-11,7));a=n,u=(s=0)===o?(l=138,3):n===o?(l=6,3):(l=7,4)}}i(x);var J=!1;function Q(e,t,r,i){F(e,(a<<1)+(i?1:0),3),function(e,t,r,i){H(e),i&&(B(e,r),B(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}t._tr_init=function(e){J||(function(){var e,t,r,i,n,a=new Array(v+1);for(i=r=0;i<o-1;i++)for(O[i]=r,e=0;e<1<<E[i];e++)R[r++]=i;for(R[r-1]=i,i=n=0;i<16;i++)for(x[i]=n,e=0;e<1<<S[i];e++)D[n++]=i;for(n>>=7;i<c;i++)for(x[i]=n<<7,e=0;e<1<<S[i]-7;e++)D[256+n++]=i;for(t=0;t<=v;t++)a[t]=0;for(e=0;e<=143;)k[2*e+1]=8,e++,a[8]++;for(;e<=255;)k[2*e+1]=9,e++,a[9]++;for(;e<=279;)k[2*e+1]=7,e++,a[7]++;for(;e<=287;)k[2*e+1]=8,e++,a[8]++;for(G(k,d+1,a),e=0;e<c;e++)A[2*e+1]=5,A[2*e]=U(e,5);L=new I(k,E,u+1,d,v),C=new I(A,S,0,c,v),P=new I(new Array(0),w,0,f,p)}(),J=!0),e.l_desc=new M(e.dyn_ltree,L),e.d_desc=new M(e.dyn_dtree,C),e.bl_desc=new M(e.bl_tree,P),e.bi_buf=0,e.bi_valid=0,V(e)},t._tr_stored_block=Q,t._tr_flush_block=function(e,t,r,i){var n,a,o=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return s;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return l;for(t=32;t<u;t++)if(0!==e.dyn_ltree[2*t])return l;return s}(e)),W(e,e.l_desc),W(e,e.d_desc),o=function(e){var t;for(Y(e,e.dyn_ltree,e.l_desc.max_code),Y(e,e.dyn_dtree,e.d_desc.max_code),W(e,e.bl_desc),t=f-1;3<=t&&0===e.bl_tree[2*T[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=n&&(n=a)):n=a=r+5,r+4<=n&&-1!==t?Q(e,t,r,i):4===e.strategy||a===n?(F(e,2+(i?1:0),3),z(e,k,A)):(F(e,4+(i?1:0),3),function(e,t,r,i){var n;for(F(e,t-257,5),F(e,r-1,5),F(e,i-4,4),n=0;n<i;n++)F(e,e.bl_tree[2*T[n]+1],3);X(e,e.dyn_ltree,t-1),X(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),z(e,e.dyn_ltree,e.dyn_dtree)),V(e),i&&H(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(R[r]+u+1)]++,e.dyn_dtree[2*j(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){F(e,2,3),N(e,g,k),function(e){16===e.bi_valid?(B(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,r){"use strict";var c=r(70),f=r(11),h=r(37),p=r(39),i=r(23),n=r(38),a=r(73),g=Object.prototype.toString;function o(e){if(!(this instanceof o))return new o(e);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;var r=c.inflateInit2(this.strm,t.windowBits);if(r!==p.Z_OK)throw new Error(i[r]);if(this.header=new a,c.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=h.string2buf(t.dictionary):"[object ArrayBuffer]"===g.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=c.inflateSetDictionary(this.strm,t.dictionary))!==p.Z_OK))throw new Error(i[r])}function s(e,t){var r=new o(t);if(r.push(e,!0),r.err)throw r.msg||i[r.err];return r.result}o.prototype.push=function(e,t){var r,i,n,a,o,s=this.strm,l=this.options.chunkSize,u=this.options.dictionary,d=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?p.Z_FINISH:p.Z_NO_FLUSH,"string"==typeof e?s.input=h.binstring2buf(e):"[object ArrayBuffer]"===g.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new f.Buf8(l),s.next_out=0,s.avail_out=l),(r=c.inflate(s,p.Z_NO_FLUSH))===p.Z_NEED_DICT&&u&&(r=c.inflateSetDictionary(this.strm,u)),r===p.Z_BUF_ERROR&&!0===d&&(r=p.Z_OK,d=!1),r!==p.Z_STREAM_END&&r!==p.Z_OK)return this.onEnd(r),!(this.ended=!0);s.next_out&&(0!==s.avail_out&&r!==p.Z_STREAM_END&&(0!==s.avail_in||i!==p.Z_FINISH&&i!==p.Z_SYNC_FLUSH)||("string"===this.options.to?(n=h.utf8border(s.output,s.next_out),a=s.next_out-n,o=h.buf2string(s.output,n),s.next_out=a,s.avail_out=l-a,a&&f.arraySet(s.output,s.output,n,a,0),this.onData(o)):this.onData(f.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(d=!0)}while((0<s.avail_in||0===s.avail_out)&&r!==p.Z_STREAM_END);return r===p.Z_STREAM_END&&(i=p.Z_FINISH),i===p.Z_FINISH?(r=c.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===p.Z_OK):i!==p.Z_SYNC_FLUSH||(this.onEnd(p.Z_OK),!(s.avail_out=0))},o.prototype.onData=function(e){this.chunks.push(e)},o.prototype.onEnd=function(e){e===p.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=o,t.inflate=s,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,s(e,t)},t.ungzip=s},function(e,t,r){"use strict";var O=r(11),L=r(35),C=r(36),P=r(71),x=r(72),I=1,M=2,j=0,B=-2,F=1,i=852,n=592;function N(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new O.Buf16(320),this.work=new O.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=F,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new O.Buf32(i),t.distcode=t.distdyn=new O.Buf32(n),t.sane=1,t.back=-1,j):B}function s(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,o(e)):B}function l(e,t){var r,i;return e&&e.state?(i=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?B:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,s(e))):B}function u(e,t){var r,i;return e?(i=new a,(e.state=i).window=null,(r=l(e,t))!==j&&(e.state=null),r):B}var d,c,f=!0;function U(e){if(f){var t;for(d=new O.Buf32(512),c=new O.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(x(I,e.lens,0,288,d,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;x(M,e.lens,0,32,c,0,e.work,{bits:5}),f=!1}e.lencode=d,e.lenbits=9,e.distcode=c,e.distbits=5}function G(e,t,r,i){var n,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new O.Buf8(a.wsize)),i>=a.wsize?(O.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(n=a.wsize-a.wnext)&&(n=i),O.arraySet(a.window,t,r-i,n,a.wnext),(i-=n)?(O.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}t.inflateReset=s,t.inflateReset2=l,t.inflateResetKeep=o,t.inflateInit=function(e){return u(e,15)},t.inflateInit2=u,t.inflate=function(e,t){var r,i,n,a,o,s,l,u,d,c,f,h,p,g,m,v,_,y,b,E,S,w,T,k,A=0,D=new O.Buf8(4),R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return B;12===(r=e.state).mode&&(r.mode=13),o=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,u=r.hold,d=r.bits,c=s,f=l,w=j;e:for(;;)switch(r.mode){case F:if(0===r.wrap){r.mode=13;break}for(;d<16;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(2&r.wrap&&35615===u){D[r.check=0]=255&u,D[1]=u>>>8&255,r.check=C(r.check,D,2,0),d=u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&u)){e.msg="unknown compression method",r.mode=30;break}if(d-=4,S=8+(15&(u>>>=4)),0===r.wbits)r.wbits=S;else if(S>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<S,e.adler=r.check=1,r.mode=512&u?10:12,d=u=0;break;case 2:for(;d<16;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(r.flags=u,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(D[0]=255&u,D[1]=u>>>8&255,r.check=C(r.check,D,2,0)),d=u=0,r.mode=3;case 3:for(;d<32;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}r.head&&(r.head.time=u),512&r.flags&&(D[0]=255&u,D[1]=u>>>8&255,D[2]=u>>>16&255,D[3]=u>>>24&255,r.check=C(r.check,D,4,0)),d=u=0,r.mode=4;case 4:for(;d<16;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(D[0]=255&u,D[1]=u>>>8&255,r.check=C(r.check,D,2,0)),d=u=0,r.mode=5;case 5:if(1024&r.flags){for(;d<16;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(D[0]=255&u,D[1]=u>>>8&255,r.check=C(r.check,D,2,0)),d=u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(s<(h=r.length)&&(h=s),h&&(r.head&&(S=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),O.arraySet(r.head.extra,i,a,h,S)),512&r.flags&&(r.check=C(r.check,i,h,a)),s-=h,a+=h,r.length-=h),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===s)break e;for(h=0;S=i[a+h++],r.head&&S&&r.length<65536&&(r.head.name+=String.fromCharCode(S)),S&&h<s;);if(512&r.flags&&(r.check=C(r.check,i,h,a)),s-=h,a+=h,S)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===s)break e;for(h=0;S=i[a+h++],r.head&&S&&r.length<65536&&(r.head.comment+=String.fromCharCode(S)),S&&h<s;);if(512&r.flags&&(r.check=C(r.check,i,h,a)),s-=h,a+=h,S)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;d<16;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}d=u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;d<32;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}e.adler=r.check=N(u),d=u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,r.hold=u,r.bits=d,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){u>>>=7&d,d-=7&d,r.mode=27;break}for(;d<3;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}switch(r.last=1&u,d-=1,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(U(r),r.mode=20,6!==t)break;u>>>=2,d-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}u>>>=2,d-=2;break;case 14:for(u>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&u,d=u=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(h=r.length){if(s<h&&(h=s),l<h&&(h=l),0===h)break e;O.arraySet(n,i,a,h,o),s-=h,a+=h,l-=h,o+=h,r.length-=h;break}r.mode=12;break;case 17:for(;d<14;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(r.nlen=257+(31&u),u>>>=5,d-=5,r.ndist=1+(31&u),u>>>=5,d-=5,r.ncode=4+(15&u),u>>>=4,d-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;d<3;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}r.lens[R[r.have++]]=7&u,u>>>=3,d-=3}for(;r.have<19;)r.lens[R[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,T={bits:r.lenbits},w=x(0,r.lens,0,19,r.lencode,0,r.work,T),r.lenbits=T.bits,w){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;v=(A=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,_=65535&A,!((m=A>>>24)<=d);){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(_<16)u>>>=m,d-=m,r.lens[r.have++]=_;else{if(16===_){for(k=m+2;d<k;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(u>>>=m,d-=m,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}S=r.lens[r.have-1],h=3+(3&u),u>>>=2,d-=2}else if(17===_){for(k=m+3;d<k;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}d-=m,S=0,h=3+(7&(u>>>=m)),u>>>=3,d-=3}else{for(k=m+7;d<k;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}d-=m,S=0,h=11+(127&(u>>>=m)),u>>>=7,d-=7}if(r.have+h>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;h--;)r.lens[r.have++]=S}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,T={bits:r.lenbits},w=x(I,r.lens,0,r.nlen,r.lencode,0,r.work,T),r.lenbits=T.bits,w){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,T={bits:r.distbits},w=x(M,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,T),r.distbits=T.bits,w){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=s&&258<=l){e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,r.hold=u,r.bits=d,P(e,f),o=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,u=r.hold,d=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;v=(A=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,_=65535&A,!((m=A>>>24)<=d);){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(v&&0==(240&v)){for(y=m,b=v,E=_;v=(A=r.lencode[E+((u&(1<<y+b)-1)>>y)])>>>16&255,_=65535&A,!(y+(m=A>>>24)<=d);){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}u>>>=y,d-=y,r.back+=y}if(u>>>=m,d-=m,r.back+=m,r.length=_,0===v){r.mode=26;break}if(32&v){r.back=-1,r.mode=12;break}if(64&v){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&v,r.mode=22;case 22:if(r.extra){for(k=r.extra;d<k;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;v=(A=r.distcode[u&(1<<r.distbits)-1])>>>16&255,_=65535&A,!((m=A>>>24)<=d);){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(0==(240&v)){for(y=m,b=v,E=_;v=(A=r.distcode[E+((u&(1<<y+b)-1)>>y)])>>>16&255,_=65535&A,!(y+(m=A>>>24)<=d);){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}u>>>=y,d-=y,r.back+=y}if(u>>>=m,d-=m,r.back+=m,64&v){e.msg="invalid distance code",r.mode=30;break}r.offset=_,r.extra=15&v,r.mode=24;case 24:if(r.extra){for(k=r.extra;d<k;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===l)break e;if(h=f-l,r.offset>h){if((h=r.offset-h)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}p=h>r.wnext?(h-=r.wnext,r.wsize-h):r.wnext-h,h>r.length&&(h=r.length),g=r.window}else g=n,p=o-r.offset,h=r.length;for(l<h&&(h=l),l-=h,r.length-=h;n[o++]=g[p++],--h;);0===r.length&&(r.mode=21);break;case 26:if(0===l)break e;n[o++]=r.length,l--,r.mode=21;break;case 27:if(r.wrap){for(;d<32;){if(0===s)break e;s--,u|=i[a++]<<d,d+=8}if(f-=l,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=r.flags?C(r.check,n,f,o-f):L(r.check,n,f,o-f)),f=l,(r.flags?u:N(u))!==r.check){e.msg="incorrect data check",r.mode=30;break}d=u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;d<32;){if(0===s)break e;s--,u+=i[a++]<<d,d+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}d=u=0}r.mode=29;case 29:w=1;break e;case 30:w=-3;break e;case 31:return-4;case 32:default:return B}return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,r.hold=u,r.bits=d,(r.wsize||f!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&G(e,e.output,e.next_out,f-e.avail_out)?(r.mode=31,-4):(c-=e.avail_in,f-=e.avail_out,e.total_in+=c,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=r.flags?C(r.check,n,f,e.next_out-f):L(r.check,n,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==c&&0===f||4===t)&&w===j&&(w=-5),w)},t.inflateEnd=function(e){if(!e||!e.state)return B;var t=e.state;return t.window&&(t.window=null),e.state=null,j},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?B:((r.head=t).done=!1,j):B},t.inflateSetDictionary=function(e,t){var r,i=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?B:11===r.mode&&L(1,t,i,0)!==r.check?-3:G(e,t,i,i)?(r.mode=31,-4):(r.havedict=1,j):B},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function(e,t){var r,i,n,a,o,s,l,u,d,c,f,h,p,g,m,v,_,y,b,E,S,w,T,k,A;r=e.state,i=e.next_in,k=e.input,n=i+(e.avail_in-5),a=e.next_out,A=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,u=r.wsize,d=r.whave,c=r.wnext,f=r.window,h=r.hold,p=r.bits,g=r.lencode,m=r.distcode,v=(1<<r.lenbits)-1,_=(1<<r.distbits)-1;e:do{p<15&&(h+=k[i++]<<p,p+=8,h+=k[i++]<<p,p+=8),y=g[h&v];t:for(;;){if(h>>>=b=y>>>24,p-=b,0===(b=y>>>16&255))A[a++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=g[(65535&y)+(h&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}E=65535&y,(b&=15)&&(p<b&&(h+=k[i++]<<p,p+=8),E+=h&(1<<b)-1,h>>>=b,p-=b),p<15&&(h+=k[i++]<<p,p+=8,h+=k[i++]<<p,p+=8),y=m[h&_];r:for(;;){if(h>>>=b=y>>>24,p-=b,!(16&(b=y>>>16&255))){if(0==(64&b)){y=m[(65535&y)+(h&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(S=65535&y,p<(b&=15)&&(h+=k[i++]<<p,(p+=8)<b&&(h+=k[i++]<<p,p+=8)),l<(S+=h&(1<<b)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(h>>>=b,p-=b,(b=a-o)<S){if(d<(b=S-b)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(T=f,(w=0)===c){if(w+=u-b,b<E){for(E-=b;A[a++]=f[w++],--b;);w=a-S,T=A}}else if(c<b){if(w+=u+c-b,(b-=c)<E){for(E-=b;A[a++]=f[w++],--b;);if(w=0,c<E){for(E-=b=c;A[a++]=f[w++],--b;);w=a-S,T=A}}}else if(w+=c-b,b<E){for(E-=b;A[a++]=f[w++],--b;);w=a-S,T=A}for(;2<E;)A[a++]=T[w++],A[a++]=T[w++],A[a++]=T[w++],E-=3;E&&(A[a++]=T[w++],1<E&&(A[a++]=T[w++]))}else{for(w=a-S;A[a++]=A[w++],A[a++]=A[w++],A[a++]=A[w++],2<(E-=3););E&&(A[a++]=A[w++],1<E&&(A[a++]=A[w++]))}break}}break}}while(i<n&&a<s);i-=E=p>>3,h&=(1<<(p-=E<<3))-1,e.next_in=i,e.next_out=a,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=h,r.bits=p}},function(e,t,r){"use strict";var I=r(11),M=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],j=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],F=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,i,n,a,o,s){var l,u,d,c,f,h,p,g,m,v=s.bits,_=0,y=0,b=0,E=0,S=0,w=0,T=0,k=0,A=0,D=0,R=null,O=0,L=new I.Buf16(16),C=new I.Buf16(16),P=null,x=0;for(_=0;_<=15;_++)L[_]=0;for(y=0;y<i;y++)L[t[r+y]]++;for(S=v,E=15;1<=E&&0===L[E];E--);if(E<S&&(S=E),0===E)return n[a++]=20971520,n[a++]=20971520,s.bits=1,0;for(b=1;b<E&&0===L[b];b++);for(S<b&&(S=b),_=k=1;_<=15;_++)if(k<<=1,(k-=L[_])<0)return-1;if(0<k&&(0===e||1!==E))return-1;for(C[1]=0,_=1;_<15;_++)C[_+1]=C[_]+L[_];for(y=0;y<i;y++)0!==t[r+y]&&(o[C[t[r+y]]++]=y);if(h=0===e?(R=P=o,19):1===e?(R=M,O-=257,P=j,x-=257,256):(R=B,P=F,-1),_=b,f=a,T=y=D=0,d=-1,c=(A=1<<(w=S))-1,1===e&&852<A||2===e&&592<A)return 1;for(;;){for(p=_-T,m=o[y]<h?(g=0,o[y]):o[y]>h?(g=P[x+o[y]],R[O+o[y]]):(g=96,0),l=1<<_-T,b=u=1<<w;n[f+(D>>T)+(u-=l)]=p<<24|g<<16|m|0,0!==u;);for(l=1<<_-1;D&l;)l>>=1;if(0!==l?(D&=l-1,D+=l):D=0,y++,0==--L[_]){if(_===E)break;_=t[r+o[y]]}if(S<_&&(D&c)!==d){for(0===T&&(T=S),f+=b,k=1<<(w=_-T);w+T<E&&!((k-=L[w+T])<=0);)w++,k<<=1;if(A+=1<<w,1===e&&852<A||2===e&&592<A)return 1;n[d=D&c]=S<<24|w<<16|f-a|0}}return 0!==D&&(n[f+D]=_-T<<24|64<<16|0),s.bits=S,0}},function(e,t,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){"use strict";var i;void 0===(i=function(e){function t(e){if(e&&"[object Object]"!==Object.prototype.toString.call(e))throw new Error("参数应该为一个对象");this.queue=[],this.timer=null,this.hasListened=!1,this._init()}var n=r(1);return t.prototype._init=function(){},t.prototype._handleParams=function(e,t,r){if(arguments.length<=2)return console.error("请输入指令和消息");if("string"!=typeof e)return!1;r=r||"broadcast";return JSON.stringify({cmd:e,msg:JSON.stringify(t),type:r})},t.prototype._handleReceivedParams=function(e){var t,r=e;if("string"==typeof e)try{r=JSON.parse(e)}catch(e){n.debug("_handleReceivedParams ==> parse JSON Error!")}try{t=JSON.parse(r.msg)}catch(e){t=r.msg}return{cmd:r.cmd,msg:t}},t.prototype.sendMessage=function(e,t,r){var i=this;this.queue.push(this._handleParams(e,t,r)),this.timer||(this.timer=setInterval(function(){if(0===i.queue.length)return clearInterval(i.timer),i.timer=null,!1;n.debug("TalkFun ==> iFrame postMessage",e,t,r),parent.window.postMessage(i.queue.shift(),"*")},100))},t.prototype.receiveMessage=function(t){var r=this;return this._hasListened||(window.attachEvent?window.attachEvent("onmessage",function(e){t&&t.call(r,r._handleReceivedParams(e.data))}):window.addEventListener("message",function(e){t&&t.call(r,r._handleReceivedParams(e.data))}),this._hasListened=!0),this},t}.call(t,r,t,e))||(e.exports=i)},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(76)),a=i(r(77)),o=i(r(78)),s=i(r(79)),l=i(r(80)),u=i(r(81)),d={vote_v2:n.default,vote:a.default,flower:o.default,lottery:s.default,iframe:l.default,marker:u.default};t.default=d},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(3)),a=i(r(9)),o=(i(r(5)),i(r(1))),s={voteUrl:n.default.APP_HOST+"/live/vote.php",userVoteUrl:n.default.APP_HOST+"/live/liveEvent.php",voteImgUrl:n.default.APP_HOST+"/live/vote.php?action=uploadPic",room:null,packet:null,setData:function(e){this.packet=e},init:function(e){this.room=e},voteAjax:function(e,t,r){o.default.ajax({type:"GET",data:t,url:e,dataType:"jsonp",success:function(e){o.default.callback(r,e)}})},publish:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteUrl,{access_token:a.default.getAccessToken(),action:"addVoteEvent",title:e.title?e.title:"",label:e.label?e.label:"",type:e.type?e.type:1,optional:e.optional?e.optional:1,op:e.op?e.op:"",imageUrl:e.imageUrl?e.imageUrl:"",answer:e.answer?e.answer:""},function(e){e&&0==e.code?t(e):r(e)})})},publishPreVote:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteUrl,{access_token:a.default.getAccessToken(),action:"emitVoteEvent",vid:e.vid},function(e){e&&0==e.code?t(e):r(e)})})},saveVote:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteUrl,{access_token:a.default.getAccessToken(),action:"saveVoteEvent",title:e.title?e.title:"",label:e.label?e.label:"",type:e.type?e.type:1,optional:e.optional?e.optional:1,op:e.op?e.op:"",imageUrl:e.imageUrl?e.imageUrl:"",answer:e.answer?e.answer:""},function(e){e&&0==e.code?t(e):r(e)})})},editVote:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteUrl,{access_token:a.default.getAccessToken(),action:"saveVoteEvent",title:e.title?e.title:"",label:e.label?e.label:"",type:e.type?e.type:1,optional:e.optional?e.optional:1,op:e.op?e.op:"",vid:e.vid,imageUrl:e.imageUrl?e.imageUrl:"",answer:e.answer?e.answer:""},function(e){e&&0==e.code?t(e):r(e)})})},uploadImg:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteImgUrl,{access_token:a.default.getAccessToken(),image:e},function(e){0==e.code?t(e):r(e)})})},voteList:function(){var e=this;return new Promise(function(t,r){e.voteAjax(e.voteUrl,{access_token:a.default.getAccessToken(),action:"getVoteEvent"},function(e){0==e.code?t(e):r(e)})})},voteDetail:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteUrl,{access_token:a.default.getAccessToken(),action:"getVoteList",vid:e.vid||"",page:e.page||1},function(e){e&&0==e.code?t(e):r(e)})})},postVote:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteUrl,{access_token:a.default.getAccessToken(),action:"vote",option:"["+e.option.join(",")+"]"||!1,vid:e.vid},function(e){e&&0==e.code?t(e):r(e)})})},endVote:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteUrl,{access_token:a.default.getAccessToken(),action:"endVoteEvent",publicVote:e.publicVote||0,vid:e.vid},function(e){e&&0==e.code?t(e):r(e)})})},delVote:function(e){var i=this;return new Promise(function(t,r){i.voteAjax(i.voteUrl,{access_token:a.default.getAccessToken(),action:"delVote",vid:e.vid},function(e){e&&0==e.code?t(e):r(e)})})}};t.default=s},function(e,t,r){"use strict";var i;void 0===(i=function(e){r(2);var t=r(3),i=r(9),g=r(24),m=r(1);return{voteUrl:t.APP_HOST+"/live/vote.php",access_token:null,ajax:m.ajax,packet:null,nativeCall:function(i,n){m.debug("原生投票调用",i);if("vote:post:data"===i.cmd){var e={vid:i.args.vid,options:i.args.options};this.postVote(e,function(e){if(m.debug("发送投票",e),e){var t=parseInt(e.code),r=e;r=0===t?e:"投票失败(错误代码:"+t+")",n({acks:i.acks,response:{code:t,data:r}})}})}else if("vote:get:data"===i.cmd){var t=i.args.vid;this.getVoteDetail(t,function(e){if(e){m.debug("获取投票",e);var t=parseInt(e.code),r={};r=0===t?e:{msg:e.msg},n({acks:i.acks,response:{code:t,data:r}})}})}},voteLock:!1,postVote:function(f,h){var p=this;if(p.voteLock)return!1;p.voteLock=!0;var e={vid:f.vid,action:"vote",option:f.options,access_token:i.getAccessToken()};m.ajax({type:"GET",url:p.voteUrl,data:e,dataType:"jsonp",success:function(e){m.callback(h,e);var t=p.room.user.xid||"-1",r=p.room.user.uid||"-1",i="",n=f.vid;p.packet&&(n=p.packet.args.vid,i=p.packet.args.info.answer);for(var a=!1,o=JSON.parse(f.options),s=[],l={1:"A",2:"B",3:"C",4:"D",5:"E",6:"F",7:"G",8:"H"},u=0;u<o.length;u++)s.push(l[o[u]]);s=s.sort();var d=i.split(",");d=d.sort(),e.data&&(a=0===e.data.answer.length?-1:!!e.data.isRight);var c={t:"vote:new",type:"callback",args:{xid:t,uid:r,vid:n,rightAns:i,res:e,isRight:a}};g.default.send(c),p.voteLock=!1},error:function(){p.voteLock=!1}})},getVoteDetail:function(e,t){var r=i.getAccessToken();m.ajax({type:"GET",data:"access_token="+r+"&action=getVoteList&vid="+e,url:this.voteUrl,dataType:"jsonp",success:function(e){m.callback(t,e)}})},setData:function(e){this.packet=e},init:function(e){this.room=e}}}.call(t,r,t,e))||(e.exports=i)},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(r(2)),n=i(r(3)),a=i(r(9)),s=i(r(16)),l=i(r(1)),u={flowerUrl:n.default.APP_HOST+"/live/flower.php",access_token:a.default.getAccessToken(),ajax:l.default.ajax,initData:null,defaults:{amount:0,duration:0,passTime:0,leftTime:0},flowerDuration:0,flowerTimer:null,nativeCall:function(e,t){if(!l.default.isInNative())return!1;window.SDK&&SDK.call(e,t)},flowerCountdown:function(e,t){var r=this,i=(t=t||"",e.data);if(clearTimeout(r.flowerTimer),r.defaults.amount="get"===t?i.amount||0:"send"===t?i.left_amount||0:i.amount,r.defaults.duration=i.time_interval,r.defaults.passTime=i.pass_time,r.defaults.leftTime=i.left_time,3<=r.defaults.amount)return!1;var n=r.defaults.passTime;l.default.debug("鲜花统计时间过去====> "+n);var a=0;!function t(){0<=n&&(r.flowerTimer=setTimeout(function(){var e=parseInt(n/r.defaults.duration,10);if(0<e&&e<=3)a!==e&&(r.defaults.amount=e,o.default.get("flower:total")(e),r.nativeCall("flower:total",{total:e}),a=e);else if(3<=e)return clearTimeout(r.flowerTimer),!1;n+=1,r.defaults.passTime=n,t()},1e3))}()},flowerStop:function(){this.defaults.amount=0,this.defaults.duration=0,this.defaults.passTime=0,this.defaults.leftTime=0,clearTimeout(this.flowerTimer)},flowerCallback:function(e){if(e.code===n.default.CODE_SUCCESS){this.flowerDuration=e.data.time_interval,this.flowerCountdown(e,"get");var t={code:e.code,amount:e.data.amount};o.default.get("flower:get:init")(t),this.nativeCall("flower:get:init",t)}else if(1202===e.code){t={code:e.code,msg:e.msg};this.flowerStop(),o.default.get("flower:get:init")(t),this.nativeCall("flower:get:init",t)}else if(15e3===e.code){t={code:e.code,leftTime:e.data.left_time};o.default.get("flower:time:left")(t),this.nativeCall("flower:time:left",t),this.flowerCountdown(e)}else o.default.get("flower:load:error")(e)},getFlower:function(t){l.default.debug("Plugins: flower init...");var r=this;r.initFlower?(r.flowerCallback(r.initFlower),r.initFlower=null):l.default.ajax({type:"GET",url:r.flowerUrl,dataType:"jsonp",data:{act:"myflower",access_token:a.default.getAccessToken()},success:function(e){r.flowerCallback(e),t&&t(e)}})},sendFlower:function(){var r=this;if(0===r.defaults.amount){var e={code:15e3,leftTime:r.defaults.duration-r.defaults.passTime};return o.default.get("flower:time:left")(e),r.nativeCall("flower:time:left",e),!1}l.default.ajax({type:"GET",url:r.flowerUrl,data:{act:"send",access_token:a.default.getAccessToken()},dataType:"jsonp",success:function(e){if(e.code===n.default.CODE_SUCCESS){r.flowerDuration=e.data.time_interval,r.flowerCountdown(e,"send");var t={code:e.code,amount:0};o.default.get("flower:get:init")(t),r.nativeCall("flower:get:init",t),e.data=s.default.dealMemberAvatar(e.data),l.default.isMobileSDK()&&2==l.default.getSDKMode()?window.SDK.broadcast({cmd:"flower:send",args:e.data}):o.default.get("flower:send")(e.data)}else if(1202===e.code){t={code:e.code,msg:e.msg};r.flowerStop(),o.default.get("flower:get:init")(t),r.nativeCall("flower:get:init",t)}else if(15e3===e.code){t={code:e.code,leftTime:e.data.left_time};r.flowerDuration=e.data.time_interval,o.default.get("flower:time:left")(t),r.nativeCall("flower:time:left",t),r.flowerCountdown(e)}}})}};t.default=u},function(e,t,r){"use strict";var i;void 0===(i=function(e){return{}}.call(t,r,t,e))||(e.exports=i)},function(e,t,i){"use strict";var r;void 0===(r=function(e){var r=i(2);return{on:function(e,t){r.put("talkfuniframe:"+e,t)},trigger:function(e,t){r.get("talkfuniframe:"+e)(t)}}}.call(t,i,t,e))||(e.exports=r)},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=i(r(5)),n=i(r(1)),a={idTimer:null,conId:null,markContent:null,randomPosition:function(){var i=this;this.idTimer&&window.clearTimeout(this.idTimer);!function r(){i.idTimer=setTimeout(function(){var e=document.querySelector("#t-m-ran");if(!e)return i.createMark(i.conId,i.markContent),!1;var t=i.getRan();e.style.top=t.r1,e.style.left=t.r2,r()},600*Math.abs((1*Math.random()).toFixed(1))*1e3)}()},getRan:function(){var e=["5%","8%","12%","22%","31%","43%","50%","60%","70%","80%","85%"],t=Math.floor(Math.random()*e.length),r=Math.floor(Math.random()*e.length);return{r1:e[t],r2:e[r]}},destroy:function(){if(this.idTimer){window.clearTimeout(this.idTimer),this.idTimer=null;var e=document.querySelector("#t-m-ran");e&&e.parentNode.removeChild(e)}},createMark:function(e,t){if(e){this.conId=e,this.markContent=t;var r=document.querySelector(e),i=document.querySelector("#t-m-ran");if(r&&!i){var n=document.createElement("span"),a=l.default.getters("getInitData"),o=0;a&&a.user&&a.user.uid&&(o=a.user.uid);var s=this.getRan();n.innerHTML=t||o,n.className="t-id-ctx",n.id="t-m-ran",n.style.cssText="\n          position:absolute; \n          padding: 5px;\n          z-index: 1500;\n          top: ".concat(s.r1,";\n          left: ").concat(s.r2,";\n          color: rgba(202, 202, 202, 0.6);\n          font-size: 12px;\n        "),r.appendChild(n),this.randomPosition(n)}}},init:function(e,t,r){n.default.debug("marker init ==>",e,t),this.createMark(e,t,r)}};t.default=a},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(9)),a=(i(r(2)),i(r(3))),o=i(r(1)),s={latestParseObj:{},toUBB:function(e){return e=e.replace(/<img.*?src="(.*)?".*?\/>/,"[IMG]$1[/IMG]")},toHTML:function(e){return e=e.replace(/\[IMG\]([^\[]*)\[\/IMG\]/gi,function(e,t){return'<img class="clip" src="'+t+'" />'})},showImageFullSize:function(e,t){e&&t&&"function"==typeof t&&t(e.replace(/_s/g,""))},onpaste:function(e,t){for(var r=window.URL||window.webkitURL,i=(e.clipboardData||e.originalEvent.clipboardData).items,n=0;n<i.length;n++){var a=i[n];if(-1<a.type.indexOf("image")){var o=a.getAsFile(),s=r.createObjectURL(o),l=new FileReader;this.latestParseObj=o,t(s),l.readAsDataURL(o)}}},postClipPhoto:function(e){e&&"function"==typeof e&&this.uploadFile(this.latestParseObj,e)},uploadFile:function(e,t){var r=new FormData;r.append("Filedata",e);var i=new XMLHttpRequest;i.upload.onprogress=function(e){var t=e.loaded/e.total*100;o.default.debug("chat image Uploaded "+t+"%")},i.onload=function(){200==i.status?t&&t(JSON.parse(i.responseText)):t&&t("Error! Upload failed")},i.onerror=function(){t&&t("Error! Upload failed. Can not connect to server.")},i.open("POST",a.default.PROTOCOL+"fp2.talk-fun.com/live/api/uploadImage.php?access_token="+n.default.getAccessToken(),!0),i.send(r)},danmakuHandle:function(t,e){switch(t.eventName){case"danmaku:open":e.getPlayer(function(e){e.jsCallFlash("danmaku:open","")});break;case"danmaku:close":e.getPlayer(function(e){e.jsCallFlash("danmaku:close","")});break;case"danmaku:set:color":e.getPlayer(function(e){e.jsCallFlash("danmaku:set:color",{color:t.data.color})})}},danmaku:function(e,t){if(o.default.isMobile())return!1;var r=e.args.msg||e.args.data.msg,i=[],n={c:r};i.push(n),i=JSON.stringify(i),t.getPlayer(function(e){e.jsCallFlash("user:chat:data",i)})}};t.default=s},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(10)),a=i(r(6)),o={room:null,liveData:null,playNumber:0,bn:0,action:"wait",logTimer:null,cid:0,setData:function(e){(this.room=e).InitData&&e.InitData.action&&(this.action=e.InitData.action),e.live&&e.live.id&&(this.liveid=e.live.id),e.course&&(this.liveData=e.course)},start:function(){this.liveStatis()},stop:function(){this.logTimer&&window.clearInterval(this.logTimer)},liveStatis:function(){var e=this,t=this.room.user,r="",i=navigator.userAgent.toLowerCase();r=-1<i.indexOf("ios-sdk")?"ios-sdk":-1<i.indexOf("android-sdk")?"android-sdk":"html",n.default.play({xid:t.xid,uid:t.uid,pid:t.partner_id,rid:t.roomid,cid:e.liveid,courseId:e.liveData&&e.liveData.course_id||0,pf:r,pt:1,pl:"start"===e.action?1:0,cbt:0,bn:e.bn||0,ba:e.ba||0,type:a.default.playStatus,pn:e.playNumber}),e.bn=0,e.ba=0,e.logTimer=setTimeout(function(){++e.playNumber,e.liveStatis()},1e3*e.room.heartbeatInterval||18e4)}},s=window.__ss=o;t.default=s},function(e,t,i){"use strict";var r;void 0===(r=function(e){var r=i(1),t={isLoaded:!1,queueArys:[],queueHash:{},runner:null,join:function(e,t){r.debug("sync event join ==>",e),this.queueHash[e]||((this.queueHash[e]=t).key=e,this.queueArys.push(this.queueHash[e])),this.isLoaded&&this.run()},run:function(){var t=this;0<this.queueArys.length&&(this.runner||(this.runner=setInterval(function(){var e=t.queueArys.shift();if(e&&(r.debug("sync event fire ==>",e.key),e.callback.call(e.parent)),0===t.queueArys.length)return clearInterval(t.runner),t.runner=null,!1},100)))}};return window.__fire=t}.call(t,i,t,e))||(e.exports=r)},function(e,t,r){"use strict";var i;void 0===(i=function(e){r(1);var t={storage:{},timmer:{},defaultConfig:{min_run_num:1,now_num:0,max_queue_time:3e4,max_queue_len:1e3,callback:function(){}},config:{},queueRunRate:200,init:function(e,t){if(void 0===this.storage[e]){for(var r in this.storage[e]=[],this.config[e]||(this.config[e]={}),this.defaultConfig)this.config[e][r]||(this.config[e][r]=this.defaultConfig[r]);if(t)for(var r in t)this.config[e][r]=t[r];this.start(e)}},add:function(e,t){if(this.storage[e].length>=this.config[e].max_queue_len)return!1;this.storage[e].push(t)},addBat:function(e,t){for(var r in t)this.add(e,t[r])},run:function(e){var t=this,r=t.storage[e].length,i=parseInt(r/(t.config[e].max_queue_time/t.queueRunRate)),n=Math.min(Math.max(t.config[e].min_run_num,i,t.config[e].now_num),r);n>t.config[e].min_run_num&&n>t.config[e].now_num&&(t.config[e].now_num=n,t.timmer[e+"_now_num"]=setTimeout(function(){t.config[e].now_num=0},t.config[e].max_queue_time));for(var a=1;a<=n;a++){var o=t.storage[e].shift();t.config[e].callback(o)}},start:function(e){var t=this;t.timmer[e]=setInterval(function(){t.run(e)},t.queueRunRate)},stop:function(e){this.timmer[e]&&(clearInterval(this.timmer[e]),this.timmer[e]=null)}};return window.queue=t}.call(t,r,t,e))||(e.exports=i)},function(e,t,r){"use strict";e.exports={latest:"4.8"}},function(e,t,r){"use strict";var i=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(r(4)),s=i(r(1)),l=i(r(3)),n=i(r(2)),a={action:"stop",livePlayerLoaded:!1,mainPlayerId:null,containerId:null,playerId:null,playerCallback:null,userPullList:null,room:null,me:null,zhuboSmallRtmp:null,isOnline:!1,flash:null,init:function(e){s.default.debug("liveCamera init data ==> ",e),e.status&&"stop"!==e.status&&this.state("start");var t={};if(e.upUsers&&(t=s.default.assignObject(e.upUsers,t)),e.small_rtmp){var r={};r[e.small_rtmp.xid]=e.small_rtmp,this.zhuboSmallRtmp=r,t=s.default.assignObject(t,r)}this.userPullList=t},whiteboard:function(e){var t=e.args;t.args&&t.args.t&&"start"===t.args.t&&t.small_rtmp&&this.init(t)},initPlayer:function(){var e;if(!this.livePlayerLoaded)return!1;this.room&&(this.me=this.room.curUser),s.default.debug("livePlayer-init."),e=this.room.userCamera?this.room.userCamera:{},s.default.debug("userCamera Data===>",e),this.doLiveCamera(e)},doLiveCamera:function(e){if(e.upUsers){var t=null,r=null,i=this.room.curUser.xid;if(e.upUsers[i]&&"up"==e.status){this.isOnline=!0;var n=e.upUsers[i];t=n.rtmp.path,r=n.rtmp.server_push,this.cameraPush(r,t),this.userPullList&&this.userPullList[i]&&delete this.userPullList[i]}this.cameraPull()}},cameraPush:function(t,r){var i=this;this.getPlayer(function(e){s.default.debug("push camera ==> ",t,r),i.flash().jsCallFlash("live:player:open:camera","","livePlayer"),e.cameraPublish(t,r)})},cameraPull:function(){var e=this.isOnline;this.flash&&(s.default.debug("camera pull ==> ",this.userPullList,e),e?this.flash().jsCallFlash("live:player:packet",this.userPullList,"cameraPlayer"):this.flash().jsCallFlash("live:player:stream",l.default.CAMERA_URL_STREAM,"cameraPlayer"))},dispatch:function(r){var e=r.args||null;switch(s.default.qtWebEngine(function(e){var t={act:r.cmd};e.JSSendMessage(JSON.stringify(t))}),r.cmd){case"rtc:start":this.state("start");break;case"rtc:up":e&&this.up(e);break;case"rtc:down":e&&this.down(e);break;case"rtc:stop":e&&this.stop(e),this.state("stop");break;case"rtc:cancel":this.down(e);break;case"rtc:kick":e&&this.down(e);break;case"rtc:check:state":this.checkDeviceState(r);break;case"rtc:invite":this.invite(e)}},isMe:function(e){var t=this.room.curUser.xid;return"string"==typeof e.xid&&(t=this.room.curUser.xid.toString()),!(!e||!e.xid||e.xid!==t)},add:function(e){this.userPullList||(this.userPullList={}),this.userPullList[e.xid]||(this.userPullList[e.xid]=e)},remove:function(e){this.userPullList&&this.userPullList[e.xid]&&(delete this.userPullList[e.xid],this.flash&&this.flash().jsCallFlash("live:player:delete",{xid:e.xid},"cameraPlayer"))},invite:function(){},up:function(e){if(e&&e.rtmp){var t=e.rtmp.path,r=e.rtmp.server_push;e.rtmp.server_get;this.isMe(e)?(this.isOnline=!0,this.cameraPush(r,t)):this.add(e),this.cameraPull()}},down:function(e,t){this.remove(e),(this.isMe(e)||t)&&(this.playerStop(),this.isOnline=!1,this.cameraPull()),this.cameraPull()},playerStop:function(){if("start"!==this.action)return!1;this.flash&&(s.default.debug("stop & close all media..."),this.flash().jsCallFlash("live:player:stop","","cameraPlayer"),this.flash().jsCallFlash("live:player:stop","","livePlayer"),this.flash().jsCallFlash("live:player:close:camera","","livePlayer"))},forceOut:function(e){e&&e(),this.stop()},clear:function(){this.playerStop(),this.userPullList=that.zhuboSmallRtmp},stop:function(e){this.playerStop(),e&&this.down(e,!0),this.isOnline=!1,this.userPullList=this.zhuboSmallRtmp,this.room&&(this.room.userCamera.upUsers=null,this.room.userCamera.applyList=[])},state:function(e){s.default.debug("live camera action ==> "+e),this.action=e},kick:function(e){this.down(e)},setUserCamera:function(){var e,t,r,i={},n=arguments,a=this.room.access_token;if(s.default.debug("===>usercamera args",n),!(0<n.length))return!1;3===n.length?(e=n[0],r="function"==typeof n[2]?r=n[2]:function(){},"string"==typeof n[1]||"number"==typeof n[1]?i={act:e,xid:n[1],access_token:a}:"object"===(0,o.default)(n[1])&&(i={act:e,xid:(t=n[1]).xid,broad:t.broad,access_token:a})):2===n.length&&(r="function"==typeof n[1]?r=n[2]:function(){},i={act:e=n[0],access_token:a}),s.default.ajax({type:"GET",url:l.default.APP_HOST+"/live/webrtc.php",dataType:"jsonp",data:i,success:function(e){s.default.debug("userCamera post ===>",e),e&&s.default.callback(r,e)},error:function(){r("error")}})},checkDeviceState:function(e){this.flash&&(e.callback&&n.default.put("live:player:check:microphone:state",e.callback),this.flash().jsCallFlash("live:player:check:microphone:state","","livePlayer"))},setPlayer:function(t){var r=this;!function e(){if(r.livePlayerLoaded)return"function"==typeof t&&t(s.default.getFlash(r.mainPlayerId)),s.default.getFlash(r.mainPlayerId);setTimeout(function(){e()},200)}()},getPlayer:function(e){this.setPlayer(e)},createPlayer:function(t,e,r){var i=this;t=t||i.containerId,e=e||i.playerId,r=r||i.playerCallback,s.default.debug("render liveplayer ==> ",document.querySelector("#"+t),t,e);var n=document.querySelector("#"+t),a=0;n?i.render():function(){s.default.debug("liveplayer self call ==> "+t);var e=arguments;if(10<a)return s.default.debug("liveplayer create faild!");setTimeout(function(){document.querySelector("#"+t)?i.render():e.callee(),a++},300)}()},render:function(){return!1},livePlayerCallback:function(){var e=null,t=this;e=setInterval(function(){!function(){if(t.livePlayerLoaded)clearInterval(e)}()},400)}},u=window.__lp=a;t.default=u}]).default;